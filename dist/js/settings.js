/*! (c) Philipp KÃ¶nig under GPL-3.0 */
window.Colorpicker=(()=>{"use strict";function e(){this.r=0,this.g=0,this.b=0,this.a=1,this.hue=0,this.saturation=0,this.value=0;let e=e=>"number"==typeof e&&!1===isNaN(e),t=(t,a,s,l)=>{e(t)&&e(a)&&e(s)&&(this.r=Math.max(0,Math.min(255,Math.trunc(t))),this.g=Math.max(0,Math.min(255,Math.trunc(a))),this.b=Math.max(0,Math.min(255,Math.trunc(s))),!0===e(l)&&(this.a=Math.max(0,Math.min(1,l))))},a=e=>{let a=e.match(/(\d*\.\d*|\d+)/g);3===a.length&&a.push(1),4===a.length&&(t(...a.map(e=>+e)),o())},s=e=>{/(^#{0,1}[0-9A-F]{6}$)|(^#{0,1}[0-9A-F]{3}$)/i.test(e)&&("#"===e[0]&&(e=e.slice(1,e.length)),3===e.length&&(e=e.replace(/([0-9A-F])([0-9A-F])([0-9A-F])/i,"$1$1$2$2$3$3")),this.r=parseInt(e.substr(0,2),16),this.g=parseInt(e.substr(2,2),16),this.b=parseInt(e.substr(4,2),16),this.a=1,o())},l=()=>{let e=this.saturation/100,a=this.value/100,s=e*a,l=this.hue/60,o=s*(1-Math.abs(l%2-1)),n=a-s;s=Math.trunc(255*(s+n)),o=Math.trunc(255*(o+n)),n=Math.trunc(255*n),l>=0&&l<1?t(s,o,n):l>=1&&l<2?t(o,s,n):l>=2&&l<3?t(n,s,o):l>=3&&l<4?t(n,o,s):l>=4&&l<5?t(o,n,s):l>=5&&l<6&&t(s,n,o)},o=()=>{let e=this.r/255,t=this.g/255,a=this.b/255,s=Math.max(e,t,a),l=s-Math.min(e,t,a),o=0,n=0;l&&(s===e&&(o=(t-a)/l),s===t&&(o=2+(a-e)/l),s===a&&(o=4+(e-t)/l),s&&(n=l/s)),this.hue=Math.trunc(60*o),this.hue<0&&(this.hue+=360),this.saturation=Math.trunc(100*n),this.value=Math.trunc(100*s)};this.setFromRaw=(e=>{"transparent"===(e=e.trim())?(this.r=0,this.g=0,this.b=0,this.a=0,o()):/(^#{0,1}[0-9A-F]{6}$)|(^#{0,1}[0-9A-F]{3}$)/i.test(e)?s(e):/^rgba?\([^)]+\)$/i.test(e)&&a(e)}),this.setByName=((t,a)=>{if(("r"===t||"g"===t||"b"===t||"a"===t)&&e(a)){let e=1;"a"!==t&&(a=Math.trunc(a),e=255),this[t]=Math.max(0,Math.min(e,a)),o()}}),this.setHSV=((t,a,s)=>{e(t)&&e(a)&&e(s)&&(this.hue=Math.max(0,Math.min(360,t)),this.saturation=Math.max(0,Math.min(100,a)),this.value=Math.max(0,Math.min(100,s)),l())}),this.setHue=(t=>{e(t)&&(this.hue=Math.max(0,Math.min(360,t)),l())}),this.getHex=(()=>{let e=this.r.toString(16),t=this.g.toString(16),a=this.b.toString(16);return this.r<16&&(e="0"+e),this.g<16&&(t="0"+t),this.b<16&&(a="0"+a),("#"+e+t+a).toLowerCase()}),this.getColor=(()=>{if(1===Math.trunc(this.a))return this.getHex();let e="("+this.r+","+this.g+","+this.b,t="",a="",s=parseFloat(this.a);return 1!==s&&(t="a",a=","+s),"rgb"+t+e+a+")"})}return function(t,a){a=a||{};let s=null,l=null,o=null,n=[],r={};this.color=new e;let i=(e,t)=>{e.addEventListener("mousedown",e=>{t(e),document.addEventListener("mousemove",t)}),document.addEventListener("mouseup",()=>{document.removeEventListener("mousemove",t)})},p=()=>{(s=document.createElement("div")).className="color-picker",document.body.appendChild(s),(l=document.createElement("span")).className="color-preview",t.parentNode.insertBefore(l,t.nextSibling),t.ownerDocument.defaultView.addEventListener("resize",()=>{this.reposition()}),l.addEventListener("click",e=>{e.preventDefault(),e.stopPropagation(),this.show()}),document.addEventListener("click",e=>{e.target===s||s.contains(e.target)||this.close()})},c=()=>{let e=document.createElement("div"),t=document.createElement("div");e.className="picking-area",t.className="picker",this.pickingArea=e,this.colorPicker=t,i(e,e=>{let t=this.pickingArea.getBoundingClientRect(),a=this.pickingArea.clientWidth,s=[e.pageX-t.left,e.pageY-t.top];s.forEach((e,t)=>{e>a&&(e=a),e<0&&(e=0),s[t]=e});let l=Math.trunc(100*s[0]/a),o=100-Math.trunc(100*s[1]/a);this.color.setHSV(this.color.hue,l,o),this.colorPicker.style.left=s[0]-5+"px",this.colorPicker.style.top=s[1]-5+"px",k(),y(),x()}),e.appendChild(t),s.appendChild(e)},d=()=>{let e=document.createElement("div"),t=document.createElement("div");e.className="hue",t.className="slider-picker",this.hueArea=e,this.huePicker=t,i(e,e=>{let t=this.hueArea.getBoundingClientRect(),a=Math.max(0,e.pageX-t.left),s=this.hueArea.clientWidth;a>s&&(a=s),this.huePicker.style.left=Math.max(a-3,-2)+"px",this.color.setHue(Math.trunc(359*a/s)),g()}),e.appendChild(t),s.appendChild(e)},h=()=>{let e=document.createElement("div"),t=document.createElement("div"),a=document.createElement("div");e.className="alpha",t.className="alpha-mask",a.className="slider-picker",o={area:e,mask:t,picker:a},i(e,e=>{let t=o.area.getBoundingClientRect(),a=e.pageX-t.left,s=o.area.clientWidth;a<0&&(a=0),a>s&&(a=s),this.color.setByName("a",+(a/s).toFixed(2)),o.picker.style.left=Math.max(a-3,-2)+"px",y(),x()}),e.appendChild(t),t.appendChild(a),s.appendChild(e)},m=(e,t)=>{let a=document.createElement("div"),l=document.createElement("input"),o=document.createElement("span");a.className="input-"+e,o.textContent=e,l.setAttribute("type","text"),a.appendChild(o),a.appendChild(l),s.appendChild(a),l.addEventListener("change",t),n[e]=(e=>{l.value=e})},g=()=>{x(),v(),f(),u(),b(),k(),y()},u=()=>{let e=this.pickingArea.clientWidth,t=this.color.value,a=Math.trunc(this.color.saturation*e/100),s=e-Math.trunc(t*e/100);this.colorPicker.style.left=a-5+"px",this.colorPicker.style.top=s-5+"px"},v=()=>{let e=this.hueArea.clientWidth,t=Math.trunc(this.color.hue*e/360);this.huePicker.style.left=t-1+"px"},b=()=>{if(o){let e=o.area.clientWidth,t=Math.trunc(this.color.a*e);o.picker.style.left=t-1+"px"}},f=()=>{let t=new e;t.setHSV(this.color.hue,100,100),this.pickingArea.style.backgroundColor=t.getHex()},k=()=>{o&&(o.mask.style.background="linear-gradient(to right, transparent 0%,"+this.color.getHex()+" 100%)")},y=()=>{t.value=this.color.getColor(),l.style.backgroundColor=this.color.getColor(),w("change")},w=e=>{void 0!==r[e]&&r[e].forEach(e=>{e({color:this.color.getColor(),colorObj:this.color,elm:this.getElements()})})},x=()=>{C("r",this.color.r),C("g",this.color.g),C("b",this.color.b),C("a",this.color.a),C("color",this.color.getColor())},C=(e,t)=>{n[e]&&n[e](t)};this.setColor=(e=>{this.color.setFromRaw(e),g()}),this.getColorObj=(()=>this.color),this.getElements=(()=>({wrapper:s,preview:l,field:t})),this.reposition=(()=>{if(s.classList.contains("visible")){let e=["bottom","left"],t=l.getBoundingClientRect(),a=t.top+l.offsetHeight,o=t.left;s.offsetHeight+a>window.innerHeight&&(a=t.top-s.offsetHeight,e[0]="top"),s.offsetWidth+o>window.innerWidth&&(o=t.left-s.offsetWidth+l.offsetWidth,e[1]="right"),s.setAttribute("data-pos",e.join("-")),s.style.top=a+"px",s.style.left=o+"px"}}),this.show=(()=>{[].forEach.call(document.getElementsByClassName("color-picker"),e=>{e.classList.remove("visible")}),s.classList.add("visible"),this.reposition(),w("show"),g()}),this.close=(()=>{s.classList.contains("visible")&&(w("hide"),s.classList.remove("visible"))}),this.on=((e,t)=>{void 0===r[e]&&(r[e]=[]),r[e].push(t)}),(()=>{p(),c(),d();let e=["r","g","b"];a.alpha&&(h(),e.push("a")),e.forEach(e=>{m(e,t=>{let a=t.target.value;a="a"===e?+a.replace(/,/g,"."):parseInt(a),this.color.setByName(e,a),t.target.value=this.color[e],g()})}),m("color",e=>{let t=e.target.value;this.color.setFromRaw(t),g()}),g()})()}})(),(e=>{"use strict";window.CheckboxHelper=function(t){let a={};this.get=((a,s,l="checkbox",n="default")=>{let r=e("<div />").html("<input type='checkbox' />").data("uid",Math.random().toString(36).substr(2,12)).attr(t.opts.attr.type,l).attr(t.opts.attr.style,n).addClass(t.opts.classes.checkbox.box);return s&&(r.children("input[type='checkbox']").attr(s),s[t.opts.attr.name]&&r.attr(t.opts.attr.name,s[t.opts.attr.name])),this.isChecked(r)&&r.addClass(t.opts.classes.checkbox.active),o(r,a),r}),this.isChecked=(e=>e.find("input[type='checkbox']")[0].checked);let s=(e,a)=>{let s=e.children("input[type='checkbox']");s.trigger("change"),t.opts.events&&t.opts.events.checkboxChanged&&t.helper.utility.triggerEvent("checkboxChanged",{container:e,checkbox:s,checked:e.hasClass(t.opts.classes.checkbox.active)},a.document()[0])},l=(o,n)=>{o.addClass(t.opts.classes.checkbox.clicked),o.removeClass(t.opts.classes.checkbox.focus),o.toggleClass(t.opts.classes.checkbox.active);let r=o.hasClass(t.opts.classes.checkbox.active),i=o.children("input[type='checkbox']");if("radio"===o.attr(t.opts.attr.type)&&o.attr(t.opts.attr.name))if(n){let a=o.attr(t.opts.attr.name);o.addClass(t.opts.classes.checkbox.active),r&&(i.attr("checked",!0),s(o,n)),n.find("div."+t.opts.classes.checkbox.box+"["+t.opts.attr.type+"='radio']["+t.opts.attr.name+"='"+a+"']").forEach(t=>{let a=e(t);t!==o[0]&&this.isChecked(a)&&l(a)})}else i.attr("checked",!1);else i.attr("checked",r),s(o,n);let p=o.data("uid");a[p]&&clearTimeout(a[p]),a[p]=setTimeout(()=>{o.removeClass(t.opts.classes.checkbox.clicked)},300)},o=(a,s)=>{a.on("mousedown",a=>{a.preventDefault(),a.stopPropagation(),e(a.currentTarget).addClass(t.opts.classes.checkbox.focus)}).on("click",t=>{t.preventDefault(),t.stopPropagation(),l(e(t.currentTarget),s)}),s.on("click",()=>{a.removeClass(t.opts.classes.checkbox.focus)})}},window.AppearanceHelper=function(t){let a={sidebar:{template:"sidebar",styles:["sidebar"]},general:{template:"sidebar",styles:["sidebar"]},overlay:{template:"overlay",styles:["overlay"]},indicator:{template:"indicator",styles:["contentBase","content"]}},s=null,l=null;this.init=(()=>new Promise(a=>{g().then(()=>{["darkMode"].forEach(e=>{let a=!1;!0===t.helper.model.getData("a/"+e)&&(t.opts.elm.checkbox[e].trigger("click"),a=!0),t.opts.elm.checkbox[e].children("input").data("initial",a)});let s=t.helper.model.getData("u/customCss");t.opts.elm.textarea.customCss[0].value=s,t.opts.elm.textarea.customCss.data("initial",s),t.opts.elm.textarea.customCss.parent().append("<span>"+t.helper.i18n.get("settings_not_synced")+"</span>");let l=t.helper.model.getData("a/styles");Object.keys(l).forEach(e=>{let a=l[e];t.opts.elm.range[e]?(t.opts.elm.range[e][0].value=a.replace("px",""),t.opts.elm.range[e].data("initial",a.replace("px","")),t.opts.elm.range[e].trigger("change")):t.opts.elm.color[e]?(o(t.opts.elm.color[e],a),t.opts.elm.color[e].data("initial",t.opts.elm.color[e][0].value)):t.opts.elm.select[e]?("fontFamily"===e&&0===t.opts.elm.select[e].children("option[value='"+a+"']").length()&&(a="default"),t.opts.elm.select[e][0].value=a,t.opts.elm.select[e].data("initial",a)):t.opts.elm.radio[e]&&(t.opts.elm.radio[e][0].value=a,t.opts.elm.radio[e].trigger("change"),t.opts.elm.radio[e].data("initial",a))}),u(),e.delay(100).then(()=>{r(),a()})})})),this.save=(()=>new Promise(e=>{let a=h();chrome.storage.sync.set({appearance:a.appearance},()=>{chrome.storage.local.get(["utility"],s=>{let l=s.utility||{};l.customCss=a.utility.customCss,chrome.storage.local.set({utility:l},()=>{t.helper.model.call("reloadIcon"),e()})})})}));let o=(e,t)=>{let a=e.data("picker");a&&a.setColor(t)},n=e=>new Promise(t=>{let a=new XMLHttpRequest;a.open("GET",chrome.extension.getURL(e),!0),a.onload=(()=>{a.response&&t(a.response)}),a.send()}),r=()=>{Object.keys(t.opts.elm.preview).forEach(e=>{i(e)})},i=s=>{let l=h();if(t.opts.elm.preview[s]){if(t.opts.elm.preview[s].find("head > style").remove(),"default"===l.appearance.styles.fontFamily){let e=t.helper.font.getDefaultFontInfo();l.appearance.styles.fontFamily=e.name}d(s),Object.assign(l.appearance.styles,t.helper.font.getFontWeights(l.appearance.styles.fontFamily));let o=a[s].css;o+=l.utility.customCss,Object.keys(l.appearance.styles).forEach(e=>{o=o.replace(new RegExp('"?%'+e+'"?',"g"),l.appearance.styles[e])}),t.opts.elm.preview[s].find("["+t.opts.attr.style+"]").forEach(a=>{let s=e(a).attr(t.opts.attr.style);Object.keys(l.appearance.styles).forEach(e=>{s=s.replace(new RegExp('"?%'+e+'"?',"g"),l.appearance.styles[e])}),a.style.cssText=s}),t.opts.elm.preview[s].find("["+t.opts.attr.hideOnFalse+"]").forEach(a=>{let s=e(a).attr(t.opts.attr.hideOnFalse);void 0===l.appearance[s]||!1===l.appearance[s]?e(a).css("display","none"):e(a).css("display","block")}),t.opts.elm.preview[s].find("head").append("<style>"+o+"</style>"),l.appearance.darkMode?t.opts.elm.preview[s].find("body").addClass(t.opts.classes.page.darkMode):t.opts.elm.preview[s].find("body").removeClass(t.opts.classes.page.darkMode),c(t.opts.elm.preview[s]),p(t.opts.elm.preview[s])}else"icon"===s&&t.helper.model.call("updateIcon",{name:l.appearance.styles.iconShape,color:l.appearance.styles.iconColor,onlyCurrentTab:!0})},p=e=>{let a=e.find("section#sidebar");if(a.length()>0){let e=a.find("> header");e.find("> h1").removeClass(t.opts.classes.hidden),e.find("> h1 > span").removeClass(t.opts.classes.hidden),["label","amount"].forEach(a=>{let s=null;e.children("a").forEach(l=>{if(null===s)s=l.offsetTop;else if(s!==l.offsetTop||0===e.find("> h1")[0].offsetTop)return"label"===a?e.find("> h1 > span").addClass(t.opts.classes.hidden):"amount"===a&&e.find("> h1").addClass(t.opts.classes.hidden),!1})})}},c=e=>{let a=e.find("div.tooltip"),l=e.find("li > a.hover");if(a.length()>0&&l.length()>0)if(+new Date-s<2e3){let e=l[0].getBoundingClientRect();a.addClass(t.opts.classes.visible),a.css({top:e.y+l.realHeight()/2-a.realHeight()/2+"px",left:e.x-a[0].offsetWidth+"px"})}else a.removeClass(t.opts.classes.visible)},d=e=>{if(t.opts.elm.content.removeClass(t.opts.classes.small),t.opts.elm.preview[e]){let a=h();if(null!==t.opts.elm.preview[e][0].offsetParent){let s=0;"overlay"===e?t.opts.elm.content.addClass(t.opts.classes.small):"indicator"===e?s=a.appearance.styles.indicatorWidth:"sidebar"!==e&&"general"!==e||(s=a.appearance.styles.sidebarWidth),t.opts.elm.header.css("padding-right",s),t.opts.elm.content.css("padding-right",s)}else t.opts.elm.header.css("padding-right",""),t.opts.elm.content.css("padding-right","");if(t.helper.menu.getPage().find("div."+t.opts.classes.box).length()>1){let e=!1,a=null;t.helper.menu.getPage().find("div."+t.opts.classes.box).forEach(t=>{if(a===t.offsetTop)return e=!0,!1;a=t.offsetTop}),e||t.opts.elm.content.addClass(t.opts.classes.small)}}},h=()=>{let e={utility:{customCss:t.opts.elm.textarea.customCss[0].value},appearance:{darkMode:t.helper.checkbox.isChecked(t.opts.elm.checkbox.darkMode),showIndicator:!0,showIndicatorIcon:!0,showBookmarkIcons:!0,showDirectoryIcons:!0,styles:{}}},a=t.helper.model.getData("a/styles");return Object.keys(a).forEach(a=>{if(t.opts.elm.range[a])e.appearance.styles[a]=t.opts.elm.range[a][0].value+"px";else if(t.opts.elm.color[a]){let s=m(a,t.opts.elm.color[a][0].value);e.appearance.styles[a]=s.color,"colorScheme"===a&&(e.appearance.styles.foregroundColor=t.helper.model.getDefaultColor("foregroundColor",s.luminance&&s.luminance>170?"dark":"light"))}else t.opts.elm.select[a]?e.appearance.styles[a]=t.opts.elm.select[a][0].value:t.opts.elm.radio[a]&&(e.appearance.styles[a]=t.opts.elm.radio[a][0].value)}),Object.entries({indicatorWidth:"showIndicator",indicatorIconSize:"showIndicatorIcon",bookmarksIconSize:"showBookmarkIcons",directoriesIconSize:"showDirectoryIcons"}).forEach(([t,a])=>{0===parseInt(e.appearance.styles[t])&&(e.appearance[a]=!1)}),e},m=(e,a)=>{let s=null,l=t.opts.elm.color[e].data("picker");if(l){let e=l.getColorObj();0===e.a&&(a="transparent"),s=.299*e.r+.587*e.g+.114*e.b}return{color:a,luminance:s}},g=()=>new Promise(s=>{let l=0,o=Object.keys(a).length;Object.keys(a).forEach(r=>{a[r].css="",t.opts.elm.preview[r]=e("<iframe />").attr(t.opts.attr.appearance,r).appendTo(t.opts.elm.body),n("html/template/"+a[r].template+".html").then(e=>{e=(e=e.replace(/__MSG_\@\@extension_id__/g,chrome.runtime.id)).replace(/__DATE__CREATED__/g,t.helper.i18n.getLocaleDate(new Date("2016-11-25"))),t.opts.elm.preview[r].find("body").html(e),t.helper.i18n.parseHtml(t.opts.elm.preview[r]),t.helper.font.addStylesheet(t.opts.elm.preview[r]),++l===o&&s()}),a[r].styles.forEach(e=>{n("css/"+e+".css").then(e=>{a[r].css+=e})})})}),u=()=>{e(window).on("resize",function(){let e=t.helper.menu.getPath();e&&e[1]&&d(e[1])}),t.opts.elm.appearance.presetWrapper.children("a").on("click",a=>{let s=e(a.currentTarget).attr(t.opts.attr.type),l=t.helper.model.getData("a/styles",!0);Object.entries({sidebarHeaderHeight:{xs:32,s:36,l:55},bookmarksFontSize:{xs:11,s:12,l:16},bookmarksLineHeight:{xs:20,s:26,l:45},sidebarWidth:{xs:250,s:300,l:400},bookmarksDirIndentation:{xs:20,s:22,l:30},bookmarksHorizontalPadding:{xs:6,s:10,l:18},bookmarksIconSize:{xs:12,s:14,l:18},directoriesIconSize:{xs:12,s:14,l:18},scrollBarWidth:{xs:10,s:11,l:12},tooltipFontSize:{xs:9,s:9,l:12}}).forEach(([e,a])=>{a[s]?t.opts.elm.range[e][0].value=a[s]:t.opts.elm.range[e][0].value=l[e].replace("px",""),t.opts.elm.range[e].trigger("change")})}),t.opts.elm.range.tooltipFontSize.on("change, input",()=>{s=+new Date,l&&clearTimeout(l),l=setTimeout(()=>{i("sidebar")},2001)}),t.opts.elm.appearance.content.find("input, textarea, select").on("change input",a=>{let s=e(a.currentTarget),l=a.currentTarget.value,n=s.data("initial");if(void 0!==n){if("checkbox"===s.attr("type")&&(l=a.currentTarget.checked,e(s).parent()[0]===t.opts.elm.checkbox.darkMode[0])){let e=t.helper.model.getDefaultColor("textColor",l?"dark":"light");o(t.opts.elm.color.textColor,e),o(t.opts.elm.color.bookmarksDirColor,e),["sidebarMaskColor","colorScheme","hoverColor"].forEach(e=>{let a=t.helper.model.getDefaultColor(e,l?"dark":"light");o(t.opts.elm.color[e],a)})}let r=e(a.currentTarget).parents("div."+t.opts.classes.box).eq(0);l!==n?0===r.children("a."+t.opts.classes.revert).length()&&e("<a href='#' />").addClass(t.opts.classes.revert).data("elm",r).appendTo(r):r.children("a."+t.opts.classes.revert).remove();let p=t.helper.menu.getPath();i(p[1])}}),t.opts.elm.appearance.content.on("click","a."+t.opts.classes.revert,a=>{a.preventDefault(),e(a.currentTarget).parent("div."+t.opts.classes.box).find("input, select").forEach(t=>{let a=e(t),s=a.data("initial");a.data("picker")?o(a,s):void 0!==s&&("checkbox"===a.attr("type")&&"boolean"==typeof s?t.checked!==s&&a.parent("div").trigger("click"):(t.value=s,a.trigger("change")))})}),e(document).on(t.opts.events.pageChanged,e=>{e.detail.path&&"appearance"===e.detail.path[0]&&i(e.detail.path[1])})}},window.FeedbackHelper=function(t){this.init=(async()=>{s(),a(),!1===t.serviceAvailable&&(t.opts.elm.feedback.form.addClass(t.opts.classes.hidden),e("<p />").addClass(t.opts.classes.error).html(t.helper.i18n.get("status_feedback_unavailable_desc")+"<br />").append("<a href='mailto:feedback@blockbyte.de'>feedback@blockbyte.de</a>").insertAfter(t.opts.elm.feedback.form))});let a=()=>{let a=t.helper.menu.getPath();if(a.length>2&&"faq"===a[1]&&a[2]){let s=t.opts.elm.feedback.faq.children("strong["+t.opts.attr.name+"='"+a[2]+"']");s.length()>0&&(s.trigger("click"),e.delay(300).then(()=>(s.next("p").addClass(t.opts.classes.highlight),e.delay(1e3))).then(()=>{s.next("p").removeClass(t.opts.classes.highlight)}))}},s=()=>{t.opts.elm.feedback.faq.children("strong").on("click",a=>{a.preventDefault(),e(a.currentTarget).next("p").toggleClass(t.opts.classes.visible)}),t.opts.elm.feedback.faq.children("p > a").on("click",a=>{a.preventDefault(),"usage"===e(a.currentTarget).parent("p").attr(t.opts.attr.type)&&window.open(chrome.extension.getURL("html/intro.html")+"?skip=1","_blank")}),t.opts.elm.feedback.send.on("click",e=>{e.preventDefault(),l()})},l=()=>{let a=t.opts.elm.textarea.feedbackMsg[0].value,s=t.opts.elm.field.feedbackEmail[0].value,l=s.length>0&&/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(s),o=a.length>0;if(l&&o){let l=+new Date,o=t.helper.template.loading().appendTo(t.opts.elm.body);t.opts.elm.body.addClass(t.opts.classes.loading);let n=null;e.xhr(t.opts.ajax.feedback,{method:"POST",data:{email:s,msg:a,version:t.opts.manifest.version_name,ua:navigator.userAgent,lang:t.helper.i18n.getLanguage(),config:t.helper.importExport.getExportConfig()}}).then(t=>(n=JSON.parse(t.responseText),e.delay(Math.max(0,1e3-(+new Date-l))))).then(()=>{t.opts.elm.body.removeClass(t.opts.classes.loading),o.remove(),n&&n.success&&!0===n.success?(t.opts.elm.textarea.feedbackMsg[0].value="",t.opts.elm.field.feedbackEmail[0].value="",t.showSuccessMessage("feedback_sent_message")):e.delay().then(()=>{alert(t.helper.i18n.get("settings_feedback_send_failed"))})})}else l?o||t.opts.elm.textarea.feedbackMsg.addClass(t.opts.classes.error):t.opts.elm.field.feedbackEmail.addClass(t.opts.classes.error);e.delay(700).then(()=>{e("."+t.opts.classes.error).removeClass(t.opts.classes.error)})}},window.FormHelper=function(t){let a={};this.init=(()=>new Promise(e=>{s(),l().then(e)}));let s=()=>{t.opts.elm.content.on("scroll",()=>{"appearance"===t.helper.menu.getPath()[0]&&Object.values(t.opts.elm.color).forEach(e=>{e.data("picker").reposition()})})},l=()=>new Promise(s=>{let l=t.opts.elm.formElement.length(),o=()=>{0===--l&&s()};t.opts.elm.formElement.forEach(s=>{let l={elm:s,type:e(s).attr(t.opts.attr.type),name:e(s).attr(t.opts.attr.name),i18n:e(s).attr(t.opts.attr.i18n)||""};l.label=e("<label />").attr(t.opts.attr.i18n,l.i18n).insertAfter(s),e("<p />").addClass(t.opts.classes.desc).attr(t.opts.attr.i18n,l.i18n+"_desc").insertAfter(l.label),a[l.type]?a[l.type](l).then(o):o(),s.remove()})});a.color=(a=>new Promise(s=>{t.opts.elm.color[a.name]=e("<input type='text' />").addClass(t.opts.classes.color.field).insertAfter(a.label);let l=new window.Colorpicker(t.opts.elm.color[a.name][0],{alpha:!!e(a.elm).attr(t.opts.attr.color.alpha)}),o=e(a.elm).attr(t.opts.attr.color.suggestions);if(o){let a=JSON.parse(o),s=[],n=l.getElements().preview;a.forEach(a=>{s.push(e("<span />").addClass(t.opts.classes.color.suggestion).attr(t.opts.attr.value,a).css("background-color",a).insertAfter(n))}),e(s).on("click",a=>{a.stopPropagation();let s=e(a.currentTarget).attr(t.opts.attr.value);l.setColor(s),l.show()})}let n=s=>{let o=t.opts.elm.body.children("div."+t.opts.classes.color.mask+"["+t.opts.attr.name+"='"+a.name+"']");s&&l.visible&&-1!==a.name.search(/MaskColor$/)?(0===o.length()&&(o=e("<div />").addClass(t.opts.classes.color.mask).attr(t.opts.attr.name,a.name).appendTo(t.opts.elm.body)),o.css("background-color",s)):o.length()>0&&o.remove()};l.on("show",e=>{l.visible=!0,n(e.color)}),l.on("hide",()=>{l.visible=!1,n()}),l.on("change",e=>{t.opts.elm.color[a.name].trigger("change"),n(e.color)}),t.opts.elm.color[a.name].data("picker",l),s()})),a.font=(a=>new Promise(s=>{t.opts.elm.select[a.name]=e("<select />").insertAfter(a.label),chrome.fontSettings.getFontList(s=>{s.unshift({fontId:"default",displayName:t.helper.i18n.get("settings_font_family_default")}),s.forEach(s=>{0===t.opts.elm.select[a.name].children("option[value='"+s.fontId.replace(/\'/g,"\\27")+"']").length()&&e("<option />").attr("value",s.fontId).text(s.displayName).appendTo(t.opts.elm.select[a.name])})}),s()})),a.language=(a=>new Promise(s=>{t.opts.elm.select[a.name]=e("<select />").insertAfter(a.label),e("<option />").attr("value","default").text(t.helper.i18n.get("settings_language_default")).appendTo(t.opts.elm.select[a.name]),t.helper.model.call("languageInfos").then(l=>{if(l&&l.infos){let s=Object.values(l.infos);s.sort((e,t)=>e.label>t.label?1:-1),s.forEach(s=>{s.available&&e("<option />").attr("value",s.name).text(s.label).appendTo(t.opts.elm.select[a.name])})}s()})})),a.textarea=(a=>new Promise(s=>{t.opts.elm.textarea[a.name]=e("<textarea />").attr(t.opts.attr.name,a.name).insertAfter(a.label),s()})),a.text=a.email=(a=>new Promise(s=>{t.opts.elm.field[a.name]=e("<input type='"+a.type+"' />").insertAfter(a.label),["placeholder"].forEach(s=>{let l=e(a.elm).attr(t.opts.attr.field[s]);l&&t.opts.elm.field[a.name].attr(s,l)}),s()})),a.radio=(a=>new Promise(s=>{t.opts.elm.radio[a.name]=e("<select />").addClass(t.opts.classes.hidden).insertAfter(a.label);let l=e("<ul />").addClass(t.opts.classes.radio.wrapper).insertAfter(t.opts.elm.radio[a.name]);e(a.elm).children("span").forEach(s=>{let o=e(s).attr(t.opts.attr.value),n=e("<li />").attr(t.opts.attr.value,o).appendTo(l);e(t.helper.checkbox.get(t.opts.elm.body,{[t.opts.attr.name]:a.name,[t.opts.attr.value]:o},"radio")).appendTo(n),e(s).appendTo(n),e("<option />").attr("value",o).text(o).appendTo(t.opts.elm.radio[a.name])}),t.opts.elm.radio[a.name].on("change",e=>{if(void 0===e.detail||"userAction"!==e.detail){let a=l.find("input[type='checkbox']["+t.opts.attr.value+"='"+e.currentTarget.value+"']");a.length()>0&&a.parent("div").trigger("click")}}),l.find("input[type='checkbox']").on("change",s=>{t.opts.elm.radio[a.name][0].value=e(s.currentTarget).attr(t.opts.attr.value),t.opts.elm.radio[a.name].trigger("change",{detail:"userAction"})}),s()})),a.range=(a=>new Promise(s=>{t.opts.elm.range[a.name]=e("<input type='range' />").insertAfter(a.label),["min","max","step"].forEach(s=>{let l=e(a.elm).attr(t.opts.attr.range[s]);l&&t.opts.elm.range[a.name].attr(s,l)}),t.opts.elm.range[a.name].attr("value",e(a.elm).attr(t.opts.attr.value)||"");let l=e(a.elm).attr(t.opts.attr.range.unit)||"",o=e("<span />").insertAfter(t.opts.elm.range[a.name]);if(t.opts.elm.range[a.name].on("input change",s=>{let n=s.currentTarget,r=n.max||100,i=n.min||0,p=Math.round(100*(n.value-i)/(r-i)),c=t.opts.elm.range[a.name].css("background-image");if(0===c.search("linear-gradient")){let s=e(n).data("backgroundTemplate");void 0===s&&(s=c.replace(/\-1px/g,"{percent}"),e(n).data("backgroundTemplate",s)),t.opts.elm.range[a.name].css("background-image",s.replace(/\{percent\}/g,p+"%"))}o.text(n.value+l)}),t.opts.elm.range[a.name].trigger("input"),"1"===e(a.elm).attr(t.opts.attr.range.infinity)){let s=t.helper.checkbox.get(t.opts.elm.body).insertAfter(o);e("<label />").attr(t.opts.attr.i18n,a.i18n+"_infinity").insertAfter(s),e("<br />").insertBefore(s),s.children("input[type='checkbox']").on("change",e=>{e.currentTarget.checked?t.opts.elm.range[a.name].addClass(t.opts.classes.range.inactive):t.opts.elm.range[a.name].removeClass(t.opts.classes.range.inactive)}),t.opts.elm.range[a.name].data("infinityCheckbox",s)}s()})),a.select=(a=>new Promise(s=>{t.opts.elm.select[a.name]=e("<select />").insertAfter(a.label),e(a.elm).children("span").forEach(s=>{let l=e(s).attr(t.opts.attr.i18n),o=e("<option />").attr({value:e(s).attr(t.opts.attr.value)}).html(e(s).html()).appendTo(t.opts.elm.select[a.name]);l&&o.attr(t.opts.attr.i18n,l)}),s()})),a.checkbox=(a=>new Promise(s=>{let l=e(a.elm).attr(t.opts.attr.style)||"default";t.opts.elm.checkbox[a.name]=t.helper.checkbox.get(t.opts.elm.body,{[t.opts.attr.name]:a.name},"checkbox",l).insertAfter(a.label),s()}))},window.ImportExportHelper=function(t){this.init=(async()=>{l(),s()}),this.getExportConfig=(()=>{let e=Object.assign({},t.helper.model.getAllData());return delete e.utility,e});let a=()=>{t.helper.model.call("trackEvent",{category:"settings",action:"import",label:"failed"}),window.alert(t.helper.i18n.get("settings_import_failed"))},s=async()=>{t.opts.elm.buttons.import.on("change",s=>{s.preventDefault();let l=s.currentTarget;if(l.files&&l.files[0]&&(l.files[0].name.search(/\.bookmark_sidebar$/)>-1||l.files[0].name.search(/\.config$/)>-1)){let s=new FileReader;s.onload=(s=>{try{let l=JSON.parse(s.target.result);l.behaviour&&l.appearance?chrome.storage.sync.set({behaviour:l.behaviour,appearance:l.appearance},()=>{t.helper.model.call("trackEvent",{category:"settings",action:"import",label:"import"}),t.helper.model.call("reinitialize"),t.showSuccessMessage("import_saved"),e.delay(1500).then(()=>{location.reload(!0)})}):a()}catch(s){a()}}),s.readAsText(l.files[0])}else a()})},l=async()=>{t.opts.elm.buttons.export.attr({href:"data:text/json;charset=utf-8,"+encodeURIComponent(JSON.stringify(this.getExportConfig())),download:o()}).on("click",()=>{t.helper.model.call("trackEvent",{category:"settings",action:"export",label:"export"})})},o=()=>{let e=new Date;return"config_"+(e.getDate()+"-"+["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sept","Oct","Nov","Dec"][e.getMonth()]+"-"+e.getFullYear())+".bookmark_sidebar"}},window.MenuHelper=function(t){let a=!1,s=!0,l=null,o=null,n=null;this.init=(()=>new Promise(a=>{l=e("<ul />").appendTo(t.opts.elm.aside.children("nav"));let o=t.opts.elm.content.children("div."+t.opts.classes.tabs.content).length(),n=()=>{0===--o&&r().then(()=>{s=!1,a()})};t.opts.elm.content.children("div."+t.opts.classes.tabs.content).forEach(a=>{let s=e(a).attr(t.opts.attr.name),o=e("<li />").attr(t.opts.attr.name,s).html("<a href='#'>"+t.helper.i18n.get("settings_menu_"+s)+"</a>").appendTo(l),r=e(a).children("div["+t.opts.attr.name+"]");if(r.length()>0){let a=e("<ul />").appendTo(o);r.forEach(l=>{let o=e(l).attr(t.opts.attr.name);e("<li />").attr(t.opts.attr.name,o).html("<a href='#'>"+t.helper.i18n.get("settings_menu_"+s+"_"+o)+"</a>").appendTo(a)}),e.delay(500).then(()=>{a.children("li").forEach(t=>{e(t).data("height",t.scrollHeight)}),n()})}else n()}),i()})),this.getPage=(()=>n||e()),this.getPath=(()=>o),this.addBreadcrumb=(a=>{t.opts.elm.content[0].scrollTop=0,a.depth&&o.length>=a.depth?(o[a.depth-1]=a.alias,t.opts.elm.headline.children("span").forEach((t,s)=>{s>=a.depth-1&&e(t).remove()})):o.push(a.alias),t.opts.elm.headline.append("<span>"+a.label+"</span>")});let r=()=>new Promise(t=>{let a=location.hash?location.hash.substr(1):null;a?d(...a.split("_")):l.find("a").eq(0).trigger("click"),e.delay(300).then(t)}),i=()=>{l.find("a").on("click",a=>{a.preventDefault();let s=e(a.currentTarget).parent("li"),l=s.attr(t.opts.attr.name);if(s.parents("li").length()>0){let e=s.parent("ul").parent("li").attr(t.opts.attr.name);d(e,l)}else d(l)}),t.opts.elm.headline.on("click","span",t=>{let a=e(t.currentTarget).prevAll().length();d(...o.slice(0,a+1))}),e(window).on("popstate",()=>{r()})},p=()=>{let e=this.getPath(),a=[t.opts.elm.content.children("div."+t.opts.classes.tabs.content+"["+t.opts.attr.name+"='"+e[0]+"']")];t.opts.elm.header.attr(t.opts.attr.type,e[0]),e[1]&&a.unshift(a[0].children("div["+t.opts.attr.name+"='"+e[1]+"']")),["save","restore"].forEach(e=>{a.some(a=>{let s=a.attr(t.opts.attr.buttons[e]);if(t.opts.elm.buttons[e].addClass(t.opts.classes.hidden),s)return"false"!==s&&t.opts.elm.buttons[e].html("true"===s?"":t.helper.i18n.get(s)).removeClass(t.opts.classes.hidden),!0})})},c=()=>{l.find("li").removeClass(t.opts.classes.tabs.active);let e=t.opts.elm.content.children("div."+t.opts.classes.tabs.content);e.removeClass(t.opts.classes.tabs.active),e.children("div["+t.opts.attr.name+"]").removeClass(t.opts.classes.tabs.active),l.find("ul").css("height","")},d=(...s)=>new Promise(r=>{if(a)r();else{a=!0;let i=s.length,d=[],h=l.children("li["+t.opts.attr.name+"='"+s[0]+"']"),m=t.opts.elm.content.children("div."+t.opts.classes.tabs.content+"["+t.opts.attr.name+"='"+s[0]+"']");1===i&&m.find("> div["+t.opts.attr.name+"]").length()>0&&(h.hasClass(t.opts.classes.incomplete)&&"language"===s[0]?s.push(m.find("> div["+t.opts.attr.name+"='translate']").eq(0).attr(t.opts.attr.name)):s.push(m.find("> div["+t.opts.attr.name+"]").eq(0).attr(t.opts.attr.name)),i++);let g=s.join("_");c();for(let a=1;a<=i;a++){let l=h.parent("ul");if(l&&l.length()>0){h.addClass(t.opts.classes.tabs.active),m.addClass(t.opts.classes.tabs.active),d.push(h.children("a").html());let o=0;l.children("li:not(."+t.opts.classes.hidden+")").forEach(t=>{o+=e(t).data("height")||0}),o>0&&l.css("height",o+"px"),a<i&&(h=h.find("> ul > li["+t.opts.attr.name+"='"+s[a]+"']"),m=m.find("> div["+t.opts.attr.name+"='"+s[a]+"']"))}}t.opts.elm.headline.html("<span>"+d.join("</span><span>")+"</span>"),t.opts.elm.body.attr(t.opts.attr.type,g),location.hash=g,n=m,o=s,t.opts.elm.content[0].scrollTop=0,p(),t.opts.elm.header.css("padding-right",""),t.opts.elm.content.css("padding-right",""),document.dispatchEvent(new CustomEvent(t.opts.events.pageChanged,{detail:{path:s},bubbles:!0,cancelable:!1})),t.helper.model.call("trackEvent",{category:"settings",action:"page",label:g}),e.delay().then(()=>{a=!1,r()})}})},window.NewtabHelper=function(e){let t=!1;this.init=(async()=>{a(),e.opts.elm.newtab.content.find("div."+e.opts.classes.newtab.hideable).addClass(e.opts.classes.hidden),["override","autoOpen"].forEach(a=>{!0===e.helper.model.getData("n/"+a)?"override"===a?chrome.permissions.contains({permissions:["tabs","topSites"]},s=>{s&&e.opts.elm.checkbox[a].trigger("click"),t=!0}):e.opts.elm.checkbox[a].trigger("click"):"override"===a&&(t=!0)}),["website"].forEach(t=>{e.opts.elm.field[t][0].value=e.helper.model.getData("n/"+t)})}),this.save=(()=>new Promise(t=>{chrome.storage.sync.get(["newtab"],a=>{let s=a.newtab||{};["override","autoOpen"].forEach(t=>{s[t]=e.helper.checkbox.isChecked(e.opts.elm.checkbox[t])}),["website"].forEach(t=>{s[t]=e.opts.elm.field[t][0].value.trim()}),s.website&&s.website.length&&0!==s.website.search(/^\w+\:\/\//)&&(s.website="http://"+s.website),chrome.storage.sync.set({newtab:s},t)})}));let a=()=>{e.opts.elm.checkbox.override.children("input[type='checkbox']").on("change",()=>{let a=e.helper.checkbox.isChecked(e.opts.elm.checkbox.override),s=e.opts.elm.newtab.content.find("div."+e.opts.classes.newtab.hideable);a?!0===t?chrome.permissions.request({permissions:["tabs","topSites"]},t=>{t||(e.opts.elm.checkbox.override.trigger("click"),a=!1),a?s.removeClass(e.opts.classes.hidden):s.addClass(e.opts.classes.hidden)}):s.removeClass(e.opts.classes.hidden):s.addClass(e.opts.classes.hidden)})}},window.SidebarHelper=function(t){this.init=(async()=>{a(),["dirAccordion","animations","preventPageScroll","reopenSidebar","dndOpen"].forEach(e=>{!0===t.helper.model.getData("b/"+e)&&t.opts.elm.checkbox[e].trigger("click")});let e=t.helper.model.getData("b/pxTolerance");t.opts.elm.range.pxToleranceMaximized[0].value=e.maximized,t.opts.elm.range.pxToleranceWindowed[0].value=e.windowed,t.opts.elm.select.language[0].value=t.helper.i18n.getLanguage(),["openAction","sidebarPosition","linkAction","rememberState","newTab","newTabPosition","tooltipContent"].forEach(e=>{t.opts.elm.select[e][0].value=t.helper.model.getData("b/"+e),t.opts.elm.select[e].trigger("change")}),["openDelay","dirOpenDuration","openChildrenWarnLimit","scrollBarHide","closeTimeout","tooltipDelay"].forEach(e=>{let a=t.helper.model.getData("b/"+e);if(-1===a){let a=t.opts.elm.range[e].data("infinityCheckbox");a&&a.length()>0&&a.trigger("click")}t.opts.elm.range[e][0].value=a,t.opts.elm.range[e].trigger("change")}),t.opts.elm.range.pxToleranceMaximized.trigger("change"),t.opts.elm.range.pxToleranceWindowed.trigger("change")}),this.save=(()=>new Promise(a=>{let s={pxTolerance:{maximized:t.opts.elm.range.pxToleranceMaximized[0].value,windowed:t.opts.elm.range.pxToleranceWindowed[0].value}};["openAction","sidebarPosition","linkAction","rememberState","newTab","newTabPosition","tooltipContent"].forEach(e=>{s[e]=t.opts.elm.select[e][0].value}),["openDelay","dirOpenDuration","openChildrenWarnLimit","scrollBarHide","closeTimeout","tooltipDelay"].forEach(e=>{let a=-1;!1===t.opts.elm.range[e].hasClass(t.opts.classes.range.inactive)&&(a=t.opts.elm.range[e][0].value),s[e]=a}),["dirAccordion","animations","preventPageScroll","reopenSidebar","dndOpen"].forEach(e=>{s[e]=t.helper.checkbox.isChecked(t.opts.elm.checkbox[e])});let l=t.opts.elm.select.language[0].value;l===t.helper.i18n.getUILanguage()&&(l="default"),chrome.storage.sync.get(["language"],t=>{chrome.storage.sync.set({behaviour:s,language:l},()=>{t&&t.language&&t.language!==l&&e.delay(1500).then(()=>{location.reload(!0)}),a()})})}));let a=()=>{t.opts.elm.select.openAction.on("change",e=>{let a=t.opts.elm.aside.find("li["+t.opts.attr.name+"='indicator']");"contextmenu"===e.currentTarget.value||"mousedown"===e.currentTarget.value?a.removeClass(t.opts.classes.hidden):a.addClass(t.opts.classes.hidden)}),t.opts.elm.buttons.keyboardShortcut.on("click",e=>{e.preventDefault();let t=navigator.userAgent.match(/Chrom(e|ium)\/([0-9]+)\./),a=t?parseInt(t[2],10):null;chrome.tabs.create({url:a>=64?"chrome://extensions/shortcuts":"chrome://extensions/configureCommands",active:!0})})}},window.SupportHelper=function(e){this.init=(async()=>{t()});let t=async()=>{chrome.storage.sync.get(["shareInfo"],t=>{t.shareInfo&&(t.shareInfo.config&&e.opts.elm.checkbox.shareConfig.trigger("click"),t.shareInfo.activity&&e.opts.elm.checkbox.shareActivity.trigger("click")),e.opts.elm.support.shareInfoWrapper.find("input[type='checkbox']").on("change",()=>{chrome.storage.sync.set({shareInfo:{config:e.helper.checkbox.isChecked(e.opts.elm.checkbox.shareConfig),activity:e.helper.checkbox.isChecked(e.opts.elm.checkbox.shareActivity)}},()=>{e.showSuccessMessage("saved_share_userdata")})})}),e.opts.elm.support.donate.on("click",t=>{t.preventDefault(),window.open(e.opts.donateLink,"_blank")})}},window.TranslationHelper=function(t){let a={},s={},l={};this.init=(()=>new Promise(e=>{o().then(()=>{r(),t.serviceAvailable?n().then(()=>{i(),g()}):c(),e()})})),this.submit=(()=>new Promise(a=>{let s=t.opts.elm.translation.langvars.data("lang");if(s){let a=+new Date,l=t.helper.template.loading().appendTo(t.opts.elm.body);t.opts.elm.body.addClass(t.opts.classes.loading);let o={};t.opts.elm.translation.wrapper.find("div."+t.opts.classes.translation.category+"["+t.opts.attr.translation.language+"='"+s+"']").forEach(t=>{e(t).find("textarea").forEach(t=>{let a=t.value;if(a&&a.trim().length>0){let s=e(t).data("initial");if((a=a.trim())!==s){let s=e(t).data("name");o[s]=a}}})}),e.xhr(t.opts.ajax.translation.submit,{method:"POST",data:{lang:s,vars:o}}).then(()=>e.delay(Math.max(0,1e3-(+new Date-a)))).then(()=>(l.remove(),t.showSuccessMessage("translation_submit_message"),e.delay(1500))).then(()=>{t.opts.elm.body.removeClass(t.opts.classes.loading),k(s)})}else a()}));let o=()=>new Promise(e=>{t.helper.model.call("languageInfos").then(t=>{a=t.infos,e()})}),n=()=>new Promise(s=>{t.opts.elm.translation.overview.children("div."+t.opts.classes.boxWrapper).html(""),e.xhr(t.opts.ajax.translation.info).then(l=>{let o=JSON.parse(l.responseText);if(o&&o.languages){let s=t.helper.i18n.getLanguage();o.languages.sort((e,t)=>t.varsAmount!==e.varsAmount?t.varsAmount-e.varsAmount:a[e.name]&&a[t.name]?a[e.name].label>a[t.name].label?1:-1:1);let l=Object.assign({},a);o.languages.forEach(n=>{if(a[n.name]){let r=n.varsAmount/o.varsAmount*100;if(r>=15){delete l[n.name];let i="draft",p=Math.floor(r);a[n.name].available&&(i=o.varsAmount>n.varsAmount?"incomplete":"released");let c=e("<div />").data("lang",n.name).addClass(t.opts.classes.box).attr(t.opts.attr.translation.releaseStatus,i).append("<a href='#' class='"+t.opts.classes.translation.edit+"'></a>").append("<strong>"+a[n.name].label+"</strong>").append("<div class="+t.opts.classes.translation.progress+" "+t.opts.attr.value+"='"+p+"%'><div style='width:"+p+"%'></div></div>").append("<span title='"+t.helper.i18n.get("settings_translation_status_"+i)+"'></span>").appendTo(t.opts.elm.translation.overview.children("div."+t.opts.classes.boxWrapper));s===n.name&&(d(n.categories,o.categories)&&(t.opts.elm.aside.find("li["+t.opts.attr.name+"='language']").addClass(t.opts.classes.incomplete),e("<span />").attr("title",t.helper.i18n.get("settings_translation_incomplete_info")).appendTo(t.opts.elm.aside.find("li["+t.opts.attr.name+"='language'] > a"))),c.addClass(t.opts.classes.translation.mark))}}}),h(l)}t.opts.elm.translation.overview.addClass(t.opts.classes.visible),s()})}),r=()=>{t.opts.elm.translation.goto.on("click",e=>{e.preventDefault(),t.opts.elm.aside.find("li["+t.opts.attr.name+"='translate'] > a").trigger("click")}),e(document).on(t.opts.events.pageChanged,e=>{e.detail.path&&"translate"===e.detail.path[1]&&(e.detail.path[2]?k(e.detail.path[2]):t.serviceAvailable?p():c())})},i=()=>{t.opts.elm.translation.overview.find("select."+t.opts.classes.translation.select).on("change",e=>{k(e.currentTarget.value)}),t.opts.elm.translation.overview.find("div."+t.opts.classes.box).on("click",t=>{t.preventDefault();let a=e(t.currentTarget).data("lang");a&&k(a)})},p=()=>{t.opts.elm.translation.wrapper.find("."+t.opts.classes.visible).removeClass(t.opts.classes.visible),t.opts.elm.translation.overview.addClass(t.opts.classes.visible),t.opts.elm.buttons.save.addClass(t.opts.classes.hidden)},c=()=>{t.opts.elm.translation.unavailable.addClass(t.opts.classes.visible),t.opts.elm.translation.wrapper.hasClass(t.opts.classes.tabs.active)&&t.opts.elm.buttons.save.addClass(t.opts.classes.hidden)},d=(e,t)=>{let a=!1;return Object.keys(e).some(s=>{if(t[s].total>e[s])return a=!0,!0}),a},h=s=>{let l=e("<div />").addClass(t.opts.classes.box).appendTo(t.opts.elm.translation.overview.children("div."+t.opts.classes.boxWrapper)),o=e("<select class='"+t.opts.classes.translation.select+"' />").appendTo(l);e("<option value='' />").text(t.helper.i18n.get("settings_translation_add_language")).appendTo(o);let n=[];Object.keys(s).forEach(t=>{n.push({elm:e("<option value='"+t+"' />").text(a[t].label),label:a[t].label})}),n.sort((e,t)=>e.label>t.label?1:-1),n.forEach(e=>{e.elm.appendTo(o)})},m=a=>new Promise(l=>{let o=e=>{e&&void 0===s[a]&&(s[a]=e),l(e)};s[a]?o(s[a]):e.xhr(t.opts.ajax.translation.langvars,{method:"POST",data:{lang:a}}).then(e=>{let s=JSON.parse(e.responseText);if(s&&Object.getOwnPropertyNames(s).length>0){let e={[a]:s},l=t.helper.i18n.getDefaultLanguage();a!==l?m(l).then(t=>{e.default=t[l],o(e)}):o(e)}else o(null)})}),g=()=>{t.opts.elm.translation.wrapper.on("click","a."+t.opts.classes.translation.back,a=>{a.preventDefault();let s=e(a.currentTarget).parents("div."+t.opts.classes.translation.category).eq(0).attr(t.opts.attr.translation.language);k(s)}),t.opts.elm.translation.wrapper.on("click","a."+t.opts.classes.translation.goto,a=>{a.preventDefault();let s=e(a.currentTarget).attr(t.opts.attr.value),l=e(a.currentTarget).parent("header").next("ul");v(s,l)}),t.opts.elm.translation.langvars.on("click","div."+t.opts.classes.box,t=>{t.preventDefault();let a=e(t.currentTarget),s=a.data("lang"),l=a.children("strong").text(),o=a.data("info");u(s,l,o)})},u=(s,o,n)=>{let r=t.opts.elm.translation.wrapper.find("div."+t.opts.classes.translation.category+"["+t.opts.attr.name+"='"+o+"']["+t.opts.attr.translation.language+"='"+s+"']");if(0===r.length()){let i=s+"_"+o;r=e("<div />").attr(t.opts.attr.name,o).attr(t.opts.attr.translation.language,s).addClass(t.opts.classes.translation.category).addClass(t.opts.classes.contentBox).appendTo(t.opts.elm.translation.wrapper);let p=e("<header />").appendTo(r),c=e("<ul />").appendTo(r);n.category.vars.forEach((s,l)=>{let o=e("<li />").append("<div><label>"+s.label+"</label></div>").append("<div />").appendTo(c);n.defaults&&n.defaults.vars&&n.defaults.vars[l]&&e("<span />").html("<span>"+a[t.helper.i18n.getDefaultLanguage()].label+" translation:</span>"+n.defaults.vars[l].value||"").appendTo(o.children("div").eq(0));let r=s.value||"";e("<textarea />").data({initial:r,name:s.name}).text(r).appendTo(o.children("div").eq(1)),0===r.length&&o.addClass(t.opts.classes.translation.empty)}),f(r),e("<a />").text(t.helper.i18n.get("settings_translation_back_to_overview")).addClass(t.opts.classes.translation.back).appendTo(p),l[i].total!==l[i].filled&&(e("<a />").addClass(t.opts.classes.translation.goto).attr(t.opts.attr.value,"down").appendTo(p),e("<a />").addClass(t.opts.classes.translation.goto).attr(t.opts.attr.value,"up").appendTo(p)),e("<span />").addClass(t.opts.classes.translation.amountInfo).html("<span>"+l[i].filled+"</span>&thinsp;/&thinsp;"+l[i].total).appendTo(p)}t.opts.elm.translation.langvars.removeClass(t.opts.classes.visible),r.addClass(t.opts.classes.visible),t.helper.menu.addBreadcrumb({label:o,alias:o,depth:4}),e.delay(0).then(()=>{let e=r.children("ul");r.find("a."+t.opts.classes.translation.goto).length()>0&&v("down",e),b(s,e)})},v=(e,a)=>{let s=null;if(a.find("li."+t.opts.classes.translation.hover).length()>0?s="up"===e?a.find("li."+t.opts.classes.translation.hover).eq(0).prevAll("li."+t.opts.classes.translation.empty):a.find("li."+t.opts.classes.translation.hover).eq(0).nextAll("li."+t.opts.classes.translation.empty):"down"===e&&(s=a.find("li."+t.opts.classes.translation.empty)),s&&s.length()>0){let e=s.eq(0);t.opts.elm.content[0].scrollTop=Math.max(0,e[0].offsetTop-40),e.find("textarea")[0].focus()}},b=(a,s)=>{if(a!==t.helper.i18n.getDefaultLanguage()&&t.helper.model.getData("u/translationHelp")){let a=null;(a="TEXTAREA"===document.activeElement.tagName?e(document.activeElement).parents("li").eq(0):s.children("li").eq(0)).addClass(t.opts.classes.translation.mark);let l=a.find("label").text();e("<span />").addClass(t.opts.classes.desc).html(t.helper.i18n.get("settings_translation_help",["<strong>"+l+"</strong>"])).appendTo(a),t.helper.model.setData({"u/translationHelp":!1})}},f=a=>{a.find("textarea").on("change input",s=>{let o=e(s.currentTarget),n=s.currentTarget.value,r=a.attr(t.opts.attr.name),i=a.attr(t.opts.attr.translation.language);n?o.parents("li").eq(0).removeClass(t.opts.classes.translation.empty):o.parents("li").eq(0).addClass(t.opts.classes.translation.empty),o.css("height",""),o.css("height",Math.max(s.currentTarget.scrollHeight,70)+"px");let p=0;a.find("textarea").forEach(e=>{e.value&&e.value.trim().length>0&&p++}),l[i+"_"+r].filled=p,a.find("span."+t.opts.classes.translation.amountInfo+" > span").text(p)}).on("focus",s=>{a.find("li").removeClass(t.opts.classes.translation.hover),e(s.currentTarget).parents("li").eq(0).addClass(t.opts.classes.translation.hover)}).on("blur",a=>{let s=e(a.currentTarget).parents("li").eq(0);e.delay(200).then(()=>{s.removeClass(t.opts.classes.translation.hover)})}),e.delay().then(()=>{a.find("textarea").trigger("change")})},k=s=>{t.helper.menu.addBreadcrumb({label:a[s].label,alias:s,depth:3}),t.opts.elm.translation.langvars.data("lang",s),t.opts.elm.translation.langvars.find("div."+t.opts.classes.boxWrapper).html(""),t.opts.elm.translation.wrapper.find("div."+t.opts.classes.translation.category).removeClass(t.opts.classes.visible),t.opts.elm.buttons.save.removeClass(t.opts.classes.hidden),t.opts.elm.translation.overview.removeClass(t.opts.classes.visible),t.opts.elm.translation.langvars.addClass([t.opts.classes.visible,t.opts.classes.loading]);let o=t.helper.template.loading().appendTo(t.opts.elm.translation.langvars);m(s).then(a=>{if(a){let o=a[s];Object.keys(o).forEach(n=>{let r=e("<div />").addClass(t.opts.classes.box).data("lang",s).data("info",{category:o[n],defaults:a.default?a.default[n]:null}).append("<strong>"+n+"</strong>").appendTo(t.opts.elm.translation.langvars.children("div."+t.opts.classes.boxWrapper)),i=s+"_"+n;void 0===l[i]&&(l[i]={total:o[n].vars.length,filled:0},o[n].vars.forEach(e=>{e.value&&l[i].filled++})),o[n].required&&e("<span />").addClass(t.opts.classes.translation.requiredInfo).text("("+t.helper.i18n.get("settings_translation_required_category")+")").appendTo(r),e("<span />").addClass(t.opts.classes.translation.amountInfo).html("<span>"+l[i].filled+"</span>&thinsp;/&thinsp;"+l[i].total).appendTo(r),l[i].total>l[i].filled&&(r.addClass(t.opts.classes.incomplete),r.children("a").attr("title",t.helper.i18n.get("settings_translation_incomplete_info")))})}else p();t.opts.elm.translation.langvars.removeClass(t.opts.classes.loading),o.remove()})}},window.settings=function(){this.opts={classes:{page:{darkMode:"dark"},tabs:{content:"tab",active:"active"},color:{field:"color",mask:"colorMask",suggestion:"suggestion"},radio:{wrapper:"radioWrapper"},range:{inactive:"inactive"},newtab:{hideable:"hideable"},translation:{select:"languageSelect",category:"category",edit:"edit",progress:"progress",mark:"mark",requiredInfo:"requiredInfo",amountInfo:"amountInfo",empty:"empty",back:"back",hover:"hover",goto:"goto"},checkbox:{box:"checkbox",active:"active",clicked:"clicked",focus:"focus"},hidden:"hidden",success:"success",error:"error",building:"building",initLoading:"initLoading",loading:"loading",revert:"revert",visible:"visible",highlight:"highlight",small:"small",desc:"desc",box:"box",dialog:"dialog",boxWrapper:"boxWrapper",contentBox:"contentBox",action:"action",incomplete:"incomplete"},attr:{type:"data-type",appearance:"data-appearance",name:"data-name",i18n:"data-i18n",value:"data-value",success:"data-successtext",style:"data-style",hideOnFalse:"data-hideOnFalse",buttons:{save:"data-save",restore:"data-restore"},range:{min:"data-min",max:"data-max",step:"data-step",unit:"data-unit",infinity:"data-infinity"},color:{alpha:"data-alpha",suggestions:"data-suggestions"},field:{placeholder:"data-placeholder"},translation:{releaseStatus:"data-status",language:"data-lang"}},elm:{body:e("body"),title:e("head > title"),aside:e("body > section#wrapper > aside"),content:e("body > section#wrapper > main"),header:e("body > header"),headline:e("body > header > h1"),advanced:{toggle:e("div.advanced > h3"),container:e("div.advanced > div")},buttons:{save:e("body > header > menu > li > button.save"),restore:e("body > header > menu > li > button.restore"),keyboardShortcut:e("div.tab[data-name='sidebar'] a.keyboardShortcut"),import:e("body a.import > input[type='file']"),export:e("body a.export")},appearance:{content:e("div.tab[data-name='appearance']"),presetWrapper:e("div.tab[data-name='appearance'] div.presets")},newtab:{content:e("div.tab[data-name='newtab']")},feedback:{wrapper:e("div.tab[data-name='feedback']"),form:e("section.form"),send:e("section.form button[type='submit']"),faq:e("div.faq")},translation:{wrapper:e("div.tab[data-name='language'] > div[data-name='translate']"),goto:e("div.tab[data-name='language'] > div[data-name='general'] a.button"),overview:e("div.tab[data-name='language'] > div[data-name='translate'] > div.overview"),langvars:e("div.tab[data-name='language'] > div[data-name='translate'] > div.langvars"),unavailable:e("div.tab[data-name='language'] > div[data-name='translate'] > div.unavailable")},formElement:e("div.formElement"),support:{shareInfoWrapper:e("div.tab[data-name='support'] div.shareInformation"),donate:e("div.tab[data-name='support'] a.donate")},preview:{},checkbox:{},range:{},select:{},color:{},textarea:{},field:{},radio:{}},events:{pageChanged:"blockbyte-bs-pageChanged"},ajax:{feedback:"https://extensions.blockbyte.de/ajax/feedback",translation:{info:"https://extensions.blockbyte.de/ajax/translation/bs/info",langvars:"https://extensions.blockbyte.de/ajax/translation/bs/langvars",submit:"https://extensions.blockbyte.de/ajax/translation/bs/submit"}},donateLink:"https://www.paypal.com/cgi-bin/webscr?cmd=_s-xclick&hosted_button_id=2VW2UADL99YEL",manifest:chrome.runtime.getManifest()},this.serviceAvailable=!0;let t=["behaviour","appearance","newtab"];this.run=(()=>{a();let t={body:this.helper.template.loading().appendTo(this.opts.elm.body)};this.opts.elm.body.addClass(this.opts.classes.initLoading),this.helper.model.init().then(()=>this.helper.i18n.init()).then(()=>(this.helper.font.init("default"),this.helper.stylesheet.init(),this.helper.stylesheet.addStylesheets(["settings"],e(document)),this.helper.form.init())).then(()=>(this.opts.elm.body.removeClass(this.opts.classes.building),this.helper.i18n.parseHtml(document),this.opts.elm.title.text(this.opts.elm.title.text()+" - "+this.helper.i18n.get("extension_name")),["translation","feedback"].forEach(e=>{t[e]=this.helper.template.loading().appendTo(this.opts.elm[e].wrapper),this.opts.elm[e].wrapper.addClass(this.opts.classes.loading)}),Promise.all([this.helper.menu.init(),this.helper.sidebar.init(),this.helper.appearance.init(),this.helper.newtab.init(),this.helper.support.init(),this.helper.importExport.init()]))).then(()=>(s(),t.body.remove(),this.opts.elm.body.removeClass(this.opts.classes.initLoading),this.helper.model.call("trackPageView",{page:"/settings"}),this.helper.model.call("websiteStatus"))).then(e=>{this.serviceAvailable="available"===e.status,this.helper.feedback.init(),this.helper.translation.init(),["translation","feedback"].forEach(e=>{t[e].remove(),this.opts.elm[e].wrapper.removeClass(this.opts.classes.loading)})})}),this.showSuccessMessage=(t=>{this.opts.elm.body.attr(this.opts.attr.success,this.helper.i18n.get("settings_"+t)),this.opts.elm.body.addClass(this.opts.classes.success),e.delay(1500).then(()=>{this.opts.elm.body.removeClass(this.opts.classes.success)})});let a=()=>{this.helper={model:new window.ModelHelper(this),checkbox:new window.CheckboxHelper(this),template:new window.TemplateHelper(this),i18n:new window.I18nHelper(this),font:new window.FontHelper(this),stylesheet:new window.StylesheetHelper(this),translation:new window.TranslationHelper(this),menu:new window.MenuHelper(this),form:new window.FormHelper(this),sidebar:new window.SidebarHelper(this),newtab:new window.NewtabHelper(this),appearance:new window.AppearanceHelper(this),feedback:new window.FeedbackHelper(this),importExport:new window.ImportExportHelper(this),support:new window.SupportHelper(this)}},s=async()=>{e(document).on("click",()=>{e("div."+this.opts.classes.dialog).removeClass(this.opts.classes.visible)}),this.opts.elm.header.on("click","div."+this.opts.classes.dialog,e=>{e.stopPropagation()}),this.opts.elm.header.on("click","div."+this.opts.classes.dialog+" > a",a=>{a.preventDefault(),a.stopPropagation();let s=e(a.currentTarget).parent("div").attr(this.opts.attr.type);if(-1!==t.indexOf(s)){let t=[];"appearance"===s&&t.push(new Promise(e=>{chrome.storage.local.get(["utility"],t=>{let a=t.utility||{};delete a.customCss,chrome.storage.local.set({utility:a},()=>{e()})})})),t.push(new Promise(t=>{chrome.storage.sync.remove([s],()=>{this.showSuccessMessage("restored_message"),this.helper.model.call("reloadIcon"),e("div."+this.opts.classes.dialog).removeClass(this.opts.classes.visible),t()})})),Promise.all(t).then(()=>e.delay(1500)).then(()=>{this.helper.model.call("reinitialize"),location.reload(!0)})}}),this.opts.elm.advanced.container.css("display","none"),this.opts.elm.advanced.toggle.on("click",t=>{let a=e(t.currentTarget).next("div");a.hasClass(this.opts.classes.visible)?(a.removeClass(this.opts.classes.visible),e.delay(300).then(()=>{a.css("display","none")})):(a.css("display","flex"),e.delay(0).then(()=>{a.addClass(this.opts.classes.visible)}))}),this.opts.elm.buttons.save.on("click",e=>{e.preventDefault(),"translate"===this.helper.menu.getPath()[1]?this.helper.translation.submit():Promise.all([this.helper.sidebar.save(),this.helper.appearance.save(),this.helper.newtab.save()]).then(()=>{this.helper.model.call("reinitialize"),this.showSuccessMessage("saved_message")})}),this.opts.elm.buttons.restore.on("click",a=>{a.preventDefault();let s=this.helper.menu.getPath(),l=s[0];if("sidebar"===l&&(l="behaviour"),-1!==t.indexOf(l)){e("div."+this.opts.classes.dialog).remove();let t=e("<div />").attr(this.opts.attr.type,l).addClass(this.opts.classes.dialog).append("<p>"+this.helper.i18n.get("settings_restore_confirm")+"</p>").append("<span>"+this.helper.i18n.get("settings_menu_"+s[0])+"</span>").append("<br />").append("<a>"+this.helper.i18n.get("settings_restore")+"</a>").css("right",this.opts.elm.header.css("padding-right")).appendTo(this.opts.elm.header);e.delay().then(()=>{t.addClass(this.opts.classes.visible)})}})}},(new window.settings).run()})(jsu);