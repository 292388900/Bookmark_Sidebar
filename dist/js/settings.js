/*! (c) Philipp KÃ¶nig under GPL-3.0 */
"use strict";function _defineProperty(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};!function(e,t){function a(e){return void 0!==e}function n(e){return"string"==typeof e}function s(e){return"object"===(void 0===e?"undefined":_typeof(e))}function o(e){return Object.keys(e).length}function r(e,t,a){return e<t?t:e>a?a:e}function i(e,t){return parseInt(e,t||10)}function c(e){return Math.round(e)}function l(e){var t,a,n,s,o,r,i,l,p=+e[0],d=+e[1],u=+e[2];switch(s=Math.floor(6*p),o=6*p-s,r=u*(1-d),i=u*(1-o*d),l=u*(1-(1-o)*d),s=s||0,i=i||0,l=l||0,s%6){case 0:t=u,a=l,n=r;break;case 1:t=i,a=u,n=r;break;case 2:t=r,a=u,n=l;break;case 3:t=r,a=i,n=u;break;case 4:t=l,a=r,n=u;break;case 5:t=u,a=r,n=i}return[c(255*t),c(255*a),c(255*n)]}function p(e){return u(l(e))}function d(e){var t,a=+e[0],n=+e[1],s=+e[2],o=Math.max(a,n,s),r=Math.min(a,n,s),i=o-r,c=0===o?0:i/o,l=o/255;switch(o){case r:t=0;break;case a:t=n-s+i*(n<s?6:0),t/=6*i;break;case n:t=s-a+2*i,t/=6*i;break;case s:t=a-n+4*i,t/=6*i}return[t,c,l]}function u(e){var t=+e[2]|+e[1]<<8|+e[0]<<16;return(t="000000"+t.toString(16)).slice(-6)}function f(e){return d(h(e))}function h(e){return 3===e.length&&(e=e.replace(/./g,"$&$&")),[i(e[0]+e[1],16),i(e[2]+e[3],16),i(e[4]+e[5],16)]}function m(e){return[+e[0]/360,+e[1]/100,+e[2]/100]}function g(e){return[c(360*+e[0]),c(100*+e[1]),c(100*+e[2])]}function b(e){return[+e[0]/255,+e[1]/255,+e[2]/255]}function v(e){if(s(e))return e;var t=/\s*rgb\s*\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*\)\s*$/i.exec(e),a=/\s*hsv\s*\(\s*(\d+)\s*,\s*(\d+)%\s*,\s*(\d+)%\s*\)\s*$/i.exec(e);return"#"===e[0]&&e.match(/^#([\da-f]{3}|[\da-f]{6})$/i)?f(e.slice(1)):a?m([+a[1],+a[2],+a[3]]):t?d([+t[1],+t[2],+t[3]]):[0,1,1]}var k="firstChild",y="scrollLeft",w="scrollTop",x="offsetLeft",C="offsetTop",T=setTimeout;!function(e){e.version="1.3.4",e.__instance__={},e.each=function(t,a){return T(function(){var a,n=e.__instance__;for(a in n)t(n[a],a,n)},0===a?0:a||1),e},e.parse=v,e._HSV2RGB=l,e._HSV2HEX=p,e._RGB2HSV=d,e._HEX2HSV=f,e._HEX2RGB=function(e){return b(h(e))},e.HSV2RGB=function(e){return l(m(e))},e.HSV2HEX=function(e){return p(m(e))},e.RGB2HSV=function(e){return g(d(e))},e.RGB2HEX=u,e.HEX2HSV=function(e){return g(f(e))},e.HEX2RGB=h}(e.CP=function(i,c){function d(e,t,a){for(var n=0,s=(e=e.split(/\s+/)).length;n<s;++n)t.addEventListener(e[n],a,!1)}function u(e,t,a){for(var n=0,s=(e=e.split(/\s+/)).length;n<s;++n)t.removeEventListener(e[n],a)}function f(e,t){var a=t.touches?t.touches[0].pageX:t.pageX,n=t.touches?t.touches[0].pageY:t.pageY,s=h(e);return{x:a-s.l,y:n-s.t}}function h(t){if(t===e)var a=e.pageXOffset||L[y],n=e.pageYOffset||L[w];else for(var a=t[x]-t.scrollLeft,n=t[C]-t.scrollTop;t=t.offsetParent;)a+=t[x]-t.scrollLeft,n+=t[C]-t.scrollTop;return{l:a,t:n}}function m(e,t){for(;(e=e.parentElement)&&e!==t;);return e}function g(e){e&&e.preventDefault()}function b(t){return t===e?{w:e.innerWidth,h:e.innerHeight}:{w:t.offsetWidth,h:t.offsetHeight}}function v(e){return j||!!a(e)&&e}function E(e){j=e}function _(e,t,n){return a(e)?a(t)?(a(F[e])||(F[e]={}),a(n)||(n=o(F[e])),F[e][n]=t,I):F[e]:F}function S(e,t){return a(e)?a(t)?(delete F[e][t],I):(F[e]={},I):(F={},I)}function H(e,t,n){if(!a(F[e]))return I;if(a(n))a(F[e][n])&&F[e][n].apply(I,t);else for(var s in F[e])F[e][s].apply(I,t);return I}function D(e,t){e&&"h"!==e||H("change:h",t),e&&"sv"!==e||H("change:sv",t),H("change",t)}function M(){return R.parentNode}function A(a,n){function s(e){l(z);var t=l([z[0],1,1]);W.style.backgroundColor="rgb("+t.join(",")+")",E(z),g(e)}function o(e){var t=r(f(N,e).y,0,_);z[0]=(_-t)/_,$.style.top=t-j/2+"px",s(e)}function h(e){var t=f(W,e),a=r(t.x,0,S),n=r(t.y,0,L);z[1]=1-(S-a)/S,z[2]=(L-n)/L,Y.style.right=S-a-F/2+"px",Y.style.top=n-V/2+"px",s(e)}function k(e){Q&&(o(e),se=p(z),J||(H("drag:h",[se,I]),H("drag",[se,I]),D("h",[se,I]))),Z&&(h(e),se=p(z),K||(H("drag:sv",[se,I]),H("drag",[se,I]),D("sv",[se,I]))),J=0,K=0}function y(e){var t=e.target,a=Q?"h":"sv",n=[p(z),I],s=t===i||m(t,i)===i,o=t===R||m(t,R)===R;s||o?o&&(H("stop:"+a,n),H("stop",n),D(a,n)):M()&&!1!==c&&(I.exit(),H("exit",[I]),D(0,n)),Q=0,Z=0}function w(e){J=1,Q=1,k(e),g(e),H("start:h",[se,I]),H("start",[se,I]),D("h",[se,I])}function x(e){K=1,Z=1,k(e),g(e),H("start:sv",[se,I]),H("start",[se,I]),D("sv",[se,I])}a||((n||P).appendChild(R),I.visible=!0),ae=b(R).w,ne=b(R).h;var C=b(W),T=b(Y),_=b(N).h,S=C.w,L=C.h,j=b($).h,F=T.w,V=T.h;if(a){var ee=function(e){var t=e.target,a=t===i||m(t,i)===i;a?A():I.exit(),H(a?"enter":"exit",[I])};R.style.left=R.style.top="-9999px",!1!==c&&d(c,i,ee),I.create=function(){return A(1),H("create",[I]),I},I.destroy=function(){return!1!==c&&u(c,i,ee),I.exit(),E(!1),H("destroy",[I]),I}}else O();G=function(){z=v(z),s(),$.style.top=_-j/2-_*+z[0]+"px",Y.style.right=S-F/2-S*+z[1]+"px",Y.style.top=L-V/2-L*+z[2]+"px"},I.exit=function(a){return M()&&(M().removeChild(R),I.visible=!1),u(B,N,w),u(B,W,x),u(X,t,k),u(q,t,y),u(U,e,O),I},G(),a||(d(B,N,w),d(B,W,x),d(X,t,k),d(q,t,y),d(U,e,O))}function O(){return I.fit()}var P=t.body,L=t.documentElement,I=this,j=!1,F={},R=t.createElement("div"),B="touchstart mousedown",X="touchmove mousemove",q="touchend mouseup",U="orientationchange resize";if(!(I instanceof CP))return new CP(i,c);CP.__instance__[i.id||i.name||o(CP.__instance__)]=I,a(c)||(c=B),E(CP.parse(i.getAttribute("data-color")||i.value||[0,1,1])),R.className="color-picker",R.innerHTML='<div class="color-picker-control"><span class="color-picker-h"><i></i></span><span class="color-picker-sv"><i></i></span></div>';var G,V=R[k].children,z=v([0,1,1]),N=V[0],W=V[1],$=N[k],Y=W[k],J=0,K=0,Q=0,Z=0,ee=0,te=0,ae=0,ne=0,se=p(z);return A(1),T(function(){var e=[p(z),I];H("create",e),D(0,e)},0),I.fit=function(t){var n=b(e),o=b(L),r=o.h>n.h,c=h(e),l=(h(L),r?o.w:n.w+c.l),p=r?n.h+c.t:Math.max(o.h,n.h),d=h(i);return ee=d.l,te=d.t+b(i).h,s(t)?(a(t[0])&&(ee=t[0]),a(t[1])&&(te=t[1])):(ee+ae>l&&(ee=l-ae),te+ne>p&&(te=p-ne)),R.style.left=ee+"px",R.style.top=te+"px",H("fit",[I]),I},I.set=function(e){return a(e)?(n(e)&&(e=CP.parse(e)),E(e),G(),I):v()},I.get=function(e){return v(e)},I.target=i,I.picker=R,I.visible=!1,I.on=_,I.off=S,I.trigger=H,I.hooks=F,I.enter=function(e){return A(0,e)},I})}(window,document),function(e){window.CheckboxHelper=function(t){var a=this,n={};this.get=function(n,s){var o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"checkbox",i=e("<div />").html("<input type='checkbox' />").data("uid",Math.random().toString(36).substr(2,12)).attr(t.opts.attr.type,o).addClass(t.opts.classes.checkbox.box);return void 0!==s&&(i.children("input[type='checkbox']").attr(s),s[t.opts.attr.name]&&i.attr(t.opts.attr.name,s[t.opts.attr.name])),a.isChecked(i)&&i.addClass(t.opts.classes.checkbox.active),r(i,n),i},this.isChecked=function(e){return e.find("input[type='checkbox']")[0].checked};var s=function(e,a){var n=e.children("input[type='checkbox']");n.trigger("change"),a.document()[0].dispatchEvent(new CustomEvent(t.opts.events.checkboxChanged,{detail:{container:e,checkbox:n,checked:e.hasClass(t.opts.classes.checkbox.active)},bubbles:!0,cancelable:!1}))},o=function o(r,i){r.addClass(t.opts.classes.checkbox.clicked),r.removeClass(t.opts.classes.checkbox.focus),r.toggleClass(t.opts.classes.checkbox.active);var c=r.hasClass(t.opts.classes.checkbox.active),l=r.children("input[type='checkbox']");if("radio"===r.attr(t.opts.attr.type)&&r.attr(t.opts.attr.name))if(i){var p=r.attr(t.opts.attr.name);r.addClass(t.opts.classes.checkbox.active),c&&(l.attr("checked",!0),s(r,i)),i.find("div."+t.opts.classes.checkbox.box+"["+t.opts.attr.type+"='radio']["+t.opts.attr.name+"='"+p+"']").forEach(function(t){var n=e(t);t!==r[0]&&a.isChecked(n)&&o(n)})}else l.attr("checked",!1);else l.attr("checked",c),s(r,i);var d=r.data("uid");n[d]&&clearTimeout(n[d]),n[d]=setTimeout(function(){r.removeClass(t.opts.classes.checkbox.clicked)},300)},r=function(a,n){a.on("mousedown",function(a){a.preventDefault(),a.stopPropagation(),e(a.currentTarget).addClass(t.opts.classes.checkbox.focus)}).on("click",function(t){t.preventDefault(),t.stopPropagation(),o(e(t.currentTarget),n)}),n.on("click",function(){a.removeClass(t.opts.classes.checkbox.focus)})}},window.AppearanceHelper=function(t){var a=this,n={sidebar:{template:"sidebar",styles:["sidebar"]},general:{template:"sidebar",styles:["sidebar"]},overlay:{template:"overlay",styles:["overlay"]},indicator:{template:"indicator",styles:["contentBase","content"]}};this.init=function(){c(),["sidebarPosition","language"].forEach(function(e){var a=t.helper.model.getData("a/"+e);t.opts.elm.select[e][0].value=a,t.opts.elm.select[e].data("initial",a)}),["darkMode"].forEach(function(e){var a=!1;!0===t.helper.model.getData("a/"+e)&&(t.opts.elm.checkbox[e].trigger("click"),a=!0),t.opts.elm.checkbox[e].children("input").data("initial",a)});var e=t.helper.model.getData("a/styles");setTimeout(function(){Object.keys(e).forEach(function(a){var n=e[a];t.opts.elm.range[a]?(t.opts.elm.range[a][0].value=n.replace("px",""),t.opts.elm.range[a].data("initial",n.replace("px","")),t.opts.elm.range[a].trigger("change")):t.opts.elm.color[a]?(t.opts.elm.color[a].data("initial",n),s(t.opts.elm.color[a],n)):t.opts.elm.select[a]&&("fontFamily"===a&&0===t.opts.elm.select[a].children("option[value='"+n+"']").length()&&(n="default"),t.opts.elm.select[a][0].value=n,t.opts.elm.select[a].data("initial",n))}),l()},0)},this.save=function(){var e=i();e.isEE&&(delete e.isEE,e.styles.colorScheme="__color_ee"),chrome.storage.sync.set({appearance:e},function(){t.helper.model.call("refreshAllTabs",{type:"Settings"}),t.showSuccessMessage("saved_message"),t.opts.elm.select.language.data("initial")!==e.language&&setTimeout(function(){location.reload(!0)},1500)})};var s=function(e,t){var a=e.data("picker");if(t.search(/rgba\(/)>-1){var n=t.replace(/(rgba|\(|\))/gi,"").split(",");t="rgb("+n[0]+","+n[1]+","+n[2]+")",a.alpha&&(a.alpha[0].value=n[3])}a.set(t),a.trigger("change")},o=function(e,t){var a=new XMLHttpRequest;a.open("GET",chrome.extension.getURL(e),!0),a.onload=function(){a.response&&t(a.response)},a.send()},r=function(a){if(t.opts.elm.preview[a]){t.opts.elm.preview[a].find("head > style").remove();var s=i();if("default"===s.styles.fontFamily){var o=t.helper.font.getDefaultFontInfo();s.styles.fontFamily=o.name}Object.assign(s.styles,t.helper.font.getFontWeights(s.styles.fontFamily));var r=n[a].css;Object.keys(s.styles).forEach(function(e){r=r.replace(new RegExp('"?%'+e+'"?',"g"),s.styles[e])}),t.opts.elm.preview[a].find("["+t.opts.attr.style+"]").forEach(function(a){var n=e(a).attr(t.opts.attr.style);Object.keys(s.styles).forEach(function(e){n=n.replace(new RegExp('"?%'+e+'"?',"g"),s.styles[e])}),a.style.cssText=n}),t.opts.elm.preview[a].find("["+t.opts.attr.hideOnFalse+"]").forEach(function(a){var n=e(a).attr(t.opts.attr.hideOnFalse);void 0===s[n]||!1===s[n]?e(a).css("display","none"):e(a).css("display","block")}),t.opts.elm.preview[a].find("["+t.opts.attr.classOnTrue+"]").forEach(function(a){var n=e(a).attr(t.opts.attr.classOnTrue).split("?"),o=n[0],r=n[1];void 0!==s[o]&&!0===s[o]?e(a).addClass(r):e(a).removeClass(r)}),t.opts.elm.body.attr(t.opts.attr.pos,s.sidebarPosition),t.opts.elm.preview[a].find("["+t.opts.attr.pos+"]").attr(t.opts.attr.pos,s.sidebarPosition),t.opts.elm.preview[a].find("head").append("<style>"+r+"</style>");var c=t.opts.elm.preview[a].find("section#sidebar");t.opts.elm.preview[a].find("div.modal");if(!0===s.isEE&&t.opts.elm.preview[a].find("body").addClass(t.opts.classes.page.ee),s.darkMode?t.opts.elm.preview[a].find("body").addClass(t.opts.classes.page.darkMode):t.opts.elm.preview[a].find("body").removeClass(t.opts.classes.page.darkMode),c.length()>0){var l=c.find("> header");l.find("> h1 > span").removeClass(t.opts.classes.hidden);var p=window.getComputedStyle(l[0]),d=parseInt(p.getPropertyValue("padding-top"));l.children("a").forEach(function(e){if(e.offsetTop>d)return l.find("> h1 > span").addClass(t.opts.classes.hidden),!0})}}},i=function(){var e={sidebarPosition:t.opts.elm.select.sidebarPosition[0].value,language:t.opts.elm.select.language[0].value,darkMode:t.helper.checkbox.isChecked(t.opts.elm.checkbox.darkMode),showIndicator:!0,showIndicatorIcon:!0,showBookmarkIcons:!0,styles:{}},a=t.helper.model.getData("a/styles");return Object.keys(a).forEach(function(a){t.opts.elm.range[a]?e.styles[a]=t.opts.elm.range[a][0].value+"px":t.opts.elm.color[a]?e.styles[a]=t.opts.elm.color[a][0].value:t.opts.elm.select[a]&&(e.styles[a]=t.opts.elm.select[a][0].value)}),0===parseInt(e.styles.indicatorWidth)&&(e.showIndicator=!1),0===parseInt(e.styles.indicatorIconSize)&&(e.showIndicatorIcon=!1),0===parseInt(e.styles.bookmarksIconSize)&&(e.showBookmarkIcons=!1),!0===a.isEE&&(e.isEE=!0),e},c=function(){Object.keys(n).forEach(function(a){n[a].css="",t.opts.elm.preview[a]=e("<iframe />").attr(t.opts.attr.appearance,a).addClass(t.opts.classes.hidden).appendTo(t.opts.elm.body),o("html/template/"+n[a].template+".html",function(e){e=(e=e.replace(/__MSG_\@\@extension_id__/g,chrome.runtime.id)).replace(/__DATE__CREATED__/g,t.helper.i18n.getLocaleDate(new Date("2016-11-25"))),t.opts.elm.preview[a].find("body").html(e),t.helper.i18n.parseHtml(t.opts.elm.preview[a]),t.helper.font.addStylesheet(t.opts.elm.preview[a])}),n[a].styles.forEach(function(e){o("css/"+e+".css",function(e){n[a].css+=e,r(a)})})})},l=function(){var n="blockbyte".split(""),o=0;e(document).on("keydown",function(e){e.key!==n[o]||t.opts.elm.appearance.content.hasClass(t.opts.classes.hidden)?o=0:++o>=n.length&&(t.opts.elm.color.colorScheme[0].value="__color_ee",a.save())}),t.opts.elm.appearance.content.find("input, select").on("change input",function(a){var n=e(a.currentTarget),o=a.currentTarget.value,i=n.data("initial");if("checkbox"===n.attr("type")&&(o=a.currentTarget.checked,e(n).parent()[0]===t.opts.elm.checkbox.darkMode[0])){var c=t.helper.model.getDefaultColor("textColor",o?"dark":"light");s(t.opts.elm.color.textColor,c),s(t.opts.elm.color.bookmarksDirColor,c),["sidebarMaskColor","colorScheme"].forEach(function(e){var a=t.helper.model.getDefaultColor(e,o?"dark":"light");s(t.opts.elm.color[e],a)})}var l=n;n.next("span").length()>0&&(l=n.next("span")),o!==i?0===l.next("a."+t.opts.classes.revert).length()&&e("<a href='#' />").addClass(t.opts.classes.revert).data("elm",n).insertAfter(l):l.next("a."+t.opts.classes.revert).remove();var p=n.parents("["+t.opts.attr.name+"]").eq(0).attr(t.opts.attr.name);r(p)}),t.opts.elm.appearance.content.on("click","a."+t.opts.classes.revert,function(t){t.preventDefault();var a=e(t.currentTarget).data("elm"),n=a.data("initial");a.data("picker")?s(a,n):(a[0].value=n,a.trigger("change"))}),t.opts.elm.appearance.backgroundChanger.on("click",function(a){a.preventDefault();var n=e(a.currentTarget).attr(t.opts.attr.bg);t.opts.elm.appearance.backgroundChanger.removeClass(t.opts.classes.tabs.active),e(a.currentTarget).addClass(t.opts.classes.tabs.active),t.opts.elm.body.attr(t.opts.attr.bg,n)}),t.opts.elm.appearance.backgroundChanger.eq(0).trigger("click"),e(document).on(t.opts.events.contentTabChanged,function(e){"appearance"===e.detail.headerTab&&Object.keys(t.opts.elm.preview).forEach(function(a){var n=t.opts.elm.preview[a];a===e.detail.contentTab?(n.removeClass(t.opts.classes.hidden),setTimeout(function(){r(a)},50)):n.addClass(t.opts.classes.hidden)})})}},window.BehaviourHelper=function(e){this.init=function(){t(),["rememberSearch","dirAccordion","animations","preventPageScroll","initialOpenOnNewTab"].forEach(function(t){!0===e.helper.model.getData("b/"+t)&&e.opts.elm.checkbox[t].trigger("click")});var a=e.helper.model.getData("b/pxTolerance");e.opts.elm.range.pxToleranceMaximized[0].value=a.maximized,e.opts.elm.range.pxToleranceWindowed[0].value=a.windowed,["openAction","linkAction","rememberState","newTab","newTabPosition"].forEach(function(t){e.opts.elm.select[t][0].value=e.helper.model.getData("b/"+t),e.opts.elm.select[t].trigger("change")}),["openDelay","dirOpenDuration","closeTimeout"].forEach(function(t){var a=e.helper.model.getData("b/"+t);if(-1===a){var n=e.opts.elm.range[t].data("infinityCheckbox");n&&n.length()>0&&n.trigger("click")}e.opts.elm.range[t][0].value=a,e.opts.elm.range[t].trigger("change")}),e.opts.elm.range.pxToleranceMaximized.trigger("change"),e.opts.elm.range.pxToleranceWindowed.trigger("change")},this.save=function(){var t={pxTolerance:{maximized:e.opts.elm.range.pxToleranceMaximized[0].value,windowed:e.opts.elm.range.pxToleranceWindowed[0].value}};["openAction","linkAction","rememberState","newTab","newTabPosition"].forEach(function(a){t[a]=e.opts.elm.select[a][0].value}),["openDelay","dirOpenDuration","closeTimeout"].forEach(function(a){var n=-1;!1===e.opts.elm.range[a].hasClass(e.opts.classes.range.inactive)&&(n=e.opts.elm.range[a][0].value),t[a]=n}),["rememberSearch","dirAccordion","animations","preventPageScroll","initialOpenOnNewTab"].forEach(function(a){t[a]=e.helper.checkbox.isChecked(e.opts.elm.checkbox[a])}),chrome.storage.sync.set({behaviour:t},function(){e.helper.model.call("refreshAllTabs",{type:"Settings"}),e.showSuccessMessage("saved_message")})};var t=function(){e.opts.elm.keyboardShortcutInfo.children("a").on("click",function(e){e.preventDefault(),chrome.tabs.create({url:"chrome://extensions/configureCommands",active:!0})})}},window.ContributeHelper=function(t){this.init=function(){a(),n()};var a=function(){var a=t.helper.i18n.getLanguage();if(a!==t.helper.i18n.getDefaultLanguage()){var n=new XMLHttpRequest;n.open("POST",t.opts.ajax.translationInfo,!0),n.onload=function(){var s=JSON.parse(n.responseText);s&&s.languages&&s.languages.some(function(n){if(n.name===a)return Object.keys(n.categories).some(function(a){if(("Settings"!==a||n.categories[a]/s.categories[a]*100>75)&&s.categories[a]>n.categories[a])return t.opts.elm.header.find("> ul."+t.opts.classes.tabs.list+" > li["+t.opts.attr.name+"='contribute']").attr("title",t.helper.i18n.get("translation_incomplete_info")).addClass(t.opts.classes.incomplete),e("<br />").appendTo(t.opts.elm.contribute.translationTabContent),e("<p />").addClass(t.opts.classes.incomplete).text(t.helper.i18n.get("translation_incomplete_info")).appendTo(t.opts.elm.contribute.translationTabContent),t.opts.elm.contribute.translationTabLink.trigger("click"),!0}),!0})},n.send()}},n=function(){chrome.storage.sync.get(["shareUserdata"],function(e){e.shareUserdata&&!0===e.shareUserdata&&t.opts.elm.checkbox.shareUserdata.trigger("click"),t.opts.elm.checkbox.shareUserdata.children("input[type='checkbox']").on("change",function(){chrome.storage.sync.set({shareUserdata:t.helper.checkbox.isChecked(t.opts.elm.checkbox.shareUserdata)},function(){t.showSuccessMessage("saved_share_userdata")})})}),t.opts.elm.contribute.action.on("click",function(a){switch(a.preventDefault(),e(a.currentTarget).parents("["+t.opts.attr.name+"]").eq(0).attr(t.opts.attr.name)){case"donation":window.open(t.opts.donateLink,"_blank");break;case"translation":window.open(chrome.extension.getURL("html/translate.html"),"_blank")}})}},window.FeedbackHelper=function(t){this.init=function(){t.opts.elm.feedback.faq.children("strong").on("click",function(a){a.preventDefault(),e(a.currentTarget).next("p").toggleClass(t.opts.classes.visible)}),t.opts.elm.feedback.faq.children("p > a").on("click",function(a){a.preventDefault(),"usage"===e(a.currentTarget).parent("p").attr(t.opts.attr.type)&&window.open(chrome.extension.getURL("html/howto.html")+"?tutorial=1","_blank")});var a=t.helper.template.loading().appendTo(t.opts.elm.feedback.form);t.opts.elm.feedback.send.addClass(t.opts.classes.hidden),t.opts.elm.feedback.form.addClass(t.opts.classes.loading),t.helper.model.call("websiteStatus",function(n){a.remove(),t.opts.elm.feedback.form.removeClass(t.opts.classes.loading),"available"===n.status?t.opts.elm.feedback.send.removeClass(t.opts.classes.hidden):(t.opts.elm.feedback.form.addClass(t.opts.classes.hidden),e("<p />").addClass(t.opts.classes.error).html(t.helper.i18n.get("status_feedback_unavailable_desc")+"<br />").append("<a href='mailto:feedback@blockbyte.de'>feedback@blockbyte.de</a>").insertAfter(t.opts.elm.feedback.form))})},this.send=function(){var a=t.opts.elm.textarea.feedbackMsg[0].value,n=t.opts.elm.field.feedbackEmail[0].value,s=n.length>0&&/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(n),o=a.length>0;if(s&&o){var r=+new Date,i=t.helper.template.loading().appendTo(t.opts.elm.body);t.opts.elm.body.addClass(t.opts.classes.loading);var c=new XMLHttpRequest;c.open("POST",t.opts.ajax.feedback,!0),c.onload=function(){setTimeout(function(){t.opts.elm.textarea.feedbackMsg[0].value="",t.opts.elm.field.feedbackEmail[0].value="",t.opts.elm.body.removeClass(t.opts.classes.loading),i.remove(),t.showSuccessMessage("feedback_sent_message")},Math.max(0,1e3-(+new Date-r)))};var l=new FormData;l.append("email",n),l.append("msg",a),l.append("extension",JSON.stringify({name:t.opts.manifest.name,version:t.opts.manifest.version})),c.send(l)}else s?o||t.opts.elm.textarea.feedbackMsg.addClass(t.opts.classes.error):t.opts.elm.field.feedbackEmail.addClass(t.opts.classes.error);setTimeout(function(){e("."+t.opts.classes.error).removeClass(t.opts.classes.error)},700)}},window.FormHelper=function(t){this.init=function(e){a(),n(e)};var a=function(){t.opts.elm.tab.children("div").on("scroll",function(){Object.values(t.opts.elm.color).forEach(function(e){e.data("picker").fit()})})},n=function(a){var n=t.opts.elm.formElement.length(),s=function(){0===--n&&"function"==typeof a&&a()};t.opts.elm.formElement.forEach(function(a){var n=e(a).attr(t.opts.attr.type),o=e(a).attr(t.opts.attr.name),r=e(a).attr(t.opts.attr.i18n)||"";e("<br />").insertAfter(a);var i=e("<label />").attr(t.opts.attr.i18n,r).insertAfter(a);switch(e("<p />").attr(t.opts.attr.i18n,r+"_desc").insertAfter(i),n){case"checkbox":t.opts.elm.checkbox[o]=t.helper.checkbox.get(t.opts.elm.body).insertAfter(i),s();break;case"text":case"email":t.opts.elm.field[o]=e("<input type='"+n+"' />").insertAfter(i),["placeholder"].forEach(function(n){var s=e(a).attr(t.opts.attr.field[n]);s&&t.opts.elm.field[o].attr(n,s)}),s();break;case"textarea":t.opts.elm.textarea[o]=e("<textarea />").insertAfter(i),s();break;case"language":t.opts.elm.select[o]=e("<select />").insertAfter(i),e("<option />").attr("value","default").text(t.helper.i18n.get("settings_language_default")).appendTo(t.opts.elm.select[o]),t.helper.model.call("languageInfos",function(a){if(a&&a.infos){var n=Object.values(a.infos);n.sort(function(e,t){return e.label>t.label?1:-1}),n.forEach(function(a){a.available&&e("<option />").attr("value",a.name).text(a.label).appendTo(t.opts.elm.select[o])})}s()});break;case"font":t.opts.elm.select[o]=e("<select />").insertAfter(i),chrome.fontSettings.getFontList(function(a){a.unshift({fontId:"default",displayName:t.helper.i18n.get("settings_font_family_default")}),a.forEach(function(a){0===t.opts.elm.select[o].children("option[value='"+a.fontId+"']").length()&&e("<option />").attr("value",a.fontId).text(a.displayName).appendTo(t.opts.elm.select[o])})}),s();break;case"color":t.opts.elm.color[o]=e("<input type='text' />").addClass(t.opts.classes.color.field).insertAfter(i);var c=e("<span />").insertAfter(t.opts.elm.color[o]),l=new CP(t.opts.elm.color[o][0]);e(a).attr(t.opts.attr.color.alpha)&&(l.alpha=e("<input type='range' />").attr({min:0,max:1,step:.01,value:1}).appendTo(l.picker),l.alpha.on("change input",function(){return l.trigger("change")})),l.on("change",function(e){var a=CP._HSV2RGB(l.set());e&&(a=CP.HEX2RGB(e)),l.alpha&&l.alpha.css("background-image","linear-gradient(to right, transparent 0%, rgb("+a.join(",")+") 100%),url("+chrome.extension.getURL("img/settings/alpha.webp")+")"),a=l.alpha&&+l.alpha[0].value<1?"rgba("+a.join(",")+","+l.alpha[0].value+")":"rgb("+a.join(",")+")",t.opts.elm.color[o][0].value=a,t.opts.elm.color[o].trigger("change"),c.css("background-color",a)}),t.opts.elm.color[o].data("picker",l),s();break;case"range":t.opts.elm.range[o]=e("<input type='range' />").insertAfter(i),["min","max","step"].forEach(function(n){var s=e(a).attr(t.opts.attr.range[n]);s&&t.opts.elm.range[o].attr(n,s)}),t.opts.elm.range[o].attr("value",e(a).attr(t.opts.attr.value)||"");var p=e(a).attr(t.opts.attr.range.unit)||"",d=e("<span />").insertAfter(t.opts.elm.range[o]);if(t.opts.elm.range[o].on("input change",function(a){var n=a.currentTarget,s=n.max||100,r=n.min||0,i=Math.round(100*(n.value-r)/(s-r)),c=t.opts.elm.range[o].css("background-image");if(0===c.search("linear-gradient")){var l=e(n).data("backgroundTemplate");void 0===l&&(l=c.replace(/\-1px/g,"{percent}"),e(n).data("backgroundTemplate",l)),t.opts.elm.range[o].css("background-image",l.replace(/\{percent\}/g,i+"%"))}d.text(n.value+p)}),t.opts.elm.range[o].trigger("input"),!0==!!e(a).attr(t.opts.attr.range.infinity)){var u=t.helper.checkbox.get(t.opts.elm.body).insertAfter(d);e("<label />").attr(t.opts.attr.i18n,r+"_infinity").insertAfter(u),u.children("input[type='checkbox'").on("change",function(e){e.currentTarget.checked?t.opts.elm.range[o].addClass(t.opts.classes.range.inactive):t.opts.elm.range[o].removeClass(t.opts.classes.range.inactive)}),t.opts.elm.range[o].data("infinityCheckbox",u)}s();break;case"select":t.opts.elm.select[o]=e("<select />").insertAfter(i),e(a).children("span").forEach(function(a){e("<option />").attr(_defineProperty({value:e(a).attr(t.opts.attr.value)},t.opts.attr.i18n,e(a).attr(t.opts.attr.i18n))).appendTo(t.opts.elm.select[o])}),s()}a.remove()})}},window.settings=function(){var t=this;this.opts={classes:{page:{darkMode:"dark",ee:"ee"},tabs:{content:"tab",list:"tabBar",active:"active"},color:{field:"color"},range:{inactive:"inactive"},checkbox:{box:"checkbox",active:"active",clicked:"clicked",focus:"focus"},hidden:"hidden",configEntry:"configEntry",success:"success",error:"error",initLoading:"initLoading",loading:"loading",revert:"revert",visible:"visible",gotoFeedback:"gotoFeedback",howto:"howto",action:"action",incomplete:"incomplete"},attr:{type:"data-type",appearance:"data-appearance",name:"data-name",i18n:"data-i18n",value:"data-value",tab:"data-tab",success:"data-successtext",style:"data-style",hideOnFalse:"data-hideOnFalse",classOnTrue:"data-classOnTrue",pos:"data-pos",bg:"data-bg",range:{min:"data-min",max:"data-max",step:"data-step",unit:"data-unit",infinity:"data-infinity"},color:{alpha:"data-alpha"},field:{placeholder:"data-placeholder"}},elm:{body:e("body"),title:e("head > title"),header:e("body > header"),content:e("section#content"),tab:e("section#content > div.tab"),contentTabs:e("ul.labels > li"),contentTabSections:e("ul.labels ~ div[data-name]"),copyrightDate:e("a#copyright > span"),keyboardShortcutInfo:e("p.shortcutInfo"),formElement:e("div.formElement"),appearance:{content:e("div.tab[data-name='appearance']"),backgroundChanger:e("menu.backgroundChanger > a")},contribute:{translationTabLink:e("div.tab[data-name='contribute'] ul.labels > li[data-type='translation'] > a"),translationTabContent:e("div.tab[data-name='contribute'] div[data-name='translation']"),action:e("div.tab[data-name='contribute'] a.action")},feedback:{form:e("section.form"),textarea:e("textarea#feedback"),email:e("input#feedbackEmail"),send:e("div.tab[data-name='feedback'] > header > button.save"),faq:e("div.faq")},button:{save:e("div.tab > header > button.save"),restore:e("div.tab > header > button.restore")},preview:{},checkbox:{},range:{},select:{},color:{},textarea:{},field:{}},events:{checkboxChanged:"blockbyte-bs-checkboxChanged",contentTabChanged:"blockbyte-bs-contentTabChanged"},ajax:{feedback:"https://blockbyte.de/ajax/extensions/feedback",translationInfo:"https://blockbyte.de/ajax/extensions/bs/i18n/info"},donateLink:"https://www.paypal.com/cgi-bin/webscr?cmd=_s-xclick&hosted_button_id=2VW2UADL99YEL",manifest:chrome.runtime.getManifest()},this.run=function(){a(),n(),t.helper.model.init(function(){t.helper.i18n.init(function(){t.helper.font.init(),t.helper.stylesheet.init(),t.helper.stylesheet.addStylesheets(["settings"],e(document)),o(),t.helper.form.init(function(){t.helper.template.footer().insertAfter(t.opts.elm.content),t.helper.i18n.parseHtml(document),t.opts.elm.title.text(t.opts.elm.title.text()+" - "+t.helper.i18n.get("extension_name")),t.helper.behaviour.init(),t.helper.appearance.init(),t.helper.feedback.init(),t.helper.contribute.init(),r(),s(),t.opts.elm.body.removeClass(t.opts.classes.initLoading)})})})},this.showSuccessMessage=function(e){t.opts.elm.body.attr(t.opts.attr.success,t.helper.i18n.get("settings_"+e)),t.opts.elm.body.addClass(t.opts.classes.success),setTimeout(function(){t.opts.elm.body.removeClass(t.opts.classes.success)},1500)};var a=function(){t.helper={model:new window.ModelHelper(t),checkbox:new window.CheckboxHelper(t),template:new window.TemplateHelper(t),i18n:new window.I18nHelper(t),font:new window.FontHelper(t),stylesheet:new window.StylesheetHelper(t),form:new window.FormHelper(t),behaviour:new window.BehaviourHelper(t),appearance:new window.AppearanceHelper(t),feedback:new window.FeedbackHelper(t),contribute:new window.ContributeHelper(t)}},n=function(){t.opts.elm.header.prepend('<svg height="48" width="48" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M19.43 12.98c.04-.32.07-.64.07-.98s-.03-.66-.07-.98l2.11-1.65c.19-.15.24-.42.12-.64l-2-3.46c-.12-.22-.39-.3-.61-.22l-2.49 1c-.52-.4-1.08-.73-1.69-.98l-.38-2.65C14.46 2.18 14.25 2 14 2h-4c-.25 0-.46.18-.49.42l-.38 2.65c-.61.25-1.17.59-1.69.98l-2.49-1c-.23-.09-.49 0-.61.22l-2 3.46c-.13.22-.07.49.12.64l2.11 1.65c-.04.32-.07.65-.07.98s.03.66.07.98l-2.11 1.65c-.19.15-.24.42-.12.64l2 3.46c.12.22.39.3.61.22l2.49-1c.52.4 1.08.73 1.69.98l.38 2.65c.03.24.24.42.49.42h4c.25 0 .46-.18.49-.42l.38-2.65c.61-.25 1.17-.59 1.69-.98l2.49 1c.23.09.49 0 .61-.22l2-3.46c.12-.22.07-.49-.12-.64l-2.11-1.65zM12 15.5c-1.93 0-3.5-1.57-3.5-3.5s1.57-3.5 3.5-3.5 3.5 1.57 3.5 3.5-1.57 3.5-3.5 3.5z"/></svg>')},s=function(){t.opts.elm.contentTabs.children("a").on("click",function(a){a.preventDefault();var n=e(a.currentTarget).parent("li"),s=n.parents("div."+t.opts.classes.tabs.content).eq(0).attr(t.opts.attr.name),o=n.attr(t.opts.attr.type);n.siblings("li").removeClass(t.opts.classes.tabs.active),n.addClass(t.opts.classes.tabs.active),e(a.currentTarget).parents("ul").eq(0).siblings("div["+t.opts.attr.name+"]").forEach(function(a){e(a).attr(t.opts.attr.name)===o?e(a).removeClass(t.opts.classes.hidden):e(a).addClass(t.opts.classes.hidden)}),document.dispatchEvent(new CustomEvent(t.opts.events.contentTabChanged,{detail:{headerTab:s,contentTab:o},bubbles:!0,cancelable:!1}))}),t.opts.elm.contentTabSections.addClass(t.opts.classes.hidden),setTimeout(function(){t.opts.elm.contentTabs.forEach(function(a){e(a).hasClass(t.opts.classes.tabs.active)&&e(a).children("a").trigger("click")})},0)},o=function(){var a=e("<ul />").addClass(t.opts.classes.tabs.list).prependTo(t.opts.elm.header);t.opts.elm.tab.forEach(function(n){var s=e(n).attr(t.opts.attr.name);e("<li />").attr(t.opts.attr.name,s).html("<a href='#'>"+t.helper.i18n.get("settings_tab_"+s)+"</a>").appendTo(a)}),a.find("> li > a").on("click",function(n){n.preventDefault(),a.children("li").removeClass(t.opts.classes.tabs.active);var s=e(n.currentTarget).parent("li"),o=s.attr(t.opts.attr.name);s.addClass(t.opts.classes.tabs.active),t.opts.elm.tab.forEach(function(a){e(a).attr(t.opts.attr.name)===o?e(a).removeClass(t.opts.classes.hidden):e(a).addClass(t.opts.classes.hidden)}),location.hash=o,t.opts.elm.body.attr(t.opts.attr.tab,o)});var n=location.hash?location.hash.substr(1):null;a.find("> li > a").eq(0).trigger("click"),n&&a.find("> li["+t.opts.attr.name+"='"+n+"'] > a").trigger("click")},r=function(){t.opts.elm.button.save.on("click",function(e){switch(e.preventDefault(),t.opts.elm.body.attr(t.opts.attr.tab)){case"behaviour":t.helper.behaviour.save();break;case"appearance":t.helper.appearance.save();break;case"feedback":t.helper.feedback.send()}}),t.opts.elm.button.restore.attr("title",t.helper.i18n.get("settings_restore")),t.opts.elm.button.restore.on("click",function(e){e.preventDefault();var a=t.opts.elm.body.attr(t.opts.attr.tab);switch(a){case"behaviour":case"appearance":chrome.storage.sync.remove([a],function(){t.helper.model.call("refreshAllTabs",{type:"Settings"}),t.showSuccessMessage("restored_message"),setTimeout(function(){location.reload(!0)},1500)})}})}},(new window.settings).run()}(jsu);