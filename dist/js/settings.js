/*! (c) Philipp KÃ¶nig under GPL-3.0 */
(e=>{"use strict";e.opts={ids:{page:{iframe:"blockbyte-bs-sidebar",overlay:"blockbyte-bs-overlay",indicator:"blockbyte-bs-indicator"},sidebar:{sidebar:"sidebar",shareInfo:"shareInfo",reloadInfo:"reloadInfo",bookmarkBox:{all:"bookmarkBox",search:"bookmarkBoxSearch"}},overlay:{urlList:"urlList"}},classes:{general:{active:"active",visible:"visible",hidden:"hidden",success:"success",error:"error",close:"close",hover:"hover",loading:"loading",building:"building",initLoading:"initLoading"},page:{visible:"blockbyte-bs-visible",hideMask:"blockbyte-bs-hideMask",hover:"blockbyte-bs-hover",noscroll:"blockbyte-bs-noscroll",hasLeftsideBack:"blockbyte-bs-has-lsb",style:"blockbyte-bs-style",fullHeight:"blockbyte-bs-fullHeight",noAnimations:"noAnimations",darkMode:"dark",highContrast:"highContrast"},sidebar:{extLoaded:"loaded",openedOnce:"openedOnce",permanent:"permanent",cached:"cached",mark:"mark",hideRoot:"hideRoot",dirAnimated:"animated",dirOpened:"opened",bookmarkDir:"dir",dirIcon:"icon",separator:"separator",bookmarkLink:"link",bookmarkLabel:"label",entryPinned:"pinned",menu:"menu",sort:"sort",fixed:"fixed",lockPinned:"lockPinned",lastHover:"lastHover",copied:"copied",filterBox:"filter",search:"search",searchBox:"searchBox",searchClose:"searchClose",searchVisible:"searchVisible",removeMask:"removeMask",removed:"removed",restored:"restored"},tooltip:{wrapper:"tooltip"},contextmenu:{wrapper:"contextmenu",top:"top",list:"list",icons:"icons",right:"right",separator:"separator"},drag:{trigger:"drag",helper:"dragHelper",isDragged:"isDragged",cancel:"dragCancel",dragHover:"dragHover",snap:"snap",dragInitial:"dragInitial"},scrollBox:{wrapper:"scrollBox",hideScrollbar:"hideScrollbar",scrolled:"scrolled"},checkbox:{box:"checkbox",clicked:"clicked",focus:"focus"},overlay:{modal:"modal",preview:"preview",previewUrl:"previewUrl",info:"info",action:"action",progressBar:"progressBar",buttonWrapper:"buttons",checkUrlProgressLabel:"progressLabel",urlCheckLoading:"urlCheckLoading",urlCheckList:"urlCheckList"},newtab:{smallContent:"small",chromeApps:"chromeApps",suggestions:"suggestions",edit:"edit",add:"add",link:"link",permanentSidebar:"permanentSidebar",remove:"remove",infoBar:"infoBar",save:"save",cancel:"cancel"},onboarding:{slide:"slide",skip:"skip",close:"close",settings:"settings",appearance:"appearance",hideOpenTypeIcon:"hideOpenType",large:"large"}},attr:{uid:"data-blockbyte-bs-uid",src:"data-src",position:"data-pos",type:"data-type",name:"data-name",value:"data-value",sort:"data-sort",direction:"data-direction",style:"data-style",id:"data-id",newtab:{perRow:"data-perRow"},onboarding:{openType:"data-openType",surface:"data-surface"}},events:{loaded:"blockbyte-bs-loaded",elementsCreated:"blockbyte-bs-created",openSidebar:"blockbyte-bs-sidebar-open",sidebarOpened:"blockbyte-bs-sidebar-opened",checkboxChanged:"blockbyte-bs-checkbox-changed",scrollBoxLastPart:"blockbyte-bs-scrollbox-lastpart",lsbLoaded:"blockbyte-lsb-loaded"},leftsideBackSelector:"div#blockbyte-lsb-indicator.blockbyte-lsb-visible",manifest:chrome.runtime.getManifest(),demoMode:!1},e.cl=e.opts.classes,e.attr=e.opts.attr,window.AppearanceHelper=function(t){let a={sidebar:{template:"sidebar",styles:["sidebar"]},general:{template:"sidebar",styles:["sidebar"]},overlay:{template:"overlay",styles:["overlay"]},indicator:{template:"indicator",styles:["contentBase","content"]}},l={sidebarHeaderHeight:{xs:32,s:36,l:55},bookmarksFontSize:{xs:11,s:12,l:16},bookmarksLineHeight:{xs:20,s:26,l:45},sidebarWidth:{xs:250,s:300,l:400},bookmarksDirIndentation:{xs:20,s:22,l:30},bookmarksHorizontalPadding:{xs:6,s:10,l:18},bookmarksIconSize:{xs:12,s:14,l:18},directoriesIconSize:{xs:12,s:14,l:18},scrollBarWidth:{xs:10,s:11,l:12},tooltipFontSize:{xs:9,s:9,l:12}},s=null,n=null;this.init=(()=>new Promise(a=>{b().then(()=>{["darkMode"].forEach(e=>{let a=!1;!0===t.helper.model.getData("a/"+e)&&(t.opts.elm.checkbox[e].trigger("click"),a=!0),t.opts.elm.checkbox[e].children("input").data("initial",a)});let l=t.helper.model.getData("u/customCss");t.opts.elm.textarea.customCss[0].value=l,t.opts.elm.textarea.customCss.data("initial",l),t.opts.elm.textarea.customCss.parent().append("<span>"+t.helper.i18n.get("settings_not_synced")+"</span>");let s=t.helper.model.getData("a/styles");Object.entries(s).forEach(([e,a])=>{t.opts.elm.range[e]?(t.opts.elm.range[e][0].value=a.replace("px",""),t.opts.elm.range[e].data("initial",a.replace("px","")),t.opts.elm.range[e].trigger("change")):t.opts.elm.color[e]?(o(t.opts.elm.color[e],a),t.opts.elm.color[e].data("initial",t.opts.elm.color[e][0].value)):t.opts.elm.select[e]?("fontFamily"===e&&0===t.opts.elm.select[e].children("option[value='"+a+"']").length()&&(a="default"),t.opts.elm.select[e][0].value=a,t.opts.elm.select[e].data("initial",a)):t.opts.elm.radio[e]&&(t.opts.elm.radio[e][0].value=a,t.opts.elm.radio[e].trigger("change"),t.opts.elm.radio[e].data("initial",a))}),u(),e.delay(100).then(()=>{r(),a()})})})),this.save=(()=>new Promise(e=>{let t=g();chrome.storage.sync.set({appearance:t.appearance},()=>{chrome.storage.local.get(["utility"],a=>{let l=a.utility||{};l.customCss=t.utility.customCss,chrome.storage.local.set({utility:l},()=>{e()})})})}));let o=(e,t)=>{let a=e.data("picker");a&&a.setColor(t)},r=()=>{Object.keys(t.opts.elm.preview).forEach(e=>{i(e)})},i=l=>{let s=g();if(t.opts.elm.preview[l]){if(t.opts.elm.preview[l].find("head > style").remove(),"default"===s.appearance.styles.fontFamily){let e=t.helper.font.getDefaultFontInfo();s.appearance.styles.fontFamily=e.name}h(l),Object.assign(s.appearance.styles,t.helper.font.getFontWeights(s.appearance.styles.fontFamily));let n=a[l].css;n+=s.utility.customCss,Object.keys(s.appearance.styles).forEach(e=>{n=n.replace(new RegExp('"?%'+e+'"?',"g"),s.appearance.styles[e])}),t.opts.elm.preview[l].find("["+t.attr.style+"]").forEach(a=>{let l=e(a).attr(t.attr.style);Object.keys(s.appearance.styles).forEach(e=>{l=l.replace(new RegExp('"?%'+e+'"?',"g"),s.appearance.styles[e])}),a.style.cssText=l}),t.opts.elm.preview[l].find("["+t.attr.hideOnFalse+"]").forEach(a=>{let l=e(a).attr(t.attr.hideOnFalse);void 0===s.appearance[l]||!1===s.appearance[l]?e(a).css("display","none"):e(a).css("display","block")}),t.opts.elm.preview[l].find("head").append("<style>"+n+"</style>"),s.appearance.darkMode?t.opts.elm.preview[l].find("body").addClass(t.cl.page.darkMode):t.opts.elm.preview[l].find("body").removeClass(t.cl.page.darkMode),p(t.opts.elm.preview[l]),c(t.opts.elm.preview[l]),d(t.opts.elm.preview[l])}else"icon"===l&&t.helper.model.call("updateIcon",{name:s.appearance.styles.iconShape,color:s.appearance.styles.iconColor,onlyCurrentTab:!0})},d=e=>{let a=e.find("div#blockbyte-bs-indicator");if(a.length()>0){let e=+t.opts.elm.range.toggleArea_height[0].value,l=+t.opts.elm.range.toggleArea_top[0].value;a.css({height:e+"%",top:l+"%"}),100===e?a.addClass(t.cl.appearance.preview.fullHeight):a.removeClass(t.cl.appearance.preview.fullHeight)}},c=e=>{let a=e.find("section#sidebar");if(a.length()>0){let e=a.find("> header");e.find("> h1").removeClass(t.cl.hidden),e.find("> h1 > span").removeClass(t.cl.hidden),["label","amount"].forEach(a=>{let l=null;e.children("a").forEach(s=>{if(null===l)l=s.offsetTop;else if(l!==s.offsetTop||0===e.find("> h1")[0].offsetTop)return"label"===a?e.find("> h1 > span").addClass(t.cl.hidden):"amount"===a&&e.find("> h1").addClass(t.cl.hidden),!1})})}},p=e=>{let a=e.find("div.tooltip"),l=e.find("li > a.hover");if(a.length()>0&&l.length()>0)if(+new Date-s<2e3){let e=l[0].getBoundingClientRect();a.addClass(t.cl.visible);let s=e.x-a[0].offsetWidth;t.helper.i18n.isRtl()&&(s=e.x+l[0].offsetWidth),a.css({top:e.y+l.realHeight()/2-a.realHeight()/2+"px",left:s+"px"})}else a.removeClass(t.cl.visible)},h=e=>{if(t.opts.elm.content.removeClass(t.cl.small),t.opts.elm.preview[e]){let a="padding-"+(t.helper.i18n.isRtl()?"left":"right"),l=g();if(null!==t.opts.elm.preview[e][0].offsetParent){let s=0;"overlay"===e?t.opts.elm.content.addClass(t.cl.small):"indicator"===e?s=l.appearance.styles.indicatorWidth:"sidebar"!==e&&"general"!==e||(s=l.appearance.styles.sidebarWidth),t.opts.elm.header.css(a,s),t.opts.elm.content.css(a,s)}else t.opts.elm.header.css(a,""),t.opts.elm.content.css(a,"");if(t.helper.menu.getPage().find("div."+t.cl.box).length()>1){let e=!1,a=null;t.helper.menu.getPage().find("div."+t.cl.box).forEach(t=>{if(a===t.offsetTop)return e=!0,!1;a=t.offsetTop}),e||t.opts.elm.content.addClass(t.cl.small)}}},g=()=>{let e={utility:{customCss:t.opts.elm.textarea.customCss[0].value},appearance:{darkMode:t.helper.checkbox.isChecked(t.opts.elm.checkbox.darkMode),highContrast:!1,showIndicator:!0,showIndicatorIcon:!0,showBookmarkIcons:!0,showDirectoryIcons:!0,styles:{}}},a=t.helper.model.getData("a/styles");return Object.keys(a).forEach(a=>{if(t.opts.elm.range[a])e.appearance.styles[a]=t.opts.elm.range[a][0].value+"px";else if(t.opts.elm.color[a]){let l=m(a,t.opts.elm.color[a][0].value);if(e.appearance.styles[a]=l.color,"colorScheme"===a){let a=l.luminance?l.luminance:0;e.appearance.styles.foregroundColor=t.helper.model.getDefaultColor("foregroundColor",a>170?"dark":"light"),a>215&&(e.appearance.highContrast=!0)}}else t.opts.elm.select[a]?e.appearance.styles[a]=t.opts.elm.select[a][0].value:t.opts.elm.radio[a]&&(e.appearance.styles[a]=t.opts.elm.radio[a][0].value)}),Object.entries({indicatorWidth:"showIndicator",indicatorIconSize:"showIndicatorIcon",bookmarksIconSize:"showBookmarkIcons",directoriesIconSize:"showDirectoryIcons"}).forEach(([t,a])=>{0===parseInt(e.appearance.styles[t])&&(e.appearance[a]=!1)}),e},m=(e,a)=>{let l=null,s=t.opts.elm.color[e].data("picker");if(s){let e=s.getColorObj();0===e.a&&(a="transparent"),l=.299*e.r+.587*e.g+.114*e.b}return{color:a,luminance:l}},b=()=>new Promise(l=>{let s=0,n=Object.keys(a).length;Object.keys(a).forEach(o=>{a[o].css="",t.opts.elm.preview[o]=e("<iframe />").attr(t.attr.appearance,o).appendTo(t.opts.elm.body),e.xhr(chrome.extension.getURL("html/template/"+a[o].template+".html")).then(e=>{if(e&&e.responseText){let a=e.responseText;a=(a=a.replace(/__DATE__CREATED__/g,t.helper.i18n.getLocaleDate(new Date("2016-11-25")))).replace(/__POSITION__/g,t.helper.i18n.isRtl()?"left":"right");let r=t.opts.elm.preview[o].find("body");r.html(a),r.parent("html").attr("dir",t.helper.i18n.isRtl()?"rtl":"ltr"),t.helper.i18n.parseHtml(t.opts.elm.preview[o]),t.helper.font.addStylesheet(t.opts.elm.preview[o]),++s===n&&l()}}),a[o].styles.forEach(t=>{e.xhr(chrome.extension.getURL("css/"+t+".css")).then(e=>{e&&e.responseText&&(a[o].css+=e.responseText)})})})}),u=()=>{e(window).on("resize",function(){let e=t.helper.menu.getPath();e&&e[1]&&h(e[1])}),t.opts.elm.appearance.presetWrapper.children("a").on("click",a=>{let s=e(a.currentTarget).attr(t.attr.type),n=t.helper.model.getData("a/styles",!0);Object.entries(l).forEach(([e,a])=>{a[s]?t.opts.elm.range[e][0].value=a[s]:t.opts.elm.range[e][0].value=n[e].replace("px",""),t.opts.elm.range[e].trigger("change")})}),t.opts.elm.range.tooltipFontSize.on("change, input",()=>{s=+new Date,n&&clearTimeout(n),n=setTimeout(()=>{i("sidebar")},2001)}),t.opts.elm.appearance.content.find("input, textarea, select").on("change input",a=>{let l=e(a.currentTarget),s=a.currentTarget.value,n=l.data("initial");if(void 0!==n){if("checkbox"===l.attr("type")&&(s=a.currentTarget.checked,e(l).parent()[0]===t.opts.elm.checkbox.darkMode[0])){let e=t.helper.model.getDefaultColor("textColor",s?"dark":"light");o(t.opts.elm.color.textColor,e),o(t.opts.elm.color.bookmarksDirColor,e),["sidebarMaskColor","colorScheme","hoverColor"].forEach(e=>{let a=t.helper.model.getDefaultColor(e,s?"dark":"light");o(t.opts.elm.color[e],a)})}let r=e(a.currentTarget).parents("div."+t.cl.box).eq(0);s!==n?0===r.children("a."+t.cl.revert).length()&&e("<a href='#' />").addClass(t.cl.revert).data("elm",r).appendTo(r):r.children("a."+t.cl.revert).remove();let d=t.helper.menu.getPath();i(d[1])}}),t.opts.elm.appearance.content.on("click","a."+t.cl.revert,a=>{a.preventDefault(),e(a.currentTarget).parent("div."+t.cl.box).find("input, select").forEach(t=>{let a=e(t),l=a.data("initial");a.data("picker")?o(a,l):void 0!==l&&("checkbox"===a.attr("type")&&"boolean"==typeof l?t.checked!==l&&a.parent("div").trigger("click"):(t.value=l,a.trigger("change")))})}),e(document).on(t.opts.events.pageChanged,e=>{e.detail.path&&"appearance"===e.detail.path[0]&&i(e.detail.path[1])})}},window.FeedbackHelper=function(t){let a=null,l={displayed:[],opened:[],closed:[]};this.init=(()=>new Promise(a=>{if(t.serviceAvailable){let l=t.helper.menu.getPath(),s=l.length>=2&&"feedback"===l[0]&&"error"===l[1]&&l[2];s&&t.opts.elm.feedback.wrapper.addClass(t.cl.feedback.onlySuggestions),d(),Promise.all([n()]).then(()=>(s&&o(l[2]),e.delay(700))).then(()=>{a()})}else t.opts.elm.feedback.form.addClass(t.cl.hidden),e("<p />").addClass(t.cl.error).html(t.helper.i18n.get("status_feedback_unavailable_desc")+"<br />").append("<a href='mailto:feedback@blockbyte.de'>feedback@blockbyte.de</a>").insertAfter(t.opts.elm.feedback.form),a()}));let s=()=>{let e=t.opts.elm.feedback.feedback[0].offsetHeight;t.opts.elm.feedback.suggestions.css("max-height",e+"px")},n=()=>new Promise(l=>{e.xhr(t.opts.ajax.feedback.suggestions).then(e=>{if(e&&e.responseText){let t=JSON.parse(e.responseText);t&&t.suggestions&&t.controls&&(a=t)}l()})}),o=e=>{let t=[],s=!1;"general"===e?t=["not_working","webstore","system_pages"]:"filter"===e&&(t=["blacklisted_whitelisted"],s=!0),t.forEach((e,t)=>{a&&a.suggestions&&a.suggestions[e]&&(l.displayed.push(e),r(e,a.suggestions[e],s))})},r=(l,s,n=!1)=>{if(a&&a.controls){t.helper.model.call("trackEvent",{category:"settings",action:"suggestion_display",label:l,always:!0});let o=e("<div />").addClass([t.cl.feedback.suggestion,t.cl.hidden,t.cl.feedback.absolute]).attr(t.attr.type,l).append("<strong>"+s.question.message+"</strong>").append("<div class='"+t.cl.feedback.answer+"'>"+s.answer.message+"</div>").appendTo(t.opts.elm.feedback.suggestions);e("<p />").append("<a "+t.attr.value+"='1'>"+a.controls.yes.message+"</a>").append("<a "+t.attr.value+"='0'>"+a.controls.no.message+"</a>").appendTo(o),o.data("links",s.answer.links||[]);let r=o.children("div."+t.cl.feedback.answer);e.delay().then(()=>(r.css("height",r[0].offsetHeight+"px"),r.addClass([t.cl.feedback.noHeight,t.cl.hidden]),e.delay(300))).then(()=>(o.css("height",o[0].offsetHeight+"px"),o.addClass(t.cl.feedback.noHeight),e.delay(300))).then(()=>(o.removeClass([t.cl.feedback.absolute,t.cl.feedback.noHeight]),e.delay(300))).then(()=>{o.css("height","").removeClass(t.cl.hidden),t.opts.elm.feedback.suggestions.addClass(t.cl.visible),n&&i(o)})}},i=s=>{let n=s.attr(t.attr.type);l.opened.push(n),t.helper.model.call("trackEvent",{category:"settings",action:"suggestion_true",label:n,always:!0});let o=s.children("p").html("");s.data("links").forEach(t=>{e("<a />").attr("href",t.target).text(t.message).appendTo(o)}),e("<a />").attr(t.attr.value,"0").text(a.controls.close.message).appendTo(o),s.children("div."+t.cl.feedback.answer).removeClass(t.cl.feedback.noHeight),e.delay(300).then(()=>{s.children("div."+t.cl.feedback.answer).removeClass(t.cl.hidden)})},d=async()=>{e(window).on("resize",()=>{s()}),t.opts.elm.textarea.feedbackMsg.on("mouseup",()=>{s()}).on("keyup",e=>{(e=>{a&&a.suggestions&&Object.entries(a.suggestions).some(([t,a])=>{let s=!1;if(a.keywords.some(t=>{if(e.search(new RegExp(t,"i"))>-1)return s=!0,!0}),s&&-1===l.displayed.indexOf(t))return l.displayed.push(t),r(t,a),!0})})(e.currentTarget.value)}),t.opts.elm.feedback.showForm.on("click",e=>{e.preventDefault(),t.opts.elm.feedback.wrapper.removeClass(t.cl.feedback.onlySuggestions)}),t.opts.elm.feedback.suggestions.on("click","a[href]:not([href^='#'])",t=>{t.preventDefault(),chrome.tabs.create({url:e(t.currentTarget).attr("href"),active:!0})}),t.opts.elm.feedback.suggestions.on("click","a["+t.attr.value+"]",a=>{a.preventDefault();let s=+e(a.currentTarget).attr(t.attr.value),n=e(a.currentTarget).parents("div."+t.cl.feedback.suggestion).eq(0);1===s?i(n):(a=>{l.closed.push(a.attr(t.attr.type)),a.css("height",a[0].offsetHeight+"px").addClass(t.cl.hidden),e.delay(200).then(()=>(a.addClass(t.cl.feedback.noHeight),e.delay(300))).then(()=>(a.remove(),e.delay())).then(()=>{0===t.opts.elm.feedback.suggestions.children("div."+t.cl.feedback.suggestion).length()&&(t.opts.elm.feedback.suggestions.removeClass(t.cl.visible),e.delay(300).then(()=>{t.opts.elm.feedback.wrapper.removeClass(t.cl.feedback.onlySuggestions)}))})})(n)}),t.opts.elm.feedback.send.on("click",e=>{e.preventDefault(),c()})},c=()=>{let a=t.opts.elm.textarea.feedbackMsg[0].value,s=t.opts.elm.field.feedbackEmail[0].value,n=s.length>0&&/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(s),o=a.length>0;if(n&&o){let n=+new Date,o=t.helper.template.loading().appendTo(t.opts.elm.body);t.opts.elm.body.addClass(t.cl.loading);let r=null;e.xhr(t.opts.ajax.feedback.form,{method:"POST",data:{email:s,msg:a,version:t.opts.manifest.version_name,ua:navigator.userAgent,lang:t.helper.i18n.getLanguage(),config:t.helper.importExport.getExportConfig(),suggestions:l}}).then(t=>(r=JSON.parse(t.responseText),e.delay(Math.max(0,1e3-(+new Date-n))))).then(()=>{t.opts.elm.body.removeClass(t.cl.loading),o.remove(),r&&r.success&&!0===r.success?(t.helper.model.call("trackEvent",{category:"settings",action:"feedback",label:"submitted",always:!0}),t.opts.elm.textarea.feedbackMsg[0].value="",t.opts.elm.field.feedbackEmail[0].value="",t.showSuccessMessage("feedback_sent_message")):e.delay().then(()=>{alert(t.helper.i18n.get("settings_feedback_send_failed"))})})}else n?o||t.opts.elm.textarea.feedbackMsg.addClass(t.cl.error):t.opts.elm.field.feedbackEmail.addClass(t.cl.error);e.delay(700).then(()=>{e("."+t.cl.error).removeClass(t.cl.error)})}},window.FormHelper=function(t){let a={};this.init=(()=>new Promise(e=>{l(),s().then(e)}));let l=()=>{t.opts.elm.content.on("scroll",()=>{"appearance"===t.helper.menu.getPath()[0]&&Object.values(t.opts.elm.color).forEach(e=>{e.data("picker").reposition()})})},s=()=>new Promise(l=>{let s=t.opts.elm.formElement.length(),n=()=>{0===--s&&l()};t.opts.elm.formElement.forEach(l=>{let s={elm:l,type:e(l).attr(t.attr.type),name:e(l).attr(t.attr.name),i18n:e(l).attr(t.attr.i18n)||""};s.label=e("<label />").attr(t.attr.i18n,s.i18n).insertAfter(l),e("<p />").addClass(t.cl.desc).attr(t.attr.i18n,s.i18n+"_desc").insertAfter(s.label),a[s.type]?a[s.type](s).then(n):n(),l.remove()})});a.color=(a=>new Promise(l=>{t.opts.elm.color[a.name]=e("<input type='text' />").addClass(t.cl.color.field).insertAfter(a.label);let s=new window.Colorpicker(t.opts.elm.color[a.name][0],{alpha:!!e(a.elm).attr(t.attr.color.alpha)}),n=e(a.elm).attr(t.attr.color.suggestions);if(n){let a=JSON.parse(n),l=[],o=s.getElements().preview;a.forEach(a=>{l.push(e("<span />").addClass(t.cl.color.suggestion).attr(t.attr.value,a).css("background-color",a).insertAfter(o))}),e(l).on("click",a=>{a.stopPropagation();let l=e(a.currentTarget).attr(t.attr.value);s.setColor(l),s.show()})}let o=l=>{let n=t.opts.elm.body.children("div."+t.cl.color.mask+"["+t.attr.name+"='"+a.name+"']");l&&s.visible&&-1!==a.name.search(/MaskColor$/)?(0===n.length()&&(n=e("<div />").addClass(t.cl.color.mask).attr(t.attr.name,a.name).appendTo(t.opts.elm.body)),n.css("background-color",l)):n.length()>0&&n.remove()};s.on("show",e=>{s.visible=!0,o(e.color)}),s.on("hide",()=>{s.visible=!1,o()}),s.on("change",e=>{t.opts.elm.color[a.name].trigger("change"),o(e.color)}),t.opts.elm.color[a.name].data("picker",s),l()})),a.font=(a=>new Promise(l=>{t.opts.elm.select[a.name]=e("<select />").insertAfter(a.label),chrome.fontSettings.getFontList(l=>{l.unshift({fontId:"default",displayName:t.helper.i18n.get("settings_font_family_default")}),l.forEach(l=>{0===t.opts.elm.select[a.name].children("option[value='"+l.fontId.replace(/\'/g,"\\27")+"']").length()&&e("<option />").attr("value",l.fontId).text(l.displayName).appendTo(t.opts.elm.select[a.name])})}),l()})),a.language=(a=>new Promise(l=>{t.opts.elm.select[a.name]=e("<select />").insertAfter(a.label),e("<option />").attr("value","default").text(t.helper.i18n.get("settings_language_default")).appendTo(t.opts.elm.select[a.name]),t.helper.model.call("languageInfos").then(s=>{if(s&&s.infos){let l=Object.values(s.infos);l.sort((e,t)=>e.label>t.label?1:-1),l.forEach(l=>{l.available&&e("<option />").attr("value",l.name).text(l.label).appendTo(t.opts.elm.select[a.name])})}l()})})),a.textarea=(a=>new Promise(l=>{t.opts.elm.textarea[a.name]=e("<textarea />").attr(t.attr.name,a.name).insertAfter(a.label),l()})),a.text=a.email=(a=>new Promise(l=>{t.opts.elm.field[a.name]=e("<input type='"+a.type+"' />").insertAfter(a.label),["placeholder"].forEach(l=>{let s=e(a.elm).attr(t.attr.field[l]);s&&t.opts.elm.field[a.name].attr(l,s)}),l()})),a.radio=(a=>new Promise(l=>{t.opts.elm.radio[a.name]=e("<select />").addClass(t.cl.hidden).insertAfter(a.label);let s=e("<ul />").addClass(t.cl.radio.wrapper).insertAfter(t.opts.elm.radio[a.name]);e(a.elm).children("span").forEach(l=>{let n=e(l).attr(t.attr.value),o=e("<li />").attr(t.attr.value,n).appendTo(s);e(t.helper.checkbox.get(t.opts.elm.body,{[t.attr.name]:a.name,[t.attr.value]:n},"radio")).appendTo(o),e(l).appendTo(o),e("<option />").attr("value",n).text(n).appendTo(t.opts.elm.radio[a.name])}),t.opts.elm.radio[a.name].on("change",e=>{if(void 0===e.detail||"userAction"!==e.detail){let a=s.find("input[type='checkbox']["+t.attr.value+"='"+e.currentTarget.value+"']");a.length()>0&&a.parent("div").trigger("click")}}),s.find("input[type='checkbox']").on("change",l=>{t.opts.elm.radio[a.name][0].value=e(l.currentTarget).attr(t.attr.value),t.opts.elm.radio[a.name].trigger("change",{detail:"userAction"})}),l()})),a.range=(a=>new Promise(l=>{t.opts.elm.range[a.name]=e("<input type='range' />").insertAfter(a.label),["min","max","step"].forEach(l=>{let s=e(a.elm).attr(t.attr.range[l]);s&&t.opts.elm.range[a.name].attr(l,s)}),t.opts.elm.range[a.name].attr("value",e(a.elm).attr(t.attr.value)||"");let s=e(a.elm).attr(t.attr.range.unit)||"",n=e("<span />").insertAfter(t.opts.elm.range[a.name]);if(t.opts.elm.range[a.name].on("input change",l=>{let o=l.currentTarget,r=o.max||100,i=o.min||0,d=Math.round(100*(o.value-i)/(r-i)),c=t.opts.elm.range[a.name].css("background-image");if(c&&0===c.search("linear-gradient")){let l=e(o).data("backgroundTemplate");void 0===l&&(l=c.replace(/-1px/g,"{percent}"),e(o).data("backgroundTemplate",l)),t.opts.elm.range[a.name].css("background-image",l.replace(/{percent}/g,d+"%"))}n.text(o.value+s)}),t.opts.elm.range[a.name].trigger("input"),"1"===e(a.elm).attr(t.attr.range.infinity)){let l=t.helper.checkbox.get(t.opts.elm.body).insertAfter(n);e("<label />").attr(t.attr.i18n,a.i18n+"_infinity").insertAfter(l),e("<br />").insertBefore(l),l.children("input[type='checkbox']").on("change",e=>{e.currentTarget.checked?t.opts.elm.range[a.name].addClass(t.cl.range.inactive):t.opts.elm.range[a.name].removeClass(t.cl.range.inactive)}),t.opts.elm.range[a.name].data("infinityCheckbox",l)}l()})),a.select=(a=>new Promise(l=>{t.opts.elm.select[a.name]=e("<select />").insertAfter(a.label),e(a.elm).children("span").forEach(l=>{let s=e(l).attr(t.attr.i18n),n=e("<option />").attr({value:e(l).attr(t.attr.value)}).html(e(l).html()).appendTo(t.opts.elm.select[a.name]);s&&n.attr(t.attr.i18n,s)}),l()})),a.checkbox=(a=>new Promise(l=>{let s=e(a.elm).attr(t.attr.style)||"default";t.opts.elm.checkbox[a.name]=t.helper.checkbox.get(t.opts.elm.body,{[t.attr.name]:a.name},"checkbox",s).insertAfter(a.label),l()}))},window.ImportExportHelper=function(t){this.init=(async()=>{s(),l()}),this.getExportConfig=(()=>{let e=Object.assign({},t.helper.model.getAllData());return delete e.utility,e});let a=()=>{t.helper.model.call("trackEvent",{category:"settings",action:"import",label:"failed"}),window.alert(t.helper.i18n.get("settings_import_failed"))},l=async()=>{t.opts.elm.buttons.import.on("change",l=>{l.preventDefault();let s=l.currentTarget;if(s.files&&s.files[0]&&(s.files[0].name.search(/\.bookmark_sidebar$/)>-1||s.files[0].name.search(/\.config$/)>-1)){let l=new FileReader;l.onload=(l=>{try{let s=JSON.parse(l.target.result);s.behaviour&&s.appearance&&s.newtab?chrome.storage.sync.set({behaviour:s.behaviour,appearance:s.appearance,newtab:s.newtab},()=>{t.helper.model.call("trackEvent",{category:"settings",action:"import",label:"import"}),t.helper.model.call("reinitialize"),t.showSuccessMessage("import_saved"),e.delay(1500).then(()=>{location.reload(!0)})}):a()}catch(l){a()}}),l.readAsText(s.files[0])}else a()})},s=async()=>{t.opts.elm.buttons.export.on("click",e=>{e.preventDefault(),chrome.permissions.request({permissions:["downloads"]},e=>{if(e){let e=new Blob([JSON.stringify(this.getExportConfig())],{type:"application/json"});chrome.downloads.download({url:URL.createObjectURL(e),filename:n(),saveAs:!0}),t.helper.model.call("trackEvent",{category:"settings",action:"export",label:"export"})}})})},n=()=>{let e=new Date;return"config_"+(e.getDate()+"-"+["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sept","Oct","Nov","Dec"][e.getMonth()]+"-"+e.getFullYear())+".bookmark_sidebar"}},window.MenuHelper=function(t){let a=!1,l=!0,s=null,n=null,o=null;this.init=(()=>new Promise(a=>{s=e("<ul />").appendTo(t.opts.elm.aside.children("nav"));let n=t.opts.elm.content.children("div."+t.cl.tabs.content).length(),o=()=>{0===--n&&r().then(()=>{l=!1,a()})};t.opts.elm.content.children("div."+t.cl.tabs.content).forEach(a=>{let l=e(a).attr(t.attr.name),n=e("<li />").attr(t.attr.name,l).html("<a href='#'>"+t.helper.i18n.get("settings_menu_"+l)+"</a>").appendTo(s),r=e(a).children("div["+t.attr.name+"]");if(r.length()>0){let a=e("<ul />").appendTo(n);r.forEach(s=>{let n=e(s).attr(t.attr.name);e("<li />").attr(t.attr.name,n).html("<a href='#'>"+t.helper.i18n.get("settings_menu_"+l+"_"+n)+"</a>").appendTo(a)}),e.delay(500).then(()=>{a.children("li").forEach(t=>{e(t).data("height",t.scrollHeight)}),o()})}else o()}),i()})),this.getPage=(()=>o||e()),this.getPath=(()=>n),this.addBreadcrumb=(a=>{t.opts.elm.content[0].scrollTop=0,a.depth&&n.length>=a.depth?(n[a.depth-1]=a.alias,t.opts.elm.headline.children("span").forEach((t,l)=>{l>=a.depth-1&&e(t).remove()})):n.push(a.alias),t.opts.elm.headline.append("<span>"+a.label+"</span>")});let r=()=>new Promise(t=>{let a=location.hash?location.hash.substr(1):null;a?c(...a.split("_")):s.find("a").eq(0).trigger("click"),e.delay(300).then(t)}),i=()=>{s.find("a").on("click",a=>{a.preventDefault();let l=e(a.currentTarget).parent("li"),s=l.attr(t.attr.name);if(l.parents("li").length()>0){let e=l.parent("ul").parent("li").attr(t.attr.name);c(e,s)}else c(s)}),t.opts.elm.headline.on("click","span",t=>{let a=e(t.currentTarget).prevAll().length();c(...n.slice(0,a+1))}),e(window).on("popstate",()=>{r()})},d=()=>{let e=this.getPath(),a=[t.opts.elm.content.children("div."+t.cl.tabs.content+"["+t.attr.name+"='"+e[0]+"']")];t.opts.elm.header.attr(t.attr.type,e[0]),e[1]&&a.unshift(a[0].children("div["+t.attr.name+"='"+e[1]+"']")),["save","restore"].forEach(e=>{a.some(a=>{let l=a.attr(t.attr.buttons[e]);if(t.opts.elm.buttons[e].addClass(t.cl.hidden),l)return"false"!==l&&t.opts.elm.buttons[e].html("true"===l?"":t.helper.i18n.get(l)).removeClass(t.cl.hidden),!0})})},c=(...l)=>new Promise(r=>{if(a)r();else{a=!0;let i=l.length,c=[],p=s.children("li["+t.attr.name+"='"+l[0]+"']"),h=t.opts.elm.content.children("div."+t.cl.tabs.content+"["+t.attr.name+"='"+l[0]+"']");1===i&&h.find("> div["+t.attr.name+"]").length()>0&&(p.hasClass(t.cl.incomplete)&&"language"===l[0]?l.push(h.find("> div["+t.attr.name+"='translate']").eq(0).attr(t.attr.name)):l.push(h.find("> div["+t.attr.name+"]").eq(0).attr(t.attr.name)),i++);let g=l.join("_");(()=>{s.find("li").removeClass(t.cl.tabs.active);let e=t.opts.elm.content.children("div."+t.cl.tabs.content);e.removeClass(t.cl.tabs.active),e.children("div["+t.attr.name+"]").removeClass(t.cl.tabs.active),s.find("ul").css("height","")})();for(let a=1;a<=i;a++){let s=p.parent("ul");if(s&&s.length()>0){p.addClass(t.cl.tabs.active),h.addClass(t.cl.tabs.active),c.push(p.children("a").html());let n=0;s.children("li:not(."+t.cl.hidden+")").forEach(t=>{n+=e(t).data("height")||0}),n>0&&s.css("height",n+"px"),a<i&&(p=p.find("> ul > li["+t.attr.name+"='"+l[a]+"']"),h=h.find("> div["+t.attr.name+"='"+l[a]+"']"))}}t.opts.elm.headline.html("<span>"+c.join("</span><span>")+"</span>"),t.opts.elm.body.attr(t.attr.type,g),location.hash=g,o=h,n=l,t.opts.elm.content[0].scrollTop=0,d();let m="padding-"+(t.helper.i18n.isRtl()?"left":"right");t.opts.elm.header.css(m,""),t.opts.elm.content.css(m,""),document.dispatchEvent(new CustomEvent(t.opts.events.pageChanged,{detail:{path:l},bubbles:!0,cancelable:!1})),t.helper.model.call("trackEvent",{category:"settings",action:"page",label:g}),e.delay().then(()=>{a=!1,r()})}})},window.NewtabHelper=function(e){let t=!1;this.init=(async()=>{a(),e.opts.elm.newtab.content.find("div."+e.cl.newtab.hideable).addClass(e.cl.hidden),["override","autoOpen"].forEach(a=>{!0===e.helper.model.getData("n/"+a)?"override"===a?chrome.permissions.contains({permissions:["tabs","topSites"]},l=>{l&&e.opts.elm.checkbox[a].trigger("click"),t=!0}):e.opts.elm.checkbox[a].trigger("click"):"override"===a&&(t=!0)}),["website"].forEach(t=>{e.opts.elm.field[t][0].value=e.helper.model.getData("n/"+t)})}),this.save=(()=>new Promise(t=>{chrome.storage.sync.get(["newtab"],a=>{let l=a.newtab||{};["override","autoOpen"].forEach(t=>{l[t]=e.helper.checkbox.isChecked(e.opts.elm.checkbox[t])}),["website"].forEach(t=>{l[t]=e.opts.elm.field[t][0].value.trim()}),l.website&&l.website.length&&0!==l.website.search(/^\w+\:\/\//)&&(l.website="http://"+l.website),chrome.storage.sync.set({newtab:l},t)})}));let a=()=>{e.opts.elm.checkbox.override.children("input[type='checkbox']").on("change",()=>{let a=e.helper.checkbox.isChecked(e.opts.elm.checkbox.override),l=e.opts.elm.newtab.content.find("div."+e.cl.newtab.hideable);a?!0===t?chrome.permissions.request({permissions:["tabs","topSites"]},t=>{t||(e.opts.elm.checkbox.override.trigger("click"),a=!1),a?l.removeClass(e.cl.hidden):l.addClass(e.cl.hidden)}):l.removeClass(e.cl.hidden):l.addClass(e.cl.hidden)})}},window.SidebarHelper=function(t){this.init=(async()=>{n(),s(),l(),a(),["dirAccordion","animations","contextmenu","preventPageScroll","reopenSidebar","preventWindowed","dndOpen"].forEach(e=>{!0===t.helper.model.getData("b/"+e)&&t.opts.elm.checkbox[e].trigger("click")}),t.opts.elm.select.language[0].value=t.helper.i18n.getLanguage(),["visibility","openAction","sidebarPosition","linkAction","rememberState","newTab","newTabPosition","tooltipContent"].forEach(e=>{t.opts.elm.select[e][0].value=t.helper.model.getData("b/"+e),t.opts.elm.select[e].trigger("change")}),["openDelay","dirOpenDuration","openChildrenWarnLimit","scrollBarHide","closeTimeout","tooltipDelay"].forEach(e=>{let a=t.helper.model.getData("b/"+e);if(-1===a){let a=t.opts.elm.range[e].data("infinityCheckbox");a&&a.length()>0&&a.trigger("click")}t.opts.elm.range[e][0].value=a,t.opts.elm.range[e].trigger("change")})}),this.save=(()=>new Promise(a=>{let l={toggleArea:{},blacklist:[],whitelist:[]};if(["width","height","top","widthWindowed"].forEach(e=>{l.toggleArea[e]=t.opts.elm.range["toggleArea_"+e][0].value}),["visibility","openAction","sidebarPosition","linkAction","rememberState","newTab","newTabPosition","tooltipContent"].forEach(e=>{l[e]=t.opts.elm.select[e][0].value}),["openDelay","dirOpenDuration","openChildrenWarnLimit","scrollBarHide","closeTimeout","tooltipDelay"].forEach(e=>{let a=-1;!1===t.opts.elm.range[e].hasClass(t.cl.range.inactive)&&(a=t.opts.elm.range[e][0].value),l[e]=a}),["dirAccordion","animations","contextmenu","preventPageScroll","reopenSidebar","preventWindowed","dndOpen"].forEach(e=>{l[e]=t.helper.checkbox.isChecked(t.opts.elm.checkbox[e])}),"blacklist"===l.visibility||"whitelist"===l.visibility){let e=t.opts.elm.textarea.visibilityFilter[0].value;l[l.visibility]=e.split(/\n+/),""===l[l.visibility][0]&&(l.visibility="always")}let s=t.opts.elm.select.language[0].value;s===t.helper.i18n.getUILanguage()&&(s="default"),chrome.storage.sync.get(["language"],t=>{chrome.storage.sync.set({behaviour:l,language:s},()=>{t&&t.language&&t.language===s||e.delay(1500).then(()=>{location.reload(!0)}),a()})})}));let a=()=>{t.opts.elm.textarea.visibilityFilter.attr("placeholder","example.com/*\n*.example.com/*"),t.opts.elm.select.visibility.on("change",e=>{let a=e.currentTarget.value;if("always"===a)t.opts.elm.sidebar.filterExplanation.addClass(t.cl.hidden),t.opts.elm.sidebar.filterPatters.addClass(t.cl.hidden);else if(("blacklist"===a||"whitelist"===a)&&(t.opts.elm.sidebar.filterExplanation.removeClass(t.cl.hidden),t.opts.elm.sidebar.filterPatters.removeClass(t.cl.hidden),0===t.opts.elm.textarea.visibilityFilter[0].value.length)){let e=t.helper.model.getData("b/"+a);t.opts.elm.textarea.visibilityFilter[0].value=e.join("\n")}})},l=()=>{let e=t.helper.model.getData("b/toggleArea");["width","height","top","widthWindowed"].forEach(a=>{t.opts.elm.range["toggleArea_"+a][0].value=e[a],t.opts.elm.range["toggleArea_"+a].trigger("change")})},s=async()=>{let a=t.opts.elm.body.children("div."+t.cl.toggleArea.modal),s=a.children("div."+t.cl.toggleArea.preview);e([t.opts.elm.range.toggleArea_width,t.opts.elm.range.toggleArea_height,t.opts.elm.range.toggleArea_top]).on("change input",e=>{let a=+t.opts.elm.range.toggleArea_width[0].value,l=+t.opts.elm.range.toggleArea_height[0].value,n=+t.opts.elm.range.toggleArea_top[0].value;if(l+n>100){let a=null;e.currentTarget===t.opts.elm.range.toggleArea_height[0]?a=n-(l+n-100):e.currentTarget===t.opts.elm.range.toggleArea_top[0]&&(a=100-l),null!==a&&(t.opts.elm.range.toggleArea_top[0].value=a,t.opts.elm.range.toggleArea_top.trigger("change"))}else s.css({width:14+a+"px",height:l+"%",top:n+"%"}),100===l?s.addClass(t.cl.toggleArea.fullHeight):s.removeClass(t.cl.toggleArea.fullHeight)}),t.opts.elm.buttons.toggleAreaOpen.on("click",l=>{l.preventDefault(),e.delay(100).then(()=>{a.attr(t.attr.type,t.opts.elm.select.sidebarPosition[0].value),t.opts.elm.body.addClass(t.cl.showModal)})}),t.opts.elm.buttons.toggleAreaSave.on("click",e=>{e.preventDefault(),t.opts.elm.buttons.save.trigger("click"),t.opts.elm.body.trigger("click")}),t.opts.elm.buttons.toggleAreaCancel.on("click",a=>{a.preventDefault(),t.opts.elm.body.trigger("click"),e.delay(500).then(()=>{l()})}),t.opts.elm.body.on("click",a=>{let l=e(a.target);s.hasClass(t.cl.toggleArea.dragging)||l.hasClass(t.cl.toggleArea.modal)||0!==l.parents("div."+t.cl.toggleArea.modal).length()||t.opts.elm.body.removeClass(t.cl.showModal)}),s.on("mousedown",e=>{s.addClass([t.cl.toggleArea.dragged,t.cl.toggleArea.dragging]),s.data("pos",{start:s[0].offsetTop,y:e.pageY})}),t.opts.elm.body.on("mouseup",()=>{e.delay(0).then(()=>{s.removeClass(t.cl.toggleArea.dragging)})}).on("mousemove",e=>{if(s.hasClass(t.cl.toggleArea.dragging)&&1===e.which){let l=s.data("pos");t.opts.elm.range.toggleArea_top[0].value=(l.start+e.pageY-l.y)/a[0].offsetHeight*100,t.opts.elm.range.toggleArea_top.trigger("change")}},{passive:!0})},n=async()=>{t.opts.elm.select.openAction.on("change",e=>{let a=t.opts.elm.aside.find("li["+t.attr.name+"='indicator']");"contextmenu"===e.currentTarget.value||"mousedown"===e.currentTarget.value?a.removeClass(t.cl.hidden):a.addClass(t.cl.hidden);let l=t.opts.elm.buttons.toggleAreaOpen.parent("div");"icon"===e.currentTarget.value?l.addClass(t.cl.hidden):l.removeClass(t.cl.hidden)}),t.opts.elm.buttons.keyboardShortcut.on("click",e=>{e.preventDefault(),chrome.tabs.create({url:"chrome://extensions/shortcuts",active:!0})})}},window.SupportHelper=function(e){this.init=(async()=>{t()});let t=async()=>{chrome.storage.sync.get(["shareInfo"],t=>{t.shareInfo&&(t.shareInfo.config&&e.opts.elm.checkbox.shareConfig.trigger("click"),t.shareInfo.activity&&e.opts.elm.checkbox.shareActivity.trigger("click")),e.opts.elm.support.shareInfoWrapper.find("input[type='checkbox']").on("change",()=>{chrome.storage.sync.set({shareInfo:{config:e.helper.checkbox.isChecked(e.opts.elm.checkbox.shareConfig),activity:e.helper.checkbox.isChecked(e.opts.elm.checkbox.shareActivity)}},()=>{e.showSuccessMessage("saved_share_userdata")})})}),e.opts.elm.support.donate.on("click",t=>{t.preventDefault(),window.open(e.opts.donateLink,"_blank")})}},window.TranslationHelper=function(t){let a={},l={},s={};this.init=(()=>new Promise(e=>{n().then(()=>{r(),t.serviceAvailable?o().then(()=>{i(),m()}):c(),e()})})),this.submit=(()=>new Promise(a=>{let l=t.opts.elm.translation.langvars.data("lang");if(l){let a=+new Date,s=t.helper.template.loading().appendTo(t.opts.elm.body);t.opts.elm.body.addClass(t.cl.loading);let n={};t.opts.elm.translation.wrapper.find("div."+t.cl.translation.category+"["+t.attr.translation.language+"='"+l+"']").forEach(t=>{e(t).find("textarea").forEach(t=>{let a=t.value;if(a&&a.trim().length>0){let l=e(t).data("initial");if((a=a.trim())!==l){let l=e(t).data("name");n[l]=a}}})}),e.xhr(t.opts.ajax.translation.submit,{method:"POST",data:{lang:l,vars:n}}).then(()=>e.delay(Math.max(0,1e3-(+new Date-a)))).then(()=>(s.remove(),t.showSuccessMessage("translation_submit_message"),e.delay(1500))).then(()=>{t.opts.elm.body.removeClass(t.cl.loading),y(l)})}else a()}));let n=()=>new Promise(e=>{t.helper.model.call("languageInfos").then(t=>{a=t.infos,e()})}),o=()=>new Promise(l=>{t.opts.elm.translation.overview.children("div."+t.cl.boxWrapper).html(""),e.xhr(t.opts.ajax.translation.info).then(s=>{let n=JSON.parse(s.responseText);if(n&&n.languages){let l=t.helper.i18n.getLanguage();n.languages.sort((e,t)=>t.varsAmount!==e.varsAmount?t.varsAmount-e.varsAmount:a[e.name]&&a[t.name]?a[e.name].label>a[t.name].label?1:-1:1);let s=Object.assign({},a);n.languages.forEach(o=>{if(a[o.name]){let r=o.varsAmount/n.varsAmount*100;if(r>=15){delete s[o.name];let i="draft",d=Math.floor(r);a[o.name].available&&(i=n.varsAmount>o.varsAmount?"incomplete":"released");let c=e("<div />").data("lang",o.name).addClass(t.cl.box).attr(t.attr.translation.releaseStatus,i).append("<a href='#' class='"+t.cl.translation.edit+"'></a>").append("<strong>"+a[o.name].label+"</strong>").append("<div class="+t.cl.translation.progress+" "+t.attr.value+"='"+d+"%'><div style='width:"+d+"%'></div></div>").append("<span title='"+t.helper.i18n.get("settings_translation_status_"+i)+"'></span>").appendTo(t.opts.elm.translation.overview.children("div."+t.cl.boxWrapper));l===o.name&&(p(o.categories,n.categories)&&(t.opts.elm.aside.find("li["+t.attr.name+"='language']").addClass(t.cl.incomplete),e("<span />").attr("title",t.helper.i18n.get("settings_translation_incomplete_info")).appendTo(t.opts.elm.aside.find("li["+t.attr.name+"='language'] > a"))),c.addClass(t.cl.translation.mark))}}}),h(s)}t.opts.elm.translation.overview.addClass(t.cl.visible),l()})}),r=()=>{t.opts.elm.translation.goto.on("click",e=>{e.preventDefault(),t.opts.elm.aside.find("li["+t.attr.name+"='translate'] > a").trigger("click")}),e(document).on(t.opts.events.pageChanged,e=>{e.detail.path&&"translate"===e.detail.path[1]&&(e.detail.path[2]?y(e.detail.path[2]):t.serviceAvailable?d():c())})},i=()=>{t.opts.elm.translation.overview.find("select."+t.cl.translation.select).on("change",e=>{y(e.currentTarget.value)}),t.opts.elm.translation.overview.find("div."+t.cl.box).on("click",t=>{t.preventDefault();let a=e(t.currentTarget).data("lang");a&&y(a)})},d=()=>{t.opts.elm.translation.wrapper.find("."+t.cl.visible).removeClass(t.cl.visible),t.opts.elm.translation.overview.addClass(t.cl.visible),t.opts.elm.buttons.save.addClass(t.cl.hidden)},c=()=>{t.opts.elm.translation.unavailable.addClass(t.cl.visible),t.opts.elm.translation.wrapper.hasClass(t.cl.tabs.active)&&t.opts.elm.buttons.save.addClass(t.cl.hidden)},p=(e,t)=>{let a=!1;return Object.keys(e).some(l=>{if(t[l].total>e[l])return a=!0,!0}),a},h=l=>{let s=e("<div />").addClass(t.cl.box).appendTo(t.opts.elm.translation.overview.children("div."+t.cl.boxWrapper)),n=e("<select class='"+t.cl.translation.select+"' />").appendTo(s);e("<option value='' />").text(t.helper.i18n.get("settings_translation_add_language")).appendTo(n);let o=[];Object.keys(l).forEach(t=>{o.push({elm:e("<option value='"+t+"' />").text(a[t].label),label:a[t].label})}),o.sort((e,t)=>e.label>t.label?1:-1),o.forEach(e=>{e.elm.appendTo(n)})},g=a=>new Promise(s=>{let n=e=>{e&&void 0===l[a]&&(l[a]=e),s(e)};l[a]?n(l[a]):e.xhr(t.opts.ajax.translation.langvars,{method:"POST",data:{lang:a}}).then(e=>{let l=JSON.parse(e.responseText);if(l&&Object.getOwnPropertyNames(l).length>0){let e={[a]:l},s=t.helper.i18n.getDefaultLanguage();a!==s?g(s).then(t=>{e.default=t[s],n(e)}):n(e)}else n(null)})}),m=()=>{t.opts.elm.translation.wrapper.on("click","a."+t.cl.translation.back,a=>{a.preventDefault();let l=e(a.currentTarget).parents("div."+t.cl.translation.category).eq(0).attr(t.attr.translation.language);y(l)}),t.opts.elm.translation.wrapper.on("click","a."+t.cl.translation.goto,a=>{a.preventDefault();let l=e(a.currentTarget).attr(t.attr.value),s=e(a.currentTarget).parent("header").next("ul");u(l,s)}),t.opts.elm.translation.langvars.on("click","div."+t.cl.box,t=>{t.preventDefault();let a=e(t.currentTarget),l=a.data("lang"),s=a.children("strong").text(),n=a.data("info");b(l,s,n)})},b=(l,n,o)=>{let r=t.opts.elm.translation.wrapper.find("div."+t.cl.translation.category+"["+t.attr.name+"='"+n+"']["+t.attr.translation.language+"='"+l+"']");if(0===r.length()){let i=l+"_"+n;r=e("<div />").attr(t.attr.name,n).attr(t.attr.translation.language,l).addClass(t.cl.translation.category).addClass(t.cl.contentBox).appendTo(t.opts.elm.translation.wrapper);let d=e("<header />").appendTo(r),c=e("<ul />").appendTo(r);o.category.vars.forEach((l,s)=>{let n=e("<li />").append("<div><label>"+l.label+"</label></div>").append("<div />").appendTo(c);o.defaults&&o.defaults.vars&&o.defaults.vars[s]&&e("<span />").html("<span>"+a[t.helper.i18n.getDefaultLanguage()].label+" translation:</span>"+o.defaults.vars[s].value||"").appendTo(n.children("div").eq(0));let r=l.value||"";e("<textarea />").data({initial:r,name:l.name}).text(r).appendTo(n.children("div").eq(1)),0===r.length&&n.addClass(t.cl.translation.empty)}),f(r),e("<a />").text(t.helper.i18n.get("settings_translation_back_to_overview")).addClass(t.cl.translation.back).appendTo(d),s[i].total!==s[i].filled&&(e("<a />").addClass(t.cl.translation.goto).attr(t.attr.value,"down").appendTo(d),e("<a />").addClass(t.cl.translation.goto).attr(t.attr.value,"up").appendTo(d)),e("<span />").addClass(t.cl.translation.amountInfo).html("<span>"+s[i].filled+"</span>&thinsp;/&thinsp;"+s[i].total).appendTo(d);let p=navigator.userAgent.match(/Chrom(e|ium)\/([0-9]+)\./);(p?parseInt(p[2],10):null)<68&&d.css("top","-35px")}t.opts.elm.translation.langvars.removeClass(t.cl.visible),r.addClass(t.cl.visible),t.helper.menu.addBreadcrumb({label:n,alias:n,depth:4}),e.delay(0).then(()=>{let e=r.children("ul");r.find("a."+t.cl.translation.goto).length()>0&&u("down",e),v(l,e)})},u=(e,a)=>{let l=null;if(a.find("li."+t.cl.translation.hover).length()>0?l="up"===e?a.find("li."+t.cl.translation.hover).eq(0).prevAll("li."+t.cl.translation.empty):a.find("li."+t.cl.translation.hover).eq(0).nextAll("li."+t.cl.translation.empty):"down"===e&&(l=a.find("li."+t.cl.translation.empty)),l&&l.length()>0){let e=l.eq(0);t.opts.elm.content[0].scrollTop=Math.max(0,e[0].offsetTop-40),e.find("textarea")[0].focus()}},v=(a,l)=>{if(a!==t.helper.i18n.getDefaultLanguage()&&t.helper.model.getData("u/translationHelp")){let a=null;(a="TEXTAREA"===document.activeElement.tagName?e(document.activeElement).parents("li").eq(0):l.children("li").eq(0)).addClass(t.cl.translation.mark);let s=a.find("label").text();e("<span />").addClass(t.cl.desc).html(t.helper.i18n.get("settings_translation_help",["<strong>"+s+"</strong>"])).appendTo(a),t.helper.model.setData({"u/translationHelp":!1})}},f=a=>{a.find("textarea").on("change input",l=>{let n=e(l.currentTarget),o=l.currentTarget.value,r=a.attr(t.attr.name),i=a.attr(t.attr.translation.language);o?n.parents("li").eq(0).removeClass(t.cl.translation.empty):n.parents("li").eq(0).addClass(t.cl.translation.empty),n.css("height",""),n.css("height",Math.max(l.currentTarget.scrollHeight,70)+"px");let d=0;a.find("textarea").forEach(e=>{e.value&&e.value.trim().length>0&&d++}),s[i+"_"+r].filled=d,a.find("span."+t.cl.translation.amountInfo+" > span").text(d)}).on("focus",l=>{a.find("li").removeClass(t.cl.translation.hover),e(l.currentTarget).parents("li").eq(0).addClass(t.cl.translation.hover)}).on("blur",a=>{let l=e(a.currentTarget).parents("li").eq(0);e.delay(200).then(()=>{l.removeClass(t.cl.translation.hover)})}),e.delay().then(()=>{a.find("textarea").trigger("change")})},y=l=>{t.helper.menu.addBreadcrumb({label:a[l].label,alias:l,depth:3}),t.opts.elm.translation.langvars.data("lang",l),t.opts.elm.translation.langvars.find("div."+t.cl.boxWrapper).html(""),t.opts.elm.translation.wrapper.find("div."+t.cl.translation.category).removeClass(t.cl.visible),t.opts.elm.buttons.save.removeClass(t.cl.hidden),t.opts.elm.translation.overview.removeClass(t.cl.visible),t.opts.elm.translation.langvars.addClass([t.cl.visible,t.cl.loading]);let n=t.helper.template.loading().appendTo(t.opts.elm.translation.langvars);g(l).then(a=>{if(a){let n=a[l];Object.keys(n).forEach(o=>{let r=e("<div />").addClass(t.cl.box).data("lang",l).data("info",{category:n[o],defaults:a.default?a.default[o]:null}).append("<strong>"+o+"</strong>").appendTo(t.opts.elm.translation.langvars.children("div."+t.cl.boxWrapper)),i=l+"_"+o;void 0===s[i]&&(s[i]={total:n[o].vars.length,filled:0},n[o].vars.forEach(e=>{e.value&&s[i].filled++})),n[o].required&&e("<span />").addClass(t.cl.translation.requiredInfo).text("("+t.helper.i18n.get("settings_translation_required_category")+")").appendTo(r),e("<span />").addClass(t.cl.translation.amountInfo).html("<span>"+s[i].filled+"</span>&thinsp;/&thinsp;"+s[i].total).appendTo(r),s[i].total>s[i].filled&&r.addClass(t.cl.incomplete)})}else d();t.opts.elm.translation.langvars.removeClass(t.cl.loading),n.remove()})}},window.settings=function(){this.opts={classes:{page:{darkMode:"dark"},tabs:{content:"tab",active:"active"},color:{field:"color",mask:"colorMask",suggestion:"suggestion"},radio:{wrapper:"radioWrapper"},range:{inactive:"inactive"},newtab:{hideable:"hideable"},translation:{select:"languageSelect",category:"category",edit:"edit",progress:"progress",mark:"mark",requiredInfo:"requiredInfo",amountInfo:"amountInfo",empty:"empty",back:"back",hover:"hover",goto:"goto"},checkbox:{box:"checkbox",active:"active",clicked:"clicked",focus:"focus"},toggleArea:{preview:"preview",fullHeight:"fullHeight",dragged:"dragged",dragging:"dragging",modal:"toggleAreaModal"},appearance:{preview:{fullHeight:"blockbyte-bs-fullHeight"}},feedback:{onlySuggestions:"onlySuggestions",suggestion:"suggestion",answer:"answer",noHeight:"noHeight",absolute:"absolute"},hidden:"hidden",success:"success",error:"error",building:"building",initLoading:"initLoading",loading:"loading",revert:"revert",visible:"visible",highlight:"highlight",showModal:"showModal",small:"small",desc:"desc",box:"box",dialog:"dialog",boxWrapper:"boxWrapper",contentBox:"contentBox",action:"action",incomplete:"incomplete"},attr:{type:"data-type",appearance:"data-appearance",name:"data-name",i18n:"data-i18n",value:"data-value",success:"data-successtext",style:"data-style",hideOnFalse:"data-hideOnFalse",buttons:{save:"data-save",restore:"data-restore"},range:{min:"data-min",max:"data-max",step:"data-step",unit:"data-unit",infinity:"data-infinity"},color:{alpha:"data-alpha",suggestions:"data-suggestions"},field:{placeholder:"data-placeholder"},translation:{releaseStatus:"data-status",language:"data-lang"}},elm:{body:e("body"),title:e("head > title"),aside:e("body > section#wrapper > aside"),content:e("body > section#wrapper > main"),header:e("body > header"),headline:e("body > header > h1"),advanced:{toggle:e("div.advanced > h3"),container:e("div.advanced > div")},buttons:{save:e("body > header > menu > li > button.save"),restore:e("body > header > menu > li > button.restore"),keyboardShortcut:e("div.tab[data-name='sidebar'] a.keyboardShortcut"),toggleAreaOpen:e("div.tab[data-name='sidebar'] div.toggleAreaDesc > a.button"),toggleAreaSave:e("div.toggleAreaModal a.save"),toggleAreaCancel:e("div.toggleAreaModal a.cancel"),import:e("body a.import > input[type='file']"),export:e("body a.export")},sidebar:{filterPatters:e("div.tab[data-name='sidebar'] div[data-name='filter'] div.patterns"),filterExplanation:e("div.tab[data-name='sidebar'] div[data-name='filter'] div.patternExplanation")},appearance:{content:e("div.tab[data-name='appearance']"),presetWrapper:e("div.tab[data-name='appearance'] div.presets")},newtab:{content:e("div.tab[data-name='newtab']")},feedback:{wrapper:e("div.tab[data-name='feedback']"),form:e("section.form"),send:e("section.form button[type='submit']"),feedback:e("div.tab[data-name='feedback'] div.feedbackWrapper"),showForm:e("div.tab[data-name='feedback'] div.suggestedAnswers > a"),suggestions:e("div.tab[data-name='feedback'] div.suggestedAnswers")},translation:{wrapper:e("div.tab[data-name='language'] > div[data-name='translate']"),goto:e("div.tab[data-name='language'] > div[data-name='general'] a.button"),overview:e("div.tab[data-name='language'] > div[data-name='translate'] > div.overview"),langvars:e("div.tab[data-name='language'] > div[data-name='translate'] > div.langvars"),unavailable:e("div.tab[data-name='language'] > div[data-name='translate'] > div.unavailable")},formElement:e("div.formElement"),support:{shareInfoWrapper:e("div.tab[data-name='support'] div.shareInformation"),donate:e("div.tab[data-name='support'] a.donate")},preview:{},checkbox:{},range:{},select:{},color:{},textarea:{},field:{},radio:{}},events:{pageChanged:"blockbyte-bs-pageChanged"},ajax:{feedback:{form:"https://extensions.blockbyte.de/ajax/feedback",suggestions:"https://extensions.blockbyte.de/ajax/feedback/suggestions"},translation:{info:"https://extensions.blockbyte.de/ajax/translation/bs/info",langvars:"https://extensions.blockbyte.de/ajax/translation/bs/langvars",submit:"https://extensions.blockbyte.de/ajax/translation/bs/submit"}},donateLink:"https://www.paypal.com/cgi-bin/webscr?cmd=_s-xclick&hosted_button_id=2VW2UADL99YEL",manifest:chrome.runtime.getManifest()},this.attr=this.opts.attr,this.cl=this.opts.classes,this.serviceAvailable=!0;let t=["behaviour","appearance","newtab"];this.run=(()=>{a();let t={body:this.helper.template.loading().appendTo(this.opts.elm.body)};this.opts.elm.body.addClass(this.cl.initLoading),this.helper.model.init().then(()=>this.helper.i18n.init()).then(()=>(this.opts.elm.body.parent("html").attr("dir",this.helper.i18n.isRtl()?"rtl":"ltr"),this.helper.font.init("default"),this.helper.stylesheet.init(),this.helper.stylesheet.addStylesheets(["settings"],e(document)),this.helper.form.init())).then(()=>(this.opts.elm.body.removeClass(this.cl.building),this.helper.i18n.parseHtml(document),this.opts.elm.title.text(this.opts.elm.title.text()+" - "+this.helper.i18n.get("extension_name")),["translation","feedback"].forEach(e=>{t[e]=this.helper.template.loading().appendTo(this.opts.elm[e].wrapper),this.opts.elm[e].wrapper.addClass(this.cl.loading)}),Promise.all([this.helper.menu.init(),this.helper.sidebar.init(),this.helper.appearance.init(),this.helper.newtab.init(),this.helper.support.init(),this.helper.importExport.init()]))).then(()=>(l(),t.body.remove(),this.opts.elm.body.removeClass(this.cl.initLoading),this.helper.model.call("trackPageView",{page:"/settings"}),this.helper.model.call("websiteStatus"))).then(e=>{this.serviceAvailable="available"===e.status,["translation","feedback"].forEach(e=>{this.helper[e].init().then(()=>{t[e].remove(),this.opts.elm[e].wrapper.removeClass(this.cl.loading)})})})}),this.showSuccessMessage=(t=>{this.opts.elm.body.attr(this.attr.success,this.helper.i18n.get("settings_"+t)),this.opts.elm.body.addClass(this.cl.success),e.delay(1500).then(()=>{this.opts.elm.body.removeClass(this.cl.success)})});let a=()=>{this.helper={model:new window.ModelHelper(this),checkbox:new window.CheckboxHelper(this),template:new window.TemplateHelper(this),i18n:new window.I18nHelper(this),font:new window.FontHelper(this),stylesheet:new window.StylesheetHelper(this),translation:new window.TranslationHelper(this),menu:new window.MenuHelper(this),form:new window.FormHelper(this),sidebar:new window.SidebarHelper(this),newtab:new window.NewtabHelper(this),appearance:new window.AppearanceHelper(this),feedback:new window.FeedbackHelper(this),importExport:new window.ImportExportHelper(this),support:new window.SupportHelper(this)}},l=async()=>{e(document).on("click",()=>{e("div."+this.cl.dialog).removeClass(this.cl.visible)}),this.opts.elm.header.on("click","div."+this.cl.dialog,e=>{e.stopPropagation()}),this.opts.elm.header.on("click","div."+this.cl.dialog+" > a",a=>{a.preventDefault(),a.stopPropagation();let l=e(a.currentTarget).parent("div").attr(this.attr.type);if(-1!==t.indexOf(l)){let t=[];"appearance"===l&&t.push(new Promise(e=>{chrome.storage.local.get(["utility"],t=>{let a=t.utility||{};delete a.customCss,chrome.storage.local.set({utility:a},()=>{e()})})})),t.push(new Promise(t=>{chrome.storage.sync.remove([l],()=>{this.showSuccessMessage("restored_message"),this.helper.model.call("reloadIcon"),e("div."+this.cl.dialog).removeClass(this.cl.visible),t()})})),Promise.all(t).then(()=>e.delay(1500)).then(()=>{this.helper.model.call("reinitialize"),location.reload(!0)})}}),this.opts.elm.advanced.container.css("display","none"),this.opts.elm.advanced.toggle.on("click",t=>{let a=e(t.currentTarget).next("div");a.hasClass(this.cl.visible)?(a.removeClass(this.cl.visible),e.delay(300).then(()=>{a.css("display","none")})):(a.css("display","flex"),e.delay(0).then(()=>{a.addClass(this.cl.visible)}))}),this.opts.elm.buttons.save.on("click",e=>{e.preventDefault(),"translate"===this.helper.menu.getPath()[1]?this.helper.translation.submit():Promise.all([this.helper.sidebar.save(),this.helper.appearance.save(),this.helper.newtab.save()]).then(()=>(this.showSuccessMessage("saved_message"),this.helper.model.call("reinitialize"))).then(()=>{this.helper.model.call("reloadIcon"),this.helper.model.call("reloadContextmenus")})}),this.opts.elm.buttons.restore.on("click",a=>{a.preventDefault();let l=this.helper.menu.getPath(),s=l[0];if("sidebar"===s&&(s="behaviour"),-1!==t.indexOf(s)){e("div."+this.cl.dialog).remove();let t=this.helper.i18n.isRtl()?"left":"right",a=e("<div />").attr(this.attr.type,s).addClass(this.cl.dialog).append("<p>"+this.helper.i18n.get("settings_restore_confirm")+"</p>").append("<span>"+this.helper.i18n.get("settings_menu_"+l[0])+"</span>").append("<br />").append("<a>"+this.helper.i18n.get("settings_restore")+"</a>").css(t,this.opts.elm.header.css("padding-"+t)).appendTo(this.opts.elm.header);e.delay().then(()=>{a.addClass(this.cl.visible)})}})}},(new window.settings).run()})(jsu);