/*! (c) Philipp KÃ¶nig under GPL-3.0 */
"use strict";!function(a){var b={},c={submitSuccess:"submitSuccess",tabBar:"tabBar",tabActive:"active",tabHidden:"hidden",feedbackError:"error",loading:"loading"},d={body:a("body"),title:a("head > title"),copyright:a("a#copyright"),tab:a("section#content > div.tab"),headerContent:a("header > div"),config:{rangeInputs:a("input[type='range']"),pxToleranceMaximized:a("input#pxToleranceMaximized"),pxToleranceWindowed:a("input#pxToleranceWindowed"),mouseScrollSensitivity:a("input#mouseScrollSensitivity"),trackpadScrollSensitivity:a("input#trackpadScrollSensitivity"),closeTimeout:a("input#closeTimeout"),addVisual:a("input#addVisual"),newTab:a("select#newTab"),rememberScroll:a("input#rememberScroll"),rememberSearch:a("input#rememberSearch"),hideEmptyDirs:a("input#hideEmptyDirs"),openAction:a("select#openAction"),save:a("button#save"),restoreDefaults:a("button#restore")},feedback:{save:a("button#sendFeedback"),textarea:a("textarea#feedback"),email:a("input#feedbackEmail"),rate:a("a#rate")},shareUserdata:{share:a("input#shareUserdata")}},e=function(){var a=+d.copyright.children("span.created").text(),b=(new Date).getFullYear();b>a&&d.copyright.children("span.created").text(a+" - "+b)},f=function(){a("[data-i18n]").forEach(function(b){var c=a(b).attr("data-i18n"),d=0===c.search(/^share_userdata/)?c:"settings_"+c;a(b).html(chrome.i18n.getMessage(d).replace(/\[u\](.*)\[\/u\]/,"<span>$1</span>"))});var b=chrome.runtime.getManifest();d.title.text(d.title.text()+" - "+b.short_name)},g=function(){var b=a("<ul />").addClass(c.tabBar).prependTo(a(d.headerContent));d.tab.forEach(function(c){var d=a(c).attr("data-name");a("<li />").attr("data-name",d).html("<a href='#'>"+chrome.i18n.getMessage("settings_tab_"+d)+"</a>").appendTo(b)}),b.find("> li > a").on("click",function(e){e.preventDefault(),b.children("li").removeClass(c.tabActive);var f=a(e.currentTarget).parent("li");f.addClass(c.tabActive),d.tab.addClass(c.tabHidden),a("section#content > div.tab[data-name='"+f.attr("data-name")+"']").removeClass(c.tabHidden)}),b.find("> li > a").eq(0).trigger("click")},h=function(){d.shareUserdata.share[0].checked=!!b.model.shareUserdata,d.shareUserdata.share.on("change",function(){b.model.shareUserdata=d.shareUserdata.share[0].checked,b.model.lastShareDate=0,chrome.storage.sync.set({model:b.model},function(){d.body.attr("data-successtext",chrome.i18n.getMessage("settings_saved_share_userdata")),d.body.addClass(c.submitSuccess),setTimeout(function(){d.body.removeClass(c.submitSuccess)},1500)})})},i=function(){d.feedback.rate.attr({href:"https://chrome.google.com/webstore/detail/"+chrome.i18n.getMessage("@@extension_id")+"/reviews",target:"_blank"}),d.feedback.save.on("click",function(){var b=d.feedback.textarea[0].value,e=d.feedback.email[0].value,f=e.length>0&&/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e),g=b.length>0;if(f&&g){d.feedback.save.addClass(c.loading);var h=chrome.runtime.getManifest(),i=new XMLHttpRequest;i.open("POST","https://moonware.de/ajax/extensions/feedback",!0),i.onload=function(){d.feedback.save.removeClass(c.loading),d.feedback.textarea[0].value="",d.feedback.email[0].value="",d.body.attr("data-successtext",chrome.i18n.getMessage("settings_saved_feedback")),d.body.addClass(c.submitSuccess),setTimeout(function(){d.body.removeClass(c.submitSuccess)},1500)};var j=new FormData;j.append("email",e),j.append("msg",b),j.append("extension",JSON.stringify({name:h.name,version:h.version})),i.send(j)}else f?g||d.feedback.textarea.addClass(c.feedbackError):d.feedback.email.addClass(c.feedbackError);setTimeout(function(){a("."+c.feedbackError).removeClass(c.feedbackError)},1500)})},j=function(){var e={windowed:10,maximized:1},f={mouse:1,trackpad:1};d.config.addVisual[0].checked="undefined"==typeof b.appearance.addVisual||b.appearance.addVisual,d.config.rememberScroll[0].checked="undefined"==typeof b.behaviour.rememberScroll||b.behaviour.rememberScroll,d.config.rememberSearch[0].checked="undefined"==typeof b.behaviour.rememberSearch||b.behaviour.rememberSearch,d.config.hideEmptyDirs[0].checked="undefined"==typeof b.behaviour.hideEmptyDirs||b.behaviour.hideEmptyDirs,d.config.openAction[0].value="undefined"==typeof b.behaviour.openAction?"mousedown":b.behaviour.openAction,d.config.newTab[0].value="undefined"==typeof b.behaviour.newTab?"foreground":b.behaviour.newTab,d.config.closeTimeout[0].value="undefined"==typeof b.behaviour.closeTimeout?1:b.behaviour.closeTimeout,d.config.closeTimeout.trigger("change"),"undefined"!=typeof b.behaviour.pxTolerance&&(e=b.behaviour.pxTolerance),d.config.pxToleranceMaximized[0].value=e.maximized,d.config.pxToleranceWindowed[0].value=e.windowed,d.config.pxToleranceMaximized.trigger("change"),d.config.pxToleranceWindowed.trigger("change"),"undefined"!=typeof b.behaviour.scrollSensitivity&&(f=b.behaviour.scrollSensitivity),d.config.mouseScrollSensitivity[0].value=f.mouse,d.config.trackpadScrollSensitivity[0].value=f.trackpad,d.config.rangeInputs.on("input change",function(b){a(b.currentTarget).next("span").text(b.currentTarget.value)}),d.config.rangeInputs.trigger("change"),d.config.save.on("click",function(){chrome.storage.sync.set({appearance:{addVisual:d.config.addVisual[0].checked},behaviour:{rememberScroll:d.config.rememberScroll[0].checked,rememberSearch:d.config.rememberSearch[0].checked,hideEmptyDirs:d.config.hideEmptyDirs[0].checked,closeTimeout:d.config.closeTimeout[0].value,openAction:d.config.openAction[0].value,newTab:d.config.newTab[0].value,pxTolerance:{windowed:d.config.pxToleranceWindowed[0].value,maximized:d.config.pxToleranceMaximized[0].value},scrollSensitivity:{mouse:d.config.mouseScrollSensitivity[0].value,trackpad:d.config.trackpadScrollSensitivity[0].value}}},function(){d.body.attr("data-successtext",chrome.i18n.getMessage("settings_saved_config")),d.body.addClass(c.submitSuccess),setTimeout(function(){d.body.removeClass(c.submitSuccess)},1500)})}),d.config.restoreDefaults.on("click",function(){chrome.storage.sync.remove(["behaviour","appearance"],function(){d.body.attr("data-successtext",chrome.i18n.getMessage("settings_saved_restore")),d.body.addClass(c.submitSuccess),setTimeout(function(){d.body.removeClass(c.submitSuccess),setTimeout(function(){window.close()},100)},1500)})})};!function(){f(),e(),g(),chrome.storage.sync.get(null,function(a){b=a,j(),i(),h()})}()}(jsu);