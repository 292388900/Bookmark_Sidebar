/*! (c) Philipp KÃ¶nig under GPL-3.0 */
!function(e,t){function a(e){return void 0!==e}function s(e){return"string"==typeof e}function n(e){return"object"==typeof e}function l(e){return Object.keys(e).length}function o(e,t,a){return e<t?t:e>a?a:e}function r(e,t){return parseInt(e,t||10)}function i(e){return Math.round(e)}function p(e){var t,a,s,n,l,o,r,p,c=+e[0],d=+e[1],h=+e[2];switch(n=Math.floor(6*c),l=6*c-n,o=h*(1-d),r=h*(1-l*d),p=h*(1-(1-l)*d),n=n||0,r=r||0,p=p||0,n%6){case 0:t=h,a=p,s=o;break;case 1:t=r,a=h,s=o;break;case 2:t=o,a=h,s=p;break;case 3:t=o,a=r,s=h;break;case 4:t=p,a=o,s=h;break;case 5:t=h,a=o,s=r}return[i(255*t),i(255*a),i(255*s)]}function c(e){return h(p(e))}function d(e){var t,a=+e[0],s=+e[1],n=+e[2],l=Math.max(a,s,n),o=Math.min(a,s,n),r=l-o,i=0===l?0:r/l,p=l/255;switch(l){case o:t=0;break;case a:t=s-n+r*(s<n?6:0),t/=6*r;break;case s:t=n-a+2*r,t/=6*r;break;case n:t=a-s+4*r,t/=6*r}return[t,i,p]}function h(e){var t=+e[2]|+e[1]<<8|+e[0]<<16;return(t="000000"+t.toString(16)).slice(-6)}function m(e){return d(g(e))}function g(e){return 3===e.length&&(e=e.replace(/./g,"$&$&")),[r(e[0]+e[1],16),r(e[2]+e[3],16),r(e[4]+e[5],16)]}function u(e){return[+e[0]/360,+e[1]/100,+e[2]/100]}function f(e){return[i(360*+e[0]),i(100*+e[1]),i(100*+e[2])]}function v(e){return[+e[0]/255,+e[1]/255,+e[2]/255]}function b(e){if(n(e))return e;var t=/\s*rgb\s*\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*\)\s*$/i.exec(e),a=/\s*hsv\s*\(\s*(\d+)\s*,\s*(\d+)%\s*,\s*(\d+)%\s*\)\s*$/i.exec(e);return"#"===e[0]&&e.match(/^#([\da-f]{3}|[\da-f]{6})$/i)?m(e.slice(1)):a?u([+a[1],+a[2],+a[3]]):t?d([+t[1],+t[2],+t[3]]):[0,1,1]}var y="firstChild",w="scrollLeft",k="scrollTop",x="offsetLeft",C="offsetTop",T=setTimeout;!function(e){e.version="1.3.4",e.__instance__={},e.each=function(t,a){return T(function(){var a,s=e.__instance__;for(a in s)t(s[a],a,s)},0===a?0:a||1),e},e.parse=b,e._HSV2RGB=p,e._HSV2HEX=c,e._RGB2HSV=d,e._HEX2HSV=m,e._HEX2RGB=function(e){return v(g(e))},e.HSV2RGB=function(e){return p(u(e))},e.HSV2HEX=function(e){return c(u(e))},e.RGB2HSV=function(e){return f(d(e))},e.RGB2HEX=h,e.HEX2HSV=function(e){return f(m(e))},e.HEX2RGB=g}(e.CP=function(r,i){function d(e,t,a){for(var s=0,n=(e=e.split(/\s+/)).length;s<n;++s)t.addEventListener(e[s],a,!1)}function h(e,t,a){for(var s=0,n=(e=e.split(/\s+/)).length;s<n;++s)t.removeEventListener(e[s],a)}function m(e,t){var a=t.touches?t.touches[0].pageX:t.pageX,s=t.touches?t.touches[0].pageY:t.pageY,n=g(e);return{x:a-n.l,y:s-n.t}}function g(t){if(t===e)var a=e.pageXOffset||M[w],s=e.pageYOffset||M[k];else for(var a=t[x]-t.scrollLeft,s=t[C]-t.scrollTop;t=t.offsetParent;)a+=t[x]-t.scrollLeft,s+=t[C]-t.scrollTop;return{l:a,t:s}}function u(e,t){for(;(e=e.parentElement)&&e!==t;);return e}function f(e){e&&e.preventDefault()}function v(t){return t===e?{w:e.innerWidth,h:e.innerHeight}:{w:t.offsetWidth,h:t.offsetHeight}}function b(e){return O||!!a(e)&&e}function _(e){O=e}function E(e,t,s){if(!a(j[e]))return I;if(a(s))a(j[e][s])&&j[e][s].apply(I,t);else for(var n in j[e])j[e][n].apply(I,t);return I}function P(e,t){e&&"h"!==e||E("change:h",t),e&&"sv"!==e||E("change:sv",t),E("change",t)}function S(){return L.parentNode}function H(a,s){function n(e){p(N);var t=p([N[0],1,1]);X.style.backgroundColor="rgb("+t.join(",")+")",_(N),f(e)}function l(e){var t=o(m(V,e).y,0,M);N[0]=(M-t)/M,G.style.top=t-z/2+"px",n(e)}function g(e){var t=m(X,e),a=o(t.x,0,O),s=o(t.y,0,j);N[1]=1-(O-a)/O,N[2]=(j-s)/j,U.style.right=O-a-Q/2+"px",U.style.top=s-Z/2+"px",n(e)}function y(e){Y&&(l(e),ae=c(N),$||(E("drag:h",[ae,I]),E("drag",[ae,I]),P("h",[ae,I]))),K&&(g(e),ae=c(N),J||(E("drag:sv",[ae,I]),E("drag",[ae,I]),P("sv",[ae,I]))),$=0,J=0}function w(e){var t=e.target,a=Y?"h":"sv",s=[c(N),I],n=t===r||u(t,r)===r,l=t===L||u(t,L)===L;n||l?l&&(E("stop:"+a,s),E("stop",s),P(a,s)):S()&&!1!==i&&(I.exit(),E("exit",[I]),P(0,s)),Y=0,K=0}function k(e){$=1,Y=1,y(e),f(e),E("start:h",[ae,I]),E("start",[ae,I]),P("h",[ae,I])}function x(e){J=1,K=1,y(e),f(e),E("start:sv",[ae,I]),E("start",[ae,I]),P("sv",[ae,I])}a||((s||A).appendChild(L),I.visible=!0),ee=v(L).w,te=v(L).h;var C=v(X),T=v(U),M=v(V).h,O=C.w,j=C.h,z=v(G).h,Q=T.w,Z=T.h;if(a){L.style.left=L.style.top="-9999px";function se(e){var t=e.target,a=t===r||u(t,r)===r;a?H():I.exit(),E(a?"enter":"exit",[I])}!1!==i&&d(i,r,se),I.create=function(){return H(1),E("create",[I]),I},I.destroy=function(){return!1!==i&&h(i,r,se),I.exit(),_(!1),E("destroy",[I]),I}}else D();F=function(){N=b(N),n(),G.style.top=M-z/2-M*+N[0]+"px",U.style.right=O-Q/2-O*+N[1]+"px",U.style.top=j-Z/2-j*+N[2]+"px"},I.exit=function(a){return S()&&(S().removeChild(L),I.visible=!1),h(q,V,k),h(q,X,x),h(B,t,y),h(W,t,w),h(R,e,D),I},F(),a||(d(q,V,k),d(q,X,x),d(B,t,y),d(W,t,w),d(R,e,D))}function D(){return I.fit()}var A=t.body,M=t.documentElement,I=this,O=!1,j={},L=t.createElement("div"),q="touchstart mousedown",B="touchmove mousemove",W="touchend mouseup",R="orientationchange resize";if(!(I instanceof CP))return new CP(r,i);CP.__instance__[r.id||r.name||l(CP.__instance__)]=I,a(i)||(i=q),_(CP.parse(r.getAttribute("data-color")||r.value||[0,1,1])),L.className="color-picker",L.innerHTML='<div class="color-picker-control"><span class="color-picker-h"><i></i></span><span class="color-picker-sv"><i></i></span></div>';var F,z=L[y].children,N=b([0,1,1]),V=z[0],X=z[1],G=V[y],U=X[y],$=0,J=0,Y=0,K=0,Q=0,Z=0,ee=0,te=0,ae=c(N);return H(1),T(function(){var e=[c(N),I];E("create",e),P(0,e)},0),I.fit=function(t){var s=v(e),l=v(M),o=l.h>s.h,i=g(e),p=(g(M),o?l.w:s.w+i.l),c=o?s.h+i.t:Math.max(l.h,s.h),d=g(r);return Q=d.l,Z=d.t+v(r).h,n(t)?(a(t[0])&&(Q=t[0]),a(t[1])&&(Z=t[1])):(Q+ee>p&&(Q=p-ee),Z+te>c&&(Z=c-te)),L.style.left=Q+"px",L.style.top=Z+"px",E("fit",[I]),I},I.set=function(e){return a(e)?(s(e)&&(e=CP.parse(e)),_(e),F(),I):b()},I.get=function(e){return b(e)},I.target=r,I.picker=L,I.visible=!1,I.on=function(e,t,s){return a(e)?a(t)?(a(j[e])||(j[e]={}),a(s)||(s=l(j[e])),j[e][s]=t,I):j[e]:j},I.off=function(e,t){return a(e)?a(t)?(delete j[e][t],I):(j[e]={},I):(j={},I)},I.trigger=E,I.hooks=j,I.enter=function(e){return H(0,e)},I})}(window,document),(e=>{"use strict";window.CheckboxHelper=function(t){let a={};this.get=((a,s,n="checkbox")=>{let o=e("<div />").html("<input type='checkbox' />").data("uid",Math.random().toString(36).substr(2,12)).attr(t.opts.attr.type,n).addClass(t.opts.classes.checkbox.box);return void 0!==s&&(o.children("input[type='checkbox']").attr(s),s[t.opts.attr.name]&&o.attr(t.opts.attr.name,s[t.opts.attr.name])),this.isChecked(o)&&o.addClass(t.opts.classes.checkbox.active),l(o,a),o}),this.isChecked=(e=>e.find("input[type='checkbox']")[0].checked);let s=(e,a)=>{let s=e.children("input[type='checkbox']");s.trigger("change"),t.opts.events&&t.opts.events.checkboxChanged&&t.helper.utility.triggerEvent("checkboxChanged",{container:e,checkbox:s,checked:e.hasClass(t.opts.classes.checkbox.active)},a.document()[0])},n=(l,o)=>{l.addClass(t.opts.classes.checkbox.clicked),l.removeClass(t.opts.classes.checkbox.focus),l.toggleClass(t.opts.classes.checkbox.active);let r=l.hasClass(t.opts.classes.checkbox.active),i=l.children("input[type='checkbox']");if("radio"===l.attr(t.opts.attr.type)&&l.attr(t.opts.attr.name))if(o){let a=l.attr(t.opts.attr.name);l.addClass(t.opts.classes.checkbox.active),r&&(i.attr("checked",!0),s(l,o)),o.find("div."+t.opts.classes.checkbox.box+"["+t.opts.attr.type+"='radio']["+t.opts.attr.name+"='"+a+"']").forEach(t=>{let a=e(t);t!==l[0]&&this.isChecked(a)&&n(a)})}else i.attr("checked",!1);else i.attr("checked",r),s(l,o);let p=l.data("uid");a[p]&&clearTimeout(a[p]),a[p]=setTimeout(()=>{l.removeClass(t.opts.classes.checkbox.clicked)},300)},l=(a,s)=>{a.on("mousedown",a=>{a.preventDefault(),a.stopPropagation(),e(a.currentTarget).addClass(t.opts.classes.checkbox.focus)}).on("click",t=>{t.preventDefault(),t.stopPropagation(),n(e(t.currentTarget),s)}),s.on("click",()=>{a.removeClass(t.opts.classes.checkbox.focus)})}},window.AppearanceHelper=function(t){let a={sidebar:{template:"sidebar",styles:["sidebar"]},general:{template:"sidebar",styles:["sidebar"]},overlay:{template:"overlay",styles:["overlay"]},indicator:{template:"indicator",styles:["contentBase","content"]}};this.init=(()=>new Promise(a=>{p().then(()=>{["darkMode"].forEach(e=>{let a=!1;!0===t.helper.model.getData("a/"+e)&&(t.opts.elm.checkbox[e].trigger("click"),a=!0),t.opts.elm.checkbox[e].children("input").data("initial",a)});let n=t.helper.model.getData("a/styles");Object.keys(n).forEach(e=>{let a=n[e];t.opts.elm.range[e]?(t.opts.elm.range[e][0].value=a.replace("px",""),t.opts.elm.range[e].data("initial",a.replace("px","")),t.opts.elm.range[e].trigger("change")):t.opts.elm.color[e]?(t.opts.elm.color[e].data("initial",a),s(t.opts.elm.color[e],a)):t.opts.elm.select[e]?("fontFamily"===e&&0===t.opts.elm.select[e].children("option[value='"+a+"']").length()&&(a="default"),t.opts.elm.select[e][0].value=a,t.opts.elm.select[e].data("initial",a)):t.opts.elm.radio[e]&&(t.opts.elm.radio[e][0].value=a,t.opts.elm.radio[e].trigger("change"),t.opts.elm.radio[e].data("initial",a))}),c(),e.delay(100).then(()=>{l(),a()})})})),this.save=(()=>new Promise(e=>{let a=i();chrome.storage.sync.set({appearance:a},()=>{t.helper.model.call("reinitialize"),t.showSuccessMessage("saved_message"),t.helper.model.call("reloadIcon"),e()})}));let s=(e,t)=>{let a=e.data("picker");if(t.search(/rgba\(/)>-1){let e=t.replace(/(rgba|\(|\))/gi,"").split(",");t="rgb("+e[0]+","+e[1]+","+e[2]+")",a.alpha&&(a.alpha[0].value=e[3])}a.set(t),a.trigger("change")},n=e=>new Promise(t=>{let a=new XMLHttpRequest;a.open("GET",chrome.extension.getURL(e),!0),a.onload=(()=>{a.response&&t(a.response)}),a.send()}),l=()=>{Object.keys(t.opts.elm.preview).forEach(e=>{o(e)})},o=s=>{if(t.opts.elm.preview[s]){t.opts.elm.preview[s].find("head > style").remove();let n=i();if("default"===n.styles.fontFamily){let e=t.helper.font.getDefaultFontInfo();n.styles.fontFamily=e.name}r(s),Object.assign(n.styles,t.helper.font.getFontWeights(n.styles.fontFamily));let l=a[s].css;Object.keys(n.styles).forEach(e=>{l=l.replace(new RegExp('"?%'+e+'"?',"g"),n.styles[e])}),t.opts.elm.preview[s].find("["+t.opts.attr.style+"]").forEach(a=>{let s=e(a).attr(t.opts.attr.style);Object.keys(n.styles).forEach(e=>{s=s.replace(new RegExp('"?%'+e+'"?',"g"),n.styles[e])}),a.style.cssText=s}),t.opts.elm.preview[s].find("["+t.opts.attr.hideOnFalse+"]").forEach(a=>{let s=e(a).attr(t.opts.attr.hideOnFalse);void 0===n[s]||!1===n[s]?e(a).css("display","none"):e(a).css("display","block")}),t.opts.elm.preview[s].find("head").append("<style>"+l+"</style>"),n.darkMode?t.opts.elm.preview[s].find("body").addClass(t.opts.classes.page.darkMode):t.opts.elm.preview[s].find("body").removeClass(t.opts.classes.page.darkMode);let o=t.opts.elm.preview[s].find("section#sidebar");if(o.length()>0){let e=o.find("> header");e.find("> h1").removeClass(t.opts.classes.hidden),e.find("> h1 > span").removeClass(t.opts.classes.hidden);let a=window.getComputedStyle(e[0]),s=parseInt(a.getPropertyValue("padding-top"));["label","amount"].forEach(a=>{e.children("a").forEach(n=>{if(n.offsetTop>s)return"label"===a?e.find("> h1 > span").addClass(t.opts.classes.hidden):"amount"===a&&e.find("> h1").addClass(t.opts.classes.hidden),!1})})}}else if("icon"===s){let e=i();t.helper.model.call("updateIcon",{name:e.styles.iconShape,color:e.styles.iconColor,onlyCurrentTab:!0})}},r=e=>{if(t.opts.elm.preview[e]){let a=i();if(t.opts.elm.content.removeClass(t.opts.classes.small),null!==t.opts.elm.preview[e][0].offsetParent){let s=0;"indicator"===e?s=a.styles.indicatorWidth:"sidebar"!==e&&"general"!==e||(s=a.styles.sidebarWidth),t.opts.elm.header.css("padding-right",s),t.opts.elm.content.css("padding-right",s)}else t.opts.elm.header.css("padding-right",""),t.opts.elm.content.css("padding-right","");if(t.helper.menu.getPage().find("div."+t.opts.classes.box).length()>1){let e=!1,a=null;t.helper.menu.getPage().find("div."+t.opts.classes.box).forEach(t=>{if(a===t.offsetTop)return e=!0,!1;a=t.offsetTop}),e||t.opts.elm.content.addClass(t.opts.classes.small)}}},i=()=>{let e={darkMode:t.helper.checkbox.isChecked(t.opts.elm.checkbox.darkMode),showIndicator:!0,showIndicatorIcon:!0,showBookmarkIcons:!0,showDirectoryIcons:!0,styles:{}},a=t.helper.model.getData("a/styles");return Object.keys(a).forEach(a=>{t.opts.elm.range[a]?e.styles[a]=t.opts.elm.range[a][0].value+"px":t.opts.elm.color[a]?e.styles[a]=t.opts.elm.color[a][0].value:t.opts.elm.select[a]?e.styles[a]=t.opts.elm.select[a][0].value:t.opts.elm.radio[a]&&(e.styles[a]=t.opts.elm.radio[a][0].value)}),Object.entries({indicatorWidth:"showIndicator",indicatorIconSize:"showIndicatorIcon",bookmarksIconSize:"showBookmarkIcons",directoriesIconSize:"showDirectoryIcons"}).forEach(([t,a])=>{0===parseInt(e.styles[t])&&(e[a]=!1)}),e},p=()=>new Promise(s=>{let l=0,o=Object.keys(a).length;Object.keys(a).forEach(r=>{a[r].css="",t.opts.elm.preview[r]=e("<iframe />").attr(t.opts.attr.appearance,r).appendTo(t.opts.elm.body),n("html/template/"+a[r].template+".html").then(e=>{e=(e=e.replace(/__MSG_\@\@extension_id__/g,chrome.runtime.id)).replace(/__DATE__CREATED__/g,t.helper.i18n.getLocaleDate(new Date("2016-11-25"))),t.opts.elm.preview[r].find("body").html(e),t.helper.i18n.parseHtml(t.opts.elm.preview[r]),t.helper.font.addStylesheet(t.opts.elm.preview[r]),++l===o&&s()}),a[r].styles.forEach(e=>{n("css/"+e+".css").then(e=>{a[r].css+=e})})})}),c=()=>{e(window).on("resize",function(){let e=t.helper.menu.getPath();r(e[1])}),t.opts.elm.appearance.content.find("input, select").on("change input",a=>{let n=e(a.currentTarget),l=a.currentTarget.value,r=n.data("initial");if(void 0!==r){if("checkbox"===n.attr("type")&&(l=a.currentTarget.checked,e(n).parent()[0]===t.opts.elm.checkbox.darkMode[0])){let e=t.helper.model.getDefaultColor("textColor",l?"dark":"light");s(t.opts.elm.color.textColor,e),s(t.opts.elm.color.bookmarksDirColor,e),["sidebarMaskColor","colorScheme"].forEach(e=>{let a=t.helper.model.getDefaultColor(e,l?"dark":"light");s(t.opts.elm.color[e],a)})}let i=e(a.currentTarget).parents("div."+t.opts.classes.box).eq(0);l!==r?0===i.children("a."+t.opts.classes.revert).length()&&e("<a href='#' />").addClass(t.opts.classes.revert).data("elm",i).appendTo(i):i.children("a."+t.opts.classes.revert).remove();let p=t.helper.menu.getPath();o(p[1])}}),t.opts.elm.appearance.content.on("click","a."+t.opts.classes.revert,a=>{a.preventDefault(),e(a.currentTarget).parent("div."+t.opts.classes.box).find("input, select").forEach(t=>{let a=e(t),n=a.data("initial");a.data("picker")?s(a,n):void 0!==n&&("checkbox"===a.attr("type")&&"boolean"==typeof n?t.checked!==n&&a.parent("div").trigger("click"):(t.value=n,a.trigger("change")))})}),e(document).on(t.opts.events.pageChanged,e=>{e.detail.path&&"appearance"===e.detail.path[0]&&o(e.detail.path[1])})}},window.FeedbackHelper=function(t){this.init=(async()=>{a(),!1===t.serviceAvailable&&(t.opts.elm.feedback.form.addClass(t.opts.classes.hidden),e("<p />").addClass(t.opts.classes.error).html(t.helper.i18n.get("status_feedback_unavailable_desc")+"<br />").append("<a href='mailto:feedback@blockbyte.de'>feedback@blockbyte.de</a>").insertAfter(t.opts.elm.feedback.form))});let a=()=>{t.opts.elm.feedback.faq.children("strong").on("click",a=>{a.preventDefault(),e(a.currentTarget).next("p").toggleClass(t.opts.classes.visible)}),t.opts.elm.feedback.faq.children("p > a").on("click",a=>{a.preventDefault(),"usage"===e(a.currentTarget).parent("p").attr(t.opts.attr.type)&&window.open(chrome.extension.getURL("html/intro.html")+"?skip=1","_blank")}),t.opts.elm.feedback.send.on("click",e=>{e.preventDefault(),s()})},s=()=>{let a=t.opts.elm.textarea.feedbackMsg[0].value,s=t.opts.elm.field.feedbackEmail[0].value,n=s.length>0&&/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(s),l=a.length>0;if(n&&l){let n=+new Date,l=t.helper.template.loading().appendTo(t.opts.elm.body);t.opts.elm.body.addClass(t.opts.classes.loading);let o=null;e.xhr(t.opts.ajax.feedback,{method:"POST",data:{email:s,msg:a,version:t.opts.manifest.version,ua:navigator.userAgent,lang:t.helper.i18n.getLanguage(),config:t.helper.importExport.getExportConfig()}}).then(t=>(o=JSON.parse(t.responseText),e.delay(Math.max(0,1e3-(+new Date-n))))).then(()=>{t.opts.elm.body.removeClass(t.opts.classes.loading),l.remove(),o&&o.success&&!0===o.success?(t.opts.elm.textarea.feedbackMsg[0].value="",t.opts.elm.field.feedbackEmail[0].value="",t.showSuccessMessage("feedback_sent_message")):e.delay().then(()=>{alert(t.helper.i18n.get("settings_feedback_send_failed"))})})}else n?l||t.opts.elm.textarea.feedbackMsg.addClass(t.opts.classes.error):t.opts.elm.field.feedbackEmail.addClass(t.opts.classes.error);e.delay(700).then(()=>{e("."+t.opts.classes.error).removeClass(t.opts.classes.error)})}},window.FormHelper=function(t){let a={};this.init=(()=>new Promise(e=>{s(),n().then(e)}));let s=()=>{t.opts.elm.content.on("scroll",()=>{"appearance"===t.helper.menu.getPath()[0]&&Object.values(t.opts.elm.color).forEach(e=>{e.data("picker").fit()})})},n=()=>new Promise(s=>{let n=t.opts.elm.formElement.length(),l=()=>{0===--n&&s()};t.opts.elm.formElement.forEach(s=>{let n={elm:s,type:e(s).attr(t.opts.attr.type),name:e(s).attr(t.opts.attr.name),i18n:e(s).attr(t.opts.attr.i18n)||""};n.label=e("<label />").attr(t.opts.attr.i18n,n.i18n).insertAfter(s),e("<p />").addClass(t.opts.classes.desc).attr(t.opts.attr.i18n,n.i18n+"_desc").insertAfter(n.label),a[n.type]?a[n.type](n).then(l):l(),s.remove()})});a.color=(a=>new Promise(s=>{t.opts.elm.color[a.name]=e("<input type='text' />").addClass(t.opts.classes.color.field).insertAfter(a.label);let n=e("<span />").insertAfter(t.opts.elm.color[a.name]),l=new CP(t.opts.elm.color[a.name][0]);l.visible=!1;let o=e(a.elm).attr(t.opts.attr.color.suggestions);if(o){let a=[];JSON.parse(o).forEach(s=>{a.push(e("<span />").addClass(t.opts.classes.color.suggestion).css("background-color",s).insertAfter(n))}),e(a).on("click",t=>{let a=e(t.currentTarget).css("background-color");l.set(a),l.trigger("change")})}e(a.elm).attr(t.opts.attr.color.alpha)&&(l.alpha=e("<input type='range' />").attr({min:0,max:1,step:.01,value:1,[t.opts.attr.name]:a.name}).appendTo(l.picker),l.alpha.on("change input",()=>l.trigger("change")));let r=s=>{let n=t.opts.elm.body.children("div."+t.opts.classes.color.mask+"["+t.opts.attr.name+"='"+a.name+"']");s&&l.visible&&-1!==a.name.search(/MaskColor$/)?(0===n.length()&&(n=e("<div />").addClass(t.opts.classes.color.mask).attr(t.opts.attr.name,a.name).appendTo(t.opts.elm.body)),n.css("background-color",s)):n.length()>0&&n.remove()};l.on("enter",()=>{l.visible=!0;let e=CP._HSV2RGB(l.get());e=l.alpha&&+l.alpha[0].value<1?"rgba("+e.join(",")+","+l.alpha[0].value+")":"rgb("+e.join(",")+")",r(e)}),l.on("exit",()=>{l.visible=!1,r()}),l.on("change",s=>{let o=CP._HSV2RGB(l.get());s&&(o=CP.HEX2RGB(s)),e("head > style["+t.opts.attr.color.style+"='"+a.name+"']").remove(),e("head").append("<style "+t.opts.attr.color.style+"='"+a.name+"'>.color-picker > input[type='range']["+t.opts.attr.name+"='"+a.name+"']::-webkit-slider-runnable-track{background-image:linear-gradient(to right, transparent 0%, rgb("+o.join(",")+") 100%)}</style>"),o=l.alpha&&+l.alpha[0].value<1?"rgba("+o.join(",")+","+l.alpha[0].value+")":"rgb("+o.join(",")+")",t.opts.elm.color[a.name][0].value=o,t.opts.elm.color[a.name].trigger("change"),n.css("background-color",o),r(o)}),t.opts.elm.color[a.name].data("picker",l),s()})),a.font=(a=>new Promise(s=>{t.opts.elm.select[a.name]=e("<select />").insertAfter(a.label),chrome.fontSettings.getFontList(s=>{s.unshift({fontId:"default",displayName:t.helper.i18n.get("settings_font_family_default")}),s.forEach(s=>{0===t.opts.elm.select[a.name].children("option[value='"+s.fontId.replace(/\'/g,"\\27")+"']").length()&&e("<option />").attr("value",s.fontId).text(s.displayName).appendTo(t.opts.elm.select[a.name])})}),s()})),a.language=(a=>new Promise(s=>{t.opts.elm.select[a.name]=e("<select />").insertAfter(a.label),e("<option />").attr("value","default").text(t.helper.i18n.get("settings_language_default")).appendTo(t.opts.elm.select[a.name]),t.helper.model.call("languageInfos").then(n=>{if(n&&n.infos){let s=Object.values(n.infos);s.sort((e,t)=>e.label>t.label?1:-1),s.forEach(s=>{s.available&&e("<option />").attr("value",s.name).text(s.label).appendTo(t.opts.elm.select[a.name])})}s()})})),a.textarea=(a=>new Promise(s=>{t.opts.elm.textarea[a.name]=e("<textarea />").insertAfter(a.label),s()})),a.text=a.email=(a=>new Promise(s=>{t.opts.elm.field[a.name]=e("<input type='"+a.type+"' />").insertAfter(a.label),["placeholder"].forEach(s=>{let n=e(a.elm).attr(t.opts.attr.field[s]);n&&t.opts.elm.field[a.name].attr(s,n)}),s()})),a.radio=(a=>new Promise(s=>{t.opts.elm.radio[a.name]=e("<select />").addClass(t.opts.classes.hidden).insertAfter(a.label);let n=e("<ul />").addClass(t.opts.classes.radio.wrapper).insertAfter(t.opts.elm.radio[a.name]);e(a.elm).children("span").forEach(s=>{let l=e(s).attr(t.opts.attr.value),o=e("<li />").attr(t.opts.attr.value,l).appendTo(n);e(t.helper.checkbox.get(t.opts.elm.body,{[t.opts.attr.name]:a.name,[t.opts.attr.value]:l},"radio")).appendTo(o),e(s).appendTo(o),e("<option />").attr("value",l).text(l).appendTo(t.opts.elm.radio[a.name])}),t.opts.elm.radio[a.name].on("change",e=>{if(void 0===e.detail||"userAction"!==e.detail){let a=n.find("input[type='checkbox']["+t.opts.attr.value+"='"+e.currentTarget.value+"']");a.length()>0&&a.parent("div").trigger("click")}}),n.find("input[type='checkbox']").on("change",s=>{t.opts.elm.radio[a.name][0].value=e(s.currentTarget).attr(t.opts.attr.value),t.opts.elm.radio[a.name].trigger("change",{detail:"userAction"})}),s()})),a.range=(a=>new Promise(s=>{t.opts.elm.range[a.name]=e("<input type='range' />").insertAfter(a.label),["min","max","step"].forEach(s=>{let n=e(a.elm).attr(t.opts.attr.range[s]);n&&t.opts.elm.range[a.name].attr(s,n)}),t.opts.elm.range[a.name].attr("value",e(a.elm).attr(t.opts.attr.value)||"");let n=e(a.elm).attr(t.opts.attr.range.unit)||"",l=e("<span />").insertAfter(t.opts.elm.range[a.name]);if(t.opts.elm.range[a.name].on("input change",s=>{let o=s.currentTarget,r=o.max||100,i=o.min||0,p=Math.round(100*(o.value-i)/(r-i)),c=t.opts.elm.range[a.name].css("background-image");if(0===c.search("linear-gradient")){let s=e(o).data("backgroundTemplate");void 0===s&&(s=c.replace(/\-1px/g,"{percent}"),e(o).data("backgroundTemplate",s)),t.opts.elm.range[a.name].css("background-image",s.replace(/\{percent\}/g,p+"%"))}l.text(o.value+n)}),t.opts.elm.range[a.name].trigger("input"),!0==!!e(a.elm).attr(t.opts.attr.range.infinity)){let s=t.helper.checkbox.get(t.opts.elm.body).insertAfter(l);e("<label />").attr(t.opts.attr.i18n,a.i18n+"_infinity").insertAfter(s),e("<br />").insertBefore(s),s.children("input[type='checkbox']").on("change",e=>{e.currentTarget.checked?t.opts.elm.range[a.name].addClass(t.opts.classes.range.inactive):t.opts.elm.range[a.name].removeClass(t.opts.classes.range.inactive)}),t.opts.elm.range[a.name].data("infinityCheckbox",s)}s()})),a.select=(a=>new Promise(s=>{t.opts.elm.select[a.name]=e("<select />").insertAfter(a.label),e(a.elm).children("span").forEach(s=>{let n=e(s).attr(t.opts.attr.i18n),l=e("<option />").attr({value:e(s).attr(t.opts.attr.value)}).html(e(s).html()).appendTo(t.opts.elm.select[a.name]);n&&l.attr(t.opts.attr.i18n,n)}),s()})),a.checkbox=(e=>new Promise(a=>{t.opts.elm.checkbox[e.name]=t.helper.checkbox.get(t.opts.elm.body).insertAfter(e.label),a()}))},window.ImportExportHelper=function(t){this.init=(async()=>{n(),s()}),this.getExportConfig=(()=>{let e=Object.assign({},t.helper.model.getAllData());return delete e.utility,e});let a=()=>{t.helper.model.call("trackEvent",{category:"settings",action:"import",label:"failed"}),alert(t.helper.i18n.get("settings_import_failed"))},s=async()=>{t.opts.elm.buttons.import.on("change",s=>{s.preventDefault();let n=s.currentTarget;if(n.files&&n.files[0]&&n.files[0].name.search(/\.config$/)>-1){let s=new FileReader;s.onload=(s=>{try{let n=JSON.parse(s.target.result);n.behaviour&&n.appearance?chrome.storage.sync.set({behaviour:n.behaviour,appearance:n.appearance},()=>{t.helper.model.call("trackEvent",{category:"settings",action:"import",label:"import"}),t.helper.model.call("reinitialize"),t.showSuccessMessage("import_saved"),e.delay(1500).then(()=>{location.reload(!0)})}):a()}catch(s){a()}}),s.readAsText(n.files[0])}else a()})},n=async()=>{t.opts.elm.buttons.export.attr({href:"data:text/json;charset=utf-8,"+encodeURIComponent(JSON.stringify(this.getExportConfig())),download:"bookmark-sidebar.config"}).on("click",()=>{t.helper.model.call("trackEvent",{category:"settings",action:"export",label:"export"})})}},window.MenuHelper=function(t){let a=!1,s=!0,n=null,l=null,o=null;this.init=(()=>new Promise(a=>{n=e("<ul />").appendTo(t.opts.elm.aside.children("nav"));let l=t.opts.elm.content.children("div."+t.opts.classes.tabs.content).length(),o=()=>{0===--l&&r().then(()=>{s=!1,a()})};t.opts.elm.content.children("div."+t.opts.classes.tabs.content).forEach(a=>{let s=e(a).attr(t.opts.attr.name),l=e("<li />").attr(t.opts.attr.name,s).html("<a href='#'>"+t.helper.i18n.get("settings_menu_"+s)+"</a>").appendTo(n),r=e(a).children("div["+t.opts.attr.name+"]");if(r.length()>0){let a=e("<ul />").appendTo(l);r.forEach(n=>{let l=e(n).attr(t.opts.attr.name);e("<li />").attr(t.opts.attr.name,l).html("<a href='#'>"+t.helper.i18n.get("settings_menu_"+s+"_"+l)+"</a>").appendTo(a)}),e.delay(500).then(()=>{a.data("entryHeight",a.children("li")[0].scrollHeight),o()})}else o()}),i()})),this.getPage=(()=>o||e()),this.getPath=(()=>l),this.addBreadcrumb=(a=>{t.opts.elm.content[0].scrollTop=0,a.depth&&l.length>=a.depth?(l[a.depth-1]=a.alias,t.opts.elm.headline.children("span").forEach((t,s)=>{s>=a.depth-1&&e(t).remove()})):l.push(a.alias),t.opts.elm.headline.append("<span>"+a.label+"</span>")});let r=()=>new Promise(t=>{let a=location.hash?location.hash.substr(1):null;a?d(...a.split("_")):n.find("a").eq(0).trigger("click"),e.delay(300).then(t)}),i=()=>{n.find("a").on("click",a=>{a.preventDefault();let s=e(a.currentTarget).parent("li"),n=s.attr(t.opts.attr.name);if(s.parents("li").length()>0){let e=s.parent("ul").parent("li").attr(t.opts.attr.name);d(e,n)}else d(n)}),t.opts.elm.headline.on("click","span",t=>{let a=e(t.currentTarget).prevAll().length();d(...l.slice(0,a+1))}),e(window).on("popstate",()=>{r()})},p=()=>{let e=this.getPath(),a=[t.opts.elm.content.children("div."+t.opts.classes.tabs.content+"["+t.opts.attr.name+"='"+e[0]+"']")];e[1]&&a.unshift(a[0].children("div["+t.opts.attr.name+"='"+e[1]+"']")),["save","restore"].forEach(e=>{a.some(a=>{let s=a.attr(t.opts.attr.buttons[e]);if(t.opts.elm.buttons[e].addClass(t.opts.classes.hidden),s)return"false"!==s&&t.opts.elm.buttons[e].html("true"===s?"":t.helper.i18n.get(s)).removeClass(t.opts.classes.hidden),!0})})},c=()=>{n.find("li").removeClass(t.opts.classes.tabs.active);let e=t.opts.elm.content.children("div."+t.opts.classes.tabs.content);e.removeClass(t.opts.classes.tabs.active),e.children("div["+t.opts.attr.name+"]").removeClass(t.opts.classes.tabs.active),n.find("ul").css("height","")},d=(...s)=>new Promise(r=>{if(a)r();else{a=!0;let i=s.length,d=[],h=n.children("li["+t.opts.attr.name+"='"+s[0]+"']"),m=t.opts.elm.content.children("div."+t.opts.classes.tabs.content+"["+t.opts.attr.name+"='"+s[0]+"']");1===i&&m.find("> div["+t.opts.attr.name+"]").length()>0&&(h.hasClass(t.opts.classes.incomplete)&&"language"===s[0]?s.push(m.find("> div["+t.opts.attr.name+"='translate']").eq(0).attr(t.opts.attr.name)):s.push(m.find("> div["+t.opts.attr.name+"]").eq(0).attr(t.opts.attr.name)),i++);let g=s.join("_");c();for(let e=1;e<=i;e++){let a=h.parent("ul");if(a&&a.length()>0){if(h.addClass(t.opts.classes.tabs.active),m.addClass(t.opts.classes.tabs.active),d.push(h.children("a").html()),a.data("entryHeight")){let e=a.data("entryHeight"),s=a.children("li:not(."+t.opts.classes.hidden+")").length();a.css("height",e*s+"px")}e<i&&(h=h.find("> ul > li["+t.opts.attr.name+"='"+s[e]+"']"),m=m.find("> div["+t.opts.attr.name+"='"+s[e]+"']"))}}t.opts.elm.headline.html("<span>"+d.join("</span><span>")+"</span>"),t.opts.elm.body.attr(t.opts.attr.type,g),location.hash=g,o=m,l=s,t.opts.elm.content[0].scrollTop=0,p(),t.opts.elm.header.css("padding-right",""),t.opts.elm.content.css("padding-right",""),document.dispatchEvent(new CustomEvent(t.opts.events.pageChanged,{detail:{path:s},bubbles:!0,cancelable:!1})),t.helper.model.call("trackEvent",{category:"settings",action:"page",label:g}),e.delay().then(()=>{a=!1,r()})}})},window.NewtabHelper=function(e){let t=!1;this.init=(async()=>{a(),e.opts.elm.newtab.content.find("div."+e.opts.classes.newtab.hideable).addClass(e.opts.classes.hidden),["override","initialOpen"].forEach(a=>{!0===e.helper.model.getData("n/"+a)?"override"===a?chrome.permissions.contains({permissions:["tabs","topSites"]},t=>{t&&e.opts.elm.checkbox[a].trigger("click")}):e.opts.elm.checkbox[a].trigger("click"):t=!0}),["website"].forEach(t=>{e.opts.elm.field[t][0].value=e.helper.model.getData("n/"+t)})}),this.save=(()=>new Promise(t=>{chrome.storage.sync.get(["newtab"],a=>{let s=a.newtab||{};["override","initialOpen"].forEach(t=>{s[t]=e.helper.checkbox.isChecked(e.opts.elm.checkbox[t])}),["website"].forEach(t=>{s[t]=e.opts.elm.field[t][0].value.trim()}),s.website&&s.website.length&&0!==s.website.search(/^\w+\:\/\//)&&(s.website="http://"+s.website),chrome.storage.sync.set({newtab:s},()=>{e.helper.model.call("reinitialize"),e.showSuccessMessage("saved_message"),t()})})}));let a=()=>{e.opts.elm.checkbox.override.children("input[type='checkbox']").on("change",()=>{let a=e.helper.checkbox.isChecked(e.opts.elm.checkbox.override),s=e.opts.elm.newtab.content.find("div."+e.opts.classes.newtab.hideable);a?!0===t?chrome.permissions.request({permissions:["tabs","topSites"]},t=>{t||(e.opts.elm.checkbox.override.trigger("click"),a=!1),a?s.removeClass(e.opts.classes.hidden):s.addClass(e.opts.classes.hidden)}):s.removeClass(e.opts.classes.hidden):s.addClass(e.opts.classes.hidden)})}},window.SidebarHelper=function(e){this.init=(async()=>{t(),["dirAccordion","animations","preventPageScroll","dndOpen"].forEach(t=>{!0===e.helper.model.getData("b/"+t)&&e.opts.elm.checkbox[t].trigger("click")});let a=e.helper.model.getData("b/pxTolerance");e.opts.elm.range.pxToleranceMaximized[0].value=a.maximized,e.opts.elm.range.pxToleranceWindowed[0].value=a.windowed,["openAction","sidebarPosition","language","linkAction","rememberState","newTab","newTabPosition","tooltipContent"].forEach(t=>{e.opts.elm.select[t][0].value=e.helper.model.getData("b/"+t),e.opts.elm.select[t].trigger("change")}),["openDelay","dirOpenDuration","openChildrenWarnLimit","scrollBarHide","closeTimeout","tooltipDelay"].forEach(t=>{let a=e.helper.model.getData("b/"+t);if(-1===a){let a=e.opts.elm.range[t].data("infinityCheckbox");a&&a.length()>0&&a.trigger("click")}e.opts.elm.range[t][0].value=a,e.opts.elm.range[t].trigger("change")}),e.opts.elm.range.pxToleranceMaximized.trigger("change"),e.opts.elm.range.pxToleranceWindowed.trigger("change")}),this.save=(()=>new Promise(t=>{let a={pxTolerance:{maximized:e.opts.elm.range.pxToleranceMaximized[0].value,windowed:e.opts.elm.range.pxToleranceWindowed[0].value}};["openAction","sidebarPosition","language","linkAction","rememberState","newTab","newTabPosition","tooltipContent"].forEach(t=>{a[t]=e.opts.elm.select[t][0].value}),["openDelay","dirOpenDuration","openChildrenWarnLimit","scrollBarHide","closeTimeout","tooltipDelay"].forEach(t=>{let s=-1;!1===e.opts.elm.range[t].hasClass(e.opts.classes.range.inactive)&&(s=e.opts.elm.range[t][0].value),a[t]=s}),["dirAccordion","animations","preventPageScroll","dndOpen"].forEach(t=>{a[t]=e.helper.checkbox.isChecked(e.opts.elm.checkbox[t])}),chrome.storage.sync.set({behaviour:a},()=>{e.helper.model.call("reinitialize"),e.showSuccessMessage("saved_message"),t()})})),this.saveLanguage=(()=>new Promise(t=>{chrome.storage.sync.get(["behaviour"],a=>{let s=a.behaviour||{};s.language=e.opts.elm.select.language[0].value,chrome.storage.sync.set({behaviour:s},()=>{e.helper.model.call("reinitialize"),e.showSuccessMessage("saved_message"),t()})})}));let t=()=>{e.opts.elm.select.openAction.on("change",t=>{let a=e.opts.elm.aside.find("li["+e.opts.attr.name+"='indicator']");"contextmenu"===t.currentTarget.value||"mousedown"===t.currentTarget.value?a.removeClass(e.opts.classes.hidden):a.addClass(e.opts.classes.hidden)}),e.opts.elm.keyboardShortcutInfo.children("a").on("click",e=>{e.preventDefault(),chrome.tabs.create({url:"chrome://extensions/configureCommands",active:!0})})}},window.SupportHelper=function(e){this.init=(async()=>{t()});let t=async()=>{chrome.storage.sync.get(["shareUserdata"],t=>{t.shareUserdata&&!0===t.shareUserdata&&e.opts.elm.checkbox.shareUserdata.trigger("click"),e.opts.elm.checkbox.shareUserdata.children("input[type='checkbox']").on("change",()=>{chrome.storage.sync.set({shareUserdata:e.helper.checkbox.isChecked(e.opts.elm.checkbox.shareUserdata)},()=>{e.showSuccessMessage("saved_share_userdata")})})}),e.opts.elm.support.donateButton.on("click",t=>{t.preventDefault(),window.open(e.opts.donateLink,"_blank")})}},window.TranslationHelper=function(t){let a={},s={},n={};this.init=(()=>new Promise(e=>{l().then(()=>{r(),t.serviceAvailable?o().then(()=>{i(),g()}):c(),e()})})),this.submit=(()=>new Promise(a=>{let s=t.opts.elm.translation.langvars.data("lang");if(s){let a=+new Date,n=t.helper.template.loading().appendTo(t.opts.elm.body);t.opts.elm.body.addClass(t.opts.classes.loading);let l={};t.opts.elm.translation.wrapper.find("div."+t.opts.classes.translation.category+"["+t.opts.attr.translation.language+"='"+s+"']").forEach(t=>{e(t).find("textarea").forEach(t=>{let a=t.value;if(a&&a.trim().length>0){let s=e(t).data("initial");if((a=a.trim())!==s){let s=e(t).data("name");l[s]=a}}})}),e.xhr(t.opts.ajax.translation.submit,{method:"POST",data:{lang:s,vars:l}}).then(()=>e.delay(Math.max(0,1e3-(+new Date-a)))).then(()=>(n.remove(),t.showSuccessMessage("translation_submit_message"),e.delay(1500))).then(()=>{t.opts.elm.body.removeClass(t.opts.classes.loading),y(s)})}else a()}));let l=()=>new Promise(e=>{t.helper.model.call("languageInfos").then(t=>{a=t.infos,e()})}),o=()=>new Promise(s=>{t.opts.elm.translation.overview.children("div."+t.opts.classes.boxWrapper).html(""),e.xhr(t.opts.ajax.translation.info).then(n=>{let l=JSON.parse(n.responseText);if(l&&l.languages){let s=t.helper.i18n.getLanguage();l.languages.sort((e,t)=>t.varsAmount!==e.varsAmount?t.varsAmount-e.varsAmount:a[e.name]&&a[t.name]?a[e.name].label>a[t.name].label?1:-1:1);let n=Object.assign({},a);l.languages.forEach(o=>{if(a[o.name]){let r=o.varsAmount/l.varsAmount*100;if(r>=15){delete n[o.name];let i="draft",p=Math.floor(r);a[o.name].available&&(i=l.varsAmount>o.varsAmount?"incomplete":"released");let c=e("<div />").data("lang",o.name).addClass(t.opts.classes.box).attr(t.opts.attr.translation.releaseStatus,i).append("<a href='#' class='"+t.opts.classes.translation.edit+"'></a>").append("<strong>"+a[o.name].label+"</strong>").append("<div class="+t.opts.classes.translation.progress+" "+t.opts.attr.value+"='"+p+"%'><div style='width:"+p+"%'></div></div>").append("<span title='"+t.helper.i18n.get("settings_translation_status_"+i)+"'></span>").appendTo(t.opts.elm.translation.overview.children("div."+t.opts.classes.boxWrapper));s===o.name&&(d(o.categories,l.categories)&&(t.opts.elm.aside.find("li["+t.opts.attr.name+"='language']").addClass(t.opts.classes.incomplete),e("<span />").attr("title",t.helper.i18n.get("settings_translation_incomplete_info")).appendTo(t.opts.elm.aside.find("li["+t.opts.attr.name+"='language'] > a"))),c.addClass(t.opts.classes.translation.mark))}}}),h(n)}t.opts.elm.translation.overview.addClass(t.opts.classes.visible),s()})}),r=()=>{t.opts.elm.translation.goto.on("click",e=>{e.preventDefault(),t.opts.elm.aside.find("li["+t.opts.attr.name+"='translate'] > a").trigger("click")}),e(document).on(t.opts.events.pageChanged,e=>{e.detail.path&&"translate"===e.detail.path[1]&&(e.detail.path[2]?y(e.detail.path[2]):t.serviceAvailable?p():c())})},i=()=>{t.opts.elm.translation.overview.find("select."+t.opts.classes.translation.select).on("change",e=>{y(e.currentTarget.value)}),t.opts.elm.translation.overview.find("div."+t.opts.classes.box).on("click",t=>{t.preventDefault();let a=e(t.currentTarget).data("lang");a&&y(a)})},p=()=>{t.opts.elm.translation.wrapper.find("."+t.opts.classes.visible).removeClass(t.opts.classes.visible),t.opts.elm.translation.overview.addClass(t.opts.classes.visible),t.opts.elm.buttons.save.addClass(t.opts.classes.hidden)},c=()=>{t.opts.elm.translation.unavailable.addClass(t.opts.classes.visible),t.opts.elm.translation.wrapper.hasClass(t.opts.classes.tabs.active)&&t.opts.elm.buttons.save.addClass(t.opts.classes.hidden)},d=(e,t)=>{let a=!1;return Object.keys(e).some(s=>{if(t[s]>e[s])return a=!0,!0}),a},h=s=>{let n=e("<div />").addClass(t.opts.classes.box).appendTo(t.opts.elm.translation.overview.children("div."+t.opts.classes.boxWrapper)),l=e("<select class='"+t.opts.classes.translation.select+"' />").appendTo(n);e("<option value='' />").text(t.helper.i18n.get("settings_translation_add_language")).appendTo(l);let o=[];Object.keys(s).forEach(t=>{o.push({elm:e("<option value='"+t+"' />").text(a[t].label),label:a[t].label})}),o.sort((e,t)=>e.label>t.label?1:-1),o.forEach(e=>{e.elm.appendTo(l)})},m=a=>new Promise(n=>{let l=e=>{e&&void 0===s[a]&&(s[a]=e),n(e)};s[a]?l(s[a]):e.xhr(t.opts.ajax.translation.langvars,{method:"POST",data:{lang:a,n:1}}).then(e=>{let s=JSON.parse(e.responseText);if(s&&Object.getOwnPropertyNames(s).length>0){let e={[a]:s},n=t.helper.i18n.getDefaultLanguage();a!==n?m(n).then(t=>{e.default=t[n],l(e)}):l(e)}else l(null)})}),g=()=>{t.opts.elm.translation.wrapper.on("click","a."+t.opts.classes.translation.back,a=>{a.preventDefault();let s=e(a.currentTarget).parents("div."+t.opts.classes.translation.category).eq(0).attr(t.opts.attr.translation.language);y(s)}),t.opts.elm.translation.wrapper.on("click","a."+t.opts.classes.translation.goto,a=>{a.preventDefault();let s=e(a.currentTarget).attr(t.opts.attr.value),n=e(a.currentTarget).parent("header").next("ul");f(s,n)}),t.opts.elm.translation.langvars.on("click","div."+t.opts.classes.box,t=>{t.preventDefault();let a=e(t.currentTarget),s=a.data("lang"),n=a.children("strong").text(),l=a.data("info");u(s,n,l)})},u=(s,l,o)=>{let r=t.opts.elm.translation.wrapper.find("div."+t.opts.classes.translation.category+"["+t.opts.attr.name+"='"+l+"']["+t.opts.attr.translation.language+"='"+s+"']");if(0===r.length()){let i=s+"_"+l;r=e("<div />").attr(t.opts.attr.name,l).attr(t.opts.attr.translation.language,s).addClass(t.opts.classes.translation.category).addClass(t.opts.classes.contentBox).appendTo(t.opts.elm.translation.wrapper);let p=e("<header />").appendTo(r),c=e("<ul />").appendTo(r);o.category.vars.forEach((s,n)=>{let l=e("<li />").append("<div><label>"+s.label+"</label></div>").append("<div />").appendTo(c);o.defaults&&o.defaults.vars&&o.defaults.vars[n]&&e("<span />").html("<span>"+a[t.helper.i18n.getDefaultLanguage()].label+" translation:</span>"+o.defaults.vars[n].value||"").appendTo(l.children("div").eq(0));let r=s.value||"";e("<textarea />").data({initial:r,name:s.name}).text(r).appendTo(l.children("div").eq(1)),0===r.length&&l.addClass(t.opts.classes.translation.empty)}),b(r),e("<a />").text(t.helper.i18n.get("settings_translation_back_to_overview")).addClass(t.opts.classes.translation.back).appendTo(p),n[i].total!==n[i].filled&&(e("<a />").addClass(t.opts.classes.translation.goto).attr(t.opts.attr.value,"down").appendTo(p),e("<a />").addClass(t.opts.classes.translation.goto).attr(t.opts.attr.value,"up").appendTo(p)),e("<span />").addClass(t.opts.classes.translation.amountInfo).html("<span>"+n[i].filled+"</span>&thinsp;/&thinsp;"+n[i].total).appendTo(p)}t.opts.elm.translation.langvars.removeClass(t.opts.classes.visible),r.addClass(t.opts.classes.visible),t.helper.menu.addBreadcrumb({label:l,alias:l,depth:4}),e.delay(0).then(()=>{let e=r.children("ul");r.find("a."+t.opts.classes.translation.goto).length()>0&&f("down",e),v(s,e)})},f=(e,a)=>{let s=null;if(a.find("li."+t.opts.classes.translation.hover).length()>0?s="up"===e?a.find("li."+t.opts.classes.translation.hover).eq(0).prevAll("li."+t.opts.classes.translation.empty):a.find("li."+t.opts.classes.translation.hover).eq(0).nextAll("li."+t.opts.classes.translation.empty):"down"===e&&(s=a.find("li."+t.opts.classes.translation.empty)),s&&s.length()>0){let e=s.eq(0);t.opts.elm.content[0].scrollTop=Math.max(0,e[0].offsetTop-40),e.find("textarea")[0].focus()}},v=(a,s)=>{if(a!==t.helper.i18n.getDefaultLanguage()&&t.helper.model.getData("u/translationHelp")){let a=null;(a="TEXTAREA"===document.activeElement.tagName?e(document.activeElement).parents("li").eq(0):s.children("li").eq(0)).addClass(t.opts.classes.translation.mark);let n=a.find("label").text();e("<span />").addClass(t.opts.classes.desc).html(t.helper.i18n.get("settings_translation_help",["<strong>"+n+"</strong>"])).appendTo(a),t.helper.model.setData({"u/translationHelp":!1})}},b=a=>{a.find("textarea").on("change input",s=>{let l=s.currentTarget.value,o=a.attr(t.opts.attr.name),r=a.attr(t.opts.attr.translation.language);l?e(s.currentTarget).parents("li").eq(0).removeClass(t.opts.classes.translation.empty):e(s.currentTarget).parents("li").eq(0).addClass(t.opts.classes.translation.empty);let i=0;a.find("textarea").forEach(e=>{e.value&&e.value.trim().length>0&&i++}),n[r+"_"+o].filled=i,a.find("span."+t.opts.classes.translation.amountInfo+" > span").text(i)}).on("focus",s=>{a.find("li").removeClass(t.opts.classes.translation.hover),e(s.currentTarget).parents("li").eq(0).addClass(t.opts.classes.translation.hover)}).on("blur",a=>{let s=e(a.currentTarget).parents("li").eq(0);e.delay(200).then(()=>{s.removeClass(t.opts.classes.translation.hover)})})},y=s=>{t.helper.menu.addBreadcrumb({label:a[s].label,alias:s,depth:3}),t.opts.elm.translation.langvars.data("lang",s),t.opts.elm.translation.langvars.find("div."+t.opts.classes.boxWrapper).html(""),t.opts.elm.translation.wrapper.find("div."+t.opts.classes.translation.category).removeClass(t.opts.classes.visible),t.opts.elm.buttons.save.removeClass(t.opts.classes.hidden),t.opts.elm.translation.overview.removeClass(t.opts.classes.visible),t.opts.elm.translation.langvars.addClass([t.opts.classes.visible,t.opts.classes.loading]);let l=t.helper.template.loading().appendTo(t.opts.elm.translation.langvars);m(s).then(a=>{if(a){let l=a[s];Object.keys(l).forEach(o=>{let r=e("<div />").addClass(t.opts.classes.box).data("lang",s).data("info",{category:l[o],defaults:a.default?a.default[o]:null}).append("<strong>"+o+"</strong>").appendTo(t.opts.elm.translation.langvars.children("div."+t.opts.classes.boxWrapper)),i=s+"_"+o;void 0===n[i]&&(n[i]={total:l[o].vars.length,filled:0},l[o].vars.forEach(e=>{e.value&&n[i].filled++})),l[o].required&&e("<span />").addClass(t.opts.classes.translation.requiredInfo).text("("+t.helper.i18n.get("settings_translation_required_category")+")").appendTo(r),e("<span />").addClass(t.opts.classes.translation.amountInfo).html("<span>"+n[i].filled+"</span>&thinsp;/&thinsp;"+n[i].total).appendTo(r),n[i].total>n[i].filled&&(r.addClass(t.opts.classes.incomplete),r.children("a").attr("title",t.helper.i18n.get("settings_translation_incomplete_info")))})}else p();t.opts.elm.translation.langvars.removeClass(t.opts.classes.loading),l.remove()})}},window.settings=function(){this.opts={classes:{page:{darkMode:"dark",ee:"ee"},tabs:{content:"tab",active:"active"},color:{field:"color",mask:"colorMask",suggestion:"suggestion"},radio:{wrapper:"radioWrapper"},range:{inactive:"inactive"},newtab:{hideable:"hideable"},translation:{select:"languageSelect",category:"category",edit:"edit",progress:"progress",mark:"mark",requiredInfo:"requiredInfo",amountInfo:"amountInfo",empty:"empty",back:"back",hover:"hover",goto:"goto"},checkbox:{box:"checkbox",active:"active",clicked:"clicked",focus:"focus"},hidden:"hidden",success:"success",error:"error",building:"building",initLoading:"initLoading",loading:"loading",revert:"revert",visible:"visible",small:"small",desc:"desc",box:"box",boxWrapper:"boxWrapper",contentBox:"contentBox",action:"action",incomplete:"incomplete"},attr:{type:"data-type",appearance:"data-appearance",name:"data-name",i18n:"data-i18n",value:"data-value",success:"data-successtext",style:"data-style",hideOnFalse:"data-hideOnFalse",buttons:{save:"data-save",restore:"data-restore"},range:{min:"data-min",max:"data-max",step:"data-step",unit:"data-unit",infinity:"data-infinity"},color:{alpha:"data-alpha",style:"data-color",suggestions:"data-suggestions"},field:{placeholder:"data-placeholder"},translation:{releaseStatus:"data-status",language:"data-lang"}},elm:{body:e("body"),title:e("head > title"),aside:e("body > section#wrapper > aside"),content:e("body > section#wrapper > main"),header:e("body > header"),headline:e("body > header > h1"),buttons:{save:e("body > header > menu > button.save"),restore:e("body > header > menu > button.restore"),import:e("body a.import > input[type='file']"),export:e("body a.export")},appearance:{content:e("div.tab[data-name='appearance']")},newtab:{content:e("div.tab[data-name='newtab']")},feedback:{wrapper:e("div.tab[data-name='feedback']"),form:e("section.form"),send:e("section.form button[type='submit']"),faq:e("div.faq")},translation:{wrapper:e("div.tab[data-name='language'] > div[data-name='translate']"),goto:e("div.tab[data-name='language'] > div[data-name='general'] button[type='submit']"),overview:e("div.tab[data-name='language'] > div[data-name='translate'] > div.overview"),langvars:e("div.tab[data-name='language'] > div[data-name='translate'] > div.langvars"),unavailable:e("div.tab[data-name='language'] > div[data-name='translate'] > div.unavailable")},keyboardShortcutInfo:e("p.shortcutInfo"),formElement:e("div.formElement"),support:{donateButton:e("div.tab[data-name='support'] button[type='submit']")},preview:{},checkbox:{},range:{},select:{},color:{},textarea:{},field:{},radio:{}},events:{pageChanged:"blockbyte-bs-pageChanged"},ajax:{feedback:"https://extensions.blockbyte.de/ajax/feedback",translation:{info:"https://extensions.blockbyte.de/ajax/bs/i18n/info",langvars:"https://extensions.blockbyte.de/ajax/bs/i18n/langvars",submit:"https://extensions.blockbyte.de/ajax/bs/i18n/submit"}},donateLink:"https://www.paypal.com/cgi-bin/webscr?cmd=_s-xclick&hosted_button_id=2VW2UADL99YEL",manifest:chrome.runtime.getManifest()},this.serviceAvailable=!0,this.run=(()=>{t();let n={body:this.helper.template.loading().appendTo(this.opts.elm.body)};this.opts.elm.body.addClass(this.opts.classes.initLoading),this.helper.model.init().then(()=>this.helper.i18n.init()).then(()=>(this.helper.font.init(),this.helper.stylesheet.init(),this.helper.stylesheet.addStylesheets(["settings"],e(document)),a(),this.helper.form.init())).then(()=>(this.opts.elm.body.removeClass(this.opts.classes.building),this.helper.i18n.parseHtml(document),this.opts.elm.title.text(this.opts.elm.title.text()+" - "+this.helper.i18n.get("extension_name")),this.opts.elm.buttons.restore.attr("title",this.helper.i18n.get("settings_restore")),["translation","feedback"].forEach(e=>{n[e]=this.helper.template.loading().appendTo(this.opts.elm[e].wrapper),this.opts.elm[e].wrapper.addClass(this.opts.classes.loading)}),Promise.all([this.helper.menu.init(),this.helper.sidebar.init(),this.helper.appearance.init(),this.helper.newtab.init(),this.helper.support.init(),this.helper.importExport.init()]))).then(()=>(s(),n.body.remove(),this.opts.elm.body.removeClass(this.opts.classes.initLoading),this.helper.model.call("trackPageView",{page:"/settings"}),this.helper.model.call("websiteStatus"))).then(e=>{this.serviceAvailable="available"===e.status,this.helper.feedback.init(),this.helper.translation.init(),["translation","feedback"].forEach(e=>{n[e].remove(),this.opts.elm[e].wrapper.removeClass(this.opts.classes.loading)})})}),this.showSuccessMessage=(t=>{this.opts.elm.body.attr(this.opts.attr.success,this.helper.i18n.get("settings_"+t)),this.opts.elm.body.addClass(this.opts.classes.success),e.delay(1500).then(()=>{this.opts.elm.body.removeClass(this.opts.classes.success)})});let t=()=>{this.helper={model:new window.ModelHelper(this),checkbox:new window.CheckboxHelper(this),template:new window.TemplateHelper(this),i18n:new window.I18nHelper(this),font:new window.FontHelper(this),stylesheet:new window.StylesheetHelper(this),translation:new window.TranslationHelper(this),menu:new window.MenuHelper(this),form:new window.FormHelper(this),sidebar:new window.SidebarHelper(this),newtab:new window.NewtabHelper(this),appearance:new window.AppearanceHelper(this),feedback:new window.FeedbackHelper(this),importExport:new window.ImportExportHelper(this),support:new window.SupportHelper(this)}},a=()=>{this.helper.template.svgByName("icon-settings").then(e=>{this.opts.elm.header.prepend(e)})},s=async()=>{this.opts.elm.buttons.save.on("click",t=>{t.preventDefault();let a=this.helper.menu.getPath();switch(a[0]){case"sidebar":this.helper.sidebar.save();break;case"appearance":this.helper.appearance.save();break;case"newtab":this.helper.newtab.save();break;case"language":"translate"===a[1]?this.helper.translation.submit():this.helper.sidebar.saveLanguage().then(()=>e.delay(1500)).then(()=>{location.reload(!0)})}}),this.opts.elm.buttons.restore.on("click",t=>{t.preventDefault();let a=t=>{let a=this.helper.model.getData("b/language");chrome.storage.sync.remove([t],()=>{"sidebar"===t&&chrome.storage.sync.set({behaviour:{language:a}}),this.showSuccessMessage("restored_message"),this.helper.model.call("reloadIcon"),e.delay(1500).then(()=>{this.helper.model.call("reinitialize"),location.reload(!0)})})};switch(this.helper.menu.getPath()[0]){case"sidebar":a("sidebar");break;case"appearance":a("appearance");break;case"newtab":a("newtab")}})}},(new window.settings).run()})(jsu);