/*! (c) Philipp KÃ¶nig under GPL-3.0 */
"use strict";var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};!function(){var e=null,n={},a=null,t=[],o=!1,r={check404:"https://blockbyte.de/extensions",updateUrls:"https://blockbyte.de/ajax/extensions/updateUrls",userdata:"https://blockbyte.de/ajax/extensions/userdata",uninstall:"https://blockbyte.de/extensions/bs/uninstall"},i={},c={af:"Afrikaans",ar:"Arabic",hy:"Armenian",be:"Belarusian",bg:"Bulgarian",ca:"Catalan","zh-CN":"Chinese (Simplified)","zh-TW":"Chinese (Traditional)",hr:"Croatian",cs:"Czech",da:"Danish",nl:"Dutch",en:"English",eo:"Esperanto",et:"Estonian",tl:"Filipino",fi:"Finnish",fr:"French",de:"German",el:"Greek",iw:"Hebrew",hi:"Hindi",hu:"Hungarian",is:"Icelandic",id:"Indonesian",it:"Italian",ja:"Japanese",ko:"Korean",lv:"Latvian",lt:"Lithuanian",no:"Norwegian",fa:"Persian",pl:"Polish",pt:"Portuguese",ro:"Romanian",ru:"Russian",sr:"Serbian",sk:"Slovak",sl:"Slovenian",es:"Spanish",sw:"Swahili",sv:"Swedish",ta:"Tamil",th:"Thai",tr:"Turkish",uk:"Ukrainian",vi:"Vietnamese"},s={get:function(e,n){chrome.bookmarks.get(""+e,n)},getSubTree:function(e,n){chrome.bookmarks.getSubTree(""+e,n)},removeTree:function(e,n){chrome.bookmarks.removeTree(""+e,n)},update:function(e,n,a){chrome.bookmarks.update(""+e,n,a)},create:function(e,n){chrome.bookmarks.create(e,n)},move:function(e,n,a){chrome.bookmarks.move(""+e,n,a)},search:function(e,n){chrome.bookmarks.search(e,n)}},l=function(e){e.id&&f(function(){void 0===a[e.id]&&(void 0===a["node_"+e.id]?a[e.id]={c:0}:a[e.id]={c:a["node_"+e.id]}),"object"!==_typeof(a[e.id])&&(a[e.id]={c:a[e.id]}),a[e.id].c++,a[e.id].d=+new Date,delete a["node_"+e.id],chrome.storage.local.set({clickCounter:a},function(){void 0===chrome.runtime.lastError&&(n.clickCounter&&(delete n.clickCounter,m()),chrome.storage.sync.remove(["clickCounter"]))})})},u=function(e){chrome.tabs.query({},function(n){n.forEach(function(n){chrome.tabs.sendMessage(n.id,{action:"refresh",scrollTop:e.scrollTop||!1,type:e.type})})})},d=function(n){var a=arguments.length>1&&void 0!==arguments[1]&&arguments[1];!window.ga||!0!==e&&!0!==a||window.ga("send",{hitType:"event",eventCategory:n.category,eventAction:n.action,eventLabel:n.label,eventValue:n.value||1})},h={realUrl:function(e,n){if(e.abort&&!0===e.abort)t.forEach(function(e){e.abort()});else{var a=new XMLHttpRequest;a.open("POST",r.updateUrls,!0),a.onload=function(){var e=JSON.parse(a.responseText);n(e)};var o=new FormData;o.append("url",e.url),o.append("ua",navigator.userAgent),o.append("lang",chrome.i18n.getUILanguage()),a.send(o),t.push(a)}},addViewAmount:function(e){void 0===n.openedByExtension&&s.search({url:e.url},function(n){n.some(function(n){return n.url===e.url&&(l(n),!0)})}),delete n.openedByExtension,m()},bookmarks:function(e,n){s.getSubTree(e.id,function(e){n({bookmarks:e})})},searchBookmarks:function(e,n){s.search(e.searchVal,function(e){n({bookmarks:e})})},moveBookmark:function(e,n){var a={parentId:""+e.parentId,index:e.index};s.move(e.id,a,function(){n({moved:e.id})})},updateBookmark:function(e,n){var a={title:e.title};e.url&&(a.url=e.url),s.update(e.id,a,function(){var a=chrome.runtime.lastError;n(void 0===a?{updated:e.id}:{error:a.message})})},createBookmark:function(e,n){var a={parentId:e.parentId,index:e.index||0,title:e.title,url:e.url?e.url:null};s.create(a,function(){var a=chrome.runtime.lastError;n(void 0===a?{created:e.id}:{error:a.message})})},deleteBookmark:function(e,n){s.removeTree(e.id,function(){n({deleted:e.id})})},refreshAllTabs:u,shareUserdata:function(n){chrome.storage.sync.set({shareUserdata:n.share}),e=n.share,m()},shareUserdataMask:function(a,t){var o=!1;null===e&&(+new Date-n.installationDate)/864e5>5&&(o=!0),t({showMask:o})},languageInfos:function(e,n){p(function(e){n({infos:e})})},langvars:function e(n,a){if(n.lang){var t=void 0===n.cache||!0===n.cache;if(i[n.lang]&&t)a({langVars:i[n.lang]});else{var o=function(e){var o=e.langVars,r=new XMLHttpRequest;r.open("GET",chrome.extension.getURL("_locales/"+n.lang+"/messages.json"),!0),r.onload=function(){var e=JSON.parse(r.responseText);Object.assign(o,e),t&&(i[n.lang]=o),a({langVars:o})},r.send()};n.defaultLang&&n.defaultLang!==n.lang?e({lang:n.defaultLang,cache:!1},o):o({langVars:{}})}}},favicon:function(e,n){var a=new Image;a.onload=function(){var e=document.createElement("canvas");e.width=this.width,e.height=this.height,e.getContext("2d").drawImage(this,0,0);var a=e.toDataURL("image/png");n({img:a})},a.src="chrome://favicon/size/16@2x/"+e.url},openLink:function(e){if(l(e),e.newTab&&!0===e.newTab){var a=function(){var a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;chrome.tabs.query({active:!0,currentWindow:!0},function(t){chrome.tabs.create({url:e.href,active:void 0===e.active||!!e.active,index:a||t[0].index+1,openerTabId:t[0].id},function(e){n.openedByExtension=e.id,m()})})};e.afterLast&&!0===e.afterLast?chrome.tabs.query({},function(e){a(e[e.length-1].index+1)}):a()}else e.incognito&&!0===e.incognito?chrome.windows.create({url:e.href,state:"maximized",incognito:!0}):chrome.tabs.query({active:!0,currentWindow:!0},function(a){chrome.tabs.update(a[0].id,{url:e.href},function(e){n.openedByExtension=e.id,m()})})},websiteStatus:function(e,n){var a=new XMLHttpRequest;["load","error","timeout"].forEach(function(e){a.addEventListener(e,function(){n({status:("load"!==e||a.status>=400?"un":"")+"available"})})}),a.timeout=5e3,a.open("HEAD",r.check404,!0),a.send()},trackPageView:function(n){var a=arguments.length>1&&void 0!==arguments[1]&&arguments[1];!window.ga||!0!==e&&!0!==a||window.ga("send","pageview",n.page)},trackEvent:d,viewAmounts:function(e,t){f(function(){t({viewAmounts:a,counterStartDate:n.installationDate})})}};chrome.extension.onMessage.addListener(function(e,n,a){return h[e.type]&&h[e.type](e,a),!0}),chrome.browserAction.onClicked.addListener(function(){chrome.tabs.query({active:!0,currentWindow:!0},function(e){chrome.tabs.sendMessage(e[0].id,{action:"toggleSidebar"})})}),chrome.bookmarks.onImportBegan.addListener(function(){o=!0}),chrome.bookmarks.onImportEnded.addListener(function(){o=!1,u({type:"Created"})}),["Changed","Created","Removed"].forEach(function(e){chrome.bookmarks["on"+e].addListener(function(){!1!==o&&"Created"===e||u({type:e})})}),chrome.runtime.setUninstallURL(r.uninstall),chrome.runtime.onInstalled.addListener(function(e){if("install"===e.reason)chrome.tabs.create({url:chrome.extension.getURL("html/howto.html")});else if("update"===e.reason){var a=chrome.runtime.getManifest().version,t=e.previousVersion.split("."),o=a.split(".");chrome.storage.local.remove(["languageInfos"]),d({category:"extension",action:"update",label:e.previousVersion+" -> "+a},!0),t[0]===o[0]&&t[1]===o[1]||(chrome.storage.sync.get(["model"],function(e){void 0===e.model||void 0!==e.model.updateNotification&&e.model.updateNotification===a||(n.updateNotification=a,m(function(){chrome.tabs.create({url:chrome.extension.getURL("html/changelog.html")})}))}),chrome.storage.sync.get(null,function(e){void 0!==e.behaviour&&void 0!==e.behaviour.hideEmptyDirs&&(delete e.behaviour.hideEmptyDirs,chrome.storage.sync.set({behaviour:e.behaviour})),void 0===e.appearance&&(e.appearance={}),void 0===e.appearance.styles&&(e.appearance.styles={}),void 0===e.appearance.styles.colorScheme&&(e.appearance.styles.colorScheme="rgb(0,137,123)"),void 0===e.behaviour&&(e.behaviour={}),void 0===e.behaviour.initialOpenOnNewTab&&(e.behaviour.initialOpenOnNewTab="de"==chrome.i18n.getUILanguage(),chrome.storage.sync.set({behaviour:e.behaviour})),e.behaviour&&(void 0===e.behaviour.rememberState&&void 0!==e.behaviour.rememberScroll&&(e.behaviour.rememberState=!1===e.behaviour.rememberScroll?"openStates":"all"),delete e.behaviour.rememberScroll,delete e.behaviour.model,delete e.behaviour.clickCounter,delete e.behaviour.clickCounterStartDate,chrome.storage.sync.set({behaviour:e.behaviour})),0===a.search("1.7.")&&(void 0===e.appearance.styles.bookmarksDirIcon||"dir"===e.appearance.styles.bookmarksDirIcon?e.appearance.styles.bookmarksDirIcon="dir-2":"dir-alt1"===e.appearance.styles.bookmarksDirIcon?(e.appearance.styles.bookmarksDirIcon="dir-1",e.appearance.styles.bookmarksDirColor="rgb(240,180,12)"):"dir-alt2"===e.appearance.styles.bookmarksDirIcon&&(e.appearance.styles.bookmarksDirIcon="dir-1")),delete e.appearance.addVisual,!e.shareUserdata||"n"!==e.shareUserdata&&"y"!==e.shareUserdata||chrome.storage.sync.set({shareUserdata:"y"===e.shareUserdata}),chrome.storage.sync.remove(["lastShareDate","scrollPos","openStates","installationDate","uuid","entriesLocked","addVisual","middleClickActive"]),chrome.storage.sync.set({appearance:e.appearance})}))}});var m=function(e){Object.getOwnPropertyNames(n).length>0&&chrome.storage.sync.set({model:n},function(){"function"==typeof e&&e()})},f=function(e){chrome.storage.local.get(["clickCounter"],function(t){a={},void 0===t.clickCounter?chrome.storage.sync.get(["clickCounter"],function(t){void 0!==t.clickCounter?a=t.clickCounter:n.clickCounter&&(a=n.clickCounter),a.data&&(a=a.data),"function"==typeof e&&e()}):void 0!==t.clickCounter&&((a=t.clickCounter).data&&(a=a.data),"function"==typeof e&&e())})},g=function(){chrome.storage.sync.get(["model","shareUserdata"],function(a){n=a.model||{},e=void 0===a.shareUserdata?null:a.shareUserdata,void 0===n.installationDate&&(n.installationDate=+new Date);var t=+(new Date).setHours(0,0,0,0);void 0!==n.lastTrackDate&&n.lastTrackDate===t||(n.lastTrackDate=t,v()),f(),m()})},p=function(e){chrome.storage.local.get(["languageInfos"],function(n){if(n&&n.languageInfos&&(+new Date-n.languageInfos.updated)/36e5<8)"function"==typeof e&&e(n.languageInfos.infos);else{var a=Object.keys(c).length,t=0,o={};Object.keys(c).forEach(function(n){o[n]={name:n,label:c[n],available:!1};var r=new XMLHttpRequest;["load","error"].forEach(function(i){r.addEventListener(i,function(){t++,"load"===i&&(o[n].available=!0),t===a&&(chrome.storage.local.set({languageInfos:{infos:o,updated:+new Date}}),"function"==typeof e&&e(o))})}),r.open("HEAD",chrome.extension.getURL("_locales/"+n+"/messages.json"),!0),r.send()})}})},v=function(){var a=chrome.runtime.getManifest(),t="not_set";if(!0===e?t="allowed":!1===e&&(t="not_allowed"),d({category:"extension",action:"user",label:"share_"+t},!0),d({category:"extension",action:"version",label:a.version},!0),!0===e){n.installationDate&&setTimeout(function(){d({category:"extension",action:"installationDate",label:new Date(n.installationDate).toISOString().slice(0,10)})},1200),s.getSubTree("0",function(e){var n=0;e&&e[0]&&e[0].children&&e[0].children.length>0&&function e(a){for(var t=0;t<a.length;t++){var o=a[t];o.url?n++:o.children&&e(o.children)}}(e[0].children),d({category:"extension",action:"bookmarks",label:"amount",value:n})});var o=["behaviour","appearance"],r=1,i=function e(n,a){Object.keys(a).forEach(function(t){"object"===_typeof(a[t])?e(n+"_"+t,a[t]):(r++,"string"!=typeof a[t]&&(a[t]=JSON.stringify(a[t])),setTimeout(function(){d({category:"configuration",action:n+"_"+t,label:a[t]})},1200*r))})};chrome.storage.sync.get(o,function(e){o.forEach(function(n){"object"===_typeof(e[n])&&i(n,e[n])})})}},b=function(){window.GoogleAnalyticsObject="ga",window.ga=window.ga||function(){(window.ga.q=window.ga.q||[]).push(arguments)},window.ga.l=+new Date;var e=document.createElement("script");e.async=1,e.src="https://www.google-analytics.com/analytics.js";var n=document.getElementsByTagName("script")[0];n.parentNode.insertBefore(e,n);var a=chrome.runtime.getManifest();window.ga("create","UA-"+("Dev"!==a.version_name&&"update_url"in a?"100595538-2":"100595538-3"),"auto"),window.ga("set","checkProtocolTask",null),window.ga("set","transport","beacon")};!function(){b(),g()}()}();