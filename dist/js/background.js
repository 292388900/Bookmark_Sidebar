/*! (c) Philipp KÃ¶nig under GPL-3.0 */
(e=>{"use strict";window.AnalyticsHelper=function(t){let a=[],i=!1,n=!1,r={dev:"100595538-3",live:"100595538-2"};this.init=(async()=>{window.GoogleAnalyticsObject="ga",window.ga=window.ga||function(){(window.ga.q=window.ga.q||[]).push(arguments)},window.ga.l=+new Date;let e=document.createElement("script");e.async=1,e.src="https://www.google-analytics.com/analytics.js";let a=document.getElementsByTagName("script")[0];a.parentNode.insertBefore(e,a),window.ga("create","UA-"+r[t.isDev?"dev":"live"],"auto"),window.ga("set","checkProtocolTask",null),window.ga("set","transport","beacon")}),this.trackEvent=(e=>new Promise(t=>{s({hitType:"event",eventCategory:e.category,eventAction:e.action,eventLabel:e.label,eventValue:e.value||1},e.always||!1),t()})),this.trackPageView=(e=>new Promise(t=>{s({hitType:"pageview",page:e.page},e.always||!1),t()})),this.trackUserData=(()=>{let e=t.helper.model.getData("lastTrackDate"),a=+(new Date).setHours(0,0,0,0);!1===n&&e!==a&&(n=!0,t.helper.model.setData("lastTrackDate",a).then(()=>{let e=t.helper.model.getShareInfo(),a="not_set";!0===e.config&&!0===e.activity?a="all":!0===e.config&&!1===e.activity?a="config":!1===e.config&&!0===e.activity?a="activity":!1===e.config&&!1===e.activity&&(a="nothing"),this.trackEvent({category:"extension",action:"user",label:"share_"+a,always:!0}),this.trackEvent({category:"extension",action:"version",label:t.manifest.version_name,always:!0}),!0===e.activity&&o(),!0===e.config&&l(),n=!1}))});let o=()=>{let e=t.helper.model.getData("installationDate");e&&this.trackEvent({category:"extension",action:"installationDate",label:new Date(e).toISOString().slice(0,10)}),t.helper.bookmarkApi.func.getSubTree(0).then(e=>{let t=0,a=e=>{for(let i=0;i<e.length;i++){let n=e[i];n.url?t++:n.children&&a(n.children)}};e&&e[0]&&e[0].children&&e[0].children.length>0&&a(e[0].children),this.trackEvent({category:"extension",action:"bookmarks",label:"amount",value:t})})},l=()=>{let e=["behaviour","appearance","newtab","language"],a=(e,t)=>{Object.keys(t).forEach(i=>{if("newtab"===e&&"shortcuts"===i?t[i]=t[i].length:"utility"===e&&"pinnedEntries"===i&&"object"==typeof t[i]&&(t[i]=Object.keys(t[i]).length),"object"==typeof t[i])a(e+"_"+i,t[i]);else{"string"!=typeof t[i]&&(t[i]=JSON.stringify(t[i])),("newtab"===e&&"website"===i||"utility"===e&&"customCss"===i)&&(t[i]=t[i]&&t[i].length>0?"true":"false");let a=1;!isNaN(parseFloat(t[i]))&&isFinite(t[i])?a=parseFloat(t[i]):0===t[i].search(/^\d+px$/i)&&(a=parseFloat(t[i].replace(/px$/i,""))),this.trackEvent({category:"configuration",action:e+"_"+i,label:t[i],value:a})}})};chrome.storage.sync.get(e,i=>{e.forEach(e=>{if("language"===e){i[e]={};let a=t.helper.language.getLanguage();a&&(i[e].ui=a)}else"newtab"===e&&"object"==typeof i[e]&&void 0!==i[e].override&&!1===i[e].override&&(i[e]={override:!1});"object"==typeof i[e]&&a(e,i[e])})}),chrome.storage.local.get(["utility"],e=>{if(e.utility){let t={};["lockPinned","pinnedEntries","customCss"].forEach(a=>{void 0!==e.utility[a]&&(t[a]=e.utility[a])}),a("utility",t)}})},s=(e,n)=>{let r=t.helper.model.getShareInfo(),o=!0;!0!==n&&(o=e.eventCategory&&"configuration"===e.eventCategory?r.config:r.activity),o&&(a.push(e),!1===i&&h())},h=()=>{i=!0,e.delay(1e3).then(()=>{if(a.length>0&&window.ga&&window.ga.loaded){let e=a.shift();window.ga("send",e),h()}else i=!1})}},window.BookmarkApi=function(e){this.func={},this.init=(()=>new Promise(e=>{["get","getSubTree","removeTree"].forEach(e=>{this.func[e]=(a=>t(e,[""+a]))}),["update","move"].forEach(e=>{this.func[e]=((a,i)=>t(e,[""+a,i]))}),["create","search"].forEach(e=>{this.func[e]=(a=>t(e,[a]))}),e()}));let t=(t,a)=>new Promise((i,n)=>{chrome.bookmarks[t](...a,a=>{let r=chrome.runtime.lastError;void 0===r?-1!==["update","move","create","removeTree"].indexOf(t)?Promise.all([e.helper.cache.remove({name:"htmlList"}),e.helper.cache.remove({name:"htmlPinnedEntries"})]).then(()=>{i(a)}):i(a):n(r.message)})})},window.BrowserActionHelper=function(e){let t=null,a=null,i="unknown";this.init=(()=>new Promise(e=>{o(),e()})),this.setReason=(e=>new Promise(t=>{e.reason&&(a=e.reason),t()})),this.clearTimeout=(()=>new Promise(e=>{t&&(clearTimeout(t),t=null),e()}));let n=t=>{let a=document.createElement("canvas");a.width=128,a.height=128;let i=a.getContext("2d");e.helper.icon.getInfo().then(t=>Promise.all([e.helper.language.getLangVars(),e.helper.icon.getSvgImage(t.name,"#555555")])).then(([e,n])=>{let o=new Image;o.onload=(()=>{i.drawImage(o,32,32,64,64);let n=r(t.url);chrome.notifications.create("browserAction",{type:"basic",title:e.vars[n.title].message,message:e.vars[n.desc].message,isClickable:!0,buttons:[{title:e.vars[n.link].message}],iconUrl:a.toDataURL()})}),o.src=n})},r=e=>{i="unknown";let t={title:"notification_sidebar_not_working_headline",link:"notification_sidebar_not_working_link",desc:"notification_sidebar_not_working_general"};if(a)"blacklisted"===a?(t.desc="notification_sidebar_blacklisted",i="filter"):"notWhitelisted"===a&&(t.desc="notification_sidebar_not_whitelisted",i="filter"),a=null;else if(e){t.desc="notification_sidebar_not_working_unknown";let a=!1,n={new_tab:["chrome://newtab/"],system:["chrome://","about:blank"],extension_page:["chrome-extension://"],webstore:["https?://chrome.google.com/webstore/"]};Object.keys(n).some(r=>{if(n[r].some(n=>{if(0===e.search(new RegExp(n,"gi")))return i=r,t.desc="notification_sidebar_not_working_"+r,a=!0,!0}),a)return!0})}return t},o=()=>{chrome.browserAction.onClicked.addListener(()=>{chrome.tabs.query({active:!0,currentWindow:!0},a=>{chrome.tabs.sendMessage(a[0].id,{action:"toggleSidebar",reinitialized:e.reinitialized}),t=setTimeout(()=>{n(a[0])},750)})}),chrome.notifications.onButtonClicked.addListener(l),chrome.notifications.onClicked.addListener(l)},l=()=>{let e="html/settings.html#feedback_error_general";"new_tab"===i?e="html/settings.html#newtab":"filter"===i&&(e="html/settings.html#feedback_error_filter"),chrome.tabs.create({url:chrome.extension.getURL(e)}),chrome.notifications.clear("browserAction")}},window.CacheHelper=function(e){this.set=(e=>new Promise(t=>{try{chrome.storage.local.set({["cache_"+e.name]:e.val},()=>{t()})}catch(e){t()}})),this.get=(e=>new Promise(t=>{chrome.storage.local.get(["cache_"+e.name],a=>{t({val:a["cache_"+e.name]})})})),this.remove=(t=>new Promise(a=>{e.importRunning?a():chrome.storage.local.remove(["cache_"+t.name],()=>{a()})}))},window.IconHelper=function(t){let a={},i=null;this.init=(()=>new Promise(e=>{this.getInfo().then(a=>{"logo"===a.name?chrome.browserAction.setIcon({path:t.manifest.browser_action.default_icon}):this.set({name:a.name,color:a.color}),t.isDev&&(chrome.browserAction.setBadgeBackgroundColor({color:[245,197,37,255]}),chrome.browserAction.setBadgeText({text:"X"})),e()})})),this.getInfo=(()=>new Promise(e=>{chrome.storage.sync.get(["appearance"],t=>{let a="bookmark",i="#555555";t&&t.appearance&&t.appearance.styles&&(t.appearance.styles.iconShape&&(a=t.appearance.styles.iconShape),t.appearance.styles.iconColor&&(i=t.appearance.styles.iconColor)),e({name:a,color:i})})})),this.getSvgImage=((t,i)=>new Promise(n=>{new Promise(i=>{a[t]?i(a[t]):e.xhr(chrome.extension.getURL("img/icon/menu/icon-"+t+".svg")).then(e=>{let n=e.responseText;a[t]="data:image/svg+xml;charset=utf-8,"+n,i(a[t])})}).then(e=>{e=e.replace(/#000/g,i),n(e)})})),this.set=(e=>new Promise(t=>{let a=e.onlyCurrentTab||!1;if(i&&!a&&i===e.name+"_"+e.color)t();else{let n=document.createElement("canvas");n.width=128,n.height=128;let r=n.getContext("2d");this.getSvgImage(e.name,e.color).then(n=>{let o=new Image;o.onload=(()=>{r.drawImage(o,0,0,128,128),chrome.browserAction.setIcon({imageData:r.getImageData(0,0,128,128),tabId:a&&e.tabInfo?e.tabInfo.id:null}),a||(i=e.name+"_"+e.color),t()}),o.src=n})}}))},window.ImageHelper=function(t){let a={},i=!1;this.init=(()=>new Promise(e=>{chrome.storage.local.get(["imageCache"],t=>{a=t.imageCache||{},e()})})),this.getThumbnail=(a=>new Promise(i=>{if(void 0===a.url)i({img:null});else{let o=n("thumb",a.url);o?i({img:o}):e.xhr(t.urls.thumbnail,{method:"POST",timeout:1e4,data:{url:a.url,lang:chrome.i18n.getUILanguage(),ua:navigator.userAgent}}).then(e=>{let t=e.responseText;t&&t.length>0?(r("thumb",a.url,t),i({img:t})):i({img:null})},()=>{i({img:null})})}})),this.getFavicon=(e=>new Promise(t=>{let a=new Image;a.onload=function(){let e=document.createElement("canvas");e.width=this.width,e.height=this.height,e.getContext("2d").drawImage(this,0,0);let a=e.toDataURL("image/png");t({img:a})},a.src="chrome://favicon/size/16@2x/"+e.url}));let n=(e,t)=>a[e+"_"+t]?a[e+"_"+t].d:null,r=(e,t,n)=>{if(a[e+"_"+t]={t:+new Date,d:n},!1===i){i=!0;let e=+new Date;return Object.keys(a).forEach(t=>{e-a[t].t>2592e5&&delete a[t]}),new Promise(e=>{chrome.storage.local.set({imageCache:a},()=>{i=!1,e()})})}}},window.LanguageHelper=function(t){let a={ar:"Arabic",am:"Amharic",bg:"Bulgarian",bn:"Bengali",ca:"Catalan",cs:"Czech",da:"Danish",de:"German",el:"Greek",en:"English",es:"Spanish",et:"Estonian",fa:"Persian",fi:"Finnish",fil:"Filipino",fr:"French",gu:"Gujarati",he:"Hebrew",hi:"Hindi",hr:"Croatian",hu:"Hungarian",id:"Indonesian",it:"Italian",ja:"Japanese",kn:"Kannada",ko:"Korean",lt:"Lithuanian",lv:"Latvian",ml:"Malayalam",mr:"Marathi",ms:"Malay",nl:"Dutch",no:"Norwegian",pl:"Polish",pt_BR:"Portuguese (Brazil)",pt_PT:"Portuguese (Portugal)",ro:"Romanian",ru:"Russian",sk:"Slovak",sl:"Slovenian",sr:"Serbian",sv:"Swedish",sw:"Swahili",ta:"Tamil",te:"Telugu",th:"Thai",tr:"Turkish",uk:"Ukrainian",vi:"Vietnamese",zh_CN:"Chinese (Simplified)",zh_TW:"Chinese (Traditional)"},i=["ar","fa","iw"],n={pt:"pt_PT"},r=null,o={},l=!1;this.init=(()=>new Promise(e=>{chrome.storage.sync.get(["language"],a=>{let h=t.manifest.default_locale,c=a.language||"default",d=null;"default"===c&&(c=chrome.i18n.getUILanguage()),c=c.replace("-","_"),n[c]&&(c=n[c]),c.search("_")>-1&&(d=c.replace(/_.*$/,"")),this.getAvailableLanguages().then(t=>{[c,d,h].some(a=>{if(null!==a&&t&&t.infos&&t.infos[a]&&t.infos[a].available)return r=a,l=i.indexOf(r)>-1,s(a,h).then(t=>{t&&t.langVars&&(o=t.langVars,e())}),!0})})})})),this.getLanguage=(()=>r),this.getLangVars=(()=>new Promise(e=>{e({language:r,dir:l?"rtl":"ltr",vars:o})})),this.getAvailableLanguages=(()=>new Promise(t=>{chrome.storage.local.get(["languageInfos"],i=>{if(i&&i.languageInfos&&(+new Date-i.languageInfos.updated)/36e5<8)t({infos:i.languageInfos.infos});else{let i=Object.keys(a).length,n=0,r={};Object.keys(a).forEach(o=>{r[o]={name:o,label:a[o],available:!1};let l=()=>{++n===i&&(chrome.storage.local.set({languageInfos:{infos:r,updated:+new Date}}),t({infos:r}))};e.xhr(chrome.extension.getURL("_locales/"+o+"/messages.json"),{method:"HEAD"}).then(()=>{r[o].available=!0,l()},l)})}})}));let s=(t,a=null)=>new Promise(i=>{if(t){let n=a=>{let n=a.langVars;e.xhr(chrome.extension.getURL("_locales/"+t+"/messages.json")).then(e=>{let t=JSON.parse(e.responseText);Object.assign(n,t),i({langVars:n})})};a&&a!==t?s(a,null).then(n):n({langVars:{}})}})},window.ModelHelper=function(e){let t={},a={config:null,activity:null};this.init=(()=>new Promise(e=>{chrome.storage.sync.get(["model","shareInfo"],n=>{t=n.model||{},"object"==typeof n.shareInfo&&(a=n.shareInfo),void 0===t.installationDate&&(t.installationDate=+new Date),i().then(e)})})),this.getShareInfo=(()=>a),this.setShareInfo=(e=>new Promise(t=>{a={config:e.config||!1,activity:e.activity||!1},chrome.storage.sync.set({shareInfo:a},()=>{chrome.runtime.lastError,t()})})),this.setData=((e,a)=>new Promise(n=>{t[e]=a,i().then(n)})),this.getData=(e=>t[e]||null);let i=()=>new Promise(e=>{Object.getOwnPropertyNames(t).length>0&&chrome.storage.sync.set({model:t},()=>{chrome.runtime.lastError,e()})})},window.NewtabHelper=function(e){let t={};this.init=(()=>new Promise(e=>{this.updateConfig().then(()=>{a(),e()})})),this.updateConfig=(()=>new Promise(e=>{chrome.storage.sync.get(["newtab"],a=>{t=void 0===a.newtab?{}:a.newtab,e()})}));let a=async()=>{chrome.tabs.onCreated.addListener(e=>{if(e.url&&"chrome://newtab/"===e.url&&void 0!==t.override&&!0===t.override){let a="create";0===e.index?a="update":chrome.tabs.remove(e.id),t.website&&t.website.length>0?n(a):i(a)}})},i=e=>{chrome.tabs[e]({url:chrome.extension.getURL("html/newtab.html"),active:!0})},n=e=>{chrome.tabs[e]({url:r(t.website,"bs_nt",1),active:!0})},r=(e,t,a)=>{let i=new RegExp("([?&])"+t+"=.*?(&|#|$)","i");if(e.match(i))return e.replace(i,"$1"+t+"="+a+"$2");{let i="";return-1!==e.indexOf("#")&&(i=e.replace(/.*#/,"#"),e=e.replace(/#.*/,"")),e+(-1!==e.indexOf("?")?"&":"?")+t+"="+a+i}}},window.PortHelper=function(t){let a=()=>new Promise(a=>{e.xhr(t.urls.checkStatus,{method:"POST",responseType:"json",data:{version:t.isDev?"9.9.9":t.manifest.version}}).then(e=>{a(e.response&&e.response.available?{status:"available"}:{status:"unavailable"})},()=>{a({status:"unavailable"})})}),i=()=>new Promise(e=>{let a=!1,i=t.helper.model.getData("installationDate"),n=t.helper.model.getShareInfo();!1===t.isDev&&null===n.config&&null===n.activity&&(+new Date-i)/864e5>5&&(a=!0),e({showMask:a})}),n=a=>new Promise(i=>{a.abort&&!0===a.abort?e.cancelXhr(t.urls.checkUrls):e.xhr(t.urls.checkUrls,{method:"POST",data:{urlList:a.urls,ua:navigator.userAgent,lang:chrome.i18n.getUILanguage()}}).then(e=>{let t=JSON.parse(e.responseText);i(t)},()=>{i({error:!0})})}),r=e=>new Promise(a=>{new Promise(a=>{let i={title:e.title};e.url&&(i.url=e.url),e.preventReload&&(t.preventReload=!0),t.helper.bookmarkApi.func.update(e.id,i).then(()=>{a({updated:e.id})},e=>{a({error:e})})}).then(i=>{e.preventReload&&(t.preventReload=!1),a(i)})}),o=e=>new Promise(a=>{new Promise(a=>{let i={parentId:e.parentId,index:e.index||0,title:e.title,url:e.url?e.url:null};e.preventReload&&(t.preventReload=!0),t.helper.bookmarkApi.func.create(i).then(e=>{a({created:e.id})},e=>{a({error:e})})}).then(i=>{e.preventReload&&(t.preventReload=!1),a(i)})}),l=e=>new Promise(a=>{new Promise(i=>{e.preventReload&&(t.preventReload=!0),t.helper.bookmarkApi.func.removeTree(e.id).then(()=>{a({deleted:e.id})},e=>{i({error:e})})}).then(i=>{e.preventReload&&(t.preventReload=!1),a(i)})}),s=e=>new Promise(a=>{let i={parentId:""+e.parentId,index:e.index};t.helper.bookmarkApi.func.move(e.id,i).then(()=>{a({moved:e.id})})}),h=e=>new Promise(a=>{t.helper.bookmarkApi.func.getSubTree(e.id).then(e=>{a({bookmarks:e})})}),c=e=>new Promise(a=>{t.helper.bookmarkApi.func.search(e.searchVal).then(e=>{a({bookmarks:e})})}),d=e=>new Promise(a=>{if(t.helper.viewAmount.addByEntry(e),e.newTab&&!0===e.newTab){let i=(i=null)=>{chrome.tabs.query({active:!0,currentWindow:!0},n=>{chrome.tabs.create({url:e.href,active:void 0===e.active||!!e.active,index:null===i?n[0].index+1:i,openerTabId:n[0].id},e=>{t.helper.model.setData("openedByExtension",e.id).then(a)})})};"afterLast"===e.position?chrome.tabs.query({currentWindow:!0},e=>{let t=0;e.forEach(e=>{t=Math.max(t,e.index)}),i(t+1)}):"beforeFirst"===e.position?i(0):i()}else e.newWindow&&!0===e.newWindow?(chrome.windows.create({url:e.href,state:"maximized"}),a()):e.incognito&&!0===e.incognito?(chrome.windows.create({url:e.href,state:"maximized",incognito:!0}),a()):chrome.tabs.query({active:!0,currentWindow:!0},i=>{chrome.tabs.update(i[0].id,{url:e.href},e=>{t.helper.model.setData("openedByExtension",e.id).then(a)})})});this.init=(()=>new Promise(e=>{let m=0,g={checkUrls:n,bookmarks:h,searchBookmarks:c,moveBookmark:s,updateBookmark:r,createBookmark:o,deleteBookmark:l,reload:t.reload,reinitialize:t.reinitialize,updateShareInfo:t.helper.model.setShareInfo,shareInfoMask:i,languageInfos:t.helper.language.getAvailableLanguages,langvars:t.helper.language.getLangVars,favicon:t.helper.image.getFavicon,thumbnail:t.helper.image.getThumbnail,openLink:d,getCache:t.helper.cache.get,setCache:t.helper.cache.set,removeCache:t.helper.cache.remove,websiteStatus:a,trackPageView:t.helper.analytics.trackPageView,trackEvent:t.helper.analytics.trackEvent,updateIcon:t.helper.icon.set,reloadIcon:t.helper.icon.init,clearNotWorkingTimeout:t.helper.browserAction.clearTimeout,setNotWorkingReason:t.helper.browserAction.setReason,addViewAmount:t.helper.viewAmount.addByUrl,viewAmounts:t.helper.viewAmount.getAll};chrome.runtime.onConnect.addListener(e=>{e.name&&"background"===e.name&&e.onMessage.addListener((a,i)=>{g[a.type]&&(50===m&&(t.helper.analytics.trackUserData(),m%=50),a.tabInfo=i.sender.tab,g[a.type](a).then(t=>{try{e.postMessage({uid:a.uid,result:t})}catch(e){}}),m++)})}),e()}))},window.UpgradeHelper=function(e){this.loaded=!1,this.init=(async()=>{chrome.runtime.onUpdateAvailable.addListener(()=>{chrome.runtime.reload()}),this.loaded=!0}),this.onInstalled=(()=>{chrome.tabs.create({url:chrome.extension.getURL("html/intro.html")}),e.reinitialize()}),this.onUpdated=(a=>{chrome.storage.local.remove(["languageInfos"]);let i=e.manifest.version;a.previousVersion!==i&&e.helper.analytics.trackEvent({category:"extension",action:"update",label:a.previousVersion+" -> "+i,always:!0});let n=a.previousVersion.split("."),r=i.split(".");n[0]!==r[0]||n[1]!==r[1]?t(i).then(()=>{e.reinitialize()}):e.reinitialize()});let t=t=>new Promise(a=>{let i=0,n=()=>{++i>=3&&a()};chrome.storage.sync.get(null,a=>{if(void 0===a.model||void 0!==a.model.updateNotification&&a.model.updateNotification===t||e.helper.model.setData("updateNotification",t).then(()=>{}),void 0===a.behaviour&&(a.behaviour={}),void 0===a.appearance&&(a.appearance={}),void 0===a.newtab&&(a.newtab={}),"string"==typeof a.language&&a.language.search("-")>-1&&chrome.storage.local.set({language:a.language.replace("-","_")}),void 0===a.behaviour.toggleArea&&void 0!==a.behaviour.pxTolerance){a.behaviour.toggleArea={width:a.behaviour.pxTolerance.maximized||1,widthWindowed:a.behaviour.pxTolerance.windowed||20,height:100,top:0};try{delete a.behaviour.pxTolerance}catch(e){}}if(chrome.storage.local.get(["utility"],t=>{if(t&&t.utility&&t.utility.separators)try{Object.entries(t.utility.separators).forEach(([t,a])=>{a&&a.length>0&&a.forEach((a,i)=>{e.preventReload=!0,e.helper.bookmarkApi.func.create({title:"----------",url:"about:blank",parentId:t,index:(a.index||0)+i})})})}catch(e){}finally{delete t.utility.separators,chrome.storage.local.set({utility:t.utility}),setTimeout(()=>{e.preventReload=!1},2e3)}}),void 0===a.behaviour.reopenSidebar&&void 0!==a.behaviour.autoOpen){a.behaviour.reopenSidebar=a.behaviour.autoOpen;try{delete a.behaviour.autoOpen,delete a.utility.autoOpen}catch(e){}}if(void 0===a.newtab.autoOpen&&void 0!==a.newtab.initialOpen){a.newtab.autoOpen=a.newtab.initialOpen;try{delete a.newtab.initialOpen}catch(e){}}chrome.storage.sync.remove(["shareUserdata"]);try{delete a.behaviour.initialOpenOnNewTab,delete a.behaviour.replaceNewTab,delete a.behaviour.language,delete a.appearance.language,delete a.appearance.sidebarPosition}catch(e){}void 0===a.appearance.styles&&(a.appearance.styles={}),void 0!==a.shareInfo||void 0===a.shareUserdata||!0!==a.shareUserdata&&!1!==a.shareUserdata||chrome.storage.sync.set({shareInfo:{config:a.shareUserdata,activity:a.shareUserdata}}),void 0===a.appearance.styles.hoverColor&&(a.appearance.styles.hoverColor=a.appearance.darkMode?"#555555":"#f5f5f5"),chrome.storage.sync.set({behaviour:a.behaviour},n),chrome.storage.sync.set({newtab:a.newtab},n),chrome.storage.sync.set({appearance:a.appearance},n)})})},window.ViewAmountHelper=function(e){this.getAll=(()=>new Promise(a=>{t().then(t=>{a({viewAmounts:t,counterStartDate:e.helper.model.getData("installationDate")})})})),this.addByUrl=(t=>new Promise(a=>{null===e.helper.model.getData("openedByExtension")&&e.helper.bookmarkApi.func.search({url:t.url}).then(e=>{e.some(e=>e.url===t.url&&(this.addByEntry(e),!0)),a()}),e.helper.model.setData("openedByExtension",null)})),this.addByEntry=(e=>{e.id&&t().then(t=>{void 0!==t[e.id]&&"object"==typeof t[e.id]||(t[e.id]={c:0}),t[e.id].c++,t[e.id].d=+new Date,chrome.storage.local.set({clickCounter:t})})});let t=()=>new Promise(e=>{chrome.storage.local.get(["clickCounter"],t=>{let a={};void 0!==t.clickCounter&&(a=t.clickCounter),e(a)})})};(new function(){this.importRunning=!1,this.preventReload=!1,this.manifest=chrome.runtime.getManifest(),this.urls={website:"https://extensions.blockbyte.de/",checkStatus:"https://extensions.blockbyte.de/ajax/status/bs",checkUrls:"https://4v1.de/u",uninstall:"https://extensions.blockbyte.de/uninstall/bs",thumbnail:"https://4v1.de/t"},this.isDev=!1,this.reinitialized=null,this.reload=(t=>new Promise(a=>{Promise.all([this.helper.newtab.updateConfig(),this.helper.cache.remove({name:"htmlList"}),this.helper.cache.remove({name:"htmlPinnedEntries"})]).then(()=>{chrome.tabs.query({},i=>{i.forEach((a,i)=>{let n=a.active?0:100*i;e.delay(n).then(()=>{chrome.tabs.sendMessage(a.id,{action:"reload",scrollTop:t.scrollTop||!1,reinitialized:this.reinitialized,type:t.type})})}),a()})})})),this.reinitialize=(()=>new Promise(a=>{this.reinitialized=+new Date;let i={css:"insertCSS",js:"executeScript"};Promise.all([this.helper.newtab.updateConfig(),this.helper.language.init(),this.helper.cache.remove({name:"htmlList"}),this.helper.cache.remove({name:"htmlPinnedEntries"})]).then(()=>{chrome.tabs.query({},n=>{n.forEach((a,n)=>{if(void 0===a.url||!a.url.startsWith("chrome://")&&!a.url.startsWith("chrome-extension://")){let r=a.active?0:100*n;e.delay(r).then(()=>{Object.entries(i).forEach(([e,i])=>{let n=!1;this.manifest.content_scripts[0][e].forEach(e=>{chrome.tabs[i](a.id,{file:e},()=>{let e=chrome.runtime.lastError;e&&e.message&&!1===n&&(n=!0,t(a.id))})})})})}else t(a.id)}),a()})})}));let t=e=>{chrome.tabs.sendMessage(e,{action:"reinitialize"})},a=async()=>{chrome.bookmarks.onImportBegan.addListener(()=>{this.importRunning=!0}),chrome.bookmarks.onImportEnded.addListener(()=>{this.importRunning=!1,e.delay(1e3).then(()=>{this.reload({type:"Created"})})}),["Changed","Created","Removed"].forEach(e=>{chrome.bookmarks["on"+e].addListener(()=>{!1===this.importRunning&&!1===this.preventReload&&this.reload({type:e})})}),["Moved","ChildrenReordered"].forEach(e=>{chrome.bookmarks["on"+e].addListener(()=>{Promise.all([this.helper.cache.remove({name:"htmlList"}),this.helper.cache.remove({name:"htmlPinnedEntries"})])})})},i=()=>{this.helper={model:new window.ModelHelper(this),bookmarkApi:new window.BookmarkApi(this),language:new window.LanguageHelper(this),upgrade:new window.UpgradeHelper(this),viewAmount:new window.ViewAmountHelper(this),newtab:new window.NewtabHelper(this),image:new window.ImageHelper(this),port:new window.PortHelper(this),icon:new window.IconHelper(this),browserAction:new window.BrowserActionHelper(this),cache:new window.CacheHelper(this),analytics:new window.AnalyticsHelper(this)}},n=(t,a=0)=>{this.helper&&this.helper.upgrade&&this.helper.upgrade.loaded?"install"===t.reason?this.helper.upgrade.onInstalled(t):"update"===t.reason&&this.helper.upgrade.onUpdated(t):a<100&&e.delay(500).then(()=>{n(t,a+1)})};this.run=(()=>{let e=+new Date;this.isDev="Dev"===this.manifest.version_name||!("update_url"in this.manifest),chrome.runtime.onInstalled.addListener(e=>{n(e)}),chrome.runtime.setUninstallURL(this.urls[this.isDev?"website":"uninstall"]),i(),Promise.all([this.helper.model.init(),this.helper.language.init(),this.helper.icon.init(),this.helper.analytics.init(),this.helper.browserAction.init(),this.helper.bookmarkApi.init()]).then(()=>Promise.all([a(),this.helper.newtab.init(),this.helper.image.init(),this.helper.port.init(),this.helper.upgrade.init()])).then(()=>{this.isDev&&console.log("Finished loading background script",+new Date-e)})})}).run()})(jsu);