/*! Bookmark Sidebar v1.3.6 | (c) Philipp KÃ¶nig under GPL-3.0 */
"use strict";!function(){var a={},b=+new Date,c=[],d={updateUrls:"https://moonware.de/ajax/extensions/updateUrls",userdata:"https://moonware.de/ajax/extensions/userdata"},e={getSubTree:function(a,b){chrome.bookmarks.getSubTree(a,b)},removeTree:function(a,b){chrome.bookmarks.removeTree(a,b)},search:function(a,b){chrome.bookmarks.search(a,b)},update:function(a,b,c){chrome.bookmarks.update(a,b,c)},move:function(a,b,c){chrome.bookmarks.move(a,b,c)}},f=function(b){b.id&&(a["node_"+b.id]||(a["node_"+b.id]=0),a["node_"+b.id]++,chrome.storage.sync.set({clickCounter:JSON.stringify(a)}))},g=function(a,b){f(a),a.newTab&&a.newTab===!0?chrome.tabs.query({active:!0,currentWindow:!0},function(b){chrome.tabs.create({url:a.href,active:"undefined"==typeof a.active||!!a.active,index:b[0].index+1,openerTabId:b[0].id},function(a){chrome.storage.sync.set({openedByExtension:a.id})})}):chrome.tabs.query({active:!0,currentWindow:!0},function(b){chrome.tabs.update(b[0].id,{url:a.href},function(a){chrome.storage.sync.set({openedByExtension:a.id})})})},h=function(a,b){var c=new Image;c.onload=function(){var a=document.createElement("canvas");a.width=this.width,a.height=this.height;var c=a.getContext("2d");c.drawImage(this,0,0);var d=a.toDataURL("image/png");b({img:d})},c.src="chrome://favicon/size/16@2x/"+a.url},i=function(c,d){d({views:a["node_"+c.id]||0,counterStartDate:b})},j=function(a,b){e.getSubTree(""+a.id,function(a){b({bookmarks:a})})},k=function(a,b){chrome.storage.sync.get("openedByExtension",function(b){chrome.tabs.query({active:!0,currentWindow:!0},function(c){"undefined"==typeof b.openedByExtension&&e.search({url:a.url},function(b){b.some(function(b){return b.url===a.url&&(f(b),!0)})}),chrome.storage.sync.remove("openedByExtension")})})},l=function(a,b){var c={parentId:""+a.parentId,index:a.index};e.move(a.id,c,function(){b({moved:a.id})})},m=function(a,b){var c={title:a.title};a.url&&(c.url=a.url),e.update(a.id,c,function(){b({updated:a.id})})},n=function(a,b){e.removeTree(a.id,function(){b({deleted:a.id})})},o=function(a,b){a.abort&&a.abort===!0?c.forEach(function(a){a.abort()}):!function(){var e=new XMLHttpRequest;e.open("POST",d.updateUrls,!0),e.onload=function(){var a=JSON.parse(e.responseText);b(a)};var f=new FormData;f.append("url",a.url),f.append("ua",navigator.userAgent),f.append("lang",chrome.i18n.getUILanguage()),e.send(f),c.push(e)}()},p=function(c,d){e.getSubTree(""+c.id,function(c){var e=0,f={bookmarks:0,dirs:0,total:0},g=function b(c){c.forEach(function(c){f.total++,c.children?f.dirs++:(f.bookmarks++,a["node_"+c.id]&&(e+=a["node_"+c.id])),c.children&&c.children.length>0&&b(c.children)})};c[0]&&c[0].children&&c[0].children.length>0&&g(c[0].children),d({childrenAmount:f,clickAmount:e,counterStartDate:b})})},q={realUrl:o,addViewAmount:k,bookmarks:j,dirInfos:p,moveBookmark:l,updateBookmark:m,deleteBookmark:n,favicon:h,openLink:g,viewAmount:i};chrome.extension.onMessage.addListener(function(a,b,c){return q[a.type]&&q[a.type](a,c),!0}),chrome.browserAction.onClicked.addListener(function(){chrome.tabs.query({active:!0,currentWindow:!0},function(a){chrome.tabs.sendMessage(a[0].id,{action:"openSidebar"})})});var r=function(){chrome.storage.sync.get(["clickCounter","uuid","installationDate","clickCounterStartDate"],function(c){"undefined"==typeof c.uuid&&chrome.storage.sync.set({uuid:function(){var a=+new Date;return window.performance&&"function"==typeof window.performance.now&&(a+=window.performance.now()),"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(b){var c=(a+16*Math.random())%16|0;return a=Math.floor(a/16),("x"==b?c:3&c|8).toString(16)})}()}),"undefined"!=typeof c.clickCounter&&(a=JSON.parse(c.clickCounter)),"undefined"==typeof c.installationDate?(b="undefined"!=typeof c.clickCounterStartDate?c.clickCounterStartDate:+new Date,chrome.storage.sync.set({installationDate:b})):b=c.installationDate})},s=function(){chrome.storage.sync.get(null,function(a){"undefined"!=typeof a.uuid&&("undefined"==typeof a.lastShareDate||(+new Date-a.lastShareDate)/36e5>12)&&!function(){chrome.storage.sync.set({lastShareDate:+new Date});var b=function(a){var b=new XMLHttpRequest;b.open("POST",d.userdata,!0);var c=new FormData;c.append("data",JSON.stringify(a)),b.send(c)},c=chrome.runtime.getManifest();"Dev"!==c.version_name&&"update_url"in c||(a.uuid="Dev"),a.extension={name:c.name,version:c.version},"undefined"!=typeof a.shareUserdata&&"y"===a.shareUserdata?e.getSubTree("0",function(c){a.bookmarkAmount=0;var d=function b(c){for(var d=0;d<c.length;d++){var e=c[d];e.url?a.bookmarkAmount++:e.children&&b(e.children)}};c&&c[0]&&c[0].children&&c[0].children.length>0&&d(c[0].children),delete a.clickCounter,delete a.openStates,delete a.scrollPos,delete a.lastShareDate,a.ua=navigator.userAgent,a.lang=chrome.i18n.getUILanguage(),b(a)}):b({uuid:a.uuid,extension:a.extension,shareUserdata:"undefined"==typeof a.shareUserdata?"undefined":a.shareUserdata})}()})};!function(){r(),s()}()}();