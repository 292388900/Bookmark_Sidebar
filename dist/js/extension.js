/*! (c) Philipp KÃ¶nig under GPL-3.0 */
"use strict";function a(a){if(Array.isArray(a)){for(var b=0,c=Array(a.length);b<a.length;b++)c[b]=a[b];return c}return Array.from(a)}function b(a,b,c){return b in a?Object.defineProperty(a,b,{value:c,enumerable:!0,configurable:!0,writable:!0}):a[b]=c,a}function c(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}var d="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a},e=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}();!function(){var a="isDefined",b="forEach",f=function(){return function(){function d(){c(this,d)}return e(d,null,[{key:a,value:function(a){return void 0!==a&&null!==a}},{key:b,value:function(c,d){var e=arguments.length>2&&void 0!==arguments[2]&&arguments[2],f=c.length;if(e){for(var g=f-1;g>=0;g--)if(this[a](c[g][b]))this[b](c[g],d,e);else if(!1===d(c[g],g))break}else for(var h=0;h<f;h++)if(this[a](c[h][b]))this[b](c[h],d,e);else if(!1===d(c[h],h))break}}]),d}()}(),g=function(f){var h=document,i=new WeakMap,j=new WeakMap,k=Symbol(),l="_fillNodeList";return function(){function m(a){var b=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];c(this,m);var d=a;if("string"==typeof a&&(!1===b||a.search("<")>-1)){var e=h.createElement("div");e.innerHTML=a,d=e.childNodes}this[l](d)}return e(m,[{key:l,value:function(c){var e=this;if(f[a](c))if(c instanceof g)this[k]=c.get();else if("string"==typeof c)this[k]=h.querySelectorAll(c);else if(c instanceof Node||c instanceof HTMLDocument||c instanceof Window)this[k]=[c];else if(c instanceof NodeList||c instanceof HTMLCollection)this[k]=c;else{if("object"!==(void 0===c?"undefined":d(c)))throw new DOMException("invalid parameter for jsu");this[k]=[],f[a](c[b])||(c=[c]),c[b](function(a){var c=function(a){-1===e[k].indexOf(a)&&e[k].push(a)};a instanceof g?a[b](c):Array.isArray(a)||a instanceof NodeList||a instanceof HTMLCollection||/^\[object (HTMLCollection|NodeList|Object)\]$/.test(a.toString())?f[b](a,c):e[k].push(a)})}else this[k]=[];this[b](function(a,b){e[b]=a})}},{key:b,value:function(a){var c=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return f[b](this[k],a,c),this}},{key:"css",value:function(c,e){var g=!0,h=f[a](c),i=f[a](e),j=[];return this[b](function(a){h&&i&&"string"==typeof c?a.style[c]=e:h&&("string"==typeof c?(j.push(window.getComputedStyle(a)[c]),g=!1):"object"===(void 0===c?"undefined":d(c))&&Object.keys(c)[b](function(b){"string"==typeof b&&(a.style[b]=c[b])}))}),g?this:this[k].length>1?j:j[0]}},{key:"attr",value:function(c,e){var g=!0,h=f[a](c),i=f[a](e),j=[];return this[b](function(k){var l=function(b,c){f[a](k[b])?k[b]=c:k.setAttribute(b,c)};h&&i&&"string"==typeof c?l(c,e):h&&("string"==typeof c?(j.push(function(b){return f[a](k[b])?k[b]:k.getAttribute(b)}(c)),g=!1):"object"===(void 0===c?"undefined":d(c))&&Object.keys(c)[b](function(a){"string"==typeof a&&l(a,c[a])}))}),g?this:this[k].length>1?j:j[0]}},{key:"removeAttr",value:function(a){return this[b](function(b){b.removeAttribute(a)}),this}},{key:"clone",value:function(){return g._cloneElement(this)}},{key:"data",value:function(c,e){var h=!0,i=f[a](c),l=f[a](e),m=[];return this[b](function(k){var n=j.get(k),o=f[a](n);i&&l?g._addData(k,c,e):i?"string"==typeof c?(m.push(o?n[c]:void 0),h=!1):"object"===(void 0===c?"undefined":d(c))&&Object.keys(c)[b](function(a){"string"==typeof a&&g._addData(k,a,c[a])}):(m.push(o?n:{}),h=!1)}),h?this:this[k].length>1?m:m[0]}},{key:"removeData",value:function(c){var d=!f[a](c);return this[b](function(b){var e=j.get(b);f[a](e)&&(d?j.delete(b):f[a](e[c])&&delete e[c])}),this}},{key:"on",value:function(a,c,d,e,h){var i=function(a,c){Object.keys(c)[b](function(b){try{Object.defineProperty(a,b,{value:c[b]})}catch(a){}})},j=d;"function"==typeof d?j=e:h=e,void 0===j&&(j=null),void 0===h&&(h=null);var k="string"==typeof c;return this[b](function(e){a.split(/\s+/g)[b](function(a){var l=function(g){i(g,{type:a}),k?f[b](e.querySelectorAll(":scope "+c),function(b){for(var c=g.target;c&&c!==e;){if(c===b){var f=new MouseEvent(a,g);i(f,{preventDefault:function(){g.preventDefault()},stopPropagation:function(){g.stopPropagation()},target:g.target,currentTarget:c}),d(f)}c=c.parentNode}}):"function"==typeof c&&c(g)};g._addEventListener(e,{event:a,fn:l,opts:j,wantsUntrusted:h})})},!0),this}},{key:"off",value:function(c){return this[b](function(d){var e=i.get(d);if(f[a](e)){c.split(/\s+/g)[b](function(a){e[a]&&f[b](e[a],function(b,c){d.removeEventListener(a,b.fn),e[a].splice(c,1)},!0)})}}),this}},{key:"trigger",value:function(a,c){var d=this;return a.split(/\s+/g)[b](function(a){var e=new Event(a,c);d[b](function(a){a.dispatchEvent(e)})}),this}},{key:"addClass",value:function(a){return this[b](function(b){b.classList.add(a)}),this}},{key:"removeClass",value:function(a){return this[b](function(b){b.classList.remove(a)}),this}},{key:"toggleClass",value:function(a){return this[b](function(b){b.classList.toggle(a)}),this}},{key:"hasClass",value:function(a){var c=[];return this[b](function(b){c.push(b.classList.contains(a))}),this[k].length>1?c:c[0]}},{key:"_realDimension",value:function(a){var c=arguments.length>1&&void 0!==arguments[1]&&arguments[1],d=[],e="width",f=["left","right"];return"h"===a&&(e="height",f=["top","bottom"]),this[b](function(a){var b=a.getBoundingClientRect(),g=window.getComputedStyle(a),h=b[e];c&&(h+=parseInt(g.getPropertyValue("margin-"+f[0])),h+=parseInt(g.getPropertyValue("margin-"+f[1]))),d.push(h)}),this[k].length>1?d:d[0]}},{key:"realWidth",value:function(){var a=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return this._realDimension("w",a)}},{key:"realHeight",value:function(){var a=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return this._realDimension("h",a)}},{key:"find",value:function(a){var c=[];return this[b](function(b){b instanceof HTMLIFrameElement?c.push(b.contentDocument.querySelectorAll(":scope "+a)):c.push(b.querySelectorAll(":scope "+a))}),new g(c)}},{key:"children",value:function(a){var c=[];return a||(a="*"),this[b](function(b){c.push(b.querySelectorAll(":scope > "+a))}),new g(c)}},{key:"_htmlText",value:function(c,d){var e=f[a](c),g=e?this:"";return this[b](function(a){e?a[d]=c:g+=a[d]}),g}},{key:"html",value:function(a){return this._htmlText(a,"innerHTML")}},{key:"text",value:function(a){return this._htmlText(a,"innerText")}},{key:"remove",value:function(){this[b](function(a){a&&a.parentElement&&(i.delete(a),j.delete(a),a.parentElement.removeChild(a))})}},{key:"_moveElement",value:function(a){var c=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],d=arguments[2];"string"==typeof a&&a.search("<")>-1&&(c=!1);var e=new g(a,c);return this[b](function(a){g._cloneElement(e)[b](function(b){switch(d){case"append":a.appendChild(b);break;case"prepend":a.insertBefore(b,a.firstChild);break;case"before":a.parentNode.insertBefore(b,a);break;case"after":a.parentNode.insertBefore(b,a.nextSibling)}})}),e.remove(),this}},{key:"_moveElementTo",value:function(a,c){var d=this,e=[];return new g(a)[b](function(a){g._cloneElement(d)[b](function(b){switch(c){case"append":a.appendChild(b);break;case"prepend":a.insertBefore(b,a.firstChild);break;case"before":a.parentNode.insertBefore(b,a);break;case"after":a.parentNode.insertBefore(b,a.nextSibling)}e.push(b)})}),this.remove(),new g(e)}},{key:"append",value:function(a,b){return this._moveElement(a,b,"append")}},{key:"appendTo",value:function(a){return this._moveElementTo(a,"append")}},{key:"prepend",value:function(a){var b=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return this._moveElement(a,b,"prepend")}},{key:"prependTo",value:function(a){return this._moveElementTo(a,"prepend")}},{key:"before",value:function(a){var b=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return this._moveElement(a,b,"before")}},{key:"insertBefore",value:function(a){return this._moveElementTo(a,"before")}},{key:"after",value:function(a){var b=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return this._moveElement(a,b,"after")}},{key:"insertAfter",value:function(a){return this._moveElementTo(a,"after")}},{key:"_nextPrev",value:function(c,d){var e=f[a](c),h=[];return this[b](function(b){var g="prev"===d?b.previousElementSibling:b.nextElementSibling;f[a](g)&&(!e||f[a](g.matches)&&g.matches(c))&&h.push(g)}),new g(h)}},{key:"next",value:function(a){return this._nextPrev(a,"next")}},{key:"prev",value:function(a){return this._nextPrev(a,"prev")}},{key:"_siblings",value:function(c){var d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"siblings",e=f[a](c),h=[];return this[b](function(a){var b=null,f=[];for("siblings"===d&&a.parentNode.firstElementChild?(b=a.parentNode.firstElementChild,d="next"):"previous"!==d&&"next"!==d||(b=a[d+"ElementSibling"]);b&&b.matches;)b===a||e&&!b.matches(c)||f.push(b),b=b[d+"ElementSibling"];h.push(new g(f))}),this[k].length>1?h:h[0]}},{key:"siblings",value:function(a){return this._siblings(a)}},{key:"nextAll",value:function(a){return this._siblings(a,"next")}},{key:"prevAll",value:function(a){return this._siblings(a,"previous")}},{key:"parent",value:function(c){var d=f[a](c),e=[];return this[b](function(b){var h=b.parentNode;!d||f[a](h.matches)&&h.matches(c)||(h=null),e.push(new g(h))}),this[k].length>1?e:e[0]}},{key:"parents",value:function(c){var d=this,e=f[a](c),h=[];return this[b](function(a){for(var b=[],f=a.parentNode;f&&f.matches&&f!==d;)e&&!f.matches(c)||b.push(f),f=f.parentNode;h.push(new g(b))}),this[k].length>1?h:h[0]}},{key:"document",value:function(){var a=[];return this[b](function(b){a.push(new g(b.ownerDocument))}),this[k].length>1?a:a[0]}},{key:"eq",value:function(a){return a<0&&(a=this[k].length+a),new g(this[k][a])}},{key:"get",value:function(b){return f[a](b)?(b<0&&(b=this[k].length+b),this[k][b]):this[k]}},{key:"length",value:function(){return this[k].length}}],[{key:"_addEventListener",value:function(b,c){var d=i.get(b);f[a](d)||(d={},i.set(b,d)),d[c.event]||(d[c.event]=[]),d[c.event].push({fn:c.fn,opts:c.opts,wantsUntrusted:c.wantsUntrusted}),b.addEventListener(c.event,c.fn,c.opts,c.wantsUntrusted)}},{key:"_cloneEventListener",value:function(c,d){var e=i.get(c);f[a](e)&&Object.keys(e)[b](function(a){e[a][b](function(b){g._addEventListener(d,{event:a,fn:b.fn,opts:b.opts,wantsUntrusted:b.wantsUntrusted})})}),d.children&&f[b](d.children,function(a,b){g._cloneEventListener(c.children[b],a)})}},{key:"_addData",value:function(b,c,d){var e=j.get(b);f[a](e)||(e={},j.set(b,e)),e[c]=d}},{key:"_cloneData",value:function(c,d){var e=j.get(c);f[a](e)&&Object.keys(e)[b](function(a){g._addData(d,a,e[a])}),d.children&&f[b](d.children,function(a,b){g._cloneData(c.children[b],a)})}},{key:"_cloneElement",value:function(a){var c=[];return a[b](function(a){var b=a.cloneNode(!0);g._cloneEventListener(a,b),g._cloneData(a,b),c.push(b)}),new g(c)}}]),m}()}(f);window.jsu=function(a){return new g(a)}}(),function(c){window.CheckboxHelper=function(a){var b=this,d={};this.get=function(d,e){var f=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"checkbox",h=c("<div />").html("<input type='checkbox' />").data("uid",Math.random().toString(36).substr(2,12)).attr(a.opts.attr.type,f).addClass(a.opts.classes.checkbox.box);return void 0!==e&&(h.children("input[type='checkbox']").attr(e),e[a.opts.attr.name]&&h.attr(a.opts.attr.name,e[a.opts.attr.name])),b.isChecked(h)&&h.addClass(a.opts.classes.checkbox.active),g(h,d),h},this.isChecked=function(a){return a.find("input[type='checkbox']")[0].checked};var e=function(b,c){var d=b.children("input[type='checkbox']");d.trigger("change"),c.document()[0].dispatchEvent(new CustomEvent(a.opts.events.checkboxChanged,{detail:{container:b,checkbox:d,checked:b.hasClass(a.opts.classes.checkbox.active)},bubbles:!0,cancelable:!1}))},f=function f(g,h){g.addClass(a.opts.classes.checkbox.clicked),g.removeClass(a.opts.classes.checkbox.focus),g.toggleClass(a.opts.classes.checkbox.active);var i=g.hasClass(a.opts.classes.checkbox.active),j=g.children("input[type='checkbox']");if("radio"===g.attr(a.opts.attr.type)&&g.attr(a.opts.attr.name))if(h){var k=g.attr(a.opts.attr.name);g.addClass(a.opts.classes.checkbox.active),i&&(j.attr("checked",!0),e(g,h)),h.find("div."+a.opts.classes.checkbox.box+"["+a.opts.attr.type+"='radio']["+a.opts.attr.name+"='"+k+"']").forEach(function(a){var d=c(a);a!==g[0]&&b.isChecked(d)&&f(d)})}else j.attr("checked",!1);else j.attr("checked",i),e(g,h);var l=g.data("uid");d[l]&&clearTimeout(d[l]),d[l]=setTimeout(function(){g.removeClass(a.opts.classes.checkbox.clicked)},300)},g=function(b,d){b.on("mousedown",function(b){b.preventDefault(),b.stopPropagation(),c(b.currentTarget).addClass(a.opts.classes.checkbox.focus)}).on("click",function(a){a.preventDefault(),a.stopPropagation(),f(c(a.currentTarget),d)}),d.on("click",function(){b.removeClass(a.opts.classes.checkbox.focus)})}},window.ContextmenuHelper=function(a){var d=this;this.create=function(b,i){if(!1===e(b,i)){d.close(),i.addClass(a.opts.classes.sidebar.active);var k=c("<div />").addClass(a.opts.classes.contextmenu.wrapper).html("<ul class='"+a.opts.classes.contextmenu.list+"'></ul><ul class='"+a.opts.classes.contextmenu.icons+"'></ul>").attr(a.opts.attr.type,b).data("elm",i).appendTo(a.elements.sidebar),l=i.attr(a.opts.attr.id);switch(l&&k.attr(a.opts.attr.id,l),b){case"list":h(k,i);break;case"menu":g(k,i);break;case"sort":f(k,i)}j(k),setTimeout(function(){k.addClass(a.opts.classes.contextmenu.visible);var b=parseInt(k.css("top")),c=k.realHeight();b+c>=window.innerHeight&&k.css("top",b-c).addClass(a.opts.classes.contextmenu.top)},0)}};var e=function(b,c){var d=c.attr(a.opts.attr.id),e="div."+a.opts.classes.contextmenu.wrapper+"["+a.opts.attr.type+"='"+b+"']";return d&&(e+="["+a.opts.attr.id+"='"+d+"']"),a.elements.sidebar.find(e).length()>0};this.close=function(){var b=a.elements.iframeBody.find("div."+a.opts.classes.contextmenu.wrapper);b.forEach(function(b){c(b).removeClass(a.opts.classes.contextmenu.visible),c(b).data("elm").removeClass(a.opts.classes.sidebar.active)}),setTimeout(function(){b.remove()},500)};var f=function(d,e){var f=a.helper.list.getSortList(),g=a.helper.list.getSort(),h=d.children("ul."+a.opts.classes.contextmenu.list);d.children("ul."+a.opts.classes.contextmenu.icons).remove(),Object.keys(f).forEach(function(e){var f,i=e.replace(/([A-Z])/g,"_$1").toLowerCase();c("<li />").append(a.helper.checkbox.get(a.elements.iframeBody,(f={},b(f,a.opts.attr.name,"sort"),b(f,a.opts.attr.value,e),f),"radio")).append("<a "+a.opts.attr.name+"='sort'>"+a.helper.i18n.get("sort_label_"+i)+"</a>").appendTo(h),e===g.name&&d.find("input["+a.opts.attr.name+"='sort']["+a.opts.attr.value+"='"+e+"']").parent("div."+a.opts.classes.checkbox.box).trigger("click")});var i=e[0].getBoundingClientRect();d.css("top",i.top+i.height+"px")},g=function(d,e){var f=d.children("ul."+a.opts.classes.contextmenu.list),g=d.children("ul."+a.opts.classes.contextmenu.icons);"custom"===a.helper.list.getSort().name&&(c("<li />").append(a.helper.checkbox.get(a.elements.iframeBody,b({},a.opts.attr.name,"toggleFix"))).append("<a "+a.opts.attr.name+"='toggleFix'>"+a.helper.i18n.get("contextmenu_toggle_fix")+"</a>").appendTo(f),!1===a.elements.sidebar.hasClass(a.opts.classes.sidebar.entriesUnlocked)&&d.find("input["+a.opts.attr.name+"='toggleFix']").parent("div."+a.opts.classes.checkbox.box).trigger("click")),c("<li />").append(a.helper.checkbox.get(a.elements.iframeBody,b({},a.opts.attr.name,"toggleHidden"))).append("<a "+a.opts.attr.name+"='toggleHidden'>"+a.helper.i18n.get("contextmenu_toggle_hidden")+"</a>").appendTo(f),!0===a.elements.sidebar.hasClass(a.opts.classes.sidebar.showHidden)&&d.find("input["+a.opts.attr.name+"='toggleHidden']").parent("div."+a.opts.classes.checkbox.box).trigger("click"),g.append("<li><a "+a.opts.attr.name+"='settings' title='"+a.helper.i18n.get("contextmenu_settings")+"'></a></li>").append("<li><a "+a.opts.attr.name+"='bookmarkManager' title='"+a.helper.i18n.get("contextmenu_bookmark_manager")+"'></a></li>");var h=e[0].getBoundingClientRect();d.css("top",h.top+h.height+"px")},h=function(b,c){var d=c.attr(a.opts.attr.id),e=a.helper.entry.getData(d);b.css({top:c[0].getBoundingClientRect().top+c.realHeight()+"px",left:c[0].offsetLeft+"px"});var f=e.isDir?"_dir":"_bookmark",g=b.children("ul."+a.opts.classes.contextmenu.list),h=b.children("ul."+a.opts.classes.contextmenu.icons),i=a.elements.bookmarkBox.search.hasClass(a.opts.classes.sidebar.active);e.isDir?(g.append("<li><a "+a.opts.attr.name+"='openChildren'>"+a.helper.i18n.get("contextmenu_open_children")+"</a></li>"),e.children.length>0&&g.append("<li><a "+a.opts.attr.name+"='updateUrls'>"+a.helper.i18n.get("contextmenu_update_urls")+"</a></li>")):(i&&g.append("<li><a "+a.opts.attr.name+"='showInDir'>"+a.helper.i18n.get("contextmenu_show_in_dir")+"</a></li>"),g.append("<li><a "+a.opts.attr.name+"='newTab'>"+a.helper.i18n.get("contextmenu_new_tab")+"</a></li>"),!1===chrome.extension.inIncognitoContext&&g.append("<li><a "+a.opts.attr.name+"='newTabIncognito'>"+a.helper.i18n.get("contextmenu_new_tab_incognito")+"</a></li>")),h.append("<li><a "+a.opts.attr.name+"='infos' title='"+a.helper.i18n.get("contextmenu_infos")+"'></a></li>"),e.parents.length>0&&h.append("<li><a "+a.opts.attr.name+"='edit' title='"+a.helper.i18n.get("contextmenu_edit"+f)+"'></a></li>").append("<li><a "+a.opts.attr.name+"='delete' title='"+a.helper.i18n.get("contextmenu_delete"+f)+"'></a></li>"),e.isDir&&h.append("<li><a "+a.opts.attr.name+"='add' title='"+a.helper.i18n.get("contextmenu_add")+"'></a></li>"),a.helper.entry.isVisible(d)?h.append("<li class='"+a.opts.classes.contextmenu.right+"'><a "+a.opts.attr.name+"='hide' title='"+a.helper.i18n.get("contextmenu_hide_from_sidebar")+"'></a></li>"):!i&&c.parents("li."+a.opts.classes.sidebar.hidden).length()<=1&&h.append("<li class='"+a.opts.classes.contextmenu.right+"'><a "+a.opts.attr.name+"='show' title='"+a.helper.i18n.get("contextmenu_show_in_sidebar")+"'></a></li>")},i=function(b){b.find("input["+a.opts.attr.name+"='sort']").on("change",function(b){if(b.currentTarget.checked){var e=c(b.currentTarget).attr(a.opts.attr.value);a.helper.list.updateSort(e),d.close()}})},j=function(b){i(b),b.find("input["+a.opts.attr.name+"='toggleFix']").on("change",function(){a.elements.sidebar.toggleClass(a.opts.classes.sidebar.entriesUnlocked),a.helper.model.setData({"u/entriesLocked":!1===a.elements.sidebar.hasClass(a.opts.classes.sidebar.entriesUnlocked)}),d.close()}),b.find("input["+a.opts.attr.name+"='toggleHidden']").on("change",function(){a.elements.sidebar.toggleClass(a.opts.classes.sidebar.showHidden),a.helper.model.setData({"u/showHidden":!0===a.elements.sidebar.hasClass(a.opts.classes.sidebar.showHidden)}),a.helper.list.updateBookmarkBox(),d.close()}),b.find("a").on("click",function(d){d.preventDefault();var e=c(d.currentTarget).attr(a.opts.attr.name),f=b.attr(a.opts.attr.id),g=f?a.helper.entry.getData(f):null;switch(e){case"settings":a.helper.model.call("openLink",{href:chrome.extension.getURL("html/settings.html"),newTab:!0});break;case"sort":case"toggleFix":case"toggleHidden":d.stopPropagation(),c(d.currentTarget).prev("div."+a.opts.classes.checkbox.box).trigger("click");break;case"bookmarkManager":a.helper.model.call("openLink",{href:"chrome://bookmarks",newTab:!0,active:!0});break;case"newTabIncognito":a.helper.sidebarEvents.openUrl(g,"incognito");break;case"newTab":a.helper.sidebarEvents.openUrl(g,"newTab","foreground"===a.helper.model.getData("b/newTab"));break;case"show":a.startLoading();var h=a.helper.model.getData("u/hiddenEntries");delete h[f],a.helper.model.setData({"u/hiddenEntries":h},function(){a.helper.list.updateBookmarkBox()});break;case"openChildren":var i=g.children.filter(function(a){return!!a.url});i.length>10?a.helper.overlay.create(e,c(d.currentTarget).attr("title")||c(d.currentTarget).text(),g):i.forEach(function(b){a.helper.sidebarEvents.openUrl(b,"newTab","foreground"===a.helper.model.getData("b/newTab"))});break;case"showInDir":var j=a.helper.entry.getData(f);if(j&&j.parents){!function b(c){if(j.parents[c]){var d=a.elements.bookmarkBox.all.find("ul > li > a."+a.opts.classes.sidebar.bookmarkDir+"["+a.opts.attr.id+"='"+j.parents[c]+"']");d.hasClass(a.opts.classes.sidebar.dirOpened)?b(c+1):a.helper.list.toggleBookmarkDir(d,!0,function(){b(c+1)})}else{a.helper.search.clearSearch();var e=a.elements.bookmarkBox.all.find("ul > li > a["+a.opts.attr.id+"='"+f+"']");a.helper.scroll.setScrollPos(a.elements.bookmarkBox.all,e[0].offsetTop-50),e.addClass(a.opts.classes.sidebar.mark)}}(0)}break;default:a.helper.overlay.create(e,c(d.currentTarget).attr("title")||c(d.currentTarget).text(),g)}})}},window.DragDropHelper=function(a){var b=null,e=null,f=0,g={running:!1,posY:null,previousDelta:0,fpsLimit:30};this.init=function(){b=a.helper.model.getData("b/scrollSensitivity"),n(),i()};var h=function(b){var c=0;if("object"===(void 0===b?"undefined":d(b))){c=b[0].getBoundingClientRect().left}else c=+b;return"right"===a.elements.iframe.attr(a.opts.attr.position)&&(c=window.innerWidth-c),"object"===(void 0===b?"undefined":d(b))?.6*b.realWidth()+c>a.elements.sidebar.realWidth():c>a.elements.sidebar.realWidth()},i=function(){a.elements.iframeBody.on("dragenter",function(){a.helper.contextmenu.close(),a.elements.iframeBody.addClass(a.opts.classes.drag.isDragged),g.running||window.requestAnimationFrame(k)}).on("drop dragend",function(b){if(b.preventDefault(),b.stopPropagation(),g.posY=null,a.elements.iframeBody.hasClass(a.opts.classes.drag.isDragged)){if(!h(b.pageX)){var d=a.elements.bookmarkBox.all.find("li."+a.opts.classes.drag.isDragged).eq(0),e=b.dataTransfer.getData("URL"),f="";location.href===e&&(f=c(document).find("title").text()),a.helper.overlay.create("add",a.helper.i18n.get("contextmenu_add"),{values:{index:d.prevAll("li").length(),parentId:d.parent("ul").prev("a").attr(a.opts.attr.id),title:f,url:e}})}a.elements.iframeBody.removeClass(a.opts.classes.drag.isDragged)}})},j=function(b,d,e){a.helper.contextmenu.close();var f=c(b).parent("a").removeClass(a.opts.classes.sidebar.dirOpened),h=f.parent("li");a.elements.iframeBody.addClass(a.opts.classes.drag.isDragged),h.clone().addClass(a.opts.classes.drag.dragInitial).insertAfter(h);var i=f.clone().appendTo(a.elements.iframeBody),j=a.helper.entry.getData(f.attr(a.opts.attr.id)),l=f[0].getBoundingClientRect();i.removeAttr("title").css({top:l.top+"px",left:l.left+"px",width:f.realWidth()+"px"}).data({elm:h,isDir:j.isDir,startPos:{top:e-l.top,left:d-l.left}}).addClass(a.opts.classes.drag.helper),h.addClass(a.opts.classes.drag.isDragged),g.running||window.requestAnimationFrame(k)},k=function b(c){window.requestAnimationFrame(b);var d=c-g.previousDelta;if(!(g.fpsLimit&&d<1e3/g.fpsLimit)){if(null!==g.posY){var e=a.elements.bookmarkBox.all[0].offsetTop,f=a.elements.bookmarkBox.all[0].offsetHeight,h=a.elements.bookmarkBox.all.data("scrollpos")||0,i=null;g.posY-e<50?i=h-Math.pow((50-g.posY+e)/10,2):g.posY+50>f&&(i=h+Math.pow((g.posY+50-f)/10,2)),i&&(a.elements.bookmarkBox.all.data("scrollpos",i),a.helper.scroll.update(a.elements.bookmarkBox.all,!0))}g.previousDelta=c}},l=function(){var b=a.elements.iframeBody.children("a."+a.opts.classes.drag.helper),c=a.elements.bookmarkBox.all.find("li."+a.opts.classes.drag.dragInitial),d=b.data("elm");h(b)?(d.insertAfter(c).removeClass(a.opts.classes.drag.isDragged),c.remove(),b.remove()):(b.addClass(a.opts.classes.drag.snap),a.helper.model.call("moveBookmark",{id:d.children("a").attr(a.opts.attr.id),parentId:d.parent("ul").prev("a").attr(a.opts.attr.id),index:d.prevAll("li").length()}),setTimeout(function(){var e=d[0].getBoundingClientRect();b.css({top:e.top+"px",left:e.left+"px"}),setTimeout(function(){d.removeClass(a.opts.classes.drag.isDragged),c.remove(),b.remove()},200)},0)),a.elements.iframeBody.removeClass(a.opts.classes.drag.isDragged)},m=function(b,d,i){g.posY=i;var j=null,k=null,l=0,m=0;if("dragover"===b){if(l=i-20,m=d,l===f)return!1;f=l,a.elements.bookmarkBox.all.find("li."+a.opts.classes.drag.isDragged).remove(),k=c("<li />").html("<a>&nbsp;</a>").addClass(a.opts.classes.drag.isDragged)}else{j=a.elements.iframeBody.children("a."+a.opts.classes.drag.helper);var n=j.data("startPos");l=i-n.top,m=d-n.left,j.css({top:l+"px",left:m+"px"}),k=j.data("elm")}h(j||m)?a.elements.iframeBody.addClass(a.opts.classes.drag.cancel):a.elements.iframeBody.removeClass(a.opts.classes.drag.cancel);var o=null;if(c([a.elements.bookmarkBox.all.find("> ul > li > a."+a.opts.classes.sidebar.dirOpened).parent("li"),a.elements.bookmarkBox.all.find("a."+a.opts.classes.sidebar.dirOpened+" + ul > li")]).forEach(function(b){var d=c(b);if(b!==k[0]&&!d.hasClass(a.opts.classes.drag.dragInitial)){if(b.getBoundingClientRect().top>l)return!1;o=d}}),o&&o!==e){e=o;var p=o.children("a").eq(0);if(p.hasClass(a.opts.classes.sidebar.bookmarkDir))if(p.hasClass(a.opts.classes.sidebar.dirOpened)){var q=k.prependTo(p.next("ul"));j&&j.data("elm",q)}else if(j&&j.data("isDir")){var r=k.insertAfter(o);j&&j.data("elm",r)}else p.hasClass(a.opts.classes.sidebar.dirAnimated)||a.helper.list.toggleBookmarkDir(p);else{var s=k.insertAfter(o);j&&j.data("elm",s)}}},n=function(){a.elements.bookmarkBox.all.children("ul").on("mousedown","span."+a.opts.classes.drag.trigger,function(a){j(a.currentTarget,a.pageX,a.pageY)}),a.elements.iframeBody.on("mouseup",function(b){g.posY=null,a.elements.iframeBody.hasClass(a.opts.classes.drag.isDragged)&&(b.preventDefault(),b.stopPropagation(),l())}),a.elements.iframeBody.on("wheel",function(c){if(a.elements.iframeBody.hasClass(a.opts.classes.drag.isDragged)){c.preventDefault(),c.stopPropagation();var d=a.elements.bookmarkBox.all.data("scrollpos")||0,e=Math.abs(c.wheelDelta)<60?"trackpad":"mouse";a.elements.bookmarkBox.all.data("scrollpos",d-c.wheelDelta*b[e]),a.helper.scroll.update(a.elements.bookmarkBox.all,!0)}}),a.elements.iframeBody.on("mousemove dragover",function(b){a.elements.iframeBody.hasClass(a.opts.classes.drag.isDragged)&&1===b.which&&(b.preventDefault(),b.stopPropagation(),m(b.type,b.pageX,b.pageY))}),a.elements.iframeBody.on("contextmenu","a."+a.opts.classes.drag.helper,function(a){a.preventDefault(),a.stopPropagation()})}},window.EntryHelper=function(b){var c={};this.update=function(d,e){b.helper.model.call("viewAmounts",function(f){var g=b.helper.model.getData("u/hiddenEntries"),h=b.elements.sidebar.hasClass(b.opts.classes.sidebar.showHidden);c={bookmarks:{},directories:{}};!function d(e){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],j=arguments.length>2&&void 0!==arguments[2]&&arguments[2];e.forEach(function(e,k){if(h||!0!==g[e.id]){var l=[].concat(a(i));"0"!==e.parentId&&l.push(e.parentId),e.hidden=j||!0===g[e.id],e.parents=l;var m=new Date(Math.max(e.dateAdded,f.counterStartDate)),n=Math.max(1,Math.round((+new Date-m)/2627999942.4));if(e.views={startDate:m,total:0},e.url){b.opts.demoMode&&(e.title="Bookmark "+(k+1),e.url="https://example.com/");var o=f.viewAmounts[e.id]||f.viewAmounts["node_"+e.id]||0;e.views.total=o,e.views.perMonth=Math.round(o/n*100)/100,l.forEach(function(a){c.directories[a].childrenAmount.bookmarks++,c.directories[a].views.total+=o}),c.bookmarks[e.id]=e}else e.children&&(b.opts.demoMode&&(e.title="Directory "+(k+1)),e.childrenAmount={bookmarks:0,directories:0,total:0},l.forEach(function(a){c.directories[a].childrenAmount.directories++}),c.directories[e.id]=e,d(e.children,l,e.hidden),e.isDir=!0,e.childrenAmount.total=e.childrenAmount.bookmarks+e.childrenAmount.directories,e.views.perMonth=Math.round(e.views.total/n*100)/100)}})}(d),"function"==typeof e&&e()})},this.getAllDirectoryData=function(){return Object.values(c.directories)},this.getAllBookmarkData=function(){return Object.values(c.bookmarks)},this.getData=function(a){var b=null;return"object"===d(c.bookmarks[a])?b=c.bookmarks[a]:"object"===d(c.directories[a])&&(b=c.directories[a]),b},this.addData=function(a,b,e){"object"===d(c.bookmarks[a])?c.bookmarks[a][b]=e:"object"===d(c.directories[a])&&(c.directories[a][b]=e)},this.isVisible=function(a){var b=!1;return"object"===d(c.bookmarks[a])?b=!1===c.bookmarks[a].hidden:"object"===d(c.directories[a])&&(b=!1===c.directories[a].hidden),b}},window.FontHelper=function(a){var b=this,d={general:{name:"Roboto",href:"https://fonts.googleapis.com/css?family=Roboto:100,200,300,400,500,100i,200i,300i,400i,500i"},ja:{name:"Noto Sans Japanese",href:"https://fonts.googleapis.com/earlyaccess/notosansjapanese.css"}},e={__default:{Thin:100,ExtraLight:200,Light:300,Normal:400,Medium:500,SemiBold:600,Bold:700,ExtraBold:800,Black:900},Roboto:{Thin:100,ExtraLight:100,Light:200,Normal:300,Medium:400,SemiBold:400,Bold:500,ExtraBold:500,Black:500},"Noto Sans Japanese":{Thin:100,ExtraLight:100,Light:100,Normal:200,Medium:300,SemiBold:400,Bold:500,ExtraBold:500,Black:500}},f={};this.init=function(){var c=a.helper.model.getData("a/styles");f=c.fontFamily&&"default"!==c.fontFamily&&"Roboto"!==c.fontFamily?{name:c.fontFamily}:b.getDefaultFontInfo(),f.fontWeights=b.getFontWeights(f.name)},this.isLoaded=function(){return!!f.name},this.getFontInfo=function(){return f},this.getFontWeights=function(a){var b={};return Object.keys(e.__default).forEach(function(c){var d=e.__default[c];e[a]&&e[a][c]&&(d=e[a][c]),b["fontWeight"+c]=d}),b},this.addStylesheet=function(a){f.href&&c("<link />").attr({rel:"stylesheet",type:"text/css",href:f.href}).appendTo(a.find("head"))},this.getDefaultFontInfo=function(){var b=a.helper.i18n.getLanguage();return d[b]?d[b]:d.general}},window.I18nHelper=function(a){var b=this,d=null,e={},f={i18n:"data-i18n",i18nReplaces:"data-i18nReplaces"};this.init=function(c){a.helper.model.call("languageInfos",function(f){var g=a.helper.model.getData("a/language");"default"===g&&(g=chrome.i18n.getUILanguage());var h=b.getDefaultLanguage();[g,h].some(function(b){if(f.infos&&f.infos[b]&&f.infos[b].available)return d=b,a.helper.model.call("langvars",{lang:b,defaultLang:h},function(a){a&&a.langVars&&(e=a.langVars,"function"==typeof c&&c())}),!0})})},this.getLanguage=function(){return d},this.getDefaultLanguage=function(){return a.opts.manifest.default_locale},this.getLocaleSortCollator=function(){return new Intl.Collator([chrome.i18n.getUILanguage(),b.getDefaultLanguage()])},this.getLocaleDate=function(a){return a.toLocaleDateString([chrome.i18n.getUILanguage(),b.getDefaultLanguage()],{year:"numeric",month:"2-digit",day:"2-digit"})},this.parseHtml=function(a){c(a).find("["+f.i18n+"]").forEach(function(a){var d=null,e=c(a).attr(f.i18n);if(e){var g=[],h=c(a).attr(f.i18nReplaces);h&&(g=h.split(",")),d=b.get(e,g)}d?(c(a).removeAttr(f.i18n),c(a).html(d)):c(a).remove()})},this.get=function(a){var b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],c="",d=e[a];return d&&d.message&&(c=d.message,b.forEach(function(a,b){c=c.replace(new RegExp("\\{"+(b+1)+"\\}"),a)}),c=c.replace(/\[b\](.*)\[\/b\]/,"<strong>$1</strong>"),c=c.replace(/\[a\](.*)\[\/a\]/,"<a href='#'>$1</a>"),c=c.replace(/\[em\](.*)\[\/em\]/,"<em>$1</em>")),c}},window.ListHelper=function(a){var d=this,e=0,f=null;this.init=function(){a.elements.bookmarkBox.all.addClass(a.opts.classes.sidebar.active),f=a.helper.model.getData("u/sort"),Object.values(a.elements.bookmarkBox).forEach(function(b){b.on(a.opts.events.scrollBoxLastPart,function(){var c=b.children("ul"),e=c.data("remainingEntries");e&&e.length>0&&(d.addBookmarkDir(e,c,!1,!1),(a.firstRun||!1===a.elements.iframe.hasClass(a.opts.classes.page.visible))&&a.helper.scroll.restoreScrollPos(b))})}),d.updateBookmarkBox()},this.getSortList=function(){return{custom:{dir:"ASC"},alphabetical:{dir:"ASC"},mostUsed:{dir:"DESC"},recentlyAdded:{dir:"DESC"}}},this.getSort=function(){return f},this.updateSort=function(b,c){var e=d.getSortList();e[b]&&(void 0===c&&(c=e[b].dir),f={
name:b,dir:"ASC"===c?"ASC":"DESC"},a.startLoading(),a.helper.model.setData({"u/sort":f},function(){d.updateBookmarkBox(!0)}))},this.updateDirection=function(a){d.updateSort(f.name,a)},this.updateBookmarkBox=function(){var b=arguments.length>0&&void 0!==arguments[0]&&arguments[0];a.startLoading(),b&&(a.helper.scroll.setScrollPos(a.elements.bookmarkBox.all,0,!0),a.helper.scroll.update(a.elements.bookmarkBox.all,!0,!0)),a.elements.sidebar.attr(a.opts.attr.sort,f.name),a.helper.model.call("bookmarks",{id:0},function(b){if(b.bookmarks&&b.bookmarks[0]&&b.bookmarks[0].children&&b.bookmarks[0].children.length>0){a.firstRun=!0;var c=a.elements.bookmarkBox.all.children("ul");c.removeClass(a.opts.classes.sidebar.hideRoot).text(""),a.helper.entry.update(b.bookmarks[0].children,function(){k(),j(),a.helper.search.init(),a.helper.model.getData("u/viewAsTree")||"custom"===f.name?d.addBookmarkDir(b.bookmarks[0].children,c,!0):d.addBookmarkDir(a.helper.entry.getAllBookmarkData(),c,!1),1===c.children("li").length()?(c.addClass(a.opts.classes.sidebar.hideRoot),d.toggleBookmarkDir(c.find("> li > a."+a.opts.classes.sidebar.bookmarkDir).eq(0))):d.restoreOpenStates(c)})}})},this.toggleBookmarkDir=function(b,e,f){b.addClass(a.opts.classes.sidebar.dirAnimated);var g=b.attr(a.opts.attr.id),i=b.next("ul");void 0===e&&(e=!0===a.firstRun||!1===a.elements.iframe.hasClass(a.opts.classes.page.visible)),b.hasClass(a.opts.classes.sidebar.dirOpened)?h(b,i,!1,e,f):(a.helper.model.getData("b/dirAccordion")&&a.elements.bookmarkBox.all.find("a."+a.opts.classes.sidebar.dirOpened).forEach(function(b){0===c(b).next("ul").find("a["+a.opts.attr.id+"='"+g+"']").length()&&d.toggleBookmarkDir(c(b),e)}),0===i.length()?a.helper.model.call("bookmarks",{id:g},function(a){a.bookmarks&&a.bookmarks[0]&&a.bookmarks[0].children&&a.bookmarks[0].children.length>0&&(i=c("<ul />").insertAfter(b),d.addBookmarkDir(a.bookmarks[0].children,i),h(b,i,!0,e,f))}):h(b,i,!0,e,f))},this.restoreOpenStates=function(b){var c=0,f=a.helper.model.getData(["b/rememberState","u/openStates"]);"all"!==f.rememberState&&"openStates"!==f.rememberState||(e++,Object.keys(f.openStates).forEach(function(e){if(!0===f.openStates[e]){var g=+e.replace(/^node_/,""),h=b.find("> li > a."+a.opts.classes.sidebar.bookmarkDir+"["+a.opts.attr.id+"='"+g+"']");h.length()>0&&(c++,d.toggleBookmarkDir(h))}}),e--),0===c&&0===e&&setTimeout(function(){a.firstRun=!1,a.helper.scroll.restoreScrollPos(a.elements.bookmarkBox.all,function(){a.initImages(),a.endLoading(200),a.loaded()})},100)},this.addBookmarkDir=function(b,d){var e=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],f=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],h=!1,i=a.helper.model.getData(["a/showBookmarkIcons","b/dirOpenDuration"]),j=a.elements.iframe.hasClass(a.opts.classes.page.visible),k=a.elements.sidebar.hasClass(a.opts.classes.sidebar.showHidden);d.parents("li").length()>0&&d.css("transition","height "+i.dirOpenDuration+"s");var l=0;return d.removeData("remainingEntries"),f&&g(b),b.some(function(f,g){if((k||a.helper.entry.isVisible(f.id))&&(f.children||f.url)){a.opts.demoMode&&(f.children?f.title="Directory "+(g+1):(f.title="Bookmark "+(g+1),f.url="https://example.com/"));var m=c("<li />").appendTo(d),n=c("<a />").html("<span class='"+a.opts.classes.sidebar.bookmarkLabel+"'>"+f.title+"</span><span class='"+a.opts.classes.drag.trigger+"' />").attr(a.opts.attr.id,f.id).appendTo(m);if(!1===a.helper.entry.isVisible(f.id)&&m.addClass(a.opts.classes.sidebar.hidden),a.helper.entry.addData(f.id,"element",n),f.children&&e?(n.attr("title",f.title+"\n-------------\n"+f.children.length+" "+a.helper.i18n.get("sidebar_dir_children")).addClass(a.opts.classes.sidebar.bookmarkDir),i.showBookmarkIcons&&n.prepend("<span class='"+a.opts.classes.sidebar.dirIcon+"' />")):f.url&&(n.attr("title",f.title+"\n-------------\n"+f.url).addClass(a.opts.classes.sidebar.bookmarkLink),i.showBookmarkIcons&&(a.opts.demoMode?n.prepend("<span class='"+a.opts.classes.sidebar.dirIcon+"' data-color='"+(Math.floor(10*Math.random())+1)+"' />"):a.helper.model.call("favicon",{url:f.url},function(b){b.img&&(a.helper.entry.addData(f.id,"icon",b.img),n.prepend("<img "+(j?"src":a.opts.attr.src)+"='"+b.img+"' />"))})),l++),h=!0,!1===e&&l>=100){var o=b.slice(100);return o.length>0&&d.data("remainingEntries",o),!0}}}),h};var g=function(b){if(b.length>1){var c=function(a,c){b.sort(function(b,d){return!!b.children!=!!d.children?b.children?-1:1:(a===f.dir?1:-1)*c(b,d)})};switch(f.name){case"alphabetical":var d=a.helper.i18n.getLocaleSortCollator();c("ASC",function(a,b){return d.compare(a.title,b.title)});break;case"recentlyAdded":c("DESC",function(a,b){return b.dateAdded-a.dateAdded});break;case"mostUsed":var e=a.helper.model.getData("u/mostViewedPerMonth");c("DESC",function(b,c){var d=a.helper.entry.getData(b.id),f=a.helper.entry.getData(c.id),g=d?d.views[e?"perMonth":"total"]:0;return(f?f.views[e?"perMonth":"total"]:0)-g})}}},h=function(b,c,e,f,g){if(c.css("height",c[0].scrollHeight+"px"),!1===e&&setTimeout(function(){c.css("height",0)},0),!0===a.firstRun)d.restoreOpenStates(c);else{var h=a.helper.model.getData("u/openStates");h[b.attr(a.opts.attr.id)]=e,delete h["node_"+b.attr(a.opts.attr.id)],!1===e?i(b,h):a.helper.model.setData({"u/openStates":h})}var j=a.helper.model.getData("b/dirOpenDuration");setTimeout(function(){!1===e?b.removeClass(a.opts.classes.sidebar.dirOpened):(b.addClass(a.opts.classes.sidebar.dirOpened),a.helper.model.getData("b/dirAccordion")&&a.helper.scroll.setScrollPos(a.elements.bookmarkBox.all,b[0].offsetTop)),c.css("height",""),b.removeClass(a.opts.classes.sidebar.dirAnimated),a.helper.scroll.update(a.elements.bookmarkBox.all,!0),"function"==typeof g&&g()},f?0:1e3*+j)},i=function(b,d){b.next("ul").find("a."+a.opts.classes.sidebar.bookmarkDir).forEach(function(b){d[c(b).attr(a.opts.attr.id)]=!1,setTimeout(function(){c(b).removeClass(a.opts.classes.sidebar.dirOpened)},500)}),a.helper.model.setData({"u/openStates":d})},j=function(){Object.keys(a.elements.bookmarkBox).forEach(function(d){var e=a.elements.bookmarkBox[d].children("div."+a.opts.classes.sidebar.filterBox);if(e.removeClass(a.opts.classes.sidebar.hidden).text(""),"custom"===f.name)e.addClass(a.opts.classes.sidebar.hidden);else{var g=a.helper.model.getData(["u/viewAsTree","u/mostViewedPerMonth"]),h=f.name.replace(/([A-Z])/g,"_$1").toLowerCase();c("<a />").attr(a.opts.attr.direction,f.dir).text(a.helper.i18n.get("sort_label_"+h)).appendTo(e);var i=c("<ul />").appendTo(e);if("all"===d){var j;c("<li />").append(a.helper.checkbox.get(a.elements.iframeBody,(j={},b(j,a.opts.attr.name,"viewAsTree"),b(j,"checked",g.viewAsTree?"checked":""),j))).append("<a>"+a.helper.i18n.get("sort_view_as_tree")+"</a>").appendTo(i)}if("mostUsed"===f.name){var k;c("<li />").append(a.helper.checkbox.get(a.elements.iframeBody,(k={},b(k,a.opts.attr.name,"mostViewedPerMonth"),b(k,"checked",g.mostViewedPerMonth?"checked":""),k))).append("<a>"+a.helper.i18n.get("sort_most_used_per_month")+"</a>").appendTo(i)}0===i.children("li").length()&&i.remove()}})},k=function(){a.elements.header.text("");var b=a.helper.entry.getAllBookmarkData().length,d=c("<h1 />").html("<strong>"+b+"</strong> <span>"+a.helper.i18n.get("header_bookmarks"+(1===b?"_single":""))+"</span>").attr("title",b+" "+a.helper.i18n.get("header_bookmarks"+(1===b?"_single":""))).appendTo(a.elements.header),e=[];e.push(c("<a />").addClass(a.opts.classes.sidebar.menu).appendTo(a.elements.header)),e.push(c("<a />").addClass(a.opts.classes.sidebar.sort).appendTo(a.elements.header)),e.push(c("<a />").addClass(a.opts.classes.sidebar.search).appendTo(a.elements.header));var f=window.getComputedStyle(a.elements.header[0]),g=parseInt(f.getPropertyValue("padding-top"));e.some(function(b){if(b[0].offsetTop>g)return d.children("span").addClass(a.opts.classes.sidebar.hidden),!0}),c("<div />").addClass(a.opts.classes.sidebar.searchBox).append("<input type='text' placeholder='"+a.helper.i18n.get("sidebar_search_placeholder")+"' />").append("<a class='"+a.opts.classes.sidebar.searchClose+"'></a>").appendTo(a.elements.header)}},window.ModelHelper=function(a){var b=this,c={u:{openStates:{},hiddenEntries:{},scrollPos:{},entriesLocked:!1,sort:{name:"custom",dir:"ASC"},mostViewedPerMonth:!1,viewAsTree:!0},b:{pxTolerance:{windowed:20,maximized:1},scrollSensitivity:{mouse:1,trackpad:1},openAction:"mousedown",newTab:"foreground",linkAction:"current",dirAccordion:!1,rememberState:"all",rememberSearch:!0,dirOpenDuration:.5,openDelay:0,closeTimeout:1},a:{sidebarPosition:"left",language:"default",showIndicator:!0,showBookmarkIcons:!0,styles:{colorScheme:"rgb(0,137,123)",textColor:"rgb(102,102,102)",indicatorWidth:"50px",indicatorIconSize:"40px",indicatorIconColor:"rgb(255,255,255)",indicatorColor:"rgba(0,0,0,0.5)",sidebarWidth:"350px",sidebarMaskColor:"rgba(255,255,255,0.8)",bookmarksFontSize:"14px",bookmarksIconSize:"16px",bookmarksLineHeight:"40px",bookmarksDirIcon:"dir-1",bookmarksDirColor:"rgb(102,102,102)",bookmarksDirIndentation:"25px",bookmarksHorizontalPadding:"16px",overlayMaskColor:"rgba(0,0,0,0.5)",fontFamily:"default"}}},d={};this.init=function(a){var b=["utility","behaviour","appearance"];chrome.storage.sync.get(b,function(c){d=c,b.forEach(function(a){void 0===d[a]&&(d[a]={})}),"function"==typeof a&&a()})},this.getData=function(b){var e=b;"string"==typeof e&&(e=[e]);var f={};if(e.forEach(function(b){var e=b.split("/")[0],g=b.split("/")[1],h=null,i=null;switch(e){case"u":i=d.utility;break;case"b":i=d.behaviour;break;case"a":i=d.appearance}if(null!==i&&(void 0===i[g]?"rememberState"===g&&void 0!==i.rememberScroll?h=!1===i.rememberScroll?"openStates":"all":void 0!==c[e]&&void 0!==c[e][g]&&(h=c[e][g]):h=i[g]),"a/styles"===b&&(h=Object.assign({},c.a.styles,h),a.helper.font&&a.helper.font.isLoaded())){var j=a.helper.font.getFontInfo();h.fontFamily=j.name,Object.assign(h,j.fontWeights)}"a/showIndicator"===b&&!0===h&&void 0!==d.behaviour.openAction&&"mousemove"===d.behaviour.openAction&&(h=!1),f[g]=h}),"string"==typeof b){var g=b.split("/")[1];f=f[g]}return f},this.setData=function(a,c){b.init(function(){Object.keys(a).forEach(function(b){var c=b.split("/")[0],e=b.split("/")[1],f=a[b];switch(c){case"u":d.utility[e]=f,d.utility;break;case"b":d.behaviour[e]=f;break;case"a":d.appearance[e]=f}});try{chrome.storage.sync.set(d,function(){"function"==typeof c&&c()})}catch(a){"function"==typeof c&&c()}})},this.call=function(a,b,c){"function"==typeof b&&(c=b,b={}),b.type=a,chrome.extension.sendMessage(b,function(a){"function"==typeof c&&c(a)})}},window.OverlayHelper=function(a){var b={};this.create=function(d,e,l){switch(b.overlay=c("<iframe />").attr("id",a.opts.ids.page.overlay).appendTo("body"),a.helper.stylesheet.addStylesheets(["overlay"],b.overlay),b.modal=c("<div />").attr(a.opts.attr.type,d).addClass(a.opts.classes.overlay.modal).appendTo(b.overlay.find("body")),b.modal.append("<h1>"+e+"</h1>"),c("<a />").addClass(a.opts.classes.overlay.close).appendTo(b.modal),b.buttonWrapper=c("<menu />").addClass(a.opts.classes.overlay.buttonWrapper).appendTo(b.modal),c("<a />").addClass(a.opts.classes.overlay.close).text(a.helper.i18n.get("overlay_"+("infos"===d?"close":"cancel"))).appendTo(b.buttonWrapper),d){case"delete":f(l);break;case"edit":g(l);break;case"infos":k(l);break;case"add":j(l);break;case"hide":i(l);break;case"openChildren":h(l);break;case"updateUrls":m(l)}u(l),setTimeout(function(){b.modal.addClass(a.opts.classes.overlay.visible),b.overlay.addClass(a.opts.classes.page.visible)},100)};var d=function(){a.helper.model.call("realUrl",{abort:!0}),a.elements.bookmarkBox.all.find("li."+a.opts.classes.drag.isDragged).remove(),b.overlay.removeClass(a.opts.classes.page.visible),setTimeout(function(){a.helper.scroll.updateAll(!0,!1)},100),setTimeout(function(){b.overlay.remove()},500)},e=function(d,e){var f=c("<"+(d.isDir?"span":"a")+" />").attr("title",d.title+(d.url?"\n"+d.url:"")).addClass(a.opts.classes.overlay.preview).html(d.title).appendTo(b.modal);d.isDir?f.prepend("<span class='"+a.opts.classes.sidebar.dirIcon+"' />"):d.icon?f.prepend("<img src='"+d.icon+"' />"):a.opts.demoMode&&f.prepend("<span class='"+a.opts.classes.sidebar.dirIcon+"' data-color='"+(Math.floor(10*Math.random())+1)+"' />"),e&&!0===e&&!0!==d.isDir&&c("<a />").addClass(a.opts.classes.overlay.previewUrl).attr("title",d.url).text(d.url).insertAfter(f)},f=function(d){c("<p />").text(a.helper.i18n.get("overlay_delete_"+(d.isDir?"dir":"bookmark")+"_confirm")).appendTo(b.modal),e(d),c("<a />").addClass(a.opts.classes.overlay.action).text(a.helper.i18n.get("overlay_delete")).appendTo(b.buttonWrapper)},g=function(d){e(d);var f=c("<ul />").appendTo(b.modal);f.append("<li><label>"+a.helper.i18n.get("overlay_bookmark_title")+"</label><input type='text' name='title' value='"+d.title+"' /></li>"),d.isDir||f.append("<li><label>"+a.helper.i18n.get("overlay_bookmark_url")+"</label><input type='text' name='url' value='"+d.url+"' /></li>"),c("<a />").addClass(a.opts.classes.overlay.action).text(a.helper.i18n.get("overlay_save")).appendTo(b.buttonWrapper)},h=function(d){var f=d.children.filter(function(a){return!!a.url}),g=a.helper.i18n.get("overlay_confirm_open_children",[f.length]);c("<p />").text(g).appendTo(b.modal),e(d),c("<a />").addClass(a.opts.classes.overlay.action).text(a.helper.i18n.get("overlay_open_children")).appendTo(b.buttonWrapper)},i=function(d){c("<p />").text(a.helper.i18n.get("overlay_hide_"+(d.isDir?"dir":"bookmark")+"_confirm")).appendTo(b.modal),e(d),c("<a />").addClass(a.opts.classes.overlay.action).text(a.helper.i18n.get("overlay_hide_from_sidebar")).appendTo(b.buttonWrapper)},j=function(d){var e=c("<a />").addClass(a.opts.classes.overlay.action).text(a.helper.i18n.get("overlay_save")).appendTo(b.buttonWrapper),f=c("<menu />").appendTo(b.modal),g=c("<a />").attr(a.opts.attr.type,"bookmark").attr("title",a.helper.i18n.get("overlay_label_bookmark")).appendTo(f);c("<a />").attr(a.opts.attr.type,"dir").attr("title",a.helper.i18n.get("overlay_label_dir")).appendTo(f),f.children("a").on("click",function(g){g.preventDefault();var h=c(g.currentTarget).attr(a.opts.attr.type),i=c("<ul />").appendTo(b.modal),j=d&&d.values&&d.values.title?d.values.title:"",k=d&&d.values&&d.values.url?d.values.url:"";i.append("<li><h2>"+c(g.currentTarget).attr("title")+"</h2></li>"),i.append("<li><label>"+a.helper.i18n.get("overlay_bookmark_title")+"</label><input type='text' name='title' value='"+j+"' /></li>"),"bookmark"===h&&i.append("<li><label>"+a.helper.i18n.get("overlay_bookmark_url")+"</label><input type='text' name='url' value='"+k+"'  /></li>"),f.addClass(a.opts.classes.sidebar.hidden),setTimeout(function(){i.addClass(a.opts.classes.overlay.visible),e.addClass(a.opts.classes.overlay.visible)},d&&d.values?0:100)}),d&&d.values&&g.trigger("click")},k=function(d){e(d,!0);var f=c("<ul />").appendTo(b.modal),g=new Date(d.dateAdded);if(c("<li />").html(a.helper.i18n.get("overlay_bookmark_created_date")+" "+a.helper.i18n.getLocaleDate(g)).appendTo(f),d.isDir){var h=c("<li />").addClass(a.opts.classes.overlay.hasTooltip).append("<span>"+d.childrenAmount.total+"</span>").append(" "+a.helper.i18n.get("overlay_dir_children"),!1).appendTo(f);c("<ul />").append("<li>"+d.childrenAmount.bookmarks+" "+a.helper.i18n.get("overlay_dir_children_bookmarks")+"</li>").append("<li>"+d.childrenAmount.directories+" "+a.helper.i18n.get("overlay_dir_children_dirs")+"</li>").appendTo(h)}var i=c("<li />").addClass(a.opts.classes.overlay.hasTooltip).append("<span>"+d.views.total+"</span>").append(" "+a.helper.i18n.get("overlay_bookmark_views"+(1===d.views.total?"_single":"")),!1).appendTo(f);c("<ul />").append("<li>"+a.helper.i18n.get("overlay_bookmark_views_since")+" "+a.helper.i18n.getLocaleDate(d.views.startDate)+"</li>").append("<li>"+d.views.perMonth+" "+a.helper.i18n.get("overlay_bookmark_views"+(1===d.views.perMonth?"_single":""))+" "+a.helper.i18n.get("overlay_bookmark_views_per_month")+"</li>").appendTo(i)},l=function(d){var e=d.length>0;setTimeout(function(){b.desc.remove(),b.progressBar.remove(),b.progressLabel.remove(),e&&b.modal.addClass(a.opts.classes.overlay.urlCheckList),setTimeout(function(){if(b.loader.remove(),b.modal.removeClass(a.opts.classes.overlay.urlCheckLoading),b.buttonWrapper.children("a."+a.opts.classes.overlay.close).text(a.helper.i18n.get("overlay_close")),0===d.length)c("<p />").addClass(a.opts.classes.overlay.success).text(a.helper.i18n.get("overlay_check_urls_no_results")).appendTo(b.modal);else{c("<a />").addClass(a.opts.classes.overlay.action).text(a.helper.i18n.get("overlay_update")).appendTo(b.buttonWrapper);var e=a.helper.scroll.add(a.opts.ids.overlay.urlList,c("<ul />").appendTo(b.modal)),f=b.overlay.find("body");d.forEach(function(b){var d=c("<li />").data("entry",b).append(a.helper.checkbox.get(f,{checked:"checked"})).append("<strong>"+b.title+"</strong>");c("<a />").attr({href:b.url,title:b.url,target:"_blank"}).html("<span>"+b.url+"</span>").appendTo(d),404===b.urlStatusCode?c("<span />").text(a.helper.i18n.get("overlay_check_urls_not_found")).appendTo(d):b.newUrl!==b.url&&c("<a />").attr({href:b.newUrl,title:b.newUrl,target:"_blank"}).html("<span>"+b.newUrl+"</span>").appendTo(d),d=d.appendTo(e.children("ul")),a.helper.model.call("favicon",{url:b.url},function(b){b.img&&c("<img src='"+b.img+"' />").insertAfter(d.children("div."+a.opts.classes.checkbox.box))})}),a.helper.scroll.update(e)}},e?1e3:0)},1e3)},m=function(d){var e=[];!function a(b){b.forEach(function(b){b.url?e.push(b):b.children&&a(b.children)})}(d.children);var f=e.length;b.desc=c("<p />").text(a.helper.i18n.get("overlay_check_urls_loading")).appendTo(b.modal),b.progressBar=c("<div />").addClass(a.opts.classes.overlay.progressBar).html("<div />").appendTo(b.modal),b.progressLabel=c("<span />").addClass(a.opts.classes.overlay.checkUrlProgressLabel).html("<span>0</span>/<span>"+f+"</span>").appendTo(b.modal),b.loader=a.helper.template.loading().appendTo(b.modal),setTimeout(function(){b.modal.addClass(a.opts.classes.overlay.urlCheckLoading)},500);var g=0,h=[];e.forEach(function(c){a.helper.model.call("realUrl",{url:c.url},function(a){g++,b.progressBar.children("div").css("width",g/f*100+"%"),b.progressLabel.children("span").eq(0).text(g),(404==+a.code||c.url!==a.url&&302!=+a.code)&&(c.newUrl=a.url,c.urlStatusCode=+a.code,h.push(c)),g===f&&l(h)})})},n=function(b){d(),b.children.filter(function(a){return!!a.url}).forEach(function(b){a.helper.sidebarEvents.openUrl(b,"newTab","foreground"===a.helper.model.getData("b/newTab"))})},o=function(b){a.startLoading(),d();var c=a.helper.model.getData("u/hiddenEntries");c[b.id]=!0,a.helper.model.setData({"u/hiddenEntries":c},function(){a.helper.list.updateBookmarkBox(),a.endLoading()})},p=function(b){d(),a.helper.model.call("deleteBookmark",{id:b.id},function(){b.element.parent("li").remove()})},q=function(c){var d=b.modal.find("input[name='title']").removeClass(a.opts.classes.overlay.inputError),e=b.modal.find("input[name='url']").removeClass(a.opts.classes.overlay.inputError),f={errors:!1,values:{title:d[0].value.trim(),url:c?null:e[0].value.trim()}};return 0===f.values.title.length&&(d.addClass(a.opts.classes.overlay.inputError),f.errors=!0),c||0!==f.values.url.length||(e.addClass(a.opts.classes.overlay.inputError),f.errors=!0),null!==f.values.url&&0!==f.values.url.search(/^\w+\:\/\//)&&(f.values.url="http://"+f.values.url),f},r=function(c){var e=q(c.isDir);!1===e.errors&&a.helper.model.call("updateBookmark",{id:c.id,title:e.values.title,url:e.values.url},function(f){f.error?b.modal.find("input[name='url']").addClass(a.opts.classes.overlay.inputError):(d(),c.title=e.values.title,c.url=e.values.url,c.element.children("span."+a.opts.classes.sidebar.bookmarkLabel).text(c.title))})},s=function(c){var e=q(0===b.modal.find("input[name='url']").length());if(!1===e.errors){var f={title:e.values.title,url:e.values.url,parentId:c.id||null,index:0};c&&c.values&&(c.values.index&&(f.index=c.values.index),c.values.parentId&&(f.parentId=c.values.parentId)),a.helper.model.call("createBookmark",f,function(c){c.error?b.modal.find("input[name='url']").addClass(a.opts.classes.overlay.inputError):(a.helper.list.updateBookmarkBox(),d())})}},t=function(){b.modal.find("div#"+a.opts.ids.overlay.urlList+" ul > li").forEach(function(b){if(c(b).find("input[type='checkbox']")[0].checked){var d=c(b).data("entry");404===d.urlStatusCode?a.helper.model.call("deleteBookmark",{id:d.id}):d.url!==d.newUrl&&a.helper.model.call("updateBookmark",{id:d.id,title:d.title,url:d.newUrl})}}),a.helper.list.updateBookmarkBox(),d()},u=function(e){b.overlay.find("body").on("click",function(a){"BODY"===a.target.tagName&&d()}),b.overlay.find("body").on("wheel",function(b){c(b.target).hasClass(a.opts.classes.scrollBox.wrapper)||0!==c(b.target).parents("."+a.opts.classes.scrollBox.wrapper).length()||(b.preventDefault(),b.stopPropagation())}),b.modal.find("a."+a.opts.classes.overlay.close).on("click",function(a){a.preventDefault(),d()}),b.modal.on("click","a."+a.opts.classes.overlay.action,function(c){switch(c.preventDefault(),b.modal.attr(a.opts.attr.type)){case"delete":p(e);break;case"hide":o(e);break;case"openChildren":n(e);break;case"edit":r(e);break;case"add":s(e);break;case"updateUrls":t()}}),b.modal.on("focus","input",function(b){c(b.currentTarget).removeClass(a.opts.classes.overlay.inputError)}),b.modal.find("a."+a.opts.classes.overlay.preview+", a."+a.opts.classes.overlay.previewUrl).on("click",function(b){b.preventDefault(),a.helper.sidebarEvents.openUrl(e,"newTab")})}},window.ScrollHelper=function(a){var b=this,d=+new Date,e={},f=[];this.add=function(d,e){var g=c("<div id='"+d+"' class='"+a.opts.classes.scrollBox.wrapper+"' />").insertBefore(e);e=e.appendTo(g);var h=c("<div class='"+a.opts.classes.scrollBox.scrollbar+"' />").html("<div />").appendTo(g);return g.data({list:e,scrollbar:h}),f.push(g),j(g),b.setScrollPos(g,0),g},this.updateAll=function(){var c=arguments.length>0&&void 0!==arguments[0]&&arguments[0],d=arguments.length>1&&void 0!==arguments[1]&&arguments[1];f.forEach(function(e){e.hasClass(a.opts.classes.sidebar.active)&&b.update(e,c,d)})},this.update=function(a){var c=arguments.length>1&&void 0!==arguments[1]&&arguments[1],d=arguments.length>2&&void 0!==arguments[2]&&arguments[2],e=a.data("scrollpos")||0;b.setScrollPos(a,e,d),c&&h(a)},this.restoreScrollPos=function(c,d){var e=a.helper.model.getData(["b/rememberState","u/scrollPos"]);"all"===e.rememberState?(b.setScrollPos(c,e.scrollPos[c.attr("id")]||0),setTimeout(function(){"function"==typeof d&&d()},100)):"function"==typeof d&&d()},this.setAllScrollPos=function(c){f.forEach(function(d){d.hasClass(a.opts.classes.sidebar.active)&&b.setScrollPos(d,c)})},this.setScrollPos=function(b,c){var d=arguments.length>2&&void 0!==arguments[2]&&arguments[2];a.helper.contextmenu.close(),b.data("list").find("a."+a.opts.classes.sidebar.hover).removeClass(a.opts.classes.sidebar.hover);var f=i(b),h=g(b);c=Math.max(0,c),f>=h?(b.addClass(a.opts.classes.scrollBox.scrolledEnd),b.data("scrollbar").addClass(a.opts.classes.scrollBox.inactive),c=0):(b.data("scrollbar").removeClass(a.opts.classes.scrollBox.inactive),c>=h-f?(c=h-f,b.addClass(a.opts.classes.scrollBox.scrolledEnd)):b.removeClass(a.opts.classes.scrollBox.scrolledEnd)),c>10?b.addClass(a.opts.classes.scrollBox.scrolled):b.removeClass(a.opts.classes.scrollBox.scrolled);var j=b.data("lastPos");c>j?b.attr(a.opts.attr.direction,"down"):c<j?b.attr(a.opts.attr.direction,"up"):b.removeAttr(a.opts.attr.direction),b.data("lastPos",c);var k=parseInt(b.data("scrollbar").css("padding-top")),l=c/h*(f-2*k)+k;b.data("scrollbar").find("> div").css({height:(f-2*k)/h*100+"%",transform:"translate3d(0,"+l+"px,0)"}),b.data("scrollpos",c),b.data("list").css("transform","translate3d(0,-"+c+"px,0)"),(h-c<2*f||h===c&&0===f)&&b.trigger(a.opts.events.scrollBoxLastPart),d?b.data("scrollbar").addClass(a.opts.classes.scrollBox.hidden):(b.data("scrollbar").removeClass(a.opts.classes.scrollBox.hidden),clearTimeout(e[b.attr("id")]),e[b.attr("id")]=setTimeout(function(){b.data("scrollbar").addClass(a.opts.classes.scrollBox.hidden)},1500))};var g=function(b){var d=0;return b.children("*:not(."+a.opts.classes.scrollBox.scrollbar+")").forEach(function(a){d+=c(a).realHeight(!0)}),d},h=function(b){if(!1===a.firstRun&&+new Date-d>500){d=+new Date;var c=a.helper.model.getData("u/scrollPos");c[b.attr("id")]=b.data("scrollpos")||0,a.helper.model.setData({"u/scrollPos":c})}},i=function(a){return a.realHeight()-parseInt(a.css("padding-top"))},j=function(d){var e=d.data("scrollbar"),f=e.children("div"),j=a.helper.model.getData("b/scrollSensitivity");d.on("wheel",function(c){c.preventDefault(),c.stopPropagation();var e=d.data("scrollpos")||0,f="mouse";Math.abs(c.wheelDelta)<60&&(f="trackpad",d.addClass(a.opts.classes.scrollBox.scrollTrackpad)),b.setScrollPos(d,e-c.wheelDelta*j[f]),h(d),d.removeClass(a.opts.classes.scrollBox.scrollTrackpad)}),f.on("mousedown",function(a){a.preventDefault(),a.stopPropagation(),c(a.currentTarget).data("startPos",a.pageY-a.currentTarget.getBoundingClientRect().top)}),d.document().on("mouseup",function(b){b.preventDefault(),b.stopPropagation(),d.removeClass(a.opts.classes.scrollBox.scrollDrag),f.removeData("startPos")}),d.document().on("mousemove",function(c){var h=f.data("startPos");if(h){d.hasClass(a.opts.classes.scrollBox.scrollDrag)||d.addClass(a.opts.classes.scrollBox.scrollDrag);var j=Math.max(0,c.pageY-e[0].getBoundingClientRect().top-h);b.setScrollPos(d,j*g(d)/i(d))}})}},window.SearchHelper=function(a){var b=this;this.init=function(){var b=a.helper.model.getData(["b/rememberSearch","u/searchValue"]);b.rememberSearch&&b.searchValue&&b.searchValue.length>0&&(a.elements.header.addClass(a.opts.classes.sidebar.searchVisible),d(b.searchValue)),g()},this.clearSearch=function(){a.helper.contextmenu.close(),a.elements.header.removeClass(a.opts.classes.sidebar.searchVisible),d("")};var d=function(){var b=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,c=a.elements.header.find("div."+a.opts.classes.sidebar.searchBox+" > input[type='text']");null===b?b=c[0].value:c[0].value=b,b&&b.length>0?e(c,b):f(c)},e=function(b,d){a.elements.bookmarkBox.all.removeClass(a.opts.classes.sidebar.active),a.elements.bookmarkBox.search.addClass(a.opts.classes.sidebar.active),d!==b.data("lastVal")&&(b.data("lastVal",d),a.helper.model.setData({"u/searchValue":d}),a.startLoading(),a.helper.scroll.setScrollPos(a.elements.bookmarkBox.search,0),a.helper.model.call("searchBookmarks",{searchVal:d},function(b){a.elements.bookmarkBox.search.children("p").remove();var d=!1,e=a.elements.bookmarkBox.search.children("ul");e.text(""),b.bookmarks&&b.bookmarks.length>0&&(d=a.helper.list.addBookmarkDir(b.bookmarks,e,!1)),!1===d&&c("<p />").text(a.helper.i18n.get("sidebar_search_no_results")).appendTo(a.elements.bookmarkBox.search),a.helper.scroll.update(a.elements.bookmarkBox.search),a.endLoading()}))},f=function(b){b.removeData("lastVal"),a.helper.model.setData({"u/searchValue":null}),a.elements.bookmarkBox.search.hasClass(a.opts.classes.sidebar.active)&&(a.startLoading(),a.elements.bookmarkBox.all.addClass(a.opts.classes.sidebar.active),a.elements.bookmarkBox.search.removeClass(a.opts.classes.sidebar.active),a.helper.scroll.restoreScrollPos(a.elements.bookmarkBox.all),a.endLoading())},g=function(){a.elements.header.on("click","a."+a.opts.classes.sidebar.search,function(b){b.preventDefault(),b.stopPropagation(),a.helper.contextmenu.close(),a.elements.header.addClass(a.opts.classes.sidebar.searchVisible),a.elements.header.find("div."+a.opts.classes.sidebar.searchBox+" > input[type='text']")[0].focus()}),a.elements.header.on("keyup","div."+a.opts.classes.sidebar.searchBox+" > input[type='text']",function(a){a.preventDefault(),d()}),a.elements.header.on("click","a."+a.opts.classes.sidebar.searchClose,function(a){a.preventDefault(),a.stopPropagation(),b.clearSearch()})}},window.SidebarEventsHelper=function(a){var d=this;this.init=function(){f(),e(),g()},this.openUrl=function(b){var c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"default",d=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];"incognito"===c?a.helper.model.call("openLink",{href:b.url,incognito:!0}):a.helper.model.call("openLink",{parentId:b.parentId,id:b.id,href:b.url,newTab:"newTab"===c,active:d})};var e=function(){c([document,a.elements.iframe[0].contentDocument]).on("keydown",function(b){a.elements.iframe.hasClass(a.opts.classes.page.visible)&&("Home"===b.key?(b.preventDefault(),a.helper.scroll.setAllScrollPos(0)):"c"===b.key&&(b.ctrlKey||b.metaKey)&&(b.preventDefault(),Object.values(a.elements.bookmarkBox).forEach(function(b){if(b.hasClass(a.opts.classes.sidebar.active)){var d=b.find("> ul a."+a.opts.classes.sidebar.hover).eq(0);if(d.length()>0){var e=a.helper.entry.getData(d.attr(a.opts.attr.id));if(e&&e.url&&a.copyToClipboard(e.url)){c(d).children("span."+a.opts.classes.sidebar.copied).remove();var f=c("<span />").addClass(a.opts.classes.sidebar.copied).text(a.helper.i18n.get("sidebar_copied_to_clipboard")).appendTo(d);setTimeout(function(){c(d).addClass(a.opts.classes.sidebar.copied),setTimeout(function(){c(d).removeClass(a.opts.classes.sidebar.copied),setTimeout(function(){f.remove()},500)},1500)},100)}}}})))})},f=function(){Object.values(a.elements.bookmarkBox).forEach(function(b){b.children("ul").on("click mousedown","a",function(b){if(b.preventDefault(),!c(b.target).hasClass(a.opts.classes.drag.trigger)&&(1===b.which&&"click"===b.type||2===b.which&&"mousedown"===b.type||a.firstRun)){var e=c(b.currentTarget),f=a.helper.entry.getData(e.attr(a.opts.attr.id));if(f.isDir&&!e.hasClass(a.opts.classes.sidebar.dirAnimated))a.helper.list.toggleBookmarkDir(e);else if(!f.isDir){var g=a.helper.model.getData(["b/newTab","b/linkAction"]),h=2===b.which||"newtab"===g.linkAction;d.openUrl(f,h?"newTab":"default",!h||"foreground"===g.newTab)}}}).on("mouseover","a",function(d){b.find("> ul a."+a.opts.classes.sidebar.hover).removeClass(a.opts.classes.sidebar.hover),c(d.currentTarget).addClass(a.opts.classes.sidebar.hover).removeClass(a.opts.classes.sidebar.mark)}).on("contextmenu","a",function(b){b.preventDefault(),a.helper.contextmenu.create("list",c(b.currentTarget))}),b.children("ul").on("mouseleave",function(b){c(b.currentTarget).find("a."+a.opts.classes.sidebar.hover).removeClass(a.opts.classes.sidebar.hover)}),b.children("div."+a.opts.classes.sidebar.filterBox).on("click","a["+a.opts.attr.direction+"]",function(b){b.preventDefault();var d=c(b.target).attr(a.opts.attr.direction),e="ASC"===d?"DESC":"ASC";a.helper.list.updateDirection(e)}).on("click","div."+a.opts.classes.checkbox.box+" + a",function(b){b.preventDefault(),c(b.target).prev("div["+a.opts.attr.name+"]").trigger("click")})})},g=function(){c(window).on("beforeunload",function(){a.elements.sidebar.hasClass(a.opts.classes.sidebar.openedOnce)&&a.helper.scroll.updateAll(!0,!0)}).on("resize",function(){a.helper.scroll.updateAll(!0)}),a.elements.iframe.find("body").on("click",function(){a.helper.contextmenu.close()}),["menu","sort"].forEach(function(b){a.elements.header.on("click contextmenu","a."+a.opts.classes.sidebar[b],function(d){d.preventDefault(),d.stopPropagation(),a.helper.contextmenu.create(b,c(d.currentTarget))})}),a.elements.iframeBody.on("click","#"+a.opts.ids.sidebar.shareUserdata+" a",function(b){b.preventDefault(),a.helper.model.call("shareUserdata",{share:c(b.currentTarget).data("accept")}),a.elements.iframeBody.find("div#"+a.opts.ids.sidebar.shareUserdata).addClass(a.opts.classes.sidebar.hidden)}),c(a.elements.iframe[0].contentDocument).on(a.opts.events.checkboxChanged,function(c){var d=c.detail.checkbox.attr(a.opts.attr.name);"viewAsTree"!==d&&"mostViewedPerMonth"!==d||a.helper.model.setData(b({},"u/"+d,c.detail.checked),function(){a.helper.list.updateBookmarkBox(!0)})})}},window.StylesheetHelper=function(a){var b={};this.init=function(){b=a.helper.model.getData("a/styles")},this.addStylesheets=function(d){
var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,f=null;null===e?f=c("html > head"):(f=e.find("head"),a.helper.font.addStylesheet(e)),d.forEach(function(a){var c=new XMLHttpRequest;c.open("GET",chrome.extension.getURL("css/"+a+".css"),!0),c.onload=function(){if(c.response){var a=c.response;Object.keys(b).forEach(function(c){a=a.replace(new RegExp('"?%'+c+'"?',"g"),b[c])}),f.append("<style>"+a+"</style>")}},c.send()})}},window.TemplateHelper=function(a){this.loading=function(){return c('<svg class="loading" width="36px" height="36px" viewBox="0 0 36 36" xmlns="http://www.w3.org/2000/svg"><circle fill="none" stroke-width="3" stroke-linecap="round" cx="18" cy="18" r="16"></circle></svg>')},this.footer=function(){var a=c('<footer> <a id="copyright" href="https://blockbyte.de/extensions" target="_blank">  &copy; <span class="created">2016</span>&ensp;<strong>Blockbyte</strong> </a></footer>'),b=+a.find("span.created").text(),d=(new Date).getFullYear();return d>b&&a.find("span.created").text(b+" - "+d),a}},window.ToggleHelper=function(a){var b=null,d=null,e={};this.init=function(){a.elements.toggle=c("<div />").attr("id",a.opts.ids.page.visual).appendTo("body");var e=a.helper.model.getData(["b/pxTolerance","a/showIndicator","a/sidebarPosition","b/openAction"]);d=e.pxTolerance,a.elements.toggle.css("width",f()+"px"),b=e.sidebarPosition,a.elements.iframe.attr(a.opts.attr.position,b),a.elements.sidebar.attr(a.opts.attr.position,b),e.showIndicator&&"icon"!==e.openAction&&a.elements.toggle.addClass(a.opts.classes.page.addVisual).attr(a.opts.attr.position,b),l(),g()};var f=function(){return d[a.isWindowed()?"windowed":"maximized"]},g=function(){c(window).on("resize",function(){a.elements.toggle.css("width",f()+"px")}),a.elements.iframe.find("body").on("click",function(c){if(c.pageX){var d=c.pageX;"right"===b&&(d=window.innerWidth-d+a.elements.sidebar.realWidth()-1),d>a.elements.sidebar.realWidth()&&a.elements.iframe.hasClass(a.opts.classes.page.visible)&&j()}}),a.elements.sidebar.on("mouseleave",function(){if(0===c("iframe#"+a.opts.ids.page.overlay).length()&&!1===a.elements.iframeBody.hasClass(a.opts.classes.drag.isDragged)&&0===a.elements.sidebar.find("."+a.opts.classes.scrollBox.scrollDrag).length()){var b=a.helper.model.getData("b/closeTimeout");e.close=setTimeout(function(){!1===a.elements.iframeBody.hasClass(a.opts.classes.drag.isDragged)&&j()},1e3*+b)}}).on("mouseenter",function(){i("close")}),c([document,a.elements.iframe[0].contentDocument]).on("keydown",function(b){"Escape"!==b.key&&"Esc"!==b.key||!a.elements.iframe.hasClass(a.opts.classes.page.visible)||(b.preventDefault(),j())}),c(document).on("visibilitychange",function(){document.hidden&&0===c("iframe#"+a.opts.ids.page.overlay).length()&&(a.elements.toggle.removeClass(a.opts.classes.page.hover),a.elements.iframe.hasClass(a.opts.classes.page.visible)&&j())}).on("mouseout",function(){i("open")}).on("mousemove dragover",function(b){h(b.pageX)?a.elements.toggle.addClass(a.opts.classes.page.hover):a.elements.toggle.removeClass(a.opts.classes.page.hover)},{passive:!0}),chrome.extension.onMessage.addListener(function(b){b&&b.action&&"toggleSidebar"===b.action&&(a.elements.iframe.hasClass(a.opts.classes.page.visible)?j():k())});var d=a.helper.model.getData("b/openAction"),g=a.helper.model.getData("b/openDelay");"icon"!==d&&c(document).on(d+" dragover",function(a){a.isTrusted&&("dragover"===a.type||"mousedown"!==d||0===a.button)&&h(a.pageX)?(a.stopPropagation(),a.preventDefault(),"mousemove"===d?e.open||(e.open=setTimeout(function(){k()},1e3*+g)):k()):i("open")})},h=function(a){return void 0!==a&&null!==a&&("right"===b&&(a=window.innerWidth-a-1),a<f())},i=function(a){e[a]&&(clearTimeout(e[a]),e[a]=null)},j=function(){i("close"),i("open"),a.helper.contextmenu.close(),a.elements.iframe.removeClass(a.opts.classes.page.visible),c(document).trigger("mousemove")},k=function(){a.helper.model.call("shareUserdataMask",function(b){b&&b.showMask?a.addShareUserdataMask():a.elements.sidebar.find("#"+a.opts.ids.sidebar.shareUserdata).remove()}),a.elements.iframe.addClass(a.opts.classes.page.visible),a.elements.sidebar.addClass(a.opts.classes.sidebar.openedOnce),a.helper.scroll.updateAll(!1,!0),a.initImages(),c(document).trigger("mousemove")},l=function(){c(a.opts.leftsideBackSelector).length()>0?a.elements.toggle.addClass(a.opts.classes.page.hasLeftsideBack):c(document).on(a.opts.events.lsbLoaded,function(b){b.detail.addVisual&&a.elements.toggle.addClass(a.opts.classes.page.hasLeftsideBack)})}},window.ext=function(a){var b=this,d={};this.firstRun=!0,this.elements={},this.opts=a,this.run=function(){e(),b.helper.model.init(function(){b.helper.i18n.init(function(){b.helper.font.init(),b.helper.stylesheet.init(),f(),b.helper.list.init(),b.helper.toggle.init(),b.helper.sidebarEvents.init(),b.helper.dragndrop.init(),""===document.referrer&&b.helper.model.call("addViewAmount",{url:location.href})})})},this.isWindowed=function(){return 0!==window.screenX||0!==window.screenY||window.screen.availWidth!==window.innerWidth},this.loaded=function(){var c=b.helper.model.getData(["b/pxTolerance","a/showIndicator"]);b.elements.iframeBody.addClass(a.classes.sidebar.extLoaded),document.dispatchEvent(new CustomEvent(a.events.loaded,{detail:{pxTolerance:c.pxTolerance,showIndicator:c.showIndicator},bubbles:!0,cancelable:!1}))},this.startLoading=function(){b.elements.sidebar.addClass(a.classes.sidebar.loading),d.timeout&&clearTimeout(d.timeout),void 0!==d.loader&&0!==d.loader.length()||(d.loader=b.helper.template.loading().appendTo(b.elements.sidebar))},this.endLoading=function(){var c=arguments.length>0&&void 0!==arguments[0]?arguments[0]:500;d.timeout=setTimeout(function(){b.elements.sidebar.removeClass(a.classes.sidebar.loading),d.loader&&d.loader.remove(),d={}},c)},this.copyToClipboard=function(a){var d=c("<textarea />").text(a).appendTo(b.elements.iframeBody);d[0].select();var e=!1;try{e=b.elements.iframe[0].contentDocument.execCommand("copy")}catch(a){}return d.remove(),e},this.initImages=function(){b.elements.iframe.hasClass(b.opts.classes.page.visible)&&b.elements.sidebar.find("img["+a.attr.src+"]").forEach(function(b){var d=c(b),e=d.attr(a.attr.src);d.removeAttr(a.attr.src),d.attr("src",e)})},this.addShareUserdataMask=function(){b.elements.sidebar.find("#"+a.ids.sidebar.shareUserdata).remove();var d=c("<div />").attr("id",a.ids.sidebar.shareUserdata).prependTo(b.elements.sidebar),e=c("<div />").prependTo(d);c("<h2 />").html(b.helper.i18n.get("share_userdata_headline")).appendTo(e),c("<p />").html(b.helper.i18n.get("share_userdata_desc")).appendTo(e),c("<p />").html(b.helper.i18n.get("share_userdata_desc2")).appendTo(e),c("<p />").addClass(a.classes.sidebar.shareUserdataNotice).html(b.helper.i18n.get("share_userdata_notice")).appendTo(e),c("<a />").data("accept",!0).html(b.helper.i18n.get("share_userdata_accept")).appendTo(e),c("<a />").data("accept",!1).html(b.helper.i18n.get("share_userdata_decline")).appendTo(e)};var e=function(){b.helper={model:new window.ModelHelper(b),toggle:new window.ToggleHelper(b),entry:new window.EntryHelper(b),list:new window.ListHelper(b),scroll:new window.ScrollHelper(b),template:new window.TemplateHelper(b),i18n:new window.I18nHelper(b),font:new window.FontHelper(b),sidebarEvents:new window.SidebarEventsHelper(b),search:new window.SearchHelper(b),stylesheet:new window.StylesheetHelper(b),dragndrop:new window.DragDropHelper(b),checkbox:new window.CheckboxHelper(b),overlay:new window.OverlayHelper(b),contextmenu:new window.ContextmenuHelper(b)}},f=function(){b.helper.stylesheet.addStylesheets(["content"]),b.elements.iframe=c('<iframe id="'+a.ids.page.iframe+'" />').appendTo("body"),b.elements.iframeBody=b.elements.iframe.find("body"),b.elements.sidebar=c('<section id="'+a.ids.sidebar.sidebar+'" />').appendTo(b.elements.iframeBody),b.elements.bookmarkBox={},["all","search"].forEach(function(d){b.elements.bookmarkBox[d]=b.helper.scroll.add(a.ids.sidebar.bookmarkBox[d],c("<ul />").appendTo(b.elements.sidebar)),c("<div />").addClass(a.classes.sidebar.filterBox).prependTo(b.elements.bookmarkBox[d])}),b.elements.iframeBody.attr(a.attr.dragCancel,b.helper.i18n.get("sidebar_drag_cancel")),b.elements.header=c("<header />").prependTo(b.elements.sidebar),b.helper.stylesheet.addStylesheets(["sidebar"],b.elements.iframe);var d=b.helper.model.getData(["u/entriesLocked","u/showHidden"]);!1===d.entriesLocked&&b.elements.sidebar.addClass(a.classes.sidebar.entriesUnlocked),!0===d.showHidden&&b.elements.sidebar.addClass(a.classes.sidebar.showHidden)}};var e={ids:{page:{iframe:"blockbyte-bs-sidebar",overlay:"blockbyte-bs-overlay",visual:"blockbyte-bs-visual"},sidebar:{sidebar:"sidebar",shareUserdata:"shareUserdata",bookmarkBox:{all:"bookmarkBox",search:"bookmarkBoxSearch"}},overlay:{urlList:"urlList"}},classes:{page:{addVisual:"blockbyte-bs-add-visual",visible:"blockbyte-bs-visible",hover:"blockbyte-bs-hover",hasLeftsideBack:"blockbyte-bs-has-lsb"},sidebar:{extLoaded:"loaded",openedOnce:"openedOnce",active:"active",mark:"mark",hideRoot:"hideRoot",entriesUnlocked:"entriesUnlocked",showHidden:"showHidden",dirAnimated:"animated",dirOpened:"opened",bookmarkDir:"dir",dirIcon:"icon",bookmarkLink:"link",bookmarkLabel:"label",menu:"menu",sort:"sort",hidden:"hidden",hover:"hover",loading:"loading",copied:"copied",filterBox:"filter",search:"search",searchBox:"searchBox",searchClose:"searchClose",searchVisible:"searchVisible",shareUserdataNotice:"shareNotice"},contextmenu:{wrapper:"contextmenu",top:"top",visible:"visible",list:"list",icons:"icons",right:"right",separator:"separator"},drag:{trigger:"drag",helper:"dragHelper",isDragged:"isDragged",cancel:"dragCancel",snap:"snap",dragInitial:"dragInitial"},scrollBox:{wrapper:"scrollBox",scrollbar:"scrollbar",inactive:"inactive",hidden:"hidden",scrolled:"scrolled",scrolledEnd:"scrolledEnd",scrollDrag:"scrollDrag",scrollTrackpad:"scrollTrackpad"},checkbox:{box:"checkbox",active:"active",clicked:"clicked",focus:"focus"},overlay:{modal:"modal",visible:"visible",preview:"preview",previewUrl:"previewUrl",action:"action",close:"close",hasTooltip:"tooltip",inputError:"error",success:"success",progressBar:"progressBar",buttonWrapper:"buttons",checkUrlProgressLabel:"progressLabel",urlCheckLoading:"urlCheckLoading",urlCheckList:"urlCheckList"}},attr:{src:"data-src",position:"data-pos",type:"data-type",name:"data-name",value:"data-value",sort:"data-sort",direction:"data-direction",dragCancel:"data-dragCancel",id:"data-id"},events:{loaded:"blockbyte-bs-loaded",checkboxChanged:"blockbyte-bs-checkboxChanged",scrollBoxLastPart:"blockbyte-bs-scrollBoxLastPart",lsbLoaded:"blockbyte-lsb-loaded"},leftsideBackSelector:"div#blockbyte-lsb-main.blockbyte-lsb-add-visual",fontHref:"https://fonts.googleapis.com/css?family=Roboto:100,200,300,400,500,100i,200i,300i,400i,500i",manifest:chrome.runtime.getManifest(),demoMode:!1};new window.ext(e).run()}(jsu);