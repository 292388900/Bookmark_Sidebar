/*! (c) Philipp KÃ¶nig under GPL-3.0 */
(e=>{"use strict";window.CheckboxHelper=function(t){let a={};this.get=((a,s,l="checkbox")=>{let o=e("<div />").html("<input type='checkbox' />").data("uid",Math.random().toString(36).substr(2,12)).attr(t.opts.attr.type,l).addClass(t.opts.classes.checkbox.box);return void 0!==s&&(o.children("input[type='checkbox']").attr(s),s[t.opts.attr.name]&&o.attr(t.opts.attr.name,s[t.opts.attr.name])),this.isChecked(o)&&o.addClass(t.opts.classes.checkbox.active),r(o,a),o}),this.isChecked=(e=>e.find("input[type='checkbox']")[0].checked);let s=(e,a)=>{let s=e.children("input[type='checkbox']");s.trigger("change"),t.opts.events&&t.opts.events.checkboxChanged&&t.helper.utility.triggerEvent("checkboxChanged",{container:e,checkbox:s,checked:e.hasClass(t.opts.classes.checkbox.active)},a.document()[0])},l=(r,o)=>{r.addClass(t.opts.classes.checkbox.clicked),r.removeClass(t.opts.classes.checkbox.focus),r.toggleClass(t.opts.classes.checkbox.active);let i=r.hasClass(t.opts.classes.checkbox.active),n=r.children("input[type='checkbox']");if("radio"===r.attr(t.opts.attr.type)&&r.attr(t.opts.attr.name))if(o){let a=r.attr(t.opts.attr.name);r.addClass(t.opts.classes.checkbox.active),i&&(n.attr("checked",!0),s(r,o)),o.find("div."+t.opts.classes.checkbox.box+"["+t.opts.attr.type+"='radio']["+t.opts.attr.name+"='"+a+"']").forEach(t=>{let a=e(t);t!==r[0]&&this.isChecked(a)&&l(a)})}else n.attr("checked",!1);else n.attr("checked",i),s(r,o);let d=r.data("uid");a[d]&&clearTimeout(a[d]),a[d]=setTimeout(()=>{r.removeClass(t.opts.classes.checkbox.clicked)},300)},r=(a,s)=>{a.on("mousedown",a=>{a.preventDefault(),a.stopPropagation(),e(a.currentTarget).addClass(t.opts.classes.checkbox.focus)}).on("click",t=>{t.preventDefault(),t.stopPropagation(),l(e(t.currentTarget),s)}),s.on("click",()=>{a.removeClass(t.opts.classes.checkbox.focus)})}},window.ContextmenuHelper=function(t){this.create=((i,d)=>{if(t.helper.tooltip.close(),!1===a(i,d)){this.close(),d.addClass(t.opts.classes.sidebar.active);let a=e("<div />").addClass(t.opts.classes.contextmenu.wrapper).html("<ul class='"+t.opts.classes.contextmenu.list+"'></ul><ul class='"+t.opts.classes.contextmenu.icons+"'></ul>").attr(t.opts.attr.type,i).data("elm",d).appendTo(t.elements.sidebar),p=i,c=d.attr(t.opts.attr.id);switch(c&&a.attr(t.opts.attr.id,c),i){case"list":o(a,d),p=t.helper.entry.getData(c).isDir?"directory":"bookmark";break;case"separator":r(a,d);break;case"menu":l(a,d);break;case"sort":s(a,d)}t.helper.model.call("trackEvent",{category:"contextmenu",action:"open",label:p}),n(a),e.delay().then(()=>{a.addClass(t.opts.classes.contextmenu.visible);let e=parseInt(a.css("top")),s=a.realHeight();e+s>=window.innerHeight&&a.css("top",e-s).addClass(t.opts.classes.contextmenu.top)})}}),this.close=(()=>{let a=t.elements.iframeBody.find("div."+t.opts.classes.contextmenu.wrapper);a.forEach(a=>{e(a).removeClass(t.opts.classes.contextmenu.visible),e(a).data("elm").removeClass(t.opts.classes.sidebar.active)}),e.delay(500).then(()=>{a.remove()})});let a=(e,a)=>{let s=a.attr(t.opts.attr.id),l=a.attr(t.opts.attr.value),r="div."+t.opts.classes.contextmenu.wrapper+"["+t.opts.attr.type+"='"+e+"']";return s?r+="["+t.opts.attr.id+"='"+s+"']":l&&(r+="["+t.opts.attr.value+"='"+l+"']"),t.elements.sidebar.find(r).length()>0},s=(a,s)=>{let l=t.helper.list.getSortList(),r=t.helper.list.getSort(),o=a.children("ul."+t.opts.classes.contextmenu.list);a.children("ul."+t.opts.classes.contextmenu.icons).remove(),Object.keys(l).forEach(s=>{let l=s.replace(/([A-Z])/g,"_$1").toLowerCase();e("<li />").append(t.helper.checkbox.get(t.elements.iframeBody,{[t.opts.attr.name]:"sort",[t.opts.attr.value]:s},"radio")).append("<a "+t.opts.attr.name+"='sort'>"+t.helper.i18n.get("sort_label_"+l)+"</a>").appendTo(o),s===r.name&&a.find("input["+t.opts.attr.name+"='sort']["+t.opts.attr.value+"='"+s+"']").parent("div."+t.opts.classes.checkbox.box).trigger("click")});let i=s[0].getBoundingClientRect();a.css("top",i.top+i.height+"px")},l=(a,s)=>{let l=a.children("ul."+t.opts.classes.contextmenu.list),r=a.children("ul."+t.opts.classes.contextmenu.icons);"custom"===t.helper.list.getSort().name&&(e("<li />").append(t.helper.checkbox.get(t.elements.iframeBody,{[t.opts.attr.name]:"toggleFix"})).append("<a "+t.opts.attr.name+"='toggleFix'>"+t.helper.i18n.get("contextmenu_toggle_fix")+"</a>").appendTo(l),!1===t.elements.sidebar.hasClass(t.opts.classes.sidebar.entriesUnlocked)&&a.find("input["+t.opts.attr.name+"='toggleFix']").parent("div."+t.opts.classes.checkbox.box).trigger("click")),e("<li />").append(t.helper.checkbox.get(t.elements.iframeBody,{[t.opts.attr.name]:"toggleHidden"})).append("<a "+t.opts.attr.name+"='toggleHidden'>"+t.helper.i18n.get("contextmenu_toggle_hidden")+"</a>").appendTo(l),t.helper.model.getData("u/showHidden")&&a.find("input["+t.opts.attr.name+"='toggleHidden']").parent("div."+t.opts.classes.checkbox.box).trigger("click"),r.append("<li><a "+t.opts.attr.name+"='settings' title='"+t.helper.i18n.get("settings_title")+"'></a></li>").append("<li><a "+t.opts.attr.name+"='bookmarkManager' title='"+t.helper.i18n.get("contextmenu_bookmark_manager")+"'></a></li>");let o=s[0].getBoundingClientRect();a.css("top",o.top+o.height+"px")},r=(a,s)=>{let l=s.parent("li");a.css({top:s[0].getBoundingClientRect().top+s.realHeight()+"px",left:l[0].offsetLeft+"px"});let r=e("<li />").appendTo(a.children("ul."+t.opts.classes.contextmenu.list));a.children("ul."+t.opts.classes.contextmenu.icons).remove(),e("<a />").attr(t.opts.attr.name,"deleteSeparator").text(t.helper.i18n.get("contextmenu_delete_separator")).data("infos",{id:l.parent("ul").prev("a").attr(t.opts.attr.id),index:l.prevAll("li").length()}).appendTo(r)},o=(a,s)=>{let l=s.attr(t.opts.attr.id),r=t.helper.entry.getData(l);a.css({top:s[0].getBoundingClientRect().top+s.realHeight()+"px",left:s.parent("li")[0].offsetLeft+"px"});let o=r.isDir?"_dir":"_bookmark",i=a.children("ul."+t.opts.classes.contextmenu.list),n=a.children("ul."+t.opts.classes.contextmenu.icons),d=t.elements.bookmarkBox.search.hasClass(t.opts.classes.sidebar.active);r.isDir?(r.children.filter(e=>!!e.url).length>0&&i.append("<li><a "+t.opts.attr.name+"='openChildren'>"+t.helper.i18n.get("contextmenu_open_children")+"</a></li>"),r.children.length>0&&i.append("<li><a "+t.opts.attr.name+"='updateUrls'>"+t.helper.i18n.get("contextmenu_update_urls")+"</a></li>")):(d&&i.append("<li><a "+t.opts.attr.name+"='showInDir'>"+t.helper.i18n.get("contextmenu_show_in_dir")+"</a></li>"),i.append("<li><a "+t.opts.attr.name+"='newTab'>"+t.helper.i18n.get("contextmenu_new_tab")+"</a></li>"),!1===e.api.extension.inIncognitoContext&&i.append("<li><a "+t.opts.attr.name+"='newTabIncognito'>"+t.helper.i18n.get("contextmenu_new_tab_incognito")+"</a></li>")),n.append("<li><a "+t.opts.attr.name+"='infos' title='"+t.helper.i18n.get("contextmenu_infos")+"'></a></li>"),r.parents.length>0&&n.append("<li><a "+t.opts.attr.name+"='edit' title='"+t.helper.i18n.get("contextmenu_edit"+o)+"'></a></li>").append("<li><a "+t.opts.attr.name+"='delete' title='"+t.helper.i18n.get("contextmenu_delete"+o)+"'></a></li>"),r.isDir?n.append("<li><a "+t.opts.attr.name+"='add' title='"+t.helper.i18n.get("contextmenu_add")+"'></a></li>"):r.pinned?n.append("<li><a "+t.opts.attr.name+"='unpin' title='"+t.helper.i18n.get("contextmenu_unpin")+"'></a></li>"):n.append("<li><a "+t.opts.attr.name+"='pin' title='"+t.helper.i18n.get("contextmenu_pin")+"'></a></li>"),t.helper.entry.isVisible(l)?n.append("<li class='"+t.opts.classes.contextmenu.right+"'><a "+t.opts.attr.name+"='hide' title='"+t.helper.i18n.get("contextmenu_hide_from_sidebar")+"'></a></li>"):!d&&s.parents("li."+t.opts.classes.sidebar.hidden).length()<=1&&n.append("<li class='"+t.opts.classes.contextmenu.right+"'><a "+t.opts.attr.name+"='show' title='"+t.helper.i18n.get("contextmenu_show_in_sidebar")+"'></a></li>")},i=a=>{a.find("input["+t.opts.attr.name+"='sort']").on("change",a=>{if(a.currentTarget.checked){let s=e(a.currentTarget).attr(t.opts.attr.value);t.helper.list.updateSort(s),this.close()}})},n=a=>{i(a),a.find("input["+t.opts.attr.name+"='toggleFix']").on("change",()=>{t.elements.sidebar.toggleClass(t.opts.classes.sidebar.entriesUnlocked),t.helper.model.setData({"u/entriesLocked":!1===t.elements.sidebar.hasClass(t.opts.classes.sidebar.entriesUnlocked)}),this.close()}),a.find("input["+t.opts.attr.name+"='toggleHidden']").on("change",a=>{t.startLoading(),Promise.all([t.helper.model.call("removeCache",{name:"html"}),t.helper.model.setData({"u/showHidden":t.helper.checkbox.isChecked(e(a.currentTarget).parent("div"))})]).then(()=>{t.helper.model.call("reload",{type:"ToggleHidden"})}),this.close()}),a.on("mouseleave",a=>{e(a.currentTarget).find("a").removeClass(t.opts.classes.sidebar.hover)}),a.find("a").on("mouseenter",s=>{a.find("a").removeClass(t.opts.classes.sidebar.hover),e(s.currentTarget).addClass(t.opts.classes.sidebar.hover)}).on("mouseleave",a=>{e(a.currentTarget).removeClass(t.opts.classes.sidebar.hover)}).on("click",s=>{s.preventDefault();let l=e(s.currentTarget).attr(t.opts.attr.name),r=a.attr(t.opts.attr.id),o=r?t.helper.entry.getData(r):null;switch(l){case"settings":t.helper.model.call("openLink",{href:e.api.extension.getURL("html/settings.html"),newTab:!0});break;case"sort":case"toggleFix":case"toggleHidden":s.stopPropagation(),e(s.currentTarget).prev("div."+t.opts.classes.checkbox.box).trigger("click");break;case"bookmarkManager":t.helper.model.call("openLink",{href:"chrome://bookmarks",newTab:!0,active:!0});break;case"newTabIncognito":t.helper.model.call("trackEvent",{category:"url",action:"open",label:"new_window_incognito"}),t.helper.utility.openUrl(o,"incognito");break;case"newTab":t.helper.model.call("trackEvent",{category:"url",action:"open",label:"new_tab_contextmenu"}),t.helper.utility.openUrl(o,"newTab","foreground"===t.helper.model.getData("b/newTab"));break;case"deleteSeparator":t.helper.specialEntry.removeSeparator(e(s.currentTarget).data("infos")).then(()=>{t.helper.model.call("reload",{type:"Separator"})});break;case"show":{t.startLoading();let e=t.helper.model.getData("u/hiddenEntries");delete e[r],t.helper.model.setData({"u/hiddenEntries":e}).then(()=>Promise.all([t.helper.model.call("removeCache",{name:"html"}),t.helper.model.call("updateEntries")])).then(()=>{t.helper.model.call("reload",{type:"Hide"})});break}case"openChildren":{let a=o.children.filter(e=>!!e.url);a.length>t.helper.model.getData("b/openChildrenWarnLimit")?t.helper.overlay.create(l,e(s.currentTarget).attr("title")||e(s.currentTarget).text(),o):t.helper.utility.openAllBookmarks(a,"foreground"===t.helper.model.getData("b/newTab"));break}case"pin":t.helper.specialEntry.pinEntry(o).then(()=>{t.helper.model.call("reload",{type:"Pin"})});break;case"unpin":t.helper.specialEntry.unpinEntry(o).then(()=>{t.helper.model.call("reload",{type:"Unpin"})});break;case"showInDir":{let e=t.helper.entry.getData(r);if(e&&e.parents){let a=s=>{if(e.parents[s]){let l=t.elements.bookmarkBox.all.find("ul > li > a."+t.opts.classes.sidebar.bookmarkDir+"["+t.opts.attr.id+"='"+e.parents[s]+"']");l.hasClass(t.opts.classes.sidebar.dirOpened)?a(s+1):t.helper.list.toggleBookmarkDir(l,!0,!1).then(()=>{a(s+1)})}else Promise.all([t.helper.list.cacheList(),t.helper.search.clearSearch()]).then(()=>{let e=t.elements.bookmarkBox.all.find("ul > li > a["+t.opts.attr.id+"='"+r+"']");t.helper.scroll.setScrollPos(t.elements.bookmarkBox.all,e[0].offsetTop-50),e.addClass(t.opts.classes.sidebar.mark)})};a(0)}break}default:t.helper.overlay.create(l,e(s.currentTarget).attr("title")||e(s.currentTarget).text(),o)}})}},window.DragDropHelper=function(t){let a=null,s=null,l=0,r=null,o={running:!1,posY:null,previousDelta:0,fpsLimit:30};this.init=(async()=>{a=t.helper.model.getData("b/sidebarPosition"),k(),n()});let i=e=>{let s=0;return s="object"==typeof e?e[0].getBoundingClientRect().left:+e,"right"===a&&(s=window.innerWidth-s),"object"==typeof e?.6*e.realWidth()+s>t.elements.sidebar.realWidth():s>t.elements.sidebar.realWidth()},n=async()=>{t.elements.iframeBody.on("dragenter",()=>{t.helper.contextmenu.close(),t.helper.tooltip.close(),t.elements.iframeBody.addClass(t.opts.classes.drag.isDragged),t.elements.iframe.removeClass(t.opts.classes.page.hideMask),p("selection"),o.running||window.requestAnimationFrame(m)}).on("drop dragend",a=>{if(a.preventDefault(),a.stopPropagation(),o.posY=null,t.elements.iframeBody.hasClass(t.opts.classes.drag.isDragged)){if(i(a.pageX))c("selection",!0);else{let s=t.elements.bookmarkBox.all.find("li."+t.opts.classes.drag.isDragged).eq(0);if(s&&s.length()>0){let l=a.dataTransfer.getData("URL"),r="";location.href===l&&(r=e(document).find("title").text()),c("selection"),t.helper.overlay.create("add",t.helper.i18n.get("contextmenu_add"),{values:{index:s.prevAll("li").length(),parentId:s.parent("ul").prev("a").attr(t.opts.attr.id),title:r,url:l}})}}t.elements.iframeBody.removeClass(t.opts.classes.drag.isDragged),!1===t.helper.utility.sidebarHasMask()&&t.elements.iframe.addClass(t.opts.classes.page.hideMask)}})},d=e=>{let a="bookmark";return"selection"===e?a=e:e.data("type")?a=e.data("type"):(e.hasClass(t.opts.classes.sidebar.bookmarkDir)?a="directory":e.hasClass(t.opts.classes.sidebar.separator)?a="separator":e.parent("li."+t.opts.classes.sidebar.entryPinned).length()>0&&(a="pinned"),e.data("type",a)),a},p=e=>{t.helper.model.call("trackEvent",{category:"dragndrop",action:d(e),label:"dragstart"})},c=(e,a=!1)=>{t.helper.model.call("trackEvent",{category:"dragndrop",action:d(e),label:a?"cancel":"dragend"})},h=(a,s,l)=>{t.helper.contextmenu.close(),t.helper.tooltip.close();let r=e(a).parent("a").removeClass(t.opts.classes.sidebar.dirOpened),i=r.parent("li"),n=i.parent("ul").prev("a");t.elements.iframeBody.addClass(t.opts.classes.drag.isDragged),i.clone().addClass(t.opts.classes.drag.dragInitial).insertAfter(i);let d=r.clone().appendTo(t.elements.iframeBody),c=r[0].getBoundingClientRect(),h={};r.hasClass(t.opts.classes.sidebar.separator)||(h=t.helper.entry.getData(r.attr(t.opts.attr.id)));let u=0;i.prevAll("li").forEach(a=>{e(a).hasClass(t.opts.classes.drag.dragInitial)||0!==e(a).children("a."+t.opts.classes.sidebar.separator).length()||u++}),d.removeAttr("title").css({top:c.top+"px",left:c.left+"px",width:r.realWidth()+"px"}).data({elm:i,isDir:!!h.isDir,parentId:n.length()>0?n.attr(t.opts.attr.id):null,index:u,startPos:{top:l-c.top,left:s-c.left}}).addClass(t.opts.classes.drag.helper),i.addClass(t.opts.classes.drag.isDragged),p(r),o.running||window.requestAnimationFrame(m)},m=e=>{window.requestAnimationFrame(m);let a=e-o.previousDelta;if(!(o.fpsLimit&&a<1e3/o.fpsLimit)){if(null!==o.posY){let e=t.elements.bookmarkBox.all[0].offsetTop,a=t.elements.bookmarkBox.all[0].offsetHeight,s=t.helper.scroll.getScrollPos(t.elements.bookmarkBox.all),l=null;o.posY-e<60?l=s-Math.pow((50-o.posY+e)/10,2):o.posY+60>a&&(l=s+Math.pow((o.posY+50-a)/10,2)),l&&t.helper.scroll.setScrollPos(t.elements.bookmarkBox.all,l)}o.previousDelta=e}},u=()=>{g();let a=t.elements.iframeBody.children("a."+t.opts.classes.drag.helper),s=t.elements.bookmarkBox.all.find("li."+t.opts.classes.drag.dragInitial),l=a.data("elm"),r=a.data("parentId"),o=a.data("index"),n=l.children("a"),p=d(n);if(i(a))l.insertAfter(s).removeClass(t.opts.classes.drag.isDragged),s.remove(),a.remove(),c(n,!0);else{a.addClass(t.opts.classes.drag.snap);let i=l.parent("ul").prev("a").attr(t.opts.attr.id),d=0;l.prevAll("li").forEach(a=>{a===s||e(a).children("a").hasClass(t.opts.classes.sidebar.separator)||d++}),"separator"===p?(i!==r&&t.helper.specialEntry.removeSeparator({id:r,index:o}),t.helper.specialEntry.reorderSeparators([i])):"pinned"===p?t.helper.specialEntry.reorderPinnedEntries({id:l.children("a").attr(t.opts.attr.id),prevId:l.prev("li").children("a").attr(t.opts.attr.id)}):(t.helper.model.call("moveBookmark",{id:l.children("a").attr(t.opts.attr.id),parentId:i,index:d}),t.helper.specialEntry.reorderSeparators([i])),c(n),e.delay().then(()=>{let t=l[0].getBoundingClientRect();return a.css({top:t.top+"px",left:t.left+"px"}),e.delay(200)}).then(()=>{l.removeClass(t.opts.classes.drag.isDragged),s.remove(),a.remove()})}t.elements.iframeBody.removeClass(t.opts.classes.drag.isDragged),e.delay(500).then(()=>{!1===t.helper.utility.sidebarHasMask()&&t.elements.iframe.addClass(t.opts.classes.page.hideMask)})},g=(e=null)=>{null===r||null!==e&&r.id===e.attr(t.opts.attr.id)||(r.elm.removeClass(t.opts.classes.drag.dragHover),clearTimeout(r.instance),r=null)},b=(a,n,p)=>{o.posY=p;let c=null,h=null,m=0,u=0;if("dragover"===a){if(m=p-20,u=n,m===l)return!1;l=m,t.elements.bookmarkBox.all.find("li."+t.opts.classes.drag.isDragged).remove(),h=e("<li />").html("<a>&nbsp;</a>").addClass(t.opts.classes.drag.isDragged)}else{let e=(c=t.elements.iframeBody.children("a."+t.opts.classes.drag.helper)).data("startPos");m=p-e.top,u=n-e.left,c.css({top:m+"px",left:u+"px"}),h=c.data("elm")}if(i(c||u))return g(),t.elements.iframeBody.addClass(t.opts.classes.drag.cancel),!1;t.elements.iframeBody.removeClass(t.opts.classes.drag.cancel);let b={elm:null},k=d(h.children("a")),f=null;if((f="pinned"===k?[t.elements.bookmarkBox.all.find("> ul > li."+t.opts.classes.sidebar.entryPinned)]:[t.elements.bookmarkBox.all.find("a."+t.opts.classes.sidebar.dirOpened+" + ul > li"),t.elements.bookmarkBox.all.find("> ul > li > a."+t.opts.classes.sidebar.dirOpened).parent("li")]).some(a=>{a.forEach(a=>{let s=e(a);if(s[0]!==h[0]&&!s.hasClass(t.opts.classes.drag.dragInitial)){let e=s[0].getBoundingClientRect(),t=m-e.top;if(e.top>m)return!1;(null===b.elm||b.diff>t)&&(b={elm:s,diff:t})}})}),b.elm&&b.elm!==s){s=b.elm;let a=b.elm.children("a").eq(0);if(g(a),a.hasClass(t.opts.classes.sidebar.bookmarkDir))if(a.hasClass(t.opts.classes.sidebar.dirOpened)){let e=h.prependTo(a.next("ul"));c&&c.data("elm",e)}else if(c&&c.data("isDir")){let e=h.insertAfter(b.elm);c&&c.data("elm",e)}else a.hasClass(t.opts.classes.sidebar.dirAnimated)?0===a.next("ul").length()&&(a.addClass(t.opts.classes.sidebar.dirOpened),e("<ul />").insertAfter(a)):null===r&&((r={id:a.attr(t.opts.attr.id),elm:a.addClass(t.opts.classes.drag.dragHover)}).instance=setTimeout(()=>{t.helper.list.toggleBookmarkDir(a)},700));else{let e=h.insertAfter(b.elm);c&&c.data("elm",e)}}else if("pinned"===k){let e=h.prependTo(t.elements.bookmarkBox.all.find("> ul"));c&&c.data("elm",e)}},k=async()=>{t.elements.bookmarkBox.all.children("ul").on("mousedown","span."+t.opts.classes.drag.trigger,e=>{let s=e.pageX;if(!1===t.helper.utility.sidebarHasMask()&&"right"===a){let e=t.elements.iframe.realWidth();t.elements.iframe.removeClass(t.opts.classes.page.hideMask),s+=t.elements.iframe.realWidth()-e}t.elements.iframe.removeClass(t.opts.classes.page.hideMask),h(e.currentTarget,s,e.pageY)}),t.elements.iframeBody.on("mouseup",e=>{o.posY=null,t.elements.iframeBody.hasClass(t.opts.classes.drag.isDragged)&&(e.preventDefault(),e.stopPropagation(),u())}),t.elements.iframeBody.on("wheel",e=>{if(t.elements.iframeBody.hasClass(t.opts.classes.drag.isDragged)){e.preventDefault(),e.stopPropagation();let a=t.elements.bookmarkBox.all[0].scrollTop;t.helper.scroll.setScrollPos(t.elements.bookmarkBox.all,a-e.wheelDelta,300)}}),t.elements.iframeBody.on("mousemove dragover",e=>{t.elements.iframeBody.hasClass(t.opts.classes.drag.isDragged)&&1===e.which&&(e.preventDefault(),e.stopPropagation(),b(e.type,e.pageX,e.pageY))}),t.elements.iframeBody.on("contextmenu","a."+t.opts.classes.drag.helper,e=>{e.preventDefault(),e.stopPropagation()})}},window.EntryHelper=function(e){let t={},a={},s=!1;this.init=(()=>new Promise(l=>{s=e.helper.model.getData("u/showHidden"),e.helper.model.call("entries").then(e=>{t=e.entries,a=e.amounts,l()})})),this.getAmount=(e=>{if(a[e]){let t=a[e].visible;return s&&(t+=a[e].hidden),t}return null}),this.getAllPinnedData=(()=>Object.values(t.pinned)),this.getAllBookmarkData=(()=>Object.values(t.bookmarks)),this.getData=(e=>{let a=null;return"object"==typeof t.bookmarks[e]?(a=t.bookmarks[e],"object"==typeof t.pinned[e]&&(a.pinnedIndex=t.pinned[e].index)):"object"==typeof t.directories[e]&&(a=t.directories[e]),a}),this.addData=((e,a,s)=>{"object"==typeof t.bookmarks[e]?("pinnedIndex"===a&&"object"==typeof t.pinned[e]&&(t.pinned[e].index=s),t.bookmarks[e][a]=s):"object"==typeof t.directories[e]&&(t.directories[e][a]=s)}),this.isVisible=(e=>{let a=!1;return"object"==typeof t.bookmarks[e]?a=!1===t.bookmarks[e].hidden:"object"==typeof t.directories[e]&&(a=!1===t.directories[e].hidden),a})},window.FontHelper=function(t){let a={general:{name:"Roboto",href:"https://fonts.googleapis.com/css?family=Roboto:100,200,300,400,500,100i,200i,300i,400i,500i"},ja:{name:"Noto Sans Japanese",href:"https://fonts.googleapis.com/earlyaccess/notosansjapanese.css"},"zh-CN":{name:"Noto Sans SC",href:"https://fonts.googleapis.com/earlyaccess/notosanssc.css"}},s={__default:{Thin:100,ExtraLight:200,Light:300,Normal:400,Medium:500,SemiBold:600,Bold:700,ExtraBold:800,Black:900},Roboto:{Thin:100,ExtraLight:100,Light:200,Normal:300,Medium:400,SemiBold:400,Bold:500,ExtraBold:500,Black:500},"Noto Sans Japanese":{Thin:100,ExtraLight:100,Light:100,Normal:200,Medium:300,SemiBold:400,Bold:500,ExtraBold:500,Black:500},"Noto Sans SC":{Thin:100,ExtraLight:100,Light:100,Normal:300,Medium:400,SemiBold:400,Bold:400,ExtraBold:500,Black:500}},l={};this.init=(()=>{let e=t.helper.model.getData("a/styles");(l=e.fontFamily&&"default"!==e.fontFamily?{name:e.fontFamily}:this.getDefaultFontInfo()).fontWeights=this.getFontWeights(l.name)}),this.isLoaded=(()=>!!l.name),this.getFontInfo=(()=>l),this.getFontWeights=(e=>{let t={};return Object.keys(s.__default).forEach(a=>{let l=s.__default[a];s[e]&&s[e][a]&&(l=s[e][a]),t["fontWeight"+a]=l}),t}),this.addStylesheet=(t=>{l.href&&e("<link />").attr({rel:"stylesheet",type:"text/css",href:l.href}).appendTo(t.find("head"))}),this.getDefaultFontInfo=(()=>{let e=t.helper.i18n.getLanguage();return a[e]?a[e]:a.general})},window.I18nHelper=function(t){let a=null,s={},l={i18n:"data-i18n",i18nReplaces:"data-i18nReplaces"};this.init=(()=>new Promise(l=>{s={},t.helper.model.call("languageInfos").then(r=>{let o=t.helper.model.getData("b/language");"default"===o&&(o=e.api.i18n.getUILanguage());let i=this.getDefaultLanguage();[o,i].some(e=>{if(r.infos&&r.infos[e]&&r.infos[e].available)return a=e,t.helper.model.call("langvars",{lang:e,defaultLang:i}).then(e=>{e&&e.langVars&&(s=e.langVars,l())}),!0})})})),this.getLanguage=(()=>a),this.getDefaultLanguage=(()=>t.opts.manifest.default_locale),this.getLocaleSortCollator=(()=>new Intl.Collator([e.api.i18n.getUILanguage(),this.getDefaultLanguage()])),this.getLocaleDate=(t=>t.toLocaleDateString([e.api.i18n.getUILanguage(),this.getDefaultLanguage()],{year:"numeric",month:"2-digit",day:"2-digit"})),this.parseHtml=(t=>{e(t).find("["+l.i18n+"]").forEach(t=>{let a=null,s=e(t).attr(l.i18n);if(s){let r=[],o=e(t).attr(l.i18nReplaces);o&&(r=o.split(",")),a=this.get(s,r)}a?(e(t).removeAttr(l.i18n),e(t).html(a)):e(t).remove()})}),this.get=((e,t=[])=>{let a="",l=s[e];return l&&l.message&&(a=l.message,t.forEach((e,t)=>{a=a.replace(new RegExp("\\{"+(t+1)+"\\}"),e)}),a=a.replace(/\[b\](.*)\[\/b\]/,"<strong>$1</strong>"),a=a.replace(/\[a\](.*)\[\/a\]/,"<a href='#'>$1</a>"),a=a.replace(/\[em\](.*)\[\/em\]/,"<em>$1</em>")),a})},window.KeyboardHelper=function(t){this.init=(async()=>{a()}),this.initOverlayEvents=(a=>{e(a[0].contentDocument).on("keydown",e=>{"Escape"===e.key||"Esc"===e.key?(e.preventDefault(),t.helper.overlay.closeOverlay(!0)):"Enter"===e.key?(e.preventDefault(),s(a)):"Tab"===e.key&&(e.preventDefault(),o(a))})});let a=()=>{e([document,t.elements.iframe[0].contentDocument]).on("keydown.bs",e=>{if(t.elements.iframe.hasClass(t.opts.classes.page.visible)){let a=["ArrowDown","ArrowUp","PageDown","PageUp","Home","End","Space"],s=t.elements.sidebar.find("div."+t.opts.classes.contextmenu.wrapper).length()>0;if(a.indexOf(e.key)>-1||a.indexOf(e.code)>-1)t.helper.scroll.focus();else if("Tab"===e.key)e.preventDefault(),s?i():n();else if("Enter"===e.key)e.preventDefault(),s?l():r(e.shiftKey,e.ctrlKey||e.metaKey);else if("Escape"===e.key||"Esc"===e.key)e.preventDefault(),s?t.helper.contextmenu.close():t.helper.toggle.closeSidebar();else if("c"===e.key&&(e.ctrlKey||e.metaKey))e.preventDefault(),d();else{let e=t.elements.header.find("div."+t.opts.classes.sidebar.searchBox+" > input[type='text']");e[0]!==t.elements.iframe[0].contentDocument.activeElement&&e[0].focus()}}}).on("keyup.bs",()=>{t.elements.iframe.hasClass(t.opts.classes.page.visible)&&t.elements.header.find("div."+t.opts.classes.sidebar.searchBox+" > input[type='text']")[0].value.length>0&&!t.elements.header.hasClass(t.opts.classes.sidebar.searchVisible)&&(t.helper.contextmenu.close(),t.helper.tooltip.close(),t.elements.header.addClass(t.opts.classes.sidebar.searchVisible))})},s=e=>{let a=e.find("menu["+t.opts.attr.name+"='select'] > a."+t.opts.classes.sidebar.hover);a.length()>0?a.trigger("click"):t.helper.overlay.performAction()},l=()=>{let e=t.elements.sidebar.find("div."+t.opts.classes.contextmenu.wrapper).find("a."+t.opts.classes.sidebar.hover);e.length()>0&&e.trigger("click")},r=(e,a)=>{Object.values(t.elements.bookmarkBox).some(s=>{if(s.hasClass(t.opts.classes.sidebar.active)){let l=s.find("ul > li > a."+t.opts.classes.sidebar.hover+", ul > li > a."+t.opts.classes.sidebar.mark);if(l.length()>0)if(e){let e="list";l.hasClass(t.opts.classes.sidebar.separator)&&(e="separator"),t.helper.contextmenu.create(e,l)}else t.helper.sidebarEvents.handleEntryClick(l,{ctrlKey:a});return!0}})},o=a=>{let s=a.find("menu["+t.opts.attr.name+"='select'] > a."+t.opts.classes.sidebar.hover),l=a[0].contentDocument;if(s.length()>0){let e=null;e=s.next("a").length()>0?s.next("a"):a.find("menu["+t.opts.attr.name+"='select'] > a").eq(0),a.find("menu["+t.opts.attr.name+"='select'] > a."+t.opts.classes.sidebar.hover).removeClass(t.opts.classes.sidebar.hover),e.addClass(t.opts.classes.sidebar.hover)}else if("INPUT"===l.activeElement.tagName){let t=e(l.activeElement).parent("li"),s=null;(s=t.length()>0&&t.next("li").length()>0?t.next("li").find("input"):a.find("input").eq(0))[0].focus()}else a.find("input").length()>0?a.find("input")[0].focus():a.find("menu["+t.opts.attr.name+"='select']").length()>0&&a.find("menu["+t.opts.attr.name+"='select'] > a").eq(0).addClass(t.opts.classes.sidebar.hover)},i=()=>{let e=t.elements.sidebar.find("div."+t.opts.classes.contextmenu.wrapper),a=null,s=null;e.find("a."+t.opts.classes.sidebar.hover).length()>0&&(s=e.find("a."+t.opts.classes.sidebar.hover).eq(0)),a=null===s?e.find("a").eq(0):s.parent("li").next("li").length()>0?s.parent("li").next("li").find("a"):s.parents("ul").eq(0).next("ul").length()>0?s.parents("ul").eq(0).next("ul").find("a").eq(0):e.find("a").eq(0),e.find("a."+t.opts.classes.sidebar.hover).removeClass(t.opts.classes.sidebar.hover),a.addClass(t.opts.classes.sidebar.hover)},n=()=>{Object.values(t.elements.bookmarkBox).some(a=>{if(a.hasClass(t.opts.classes.sidebar.active)){let s=t.helper.scroll.getScrollPos(a),l=null;if(a.find("ul > li > a."+t.opts.classes.sidebar.mark).length()>0?l=a.find("ul > li > a."+t.opts.classes.sidebar.mark).eq(0).parent("li"):a.find("ul > li > a."+t.opts.classes.sidebar.hover).length()>0?l=a.find("ul > li > a."+t.opts.classes.sidebar.hover).eq(0).parent("li"):a.find("ul > li").forEach(t=>{if(t.offsetTop>=s)return l=e(t),!1}),l){let e=l.children("a"),r=null;if(e.hasClass(t.opts.classes.sidebar.hover)||e.hasClass(t.opts.classes.sidebar.mark))if(e.hasClass(t.opts.classes.sidebar.dirOpened)&&e.next("ul").length()>0)r=e.next("ul").find("> li:first-child > a");else if(l.next("li").length()>0)r=l.next("li").children("a");else{let e=!1,t=0;for(;!1===e;){let a=l.parents("li").eq(t);a.length()>0?a.next("li").length()>0?(r=a.next("li").children("a"),e=!0):t++:e=!0}}else r=e;if(r){a.find("ul > li > a."+t.opts.classes.sidebar.hover).removeClass(t.opts.classes.sidebar.hover),a.find("ul > li > a."+t.opts.classes.sidebar.mark).removeClass(t.opts.classes.sidebar.mark),r.addClass(t.opts.classes.sidebar.hover);let e=r[0].offsetTop-s,l=window.innerHeight-e;e<0?t.helper.scroll.setScrollPos(a,r[0].offsetTop):l<150&&t.helper.scroll.setScrollPos(a,s+(150-l))}}return!0}})},d=()=>{Object.values(t.elements.bookmarkBox).some(a=>{if(a.hasClass(t.opts.classes.sidebar.active)){let s=a.find("> ul a."+t.opts.classes.sidebar.hover).eq(0);if(s.length()>0){let a=t.helper.entry.getData(s.attr(t.opts.attr.id));if(a&&a.url&&t.helper.utility.copyToClipboard(a.url)){e(s).children("span."+t.opts.classes.sidebar.copied).remove();let a=e("<span />").addClass(t.opts.classes.sidebar.copied).text(t.helper.i18n.get("sidebar_copied_to_clipboard")).appendTo(s);e.delay(100).then(()=>(e(s).addClass(t.opts.classes.sidebar.copied),e.delay(1500))).then(()=>(e(s).removeClass(t.opts.classes.sidebar.copied),e.delay(500))).then(()=>{a.remove()})}}return!0}})}},window.ListHelper=function(t){let a=0,s=null;this.init=(async()=>{t.elements.bookmarkBox.all.addClass(t.opts.classes.sidebar.active),Object.values(t.elements.bookmarkBox).forEach(e=>{e.on(t.opts.events.scrollBoxLastPart,()=>{let a=e.children("ul"),s=a.data("remainingEntries");s&&s.length>0&&(this.addBookmarkDir(s,a,!1,!1),(t.refreshRun||!1===t.elements.iframe.hasClass(t.opts.classes.page.visible))&&t.helper.scroll.restoreScrollPos(e))})}),this.updateBookmarkBox()}),this.getSortList=(()=>({custom:{dir:"ASC"},alphabetical:{dir:"ASC"},mostUsed:{dir:"DESC"},recentlyUsed:{dir:"DESC"},recentlyAdded:{dir:"DESC"}})),this.getSort=(()=>s),this.updateSort=((e,a)=>{let l=this.getSortList();l[e]&&(void 0===a&&(a=l[e].dir),s={name:e,dir:"ASC"===a?"ASC":"DESC"},t.startLoading(),Promise.all([t.helper.model.call("removeCache",{name:"html"}),t.helper.model.setData({"u/sort":s})]).then(()=>{t.helper.model.call("trackEvent",{category:"sorting",action:"change",label:s.name+"_"+s.dir}),t.helper.model.call("reload",{scrollTop:!0,type:"Sort"})}))}),this.updateDirection=(e=>{this.updateSort(s.name,e)}),this.updateBookmarkBox=(()=>new Promise(e=>{t.startLoading(),s=t.helper.model.getData("u/sort"),t.elements.sidebar.attr(t.opts.attr.sort,s.name);let a=t.elements.bookmarkBox.all.children("ul"),l=null;window.start=+new Date,l=t.helper.model.getData("u/viewAsTree")?t.helper.model.call("getCache",{name:"html"}):new Promise(e=>{e()}),t.helper.scroll.focus(),l.then(e=>e&&e.val?n(a,e.val):d(a)).then(()=>{e()})})),this.toggleBookmarkDir=((a,s,l=!0)=>new Promise(r=>{a.addClass(t.opts.classes.sidebar.dirAnimated);let i=a.attr(t.opts.attr.id),n=a.next("ul"),d=n.length()>0,p=!0===t.refreshRun||!1===t.elements.iframe.hasClass(t.opts.classes.page.visible);void 0===s&&(s=p||!1===t.helper.model.getData("b/animations"));let c=()=>{"nothing"!==t.helper.model.getData("b/rememberState")&&l&&!p?this.cacheList().then(r):r()};a.hasClass(t.opts.classes.sidebar.dirOpened)&&d?o(a,n,!1,s).then(c):(t.helper.model.getData("b/dirAccordion")&&t.elements.bookmarkBox.all.find("a."+t.opts.classes.sidebar.dirOpened).forEach(a=>{0===e(a).next("ul").find("a["+t.opts.attr.id+"='"+i+"']").length()&&this.toggleBookmarkDir(e(a),s,!1)}),d?o(a,n,!0,s).then(c):t.helper.model.call("bookmarks",{id:i}).then(t=>{t.bookmarks&&t.bookmarks[0]&&t.bookmarks[0].children&&(n=e("<ul />").insertAfter(a),this.addBookmarkDir(t.bookmarks[0].children,n),o(a,n,!0,s).then(c))}))})),this.cacheList=(()=>(console.log("CACHE"),t.helper.model.call("setCache",{name:"html",val:t.elements.bookmarkBox.all.children("ul").html()}))),this.updateSidebarHeader=(()=>{t.elements.header.text("");let a=t.helper.entry.getAmount("bookmarks"),s=e("<h1 />").html("<strong>"+a+"</strong> <span>"+t.helper.i18n.get("header_bookmarks"+(1===a?"_single":""))+"</span>").attr("title",a+" "+t.helper.i18n.get("header_bookmarks"+(1===a?"_single":""))).appendTo(t.elements.header),l=[];l.push(e("<a />").addClass(t.opts.classes.sidebar.menu).appendTo(t.elements.header)),l.push(e("<a />").addClass(t.opts.classes.sidebar.sort).appendTo(t.elements.header)),l.push(e("<a />").addClass(t.opts.classes.sidebar.search).appendTo(t.elements.header));let r=window.getComputedStyle(t.elements.header[0]),o=parseInt(r.getPropertyValue("padding-top"));["label","amount"].forEach(e=>{l.some(a=>{if(a[0].offsetTop>o)return"label"===e?s.children("span").addClass(t.opts.classes.sidebar.hidden):"amount"===e&&s.addClass(t.opts.classes.sidebar.hidden),!0})}),e("<div />").addClass(t.opts.classes.sidebar.searchBox).append("<input type='text' placeholder='"+t.helper.i18n.get("sidebar_search_placeholder")+"' />").append("<a class='"+t.opts.classes.sidebar.searchClose+"'></a>").appendTo(t.elements.header)}),this.restoreOpenStates=(s=>{let l=!1,r=t.helper.model.getData(["b/rememberState","u/openStates"]),o=()=>{l||0!==a||e.delay(100).then(()=>{p()})};"all"!==r.rememberState&&"openStatesAndPos"!==r.rememberState&&"openStates"!==r.rememberState&&"openStatesRoot"!==r.rememberState||Object.keys(r.openStates).forEach(e=>{if(!0===r.openStates[e]){let i=s.find("> li > a."+t.opts.classes.sidebar.bookmarkDir+"["+t.opts.attr.id+"='"+e+"']");i.length()>0&&("openStatesRoot"===r.rememberState&&1!==i.parents("ul").length()||(l=!0,a++,this.toggleBookmarkDir(i).then(()=>{a--,l=!1,o()})))}}),o()}),this.updateSortFilter=(()=>{t.elements.filterBox.removeClass(t.opts.classes.sidebar.hidden).text("");let a=0;if("custom"===s.name)t.elements.filterBox.addClass(t.opts.classes.sidebar.hidden);else{let l=t.helper.model.getData(["u/viewAsTree","u/mostViewedPerMonth"]),r=s.name.replace(/([A-Z])/g,"_$1").toLowerCase();e("<a />").attr(t.opts.attr.direction,s.dir).text(t.helper.i18n.get("sort_label_"+r)).appendTo(t.elements.filterBox);let o=e("<ul />").appendTo(t.elements.filterBox);t.elements.bookmarkBox.search.hasClass(t.opts.classes.sidebar.active)||e("<li />").append(t.helper.checkbox.get(t.elements.iframeBody,{[t.opts.attr.name]:"viewAsTree",checked:l.viewAsTree?"checked":""})).append("<a>"+t.helper.i18n.get("sort_view_as_tree")+"</a>").appendTo(o),"mostUsed"===s.name&&e("<li />").append(t.helper.checkbox.get(t.elements.iframeBody,{[t.opts.attr.name]:"mostViewedPerMonth",checked:l.mostViewedPerMonth?"checked":""})).append("<a>"+t.helper.i18n.get("sort_most_used_per_month")+"</a>").appendTo(o),0===o.children("li").length()&&o.remove(),a=t.elements.filterBox.realHeight()}Object.values(t.elements.bookmarkBox).forEach(e=>{e.css("padding-top",a)})}),this.addBookmarkDir=((e,a,o=!0,i=!0)=>{let n=!1,d=t.helper.model.getData(["a/showBookmarkIcons","a/showDirectoryIcons","b/dirOpenDuration","u/showHidden"]),p=t.elements.iframe.hasClass(t.opts.classes.page.visible);if(0===a.parents("li").length()){if(!t.elements.bookmarkBox.search.hasClass(t.opts.classes.sidebar.active)&&0===a.find("li."+t.opts.classes.sidebar.entryPinned).length()){let e=t.helper.entry.getAllPinnedData();r(e),e.forEach(e=>{(d.showHidden||t.helper.entry.isVisible(e.id))&&l(e,a,{config:d,asTree:o,sidebarOpen:p}).addClass(t.opts.classes.sidebar.entryPinned)})}}else a.css("transition","height "+d.dirOpenDuration+"s");if(o&&"custom"===s.name&&a.prev("a").length()>0){let s=a.prev("a").attr("data-id"),l=t.helper.model.getData("u/separators");l[s]&&l[s].forEach(t=>{t.separator=!0,t.parentId=s,e.push(t)})}let c=0;return a.removeData("remainingEntries"),i&&r(e),e.some((s,r)=>{if((d.showHidden||s.separator||t.helper.entry.isVisible(s.id))&&(s.children||s.url||s.separator)&&(t.opts.demoMode&&(s.children?s.title="Directory "+(r+1):(s.title="Bookmark "+(r+1),s.url="https://example.com/")),l(s,a,{config:d,asTree:o,sidebarOpen:p}),s.url&&c++,n=!0,!1===o&&c>=100)){let t=e.slice(100);return t.length>0&&a.data("remainingEntries",t),!0}}),n});let l=(a,s,l)=>{let r;for(let o=0;o<(a.url,1);o++){r=e("<li />").appendTo(s);let o=a.title&&a.title.trim().length?a.title:"&nbsp;",i=e("<a />").html("<span class='"+t.opts.classes.sidebar.bookmarkLabel+"'>"+o.trim()+"</span><span class='"+t.opts.classes.drag.trigger+"' />").appendTo(r);a.id&&i.attr(t.opts.attr.id,a.id),a.separator||!1!==t.helper.entry.isVisible(a.id)||r.addClass(t.opts.classes.sidebar.hidden),a.children&&l.asTree?(i.addClass(t.opts.classes.sidebar.bookmarkDir),l.config.showDirectoryIcons&&i.prepend("<span class='"+t.opts.classes.sidebar.dirIcon+"' />")):a.url?(i.addClass(t.opts.classes.sidebar.bookmarkLink),l.config.showBookmarkIcons&&(t.opts.demoMode?i.prepend("<span class='"+t.opts.classes.sidebar.dirIcon+"' data-color='"+(Math.floor(10*Math.random())+1)+"' />"):t.helper.model.call("favicon",{url:a.url}).then(e=>{e.img&&i.prepend("<img "+(l.sidebarOpen?"src":t.opts.attr.src)+"='"+e.img+"' />")}))):a.separator&&i.addClass(t.opts.classes.sidebar.separator)}return r},r=e=>{if(e.length>1){let a=t.helper.i18n.getLocaleSortCollator(),l=(t,a)=>{e.sort((e,l)=>"custom"!==s.name&&!!e.children!=!!l.children?e.children?-1:1:(t===s.dir?1:-1)*a(e,l))};switch(s.name){case"custom":l("ASC",(e,t)=>e.index-(e.separator?.5:0)-(t.index-(t.separator?.5:0)));break;case"alphabetical":l("ASC",(e,t)=>a.compare(e.title,t.title));break;case"recentlyAdded":l("DESC",(e,t)=>t.dateAdded-e.dateAdded);break;case"mostUsed":{let e=t.helper.model.getData("u/mostViewedPerMonth");l("DESC",(s,l)=>{let r=t.helper.entry.getData(s.id),o=t.helper.entry.getData(l.id),i=r?r.views[e?"perMonth":"total"]:0,n=o?o.views[e?"perMonth":"total"]:0;return i===n?a.compare(s.title,l.title):n-i});break}case"recentlyUsed":l("DESC",(e,s)=>{let l=t.helper.entry.getData(e.id),r=t.helper.entry.getData(s.id),o=l?l.views.lastView:0,i=r?r.views.lastView:0;return o===i?a.compare(e.title,s.title):i-o})}}},o=(a,s,l,r)=>new Promise(o=>{if(s.css("height",s[0].scrollHeight+"px"),!1===l&&e.delay(0).then(()=>{s.css("height",0)}),!0===t.refreshRun)this.restoreOpenStates(s);else{let e=t.helper.model.getData("u/openStates");e[a.attr(t.opts.attr.id)]=l,!1===l?i(a,e):t.helper.model.setData({"u/openStates":e})}let n=t.helper.model.getData("b/dirOpenDuration");e.delay(r?0:1e3*+n).then(()=>{!1===l?a.removeClass(t.opts.classes.sidebar.dirOpened):(a.addClass(t.opts.classes.sidebar.dirOpened),t.helper.model.getData("b/dirAccordion")&&!1===t.refreshRun&&t.helper.scroll.setScrollPos(t.elements.bookmarkBox.all,a[0].offsetTop,300)),s.css("height",""),a.removeClass(t.opts.classes.sidebar.dirAnimated),o()})}),i=(a,s)=>{a.next("ul").find("a."+t.opts.classes.sidebar.bookmarkDir).forEach(a=>{s[e(a).attr(t.opts.attr.id)]=!1,e.delay(500).then(()=>{e(a).removeClass(t.opts.classes.sidebar.dirOpened)})}),t.helper.model.setData({"u/openStates":s})},n=(e,a)=>new Promise(s=>{console.log("LOAD FROM CACHE"),e.html(a),e.find("a."+t.opts.classes.sidebar.mark).removeClass(t.opts.classes.sidebar.mark),t.elements.bookmarkBox.all.addClass(t.opts.classes.sidebar.cached),this.updateSidebarHeader(),this.updateSortFilter(),t.helper.search.init(),1===e.children("li:not(."+t.opts.classes.sidebar.entryPinned+")").length()&&e.addClass(t.opts.classes.sidebar.hideRoot),p(),s()}),d=a=>new Promise(l=>{console.log("LOAD FROM OBJECT");let r=[],o=t.helper.model.getData("u/viewAsTree");t.elements.bookmarkBox.all.removeClass(t.opts.classes.sidebar.cached),t.helper.model.call("bookmarks",{id:0}).then(s=>(t.refreshRun=!0,a.removeClass(t.opts.classes.sidebar.hideRoot).text(""),s.bookmarks&&s.bookmarks[0]&&s.bookmarks[0].children&&(r=s.bookmarks[0].children),e.delay(0))).then(()=>{this.updateSidebarHeader(),this.updateSortFilter(),t.helper.search.init(),o||"custom"===s.name?(this.addBookmarkDir(r,a,!0),1===a.children("li:not(."+t.opts.classes.sidebar.entryPinned+")").length()?(a.addClass(t.opts.classes.sidebar.hideRoot),this.toggleBookmarkDir(a.find("> li > a."+t.opts.classes.sidebar.bookmarkDir).eq(0))):this.restoreOpenStates(a)):(this.addBookmarkDir(t.helper.entry.getAllBookmarkData(),a,!1),p()),l()})}),p=()=>{t.helper.scroll.restoreScrollPos(t.elements.bookmarkBox.all).then(()=>{t.initImages(),t.endLoading(200),t.firstRun=!1,t.refreshRun=!1,t.helper.model.getData("u/viewAsTree")&&!t.elements.bookmarkBox.all.hasClass(t.opts.classes.sidebar.cached)&&this.cacheList(),t.loaded()})}},window.ModelHelper=function(t){let a={textColor:{light:"rgb(100,100,100)",dark:"rgb(200,200,200)"},sidebarMaskColor:{light:"rgba(255,255,255,0.8)",dark:"rgba(0,0,0,0.6)"},colorScheme:{light:"rgb(27,130,241)",dark:"rgb(31,77,128)"}},s={u:{openStates:{},hiddenEntries:{},scrollPos:{},separators:{},pinnedEntries:{},entriesLocked:!1,lastOpened:null,sort:{name:"custom",dir:"ASC"},mostViewedPerMonth:!1,viewAsTree:!0},b:{animations:!0,preventPageScroll:!1,pxTolerance:{windowed:20,maximized:1},sidebarPosition:"left",language:"default",openAction:"mousedown",newTab:"foreground",newTabPosition:"afterCurrent",linkAction:"current",dirAccordion:!1,rememberState:"openStatesAndPos",tooltipDelay:1,tooltipContent:"all",dndOpen:!0,openChildrenWarnLimit:10,dirOpenDuration:.5,scrollBarHide:1.5,openDelay:0,closeTimeout:1},n:{override:!1,initialOpen:!1,website:""},a:{showIndicator:!0,showIndicatorIcon:!0,darkMode:!1,showBookmarkIcons:!0,showDirectoryIcons:!0,styles:{colorScheme:a.colorScheme.light,textColor:a.textColor.light,indicatorWidth:"40px",indicatorIconSize:"32px",indicatorIconColor:"rgb(255,255,255)",indicatorColor:"rgba(0,0,0,0.5)",sidebarWidth:"350px",sidebarMaskColor:a.sidebarMaskColor.light,bookmarksFontSize:"14px",directoriesIconSize:"16px",bookmarksIconSize:"16px",bookmarksLineHeight:"40px",bookmarksDirIcon:"dir-1",bookmarksDirColor:a.textColor.light,bookmarksDirIndentation:"25px",bookmarksHorizontalPadding:"16px",scrollBarWidth:"11px",overlayMaskColor:"rgba(0,0,0,0.5)",fontFamily:"default",iconShape:"bookmark",iconColor:"rgb(85,85,85)"}}},l={},r=null,o={};this.init=(()=>new Promise(e=>{Promise.all([i(),n()]).then(e)}));let i=()=>new Promise(t=>{r&&r.disconnect(),(r=e.api.runtime.connect({name:"background"})).onMessage.addListener(e=>{o[e.uid]&&(o[e.uid](e.result),delete o[e.uid])}),t()}),n=()=>new Promise(t=>{let a=["utility","behaviour","appearance","newtab"],s={},r=a.length,o=0;a.forEach(a=>{e.api.storage["utility"===a?"local":"sync"].get([a],i=>{s[a]=i[a]||{},"utility"===a&&0===Object.keys(s[a]).length?e.api.storage.sync.get([a],e=>{s[a]=e[a]||{},++o===r&&(l=s,t())}):++o===r&&(l=s,t())})})});this.getAllData=(()=>l),this.getData=(e=>{let a=e;"string"==typeof a&&(a=[a]);let r={};if(a.forEach(e=>{let a=e.split("/")[0],o=e.split("/")[1],i=null,n=null;switch(a){case"u":n=l.utility;break;case"b":n=l.behaviour;break;case"a":n=l.appearance;break;case"n":n=l.newtab}null!==n&&(void 0===n[o]?(["sidebarPosition","language"].some(t=>{if(e==="b/"+t)return null!==(i=this.getData("a/"+t))&&(a="__FOUND"),!0}),void 0!==s[a]&&void 0!==s[a][o]&&(i=s[a][o])):i=n[o]);let d=location.href.search(/chrome\-extension\:\/\//)>-1&&location.pathname.search(/settings\.html$/)>-1;if("b/pxTolerance"===e&&matchMedia("(min-resolution: 1.25dppx)").matches&&!1===d&&(i=Object.assign({},i),Object.keys(i).forEach(e=>{i[e]++})),"a/styles"===e){if(i=Object.assign({},s.a.styles,i),t.helper.font&&t.helper.font.isLoaded()){let e=t.helper.font.getFontInfo();i.fontFamily=e.name,Object.assign(i,e.fontWeights)}"__color_ee"===i.colorScheme&&(i.isEE=!0,i.colorScheme="#7b5fa4")}r[o]=i}),"string"==typeof e){let t=e.split("/")[1];r=r[t]}return r}),this.setData=(t=>new Promise(a=>{n().then(()=>{Object.keys(t).forEach(e=>{let a=e.split("/")[0],s=e.split("/")[1],r=t[e];switch(a){case"u":l.utility[s]=r;break;case"b":l.behaviour[s]=r;break;case"a":l.appearance[s]=r;break;case"n":l.newtab[s]=r}});let s=0,r=(e=1)=>{(s+=e)>=3&&a()};try{e.api.storage.local.set({utility:l.utility},()=>{r()}),e.api.storage.sync.set({behaviour:l.behaviour,appearance:l.appearance},()=>{r(2)})}catch(e){a()}})})),this.call=((e,t={})=>new Promise(a=>{t.type=e,t.uid=e+"_"+JSON.stringify(t)+"_"+ +new Date+Math.random().toString(36).substr(2,12),o[t.uid]=(e=>{a(e)}),r.postMessage(t)})),this.getDefaultColor=((e,t)=>a[e]?t&&a[e][t]?a[e][t]:a[e].light:null)},window.OverlayHelper=function(t){let a={};this.create=((l,c,m)=>{t.helper.tooltip.close(),a.overlay=e("<iframe />").attr("id",t.opts.ids.page.overlay).data("info",m).appendTo("body"),!1===t.helper.model.getData("b/animations")&&a.overlay.addClass(t.opts.classes.page.noAnimations),t.helper.stylesheet.addStylesheets(["overlay"],a.overlay);let u=a.overlay.find("body");a.modal=e("<div />").attr(t.opts.attr.type,l).addClass(t.opts.classes.overlay.modal).appendTo(u),!0===t.helper.model.getData("a/darkMode")&&u.addClass(t.opts.classes.page.darkMode);let g=l;switch(a.modal.append("<h1>"+c+"</h1>"),e("<a />").addClass(t.opts.classes.overlay.close).appendTo(a.modal),a.buttonWrapper=e("<menu />").addClass(t.opts.classes.overlay.buttonWrapper).appendTo(a.modal),e("<a />").addClass(t.opts.classes.overlay.close).appendTo(a.buttonWrapper),s("infos"===l?"close":"cancel"),l){case"delete":r(m);break;case"edit":o(m);break;case"infos":p(m);break;case"add":d(m);break;case"hide":n(m);break;case"openChildren":i(m);break;case"updateUrls":h(m)}a.overlay[0].focus(),a.modal.find("input").length()>0&&a.modal.find("input")[0].focus(),t.helper.keyboard.initOverlayEvents(a.overlay),t.helper.model.call("trackPageView",{page:"/overlay/"+g}),y(),e.delay(100).then(()=>{a.modal.addClass(t.opts.classes.overlay.visible),a.overlay.addClass(t.opts.classes.page.visible)})}),this.performAction=(()=>{let e=a.overlay.data("info");switch(a.modal.attr(t.opts.attr.type)){case"delete":g(e);break;case"hide":u(e);break;case"openChildren":m(e);break;case"edit":k(e);break;case"add":f(e);break;case"updateUrls":v()}}),this.closeOverlay=((s=!1,l="")=>{t.helper.model.call("checkUrls",{abort:!0}),t.elements.bookmarkBox.all.find("li."+t.opts.classes.drag.isDragged).remove(),a.overlay.removeClass(t.opts.classes.page.visible),t.helper.model.call("trackEvent",{category:"overlay",action:s?"cancel":"action",label:a.modal.attr(t.opts.attr.type)+l}),t.helper.scroll.focus(),e.delay(500).then(()=>{a.overlay.remove()})});let s=(e="close")=>{a.buttonWrapper.children("a."+t.opts.classes.overlay.close).text(t.helper.i18n.get("overlay_"+e))},l=(s,l)=>{let r=e("<"+(s.isDir?"span":"a")+" />").attr("title",s.title).addClass(t.opts.classes.overlay.preview).html(s.title).appendTo(a.modal);s.isDir?r.prepend("<span class='"+t.opts.classes.sidebar.dirIcon+"' />"):t.opts.demoMode?r.prepend("<span class='"+t.opts.classes.sidebar.dirIcon+"' data-color='"+(Math.floor(10*Math.random())+1)+"' />"):t.helper.model.call("favicon",{url:s.url}).then(e=>{e.img&&r.prepend("<img src='"+e.img+"' />")}),l&&!0===l&&!0!==s.isDir&&e("<a />").addClass(t.opts.classes.overlay.previewUrl).attr("title",s.url).text(s.url).insertAfter(r)},r=s=>{e("<p />").text(t.helper.i18n.get("overlay_delete_"+(s.isDir?"dir":"bookmark")+"_confirm")).appendTo(a.modal),l(s),e("<a />").addClass(t.opts.classes.overlay.action).text(t.helper.i18n.get("overlay_delete")).appendTo(a.buttonWrapper)},o=s=>{l(s);let r=e("<ul />").appendTo(a.modal);r.append("<li><label>"+t.helper.i18n.get("overlay_bookmark_title")+"</label><input type='text' name='title' value='"+s.title+"' /></li>"),s.isDir||r.append("<li><label>"+t.helper.i18n.get("overlay_bookmark_url")+"</label><input type='text' name='url' value='"+s.url+"' /></li>"),e("<a />").addClass(t.opts.classes.overlay.action).text(t.helper.i18n.get("overlay_save")).appendTo(a.buttonWrapper)},i=s=>{let r=s.children.filter(e=>!!e.url),o=t.helper.i18n.get("overlay_confirm_open_children",[r.length]);e("<p />").text(o).appendTo(a.modal),l(s),e("<a />").addClass(t.opts.classes.overlay.action).text(t.helper.i18n.get("overlay_open_children")).appendTo(a.buttonWrapper)},n=s=>{e("<p />").text(t.helper.i18n.get("overlay_hide_"+(s.isDir?"dir":"bookmark")+"_confirm")).appendTo(a.modal),l(s),e("<a />").addClass(t.opts.classes.overlay.action).text(t.helper.i18n.get("overlay_hide_from_sidebar")).appendTo(a.buttonWrapper)},d=s=>{let l=e("<a />").addClass(t.opts.classes.overlay.action).text(t.helper.i18n.get("overlay_save")).appendTo(a.buttonWrapper),r=e("<menu />").attr(t.opts.attr.name,"select").appendTo(a.modal),o=e("<a />").attr(t.opts.attr.type,"bookmark").attr("title",t.helper.i18n.get("overlay_label_bookmark")).appendTo(r);e("<a />").attr(t.opts.attr.type,"dir").attr("title",t.helper.i18n.get("overlay_label_dir")).appendTo(r),e("<a />").attr(t.opts.attr.type,"separator").attr("title",t.helper.i18n.get("overlay_label_separator")).appendTo(r),r.on("mouseleave",a=>{e(a.currentTarget).children("a").removeClass(t.opts.classes.sidebar.hover)}),r.children("a").on("mouseenter",a=>{r.children("a").removeClass(t.opts.classes.sidebar.hover),e(a.currentTarget).addClass(t.opts.classes.sidebar.hover)}).on("mouseleave",a=>{e(a.currentTarget).removeClass(t.opts.classes.sidebar.hover)}).on("click",o=>{o.preventDefault();let i=e(o.currentTarget).attr(t.opts.attr.type);if("separator"===i)t.helper.specialEntry.addSeparator({id:s.id,index:0}).then(()=>{this.closeOverlay(!1,"_separator"),t.helper.model.call("reload",{type:"Separator"})});else{let n=e("<ul />").appendTo(a.modal),d="",p="";"bookmark"===i&&(d=e(document).find("title").text(),p=location.href),s&&s.values&&(s.values.title&&(d=s.values.title),s.values.url&&(p=s.values.url)),n.append("<li><h2>"+e(o.currentTarget).attr("title")+"</h2></li>"),n.append("<li><label>"+t.helper.i18n.get("overlay_bookmark_title")+"</label><input type='text' name='title' value='"+d+"' /></li>"),"bookmark"===i&&n.append("<li><label>"+t.helper.i18n.get("overlay_bookmark_url")+"</label><input type='text' name='url' value='"+p+"'  /></li>"),r.addClass(t.opts.classes.sidebar.hidden),r.children("a").removeClass(t.opts.classes.sidebar.hover),e.delay(s&&s.values?0:100).then(()=>{n.addClass(t.opts.classes.overlay.visible),n.find("input")[0].focus(),l.addClass(t.opts.classes.overlay.visible)})}}),s&&s.values&&o.trigger("click")},p=s=>{l(s,!0);let r=e("<ul />").appendTo(a.modal),o=new Date(s.dateAdded);if(e("<li />").html(t.helper.i18n.get("overlay_bookmark_created_date")+" "+t.helper.i18n.getLocaleDate(o)).appendTo(r),s.isDir){let a=e("<li />").addClass(t.opts.classes.overlay.hasTooltip).append("<span>"+s.childrenAmount.total+"</span>").append(" "+t.helper.i18n.get("overlay_dir_children"),!1).appendTo(r);e("<ul />").append("<li>"+s.childrenAmount.bookmarks+" "+t.helper.i18n.get("overlay_dir_children_bookmarks")+"</li>").append("<li>"+s.childrenAmount.directories+" "+t.helper.i18n.get("overlay_dir_children_dirs")+"</li>").appendTo(a)}let i=e("<li />").addClass(t.opts.classes.overlay.hasTooltip).append("<span>"+s.views.total+"</span>").append(" "+t.helper.i18n.get("overlay_bookmark_views"+(1===s.views.total?"_single":"")),!1).appendTo(r),n=new Date(s.views.startDate);e("<ul />").append("<li>"+t.helper.i18n.get("overlay_bookmark_views_since")+" "+t.helper.i18n.getLocaleDate(n)+"</li>").append("<li>"+s.views.perMonth+" "+t.helper.i18n.get("overlay_bookmark_views"+(1===s.views.perMonth?"_single":""))+" "+t.helper.i18n.get("overlay_bookmark_views_per_month")+"</li>").appendTo(i)},c=l=>{let r=l.length>0;e.delay(1e3).then(()=>(a.desc.remove(),a.progressBar.remove(),a.progressLabel.remove(),r&&a.modal.addClass(t.opts.classes.overlay.urlCheckList),e.delay(r?1e3:0))).then(()=>{if(a.loader.remove(),a.modal.removeClass(t.opts.classes.overlay.urlCheckLoading),s("close"),0===l.length)e("<p />").addClass(t.opts.classes.overlay.success).text(t.helper.i18n.get("overlay_check_urls_no_results")).appendTo(a.modal);else{e("<a />").addClass(t.opts.classes.overlay.action).text(t.helper.i18n.get("overlay_update")).appendTo(a.buttonWrapper);let s=t.helper.scroll.add(t.opts.ids.overlay.urlList,e("<ul />").appendTo(a.modal)),r=a.overlay.find("body");l.forEach(a=>{let l=e("<li />").data("entry",a).append(t.helper.checkbox.get(r,{checked:"checked"})).append("<strong>"+a.title+"</strong>");e("<a />").attr({href:a.url,title:a.url,target:"_blank"}).html("<span>"+a.url+"</span>").appendTo(l),404===a.urlStatusCode?e("<span />").text(t.helper.i18n.get("overlay_check_urls_not_found")).appendTo(l):a.newUrl!==a.url&&e("<a />").attr({href:a.newUrl,title:a.newUrl,target:"_blank"}).html("<span>"+a.newUrl+"</span>").appendTo(l),l=l.appendTo(s.children("ul")),t.helper.model.call("favicon",{url:a.url}).then(a=>{a.img&&e("<img src='"+a.img+"' />").insertAfter(l.children("div."+t.opts.classes.checkbox.box))})})}})},h=l=>{a.loader=t.helper.template.loading().appendTo(a.modal),a.desc=e("<p />").text(t.helper.i18n.get("overlay_check_urls_loading")).appendTo(a.modal),t.helper.model.call("websiteStatus").then(r=>{if("available"===r.status){let s=[],r=e=>{e.forEach(e=>{e.url?s.push(e):e.children&&r(e.children)})};r(l.children);let o=s.length;a.progressBar=e("<div />").addClass(t.opts.classes.overlay.progressBar).html("<div />").appendTo(a.modal),a.progressLabel=e("<span />").addClass(t.opts.classes.overlay.checkUrlProgressLabel).html("<span>0</span>/<span>"+o+"</span>").appendTo(a.modal),e.delay(500).then(()=>{a.modal.addClass(t.opts.classes.overlay.urlCheckLoading)});let i=0,n=[],d={},p=s=>{t.helper.model.call("checkUrls",{urls:s}).then(t=>{if(!t.error){let s=-1;Object.entries(t).forEach(([t,l])=>{e.delay(50*++s).then(()=>{i++,a.progressBar.children("div").css("width",i/o*100+"%"),a.progressLabel.children("span").eq(0).text(i),(404==+l.code||d[t].url!==l.url&&302!=+l.code)&&(d[t].newUrl=l.url,d[t].urlStatusCode=+l.code,n.push(d[t])),i===o&&c(n)})})}})},h=0,m={};s.forEach(e=>{h++,m[e.id]=e.url,d[e.id]=e,(Object.keys(m).length>=10||h===o)&&(p(m),m={})})}else a.loader.remove(),a.desc.remove(),e("<div />").addClass(t.opts.classes.overlay.inputError).append("<h3>"+t.helper.i18n.get("status_service_unavailable_headline")+"</h3>").append("<p>"+t.helper.i18n.get("status_check_urls_unavailable_desc")+"</p>").appendTo(a.modal),s("close")})},m=e=>{this.closeOverlay();let a=e.children.filter(e=>!!e.url);t.helper.utility.openAllBookmarks(a,"foreground"===t.helper.model.getData("b/newTab"))},u=e=>{t.startLoading(),this.closeOverlay();let a=t.helper.model.getData("u/hiddenEntries");a[e.id]=!0,t.helper.model.setData({"u/hiddenEntries":a}).then(()=>Promise.all([t.helper.model.call("removeCache",{name:"html"}),t.helper.model.call("updateEntries")])).then(()=>{t.helper.model.call("reload",{type:"Hide"})})},g=e=>{this.closeOverlay(),t.helper.model.call("trackEvent",{category:"extension",action:"remove",label:e.url?"bookmark":"directory"}),t.elements.bookmarkBox.all.find("a[data-id='"+e.id+"']").parent("li").remove(),t.helper.specialEntry.reorderSeparators([e.parentId]).then(()=>{t.helper.model.call("deleteBookmark",{id:e.id})})},b=e=>{let s=a.modal.find("input[name='title']").removeClass(t.opts.classes.overlay.inputError),l=a.modal.find("input[name='url']").removeClass(t.opts.classes.overlay.inputError),r={errors:!1,values:{title:s[0].value.trim(),url:e?null:l[0].value.trim()}};return 0===r.values.title.length&&(s.addClass(t.opts.classes.overlay.inputError),r.errors=!0),e||0!==r.values.url.length||(l.addClass(t.opts.classes.overlay.inputError),r.errors=!0),null!==r.values.url&&0!==r.values.url.search(/^\w+\:\/\//)&&(r.values.url="http://"+r.values.url),r},k=e=>{let s=b(e.isDir);!1===s.errors&&t.helper.model.call("updateBookmark",{id:e.id,title:s.values.title,url:s.values.url}).then(e=>{e.error?a.modal.find("input[name='url']").addClass(t.opts.classes.overlay.inputError):this.closeOverlay()})},f=s=>{let l=b(0===a.modal.find("input[name='url']").length());if(!1===l.errors){let r={title:l.values.title,url:l.values.url,parentId:s.id||null,index:0};s&&s.values&&(s.values.index&&(r.index=s.values.index),s.values.parentId&&(r.parentId=s.values.parentId));let o=t.elements.bookmarkBox.all.find("a[data-id='"+r.parentId+"']");if(o.length()>0&&o.next("ul").length()>0){let t=o.next("ul").children("li");0===t.length()?o.next("ul").prepend("<li />"):t.eq(r.index)&&e("<li />").insertBefore(t.eq(r.index))}e.delay(100).then(()=>t.helper.specialEntry.reorderSeparators([r.parentId])).then(()=>t.helper.model.call("createBookmark",r)).then(e=>{e.error?a.modal.find("input[name='url']").addClass(t.opts.classes.overlay.inputError):(t.helper.model.call("trackEvent",{category:"extension",action:"add",label:r.url?"bookmark":"directory"}),this.closeOverlay(!1,"_"+(r.url?"bookmark":"directory")))})}},v=()=>{let s=[],l=[];a.modal.find("div#"+t.opts.ids.overlay.urlList+" ul > li").forEach(a=>{if(e(a).find("input[type='checkbox']")[0].checked){let r=e(a).data("entry");404===r.urlStatusCode?(t.elements.bookmarkBox.all.find("a[data-id='"+r.id+"']").parent("li").remove(),s.push({id:r.id}),-1===l.indexOf(r.parentId)&&l.push(r.parentId)):r.url!==r.newUrl&&t.helper.model.call("updateBookmark",{id:r.id,title:r.title,url:r.newUrl})}}),t.helper.specialEntry.reorderSeparators(l).then(()=>{s.forEach(e=>{t.helper.model.call("deleteBookmark",e)})}),this.closeOverlay()},y=()=>{a.overlay.find("body").on("click",e=>{"BODY"===e.target.tagName&&this.closeOverlay(!0)}),a.modal.find("a."+t.opts.classes.overlay.close).on("click",e=>{e.preventDefault(),this.closeOverlay(!0)}),a.modal.on("click","a."+t.opts.classes.overlay.action,e=>{e.preventDefault(),this.performAction()}),a.modal.on("focus","input",a=>{e(a.currentTarget).removeClass(t.opts.classes.overlay.inputError)}),a.modal.find("a."+t.opts.classes.overlay.preview+", a."+t.opts.classes.overlay.previewUrl).on("click",e=>{e.preventDefault(),t.helper.model.call("trackEvent",{category:"url",action:"open",label:"new_tab_overlay"}),t.helper.utility.openUrl(a.overlay.data("info"),"newTab")})}},window.ScrollHelper=function(t){let a=+new Date,s={},l=[],r=0;this.init=(async()=>{let e=t.helper.model.getData("b/scrollBarHide");r=1e3*+e}),this.add=((a,s)=>{let r=e("<div id='"+a+"' class='"+t.opts.classes.scrollBox.wrapper+"' tabindex='0' />").insertBefore(s);return s=s.appendTo(r),r.data({list:s}),l.push(r),d(r),r}),this.focus=(()=>{t.elements.iframe.hasClass(t.opts.classes.page.visible)&&t.elements.header.find("div."+t.opts.classes.sidebar.searchBox+" > input[type='text']")[0]!==t.elements.iframe[0].contentDocument.activeElement&&l.forEach(e=>{e.hasClass(t.opts.classes.sidebar.active)&&e[0].focus()})}),this.updateAll=(()=>{l.forEach(e=>{e.hasClass(t.opts.classes.sidebar.active)&&this.update(e)})}),this.restoreScrollPos=(a=>new Promise(s=>{let l=t.helper.model.getData(["b/rememberState","u/scrollPos"]);"all"===l.rememberState||"openStatesAndPos"===l.rememberState?(this.setScrollPos(a,l.scrollPos[a.attr("id")]||0),e.delay(100).then(s)):s()})),this.setScrollPos=((e,t,a=0)=>{if(0===a)e[0].scrollTop=t,this.update(e);else{let s=e[0].scrollTop,l=0,r=()=>{let o=(l+=1/60)/(a/1e3),i=Math.sin(o*(Math.PI/2));o<1?(window.requestAnimationFrame(r),e[0].scrollTop=s+(t-s)*i):(e[0].scrollTop=t,this.update(e))};r()}}),this.getScrollPos=(e=>e[0].scrollTop),this.update=(e=>{t.helper.contextmenu.close(),t.helper.tooltip.close(),i(e);let a=n(e),l=o(e),d=e[0].scrollTop;d>10?e.addClass(t.opts.classes.scrollBox.scrolled):e.removeClass(t.opts.classes.scrollBox.scrolled);let p=e.data("lastPos")||0;d>p?e.attr(t.opts.attr.direction,"down"):d<p?e.attr(t.opts.attr.direction,"up"):e.removeAttr(t.opts.attr.direction),e.data("lastPos",d),(l-d<2*a||l===d&&0===a)&&e.trigger(t.opts.events.scrollBoxLastPart),r>0&&(t.elements.iframe.hasClass(t.opts.classes.page.visible)?(e.removeClass(t.opts.classes.scrollBox.hideScrollbar),clearTimeout(s[e.attr("id")]),s[e.attr("id")]=setTimeout(()=>{e.addClass(t.opts.classes.scrollBox.hideScrollbar)},r)):e.addClass(t.opts.classes.scrollBox.hideScrollbar)),t.helper.scroll.focus()});let o=t=>{let a=0;return t.children().forEach(t=>{a+=e(t).realHeight(!0)}),a},i=e=>{if(!1===t.refreshRun&&+new Date-a>500){a=+new Date;let s=t.helper.model.getData("u/scrollPos");s[e.attr("id")]=e[0].scrollTop,t.helper.model.setData({"u/scrollPos":s})}},n=e=>e.realHeight()-parseInt(e.css("padding-top")),d=e=>{e.on("scroll",()=>{this.update(e)})}},window.SearchHelper=function(t){let a=null;this.init=(()=>{let e=t.helper.model.getData("u/searchValue");e&&e.length>0&&(t.elements.header.addClass(t.opts.classes.sidebar.searchVisible),s(e)),o()}),this.clearSearch=(()=>new Promise(e=>{t.helper.contextmenu.close(),t.helper.tooltip.close(),t.elements.header.removeClass(t.opts.classes.sidebar.searchVisible),s("").then(e)}));let s=(e=null)=>new Promise(a=>{let s=t.elements.header.find("div."+t.opts.classes.sidebar.searchBox+" > input[type='text']");null===e?e=s[0].value:s[0].value=e,e&&e.length>0?l(s,e).then(a):r(s).then(a)}),l=(s,l)=>new Promise(r=>{let o=t.firstRun;t.elements.bookmarkBox.all.removeClass(t.opts.classes.sidebar.active).removeClass(t.opts.classes.scrollBox.scrolled),t.elements.bookmarkBox.search.addClass(t.opts.classes.sidebar.active),t.helper.scroll.focus(),t.helper.list.updateSortFilter(),l!==s.data("lastVal")&&(t.startLoading(),s.data("lastVal",l),a&&(clearTimeout(a),a=null),t.helper.model.setData({"u/searchValue":l}).then(()=>(t.helper.scroll.setScrollPos(t.elements.bookmarkBox.search,0),t.helper.model.call("searchBookmarks",{searchVal:l}))).then(s=>{t.elements.bookmarkBox.search.children("p").remove();let i=!1,n=t.elements.bookmarkBox.search.children("ul");n.text(""),s.bookmarks&&s.bookmarks.length>0&&(i=t.helper.list.addBookmarkDir(s.bookmarks,n,!1)),!1===i&&e("<p />").text(t.helper.i18n.get("sidebar_search_no_results")).appendTo(t.elements.bookmarkBox.search),o||(a=setTimeout(()=>{t.helper.model.call("trackEvent",{category:"search",action:"search",label:"search",value:l.length})},500)),t.endLoading(500),r()}))}),r=e=>new Promise(a=>{e.removeData("lastVal"),t.helper.model.setData({"u/searchValue":!1}).then(()=>{t.elements.bookmarkBox.search.hasClass(t.opts.classes.sidebar.active)&&(t.startLoading(),t.elements.bookmarkBox.all.addClass(t.opts.classes.sidebar.active),t.elements.bookmarkBox.search.removeClass(t.opts.classes.sidebar.active),t.helper.scroll.restoreScrollPos(t.elements.bookmarkBox.all),t.helper.scroll.focus(),t.endLoading()),t.helper.list.updateSortFilter(),a()})}),o=()=>{t.elements.header.on("click","a."+t.opts.classes.sidebar.search,e=>{e.preventDefault(),e.stopPropagation(),t.helper.contextmenu.close(),t.helper.tooltip.close(),t.elements.header.addClass(t.opts.classes.sidebar.searchVisible),t.elements.header.find("div."+t.opts.classes.sidebar.searchBox+" > input[type='text']")[0].focus()}),t.elements.header.on("keyup","div."+t.opts.classes.sidebar.searchBox+" > input[type='text']",e=>{e.preventDefault(),s()}),t.elements.header.on("click","a."+t.opts.classes.sidebar.searchClose,e=>{e.preventDefault(),e.stopPropagation(),this.clearSearch()})}},window.SidebarEventsHelper=function(t){this.init=(async()=>{s(),a(),l()}),this.handleEntryClick=((e,a)=>{let s=t.helper.entry.getData(e.attr(t.opts.attr.id)),l=t.helper.model.getData(["b/newTab","b/linkAction"]),r=2===a.which||a.ctrlKey||a.metaKey;if(s.isDir&&!e.hasClass(t.opts.classes.sidebar.dirAnimated))if(r){let e=s.children.filter(e=>!!e.url);e.length>t.helper.model.getData("b/openChildrenWarnLimit")?t.helper.overlay.create("openChildren",t.helper.i18n.get("contextmenu_open_children"),s):t.helper.utility.openAllBookmarks(e,"foreground"===l.newTab)}else t.helper.list.toggleBookmarkDir(e);else s.isDir||(r?t.helper.model.call("trackEvent",{category:"url",action:"open",label:"new_tab_middle_click"}):t.helper.model.call("trackEvent",{category:"url",action:"open",label:(2===a.which||"newtab"===l.linkAction?"new":"current")+"_tab_default"}),r?t.helper.utility.openUrl(s,"newTab","background"===l.newTab&&"newtab"===l.linkAction):"newtab"===l.linkAction?t.helper.utility.openUrl(s,"newTab","foreground"===l.newTab):t.helper.utility.openUrl(s,"default",!0))});let a=async()=>{t.elements.filterBox.on("click","a["+t.opts.attr.direction+"]",a=>{a.preventDefault();let s="ASC"===e(a.target).attr(t.opts.attr.direction)?"DESC":"ASC";t.helper.list.updateDirection(s)}).on("click","div."+t.opts.classes.checkbox.box+" + a",a=>{a.preventDefault(),e(a.target).prev("div["+t.opts.attr.name+"]").trigger("click")}),e(t.elements.iframe[0].contentDocument).on(t.opts.events.checkboxChanged,e=>{let a=e.detail.checkbox.attr(t.opts.attr.name);"viewAsTree"!==a&&"mostViewedPerMonth"!==a||t.helper.model.setData({["u/"+a]:e.detail.checked}).then(()=>{t.startLoading(),t.helper.model.call("reload",{scrollTop:!0,type:"Sort"})})})},s=async()=>{Object.values(t.elements.bookmarkBox).forEach(a=>{a.children("ul").on("click mousedown","a",a=>{a.preventDefault(),e(a.target).hasClass(t.opts.classes.drag.trigger)||e(a.target).hasClass(t.opts.classes.sidebar.separator)||!(1===a.which&&"click"===a.type||2===a.which&&"mousedown"===a.type||t.refreshRun)||this.handleEntryClick(e(a.currentTarget),a)}).on("mouseover","a",s=>{let l=e(s.currentTarget);a.find("> ul a."+t.opts.classes.sidebar.hover).removeClass(t.opts.classes.sidebar.hover),l.addClass(t.opts.classes.sidebar.hover).removeClass(t.opts.classes.sidebar.mark),t.helper.tooltip.create(l)}).on("contextmenu","a",a=>{a.preventDefault();let s="list";e(a.target).hasClass(t.opts.classes.sidebar.separator)&&(s="separator"),t.helper.contextmenu.create(s,e(a.currentTarget))}),a.children("ul").on("mouseleave",a=>{t.helper.tooltip.close(),e(a.currentTarget).find("a."+t.opts.classes.sidebar.hover).removeClass(t.opts.classes.sidebar.hover)})})},l=async()=>{e(window).on("beforeunload.bs",()=>{t.elements.sidebar.hasClass(t.opts.classes.sidebar.openedOnce)&&t.helper.scroll.updateAll()}),t.elements.iframe.find("body").on("click",()=>{t.helper.contextmenu.close(),t.helper.tooltip.close()}),e.api.extension.onMessage.addListener(a=>{if(a&&a.action&&(null===a.reinitialized||t.initialized>a.reinitialized)&&"reload"===a.action){let s=0;a.scrollTop&&(t.helper.scroll.setScrollPos(t.elements.bookmarkBox.all,0),s=100),e.delay(s).then(t.reload)}}),["menu","sort"].forEach(a=>{t.elements.header.on("click contextmenu","a."+t.opts.classes.sidebar[a],s=>{s.preventDefault(),s.stopPropagation(),t.helper.contextmenu.create(a,e(s.currentTarget))})}),t.elements.iframeBody.on("click","#"+t.opts.ids.sidebar.reloadInfo+" a",e=>{e.preventDefault(),location.reload(!0)}),t.elements.iframeBody.on("click","#"+t.opts.ids.sidebar.shareUserdata+" a",a=>{a.preventDefault(),t.helper.model.call("shareUserdata",{share:e(a.currentTarget).data("accept")}),t.elements.iframeBody.find("div#"+t.opts.ids.sidebar.shareUserdata).addClass(t.opts.classes.sidebar.hidden)})}},window.SpecialEntryHelper=function(t){this.pinEntry=(e=>new Promise(s=>{let l=t.helper.model.getData("u/pinnedEntries"),r=-1;Object.values(l).forEach(e=>{r=Math.max(r,e.index)}),l[e.id]={index:r+1},t.helper.model.call("trackEvent",{category:"extension",action:"pinnedEntry",label:"pin"}),a(l).then(s)})),this.unpinEntry=(e=>new Promise(s=>{let l=t.helper.model.getData("u/pinnedEntries");delete l[e.id],t.helper.model.call("trackEvent",{category:"extension",action:"pinnedEntry",label:"unpin"}),a(l).then(s)})),this.reorderPinnedEntries=(e=>new Promise(s=>{let l=t.helper.model.getData("u/pinnedEntries"),r=0;if(e.prevId){let a=t.helper.entry.getData(e.prevId);r=a.pinnedIndex+1}Object.keys(l).forEach(a=>{+a==+e.id?(l[a].index=r,t.helper.entry.addData(a,"pinnedIndex",r)):l[a].index>=r&&(l[a].index++,t.helper.entry.addData(a,"pinnedIndex",l[a].index))}),a(l).then(s)}));let a=e=>new Promise(a=>{Promise.all([t.helper.model.call("removeCache",{name:"html"}),t.helper.model.setData({"u/pinnedEntries":e})]).then(()=>t.helper.model.call("updateEntries")).then(a)}),s=e=>new Promise(a=>{Promise.all([t.helper.model.call("removeCache",{name:"html"}),t.helper.model.setData({"u/separators":e})]).then(a)});this.reorderSeparators=(a=>new Promise(l=>{let r=t.helper.model.getData("u/separators"),o=(i=0)=>{let n=a[i];if(void 0!==n){let a=t.elements.bookmarkBox.all.find("a[data-id='"+n+"']");if(a.length()>0&&a.next("ul").length()>0){let s=0,l=[];a.next("ul").children("li").forEach(a=>{e(a).hasClass(t.opts.classes.drag.dragInitial)||(e(a).children("a."+t.opts.classes.sidebar.separator).length()>0?l.push({index:s}):s++)}),r[n]=l}o(i+1)}else s(r).then(l)};o()})),this.addSeparator=(e=>new Promise(a=>{let l=t.helper.model.getData("u/separators");void 0===l[e.id]&&(l[e.id]=[]),l[e.id].push({index:e.index||0}),t.helper.model.call("trackEvent",{category:"extension",action:"add",label:"separator"}),s(l).then(a)})),this.removeSeparator=(e=>new Promise(a=>{let l=t.helper.model.getData("u/separators");void 0!==l[e.id]?(l[e.id].some((t,a)=>{if(t.index===e.index)return l[e.id].splice(a,1),!0}),t.helper.model.call("trackEvent",{category:"extension",action:"remove",label:"separator"}),s(l).then(a)):a()}))},window.StylesheetHelper=function(t){let a={};this.init=(()=>{a=t.helper.model.getData("a/styles")}),this.addStylesheets=((s,l=null)=>{null===l?l=e(document):(t.helper.font.addStylesheet(l),t.opts.classes&&t.opts.classes.page&&(a.isEE&&t.opts.classes.page.ee&&l.find("body").addClass(t.opts.classes.page.ee),!1===t.helper.model.getData("b/animations")&&t.opts.classes.page.noAnimations&&l.find("body").addClass(t.opts.classes.page.noAnimations)));let r=null;r=0===l.find("head").length()?l.find("body"):l.find("head"),s.forEach(s=>{e.xhr(e.api.extension.getURL("css/"+s+".css")).then(e=>{if(e.response){let l=e.response;Object.keys(a).forEach(e=>{l=l.replace(new RegExp('"?%'+e+'"?',"g"),a[e])}),t.opts.classes&&t.opts.classes.page&&t.opts.classes.style&&t.opts.attr&&t.opts.attr.name?(r.find("style."+t.opts.classes.page.style+"["+t.opts.attr.name+"='"+s+"]").remove(),r.append("<style class='"+t.opts.classes.page.style+"' "+t.opts.attr.name+"='"+s+"'>"+l+"</style>")):r.append("<style>"+l+"</style>")}})})})},window.TemplateHelper=function(t){this.loading=(()=>e('<svg class="loading" width="36px" height="36px" viewBox="0 0 36 36" xmlns="http://www.w3.org/2000/svg"><circle fill="none" stroke-width="3" stroke-linecap="round" cx="18" cy="18" r="16"></circle></svg>')),this.svgByName=(t=>new Promise((a,s)=>{e.xhr(e.api.extension.getURL("img/"+t+".svg")).then(e=>{a(e.responseText)},()=>{s()})})),this.footer=(()=>{let t=e('<footer> <a id="copyright" href="https://extensions.blockbyte.de/" target="_blank">  &copy; <span class="created">2016</span>&ensp;<strong>Blockbyte</strong> </a></footer>'),a=+t.find("span.created").text(),s=(new Date).getFullYear();return s>a&&t.find("span.created").text(a+" - "+s),t})},window.ToggleHelper=function(t){let a=null,s=null,l=null,r=null,o=0,i=null,n=null,d=!1,p={},c=null;this.init=(async()=>{t.elements.indicator=e("<div />").attr("id",t.opts.ids.page.indicator).appendTo("body"),!1===t.helper.model.getData("b/animations")&&t.elements.indicator.addClass(t.opts.classes.page.noAnimations);let n=t.helper.utility.getPageType().startsWith("newtab_"),d=t.helper.model.getData(["b/pxTolerance","b/preventPageScroll","a/showIndicator","a/showIndicatorIcon","a/styles","b/sidebarPosition","b/openDelay","b/openAction","b/dndOpen"]);if(l=d.pxTolerance,o=1e3*+d.openDelay,a=d.sidebarPosition,r=d.preventPageScroll,s=d.dndOpen,t.elements.indicator.css("width",m()+"px"),t.elements.iframe.attr(t.opts.attr.position,a),t.elements.sidebar.attr(t.opts.attr.position,a),d.styles&&d.styles.indicatorWidth&&(i=parseInt(d.styles.indicatorWidth)),d.showIndicator&&"icon"!==d.openAction&&"mousemove"!==d.openAction)if(t.elements.indicator.html("<div />").attr(t.opts.attr.position,a),d.showIndicatorIcon){let a=e("<span />").appendTo(t.elements.indicator.children("div"));n?t.helper.template.svgByName("icon-bookmark").then(e=>{a.css("-webkit-mask-image","url('data:image/svg+xml;base64,"+window.btoa(e)+"')"),h()}):h()}else h();k(),u(),n&&t.helper.model.getData("n/initialOpen")&&this.openSidebar(),!1===t.helper.utility.sidebarHasMask()&&t.elements.iframe.addClass(t.opts.classes.page.hideMask)}),this.closeSidebar=(()=>{b("close"),b("open"),t.helper.contextmenu.close(),t.helper.tooltip.close(),t.elements.iframe.removeClass(t.opts.classes.page.visible),e("body").removeClass(t.opts.classes.page.noscroll),e(document).trigger("mousemove.bs")}),this.openSidebar=(()=>{if(!1===t.helper.utility.isBackgroundConnected())t.elements.iframe.addClass(t.opts.classes.page.visible),t.addReloadMask();else{if(t.helper.model.call("shareUserdataMask").then(e=>{e&&e.showMask?t.addShareUserdataMask():t.elements.sidebar.find("#"+t.opts.ids.sidebar.shareUserdata).remove()}),!t.elements.sidebar.hasClass(t.opts.classes.sidebar.openedOnce)){t.trackInitialEvents(),t.elements.sidebar.addClass(t.opts.classes.sidebar.openedOnce);let e=t.helper.model.getData(["u/lastOpened","b/rememberState"]);"all"===e.rememberState&&e.lastOpened&&t.elements.bookmarkBox.all.find("ul > li > a["+t.opts.attr.id+"='"+e.lastOpened+"']").addClass(t.opts.classes.sidebar.mark),t.helper.model.setData({"u/lastOpened":null})}t.helper.model.call("trackPageView",{page:"/sidebar/"+t.helper.utility.getPageType()}),t.elements.iframe.addClass(t.opts.classes.page.visible),t.initImages(),r&&e("body").addClass(t.opts.classes.page.noscroll),t.helper.scroll.focus(),e(document).trigger("mousemove.bs"),t.helper.utility.triggerEvent("sidebarOpened")}});let h=()=>{e.delay(50).then(()=>{t.elements.indicator.addClass(t.opts.classes.page.visible)})},m=()=>l[t.helper.utility.isWindowed()?"windowed":"maximized"],u=async()=>{e(window).on("resize.bs",()=>{t.elements.indicator.css("width",m()+"px")}),t.elements.iframe.find("body").on("click",e=>{if(e.pageX){let s=e.pageX;"right"===a&&(s=t.helper.utility.getPageType().startsWith("newtab_")?t.elements.iframe.realWidth()-s:window.innerWidth-s+t.elements.sidebar.realWidth()-1),s>t.elements.sidebar.realWidth()&&t.elements.iframe.hasClass(t.opts.classes.page.visible)&&this.closeSidebar()}}),e(document).on("click.bs",e=>{e.isTrusted&&this.closeSidebar()}),e(window).on("keydown.bs",()=>{c=+new Date}).on("keyup.bs",()=>{c=null}),t.elements.sidebar.on("mouseleave",()=>{if(0===e("iframe#"+t.opts.ids.page.overlay).length()&&!1===t.elements.iframeBody.hasClass(t.opts.classes.drag.isDragged)){let e=t.helper.model.getData("b/closeTimeout");-1!=+e&&(p.close=setTimeout(()=>{!1===t.elements.iframeBody.hasClass(t.opts.classes.drag.isDragged)&&this.closeSidebar()},1e3*+e))}}).on("mouseenter",()=>{b("close")}),e(document).on("visibilitychange.bs",()=>{document.hidden&&0===e("iframe#"+t.opts.ids.page.overlay).length()&&(t.elements.indicator.removeClass(t.opts.classes.page.hover),t.elements.iframe.hasClass(t.opts.classes.page.visible)&&this.closeSidebar())}).on("mouseout.bs",()=>{b("open")}).on("mousemove.bs",e=>{if(e.isTrusted&&g(e.pageX,e.pageY)){let e=+new Date-(n||0);p.indicator||(p.indicator=setTimeout(()=>{t.elements.indicator.addClass(t.opts.classes.page.hover)},Math.max(o-e,0)))}else b("indicator"),t.elements.indicator.removeClass(t.opts.classes.page.hover)},{passive:!0}),e.api.extension.onMessage.addListener(e=>{e&&e.action&&"toggleSidebar"===e.action&&(t.elements.iframe.hasClass(t.opts.classes.page.visible)?this.closeSidebar():this.openSidebar())});let l=t.helper.model.getData("b/openAction");"icon"!==l&&e(document).on(l+".bs dragover.bs",e=>{let t=!1;t="dragover"===e.type?s:"mousedown"!==e.type||0===e.button,e.isTrusted&&t&&g(e.pageX,e.pageY)?(e.stopPropagation(),e.preventDefault(),"mousemove"===l?p.open||(p.open=setTimeout(()=>{this.openSidebar()},o)):(0===o||null===n||+new Date-n>o)&&this.openSidebar()):b("open")})},g=(e,s)=>{let l=!1;if(null!==c&&+new Date-c<500);else if(void 0!==e&&null!==e&&(e>0||s>0||d)){d=!0,"right"===a&&(e=window.innerWidth-e-1);let s=m();t.elements.indicator.hasClass(t.opts.classes.page.hover)&&i>s&&(s=i),l=e<s}return!1===l?n=null:null===n&&(n=+new Date),l},b=e=>{p[e]&&(clearTimeout(p[e]),p[e]=null)},k=async()=>{e(t.opts.leftsideBackSelector).length()>0?t.elements.indicator.addClass(t.opts.classes.page.hasLeftsideBack):e(document).on(t.opts.events.lsbLoaded+".bs",e=>{e.detail.showIndicator&&t.elements.indicator.addClass(t.opts.classes.page.hasLeftsideBack)})}},window.TooltipHelper=function(t){let a={},s={};this.init=(async()=>{s=t.helper.model.getData(["b/tooltipContent","b/tooltipDelay","b/sidebarPosition"])}),this.create=(r=>{let o=r.attr(t.opts.attr.id);if(o){l(o);let i=t.elements.iframeBody.find("div."+t.opts.classes.tooltip.wrapper+"["+t.opts.attr.id+"='"+o+"']");if(i.length()>0)0!==i[0].getBoundingClientRect().top&&i.addClass(t.opts.classes.tooltip.visible);else if(-1!=+s.tooltipDelay){let l=e("<div />").addClass(t.opts.classes.tooltip.wrapper).attr(t.opts.attr.id,o).appendTo(t.elements.iframeBody),i=t.helper.entry.getData(o);"all"!==s.tooltipContent&&"title"!==s.tooltipContent||l.append("<h3>"+i.title+"</h3>"),i.isDir?l.append("<span>"+i.children.length+" "+t.helper.i18n.get("sidebar_dir_children")+"</span>"):"all"!==s.tooltipContent&&"url"!==s.tooltipContent||l.append("<span>"+i.url+"</span>"),a[o]&&(clearTimeout(a[o]),a[o]=null),a[o]=setTimeout(()=>{l.addClass(t.opts.classes.tooltip.visible),l.css("top",r[0].getBoundingClientRect().top+r.realHeight()/2-l.realHeight()/2+"px"),"right"===s.sidebarPosition?l.css("right",r.realWidth()+10+"px"):l.css("left",r.parent("li")[0].offsetLeft+r.realWidth()+"px")},1e3*+s.tooltipDelay)}}else l()}),this.close=(()=>{l()});let l=s=>{Object.values(a).forEach(e=>{e&&clearTimeout(a[e])}),a={};let l=t.elements.iframeBody.find("div."+t.opts.classes.tooltip.wrapper+(s?":not(["+t.opts.attr.id+"='"+s+"'])":""));l.removeClass(t.opts.classes.tooltip.visible),e.delay(300).then(()=>{l.remove()})}},window.UtilityHelper=function(t){this.openUrl=((e,a="default",s=!0)=>{t.helper.model.setData({"u/lastOpened":e.id}),"incognito"===a?t.helper.model.call("openLink",{href:e.url,incognito:!0}):t.helper.model.call("openLink",{parentId:e.parentId,id:e.id,href:e.url,newTab:"newTab"===a,position:t.helper.model.getData("b/newTabPosition"),active:s})}),this.openAllBookmarks=((e,a=!0)=>{t.helper.model.call("trackEvent",{category:"url",action:"open",label:"new_tab_all_children",value:e.length}),"afterCurrent"===t.helper.model.getData("b/newTabPosition")&&e.reverse(),e.forEach(e=>{this.openUrl(e,"newTab",a)})}),this.getPageType=(()=>{let t=location.href,a="other",s=!1,l={newtab_default:["https?://www.google..+/_/chrome/newtab"],newtab_replacement:[e.api.extension.getURL("html/newtab.html")],newtab_website:[".*[?&]bs_nt=1(&|#|$)"],website:["https?://"],onboarding:["chrome-extension://.*/intro.html"],chrome:["chrome://"],extension:["chrome-extension://"],local:["file://"]};return Object.keys(l).some(e=>{if(l[e].some(l=>{if(0===t.search(new RegExp(l,"gi")))return a=e,s=!0,!0}),s)return!0}),a}),this.isBackgroundConnected=(()=>{let t=e.api.runtime.connect();return!!t&&(t.disconnect(),!0)}),this.sidebarHasMask=(()=>{let e=t.helper.utility.getPageType();return!e.startsWith("newtab_")&&"onboarding"!==e}),this.triggerEvent=((e,a={},s=null)=>{(s||document).dispatchEvent(new CustomEvent(t.opts.events[e],{detail:a,bubbles:!0,cancelable:!1}))}),this.copyToClipboard=(a=>{let s=e("<textarea />").text(a).appendTo(t.elements.iframeBody);s[0].select();let l=!1;try{l=t.elements.iframe[0].contentDocument.execCommand("copy")}catch(e){}return s.remove(),l}),this.isWindowed=(()=>0!==window.screenX||0!==window.screenY||window.screen.availWidth!==window.innerWidth)},window.ext=function(t){let a={};this.initialized=null,this.firstRun=!0,this.refreshRun=!0,this.elements={},this.opts=t,this.run=(()=>{s(),this.helper.model.init().then(()=>this.helper.i18n.init()).then(()=>(l(),this.helper.font.init(),this.helper.stylesheet.init(),this.helper.stylesheet.addStylesheets(["content"]),Promise.all([r(),this.helper.entry.init()]))).then(()=>{this.elements.iframe&&this.elements.iframe[0]&&(this.helper.toggle.init(),this.helper.list.init(),this.helper.scroll.init(),this.helper.tooltip.init(),this.helper.sidebarEvents.init(),this.helper.dragndrop.init(),this.helper.keyboard.init(),""===document.referrer&&this.helper.model.call("addViewAmount",{url:location.href}))})}),this.reload=(()=>{this.helper.model.init().then(()=>Promise.all([this.helper.i18n.init(),this.helper.entry.init()])).then(()=>{!1===this.helper.model.getData(["u/entriesLocked","u/showHidden"]).entriesLocked?this.elements.sidebar.addClass(t.classes.sidebar.entriesUnlocked):this.elements.sidebar.removeClass(t.classes.sidebar.entriesUnlocked),this.helper.list.updateBookmarkBox()})}),this.trackInitialEvents=(()=>{let a=()=>{let e=this.helper.list.getSort();this.helper.model.call("trackEvent",{category:"sorting",action:"initial",label:e.name+"_"+e.dir});let a=this.elements.header.find("div."+t.classes.sidebar.searchBox+" > input[type='text']")[0].value;a.length>0&&this.helper.model.call("trackEvent",{category:"search",action:"search",label:"initial",value:a.length})};this.firstRun?e(document).on(t.events.loaded+".bs",()=>{a()}):a()}),this.loaded=(()=>{if(!this.elements.iframeBody.hasClass(t.classes.sidebar.extLoaded)){let e=this.helper.model.getData(["b/pxTolerance","a/showIndicator"]);this.elements.iframeBody.addClass(t.classes.sidebar.extLoaded),this.helper.list.updateSidebarHeader(),this.initialized=+new Date,console.log(+new Date-window.start),this.helper.utility.triggerEvent("loaded",{pxTolerance:e.pxTolerance,showIndicator:e.showIndicator})}}),this.startLoading=(()=>{this.elements.sidebar.addClass(t.classes.sidebar.loading),a.timeout&&clearTimeout(a.timeout),void 0!==a.loader&&0!==a.loader.length()||(a.loader=this.helper.template.loading().appendTo(this.elements.sidebar))}),this.endLoading=((e=500)=>{a.timeout=setTimeout(()=>{this.elements.sidebar.removeClass(t.classes.sidebar.loading),a.loader&&a.loader.remove(),a={}},e)}),this.initImages=(()=>{this.elements.iframe.hasClass(t.classes.page.visible)&&this.elements.sidebar.find("img["+t.attr.src+"]").forEach(a=>{let s=e(a),l=s.attr(t.attr.src);s.removeAttr(t.attr.src),s.attr("src",l)})}),this.addReloadMask=(()=>{this.elements.sidebar.text("");let a=e("<div />").attr("id",t.ids.sidebar.reloadInfo).prependTo(this.elements.sidebar),s=e("<div />").prependTo(a);e("<p />").html(this.helper.i18n.get("status_background_disconnected_reload_desc")).appendTo(s),e("<a />").text(this.helper.i18n.get("status_background_disconnected_reload_action")).appendTo(s)}),this.addShareUserdataMask=(()=>{this.elements.sidebar.find("#"+t.ids.sidebar.shareUserdata).remove();let a=e("<div />").attr("id",t.ids.sidebar.shareUserdata).prependTo(this.elements.sidebar),s=e("<div />").prependTo(a);e("<h2 />").html(this.helper.i18n.get("share_userdata_headline")).appendTo(s),e("<p />").html(this.helper.i18n.get("share_userdata_desc")).appendTo(s),e("<p />").html(this.helper.i18n.get("share_userdata_desc2")).appendTo(s),e("<p />").addClass(t.classes.sidebar.shareUserdataNotice).html(this.helper.i18n.get("share_userdata_notice")).appendTo(s),e("<a />").data("accept",!0).text(this.helper.i18n.get("share_userdata_accept")).appendTo(s),e("<a />").data("accept",!1).text(this.helper.i18n.get("share_userdata_decline")).appendTo(s)});let s=()=>{this.helper={model:new window.ModelHelper(this),toggle:new window.ToggleHelper(this),entry:new window.EntryHelper(this),list:new window.ListHelper(this),scroll:new window.ScrollHelper(this),template:new window.TemplateHelper(this),i18n:new window.I18nHelper(this),font:new window.FontHelper(this),sidebarEvents:new window.SidebarEventsHelper(this),search:new window.SearchHelper(this),stylesheet:new window.StylesheetHelper(this),dragndrop:new window.DragDropHelper(this),checkbox:new window.CheckboxHelper(this),keyboard:new window.KeyboardHelper(this),overlay:new window.OverlayHelper(this),utility:new window.UtilityHelper(this),specialEntry:new window.SpecialEntryHelper(this),contextmenu:new window.ContextmenuHelper(this),tooltip:new window.TooltipHelper(this)}},l=()=>{let a=e("iframe#"+t.ids.page.iframe);a.length()>0&&(console.log("DESTROY"),a.remove(),e("iframe#"+t.ids.page.overlay).remove(),e("div#"+t.ids.page.indicator).remove(),e(document).off("*.bs"),e(window).off("*.bs"))},r=async()=>{this.elements.iframe=e('<iframe id="'+t.ids.page.iframe+'" />').appendTo("body"),!1===this.helper.model.getData("b/animations")&&this.elements.iframe.addClass(t.classes.page.noAnimations),this.elements.iframeBody=this.elements.iframe.find("body"),this.elements.sidebar=e('<section id="'+t.ids.sidebar.sidebar+'" />').appendTo(this.elements.iframeBody),this.elements.bookmarkBox={},["all","search"].forEach(a=>{this.elements.bookmarkBox[a]=this.helper.scroll.add(t.ids.sidebar.bookmarkBox[a],e("<ul />").appendTo(this.elements.sidebar))}),this.elements.filterBox=e("<div />").addClass(t.classes.sidebar.filterBox).appendTo(this.elements.sidebar),this.elements.iframeBody.attr(t.attr.dragCancel,this.helper.i18n.get("sidebar_drag_cancel")),this.elements.header=e("<header />").prependTo(this.elements.sidebar),this.helper.stylesheet.addStylesheets(["sidebar"],this.elements.iframe);let a=this.helper.model.getData(["u/entriesLocked","u/showHidden","a/darkMode"]);!1===a.entriesLocked&&this.elements.sidebar.addClass(t.classes.sidebar.entriesUnlocked),!0===a.darkMode&&this.elements.iframeBody.addClass(t.classes.page.darkMode)}},e.api=e.api||window.browser||window.chrome;let t={ids:{page:{iframe:"blockbyte-bs-sidebar",overlay:"blockbyte-bs-overlay",indicator:"blockbyte-bs-indicator"},sidebar:{sidebar:"sidebar",shareUserdata:"shareUserdata",reloadInfo:"reloadInfo",bookmarkBox:{all:"bookmarkBox",search:"bookmarkBoxSearch"}},overlay:{urlList:"urlList"}},classes:{page:{visible:"blockbyte-bs-visible",hideMask:"blockbyte-bs-hideMask",hover:"blockbyte-bs-hover",noscroll:"blockbyte-bs-noscroll",hasLeftsideBack:"blockbyte-bs-has-lsb",style:"blockbyte-bs-style",noAnimations:"noAnimations",darkMode:"dark",ee:"ee"},sidebar:{extLoaded:"loaded",openedOnce:"openedOnce",active:"active",cached:"cached",mark:"mark",hideRoot:"hideRoot",entriesUnlocked:"entriesUnlocked",dirAnimated:"animated",dirOpened:"opened",bookmarkDir:"dir",dirIcon:"icon",separator:"separator",bookmarkLink:"link",bookmarkLabel:"label",entryPinned:"pinned",menu:"menu",sort:"sort",hidden:"hidden",hover:"hover",loading:"loading",copied:"copied",filterBox:"filter",search:"search",searchBox:"searchBox",searchClose:"searchClose",searchVisible:"searchVisible",shareUserdataNotice:"shareNotice"},tooltip:{wrapper:"tooltip",visible:"visible"},contextmenu:{wrapper:"contextmenu",top:"top",visible:"visible",list:"list",icons:"icons",right:"right",separator:"separator"},drag:{trigger:"drag",helper:"dragHelper",isDragged:"isDragged",cancel:"dragCancel",dragHover:"dragHover",snap:"snap",dragInitial:"dragInitial"},scrollBox:{wrapper:"scrollBox",scrollbar:"scrollbar",inactive:"inactive",hideScrollbar:"hideScrollbar",hidden:"hidden",scrolled:"scrolled"},checkbox:{box:"checkbox",active:"active",clicked:"clicked",focus:"focus"},overlay:{modal:"modal",visible:"visible",preview:"preview",previewUrl:"previewUrl",action:"action",close:"close",hasTooltip:"tooltip",inputError:"error",success:"success",progressBar:"progressBar",buttonWrapper:"buttons",checkUrlProgressLabel:"progressLabel",urlCheckLoading:"urlCheckLoading",urlCheckList:"urlCheckList"}},attr:{src:"data-src",position:"data-pos",type:"data-type",name:"data-name",value:"data-value",sort:"data-sort",direction:"data-direction",dragCancel:"data-dragCancel",id:"data-id"},events:{loaded:"blockbyte-bs-loaded",sidebarOpened:"blockbyte-bs-sidebar-opened",checkboxChanged:"blockbyte-bs-checkbox-changed",scrollBoxLastPart:"blockbyte-bs-scrollbox-lastpart",lsbLoaded:"blockbyte-lsb-loaded"},leftsideBackSelector:"div#blockbyte-lsb-indicator.blockbyte-lsb-visible",manifest:e.api.runtime.getManifest(),demoMode:!1};new window.ext(t).run()})(jsu);