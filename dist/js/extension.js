/*! (c) Philipp KÃ¶nig under GPL-3.0 */
(e=>{"use strict";window.BookmarkHelper=function(t){this.removeEntry=(l=>new Promise(a=>{let r=t.helper.entry.getDataById(l);r&&r.url?(Object.values(t.elm.bookmarkBox).some(l=>{if(l.hasClass(e.cl.general.active)){let a=l.find("a["+e.attr.id+"='"+r.id+"']");a.data("restore",r);let i=e("<span />").addClass(e.cl.sidebar.removeMask).append("<em>"+t.helper.i18n.get("sidebar_deleted")+"</em>").append("<span>"+t.helper.i18n.get("sidebar_undo_deletion")+"</span>").appendTo(a);return e.delay(100).then(()=>{a.addClass(e.cl.sidebar.removed),i.children("span")[0].offsetTop>0&&i.children("em").remove()}),!0}}),this.performDeletion(r).then(a)):(t.helper.overlay.create("delete",t.helper.i18n.get("contextmenu_delete_dir"),r),a())})),this.editEntry=(e=>new Promise(l=>{let a=t.helper.model.getData("u/additionalInfo");a[e.id]={desc:e.additionalInfo},Promise.all([t.helper.model.call("updateBookmark",{id:e.id,title:e.title,url:e.url,preventReload:!0}),t.helper.model.setData({"u/additionalInfo":a})]).then(l)})),this.restoreEntry=(l=>new Promise(a=>{if(l&&l.length()>0){let r=l.data("restore");l.removeClass(e.cl.sidebar.removed).addClass(e.cl.sidebar.restored),e.delay(500).then(()=>(l.children("span."+e.cl.sidebar.removeMask).remove(),t.helper.model.call("createBookmark",r))).then(a=>{let i=[];if(a&&a.created){l.attr(e.attr.id,a.created),t.helper.model.call("trackEvent",{category:"extension",action:"restore",label:r.url?"bookmark":"directory"});let o=t.helper.model.getData("u/additionalInfo");o[r.id]&&(o[a.created]=o[r.id],i.push(t.helper.model.setData({"u/additionalInfo":o})))}return i.push(t.helper.entry.init()),Promise.all(i)}).then(()=>{a()})}else a()})),this.performDeletion=(e=>new Promise(l=>{t.helper.model.call("trackEvent",{category:"extension",action:"remove",label:e.url?"bookmark":"directory"}),t.helper.model.call("deleteBookmark",{id:e.id}).then(()=>{l()})})),this.pinEntry=(e=>new Promise(a=>{let r=t.helper.model.getData("u/pinnedEntries"),i=-1;Object.values(r).forEach(e=>{i=Math.max(i,e.index)}),r[e.id]={index:i+1},t.helper.model.call("trackEvent",{category:"extension",action:"pinnedEntry",label:"pin"}),l(r).then(a)})),this.unpinEntry=(e=>new Promise(a=>{let r=t.helper.model.getData("u/pinnedEntries");delete r[e.id],t.helper.model.call("trackEvent",{category:"extension",action:"pinnedEntry",label:"unpin"}),l(r).then(a)})),this.reorderPinnedEntries=(e=>new Promise(a=>{let r=t.helper.model.getData("u/pinnedEntries"),i=0;if(e.prevId){let l=t.helper.entry.getDataById(e.prevId);i=l.pinnedIndex+1}Object.keys(r).forEach(l=>{+l==+e.id?(r[l].index=i,t.helper.entry.addData(l,"pinnedIndex",i)):r[l].index>=i&&(r[l].index++,t.helper.entry.addData(l,"pinnedIndex",r[l].index))}),l(r).then(a)}));let l=e=>new Promise(l=>{Promise.all([t.helper.model.call("removeCache",{name:"htmlList"}),t.helper.model.call("removeCache",{name:"htmlPinnedEntries"}),t.helper.model.setData({"u/pinnedEntries":e})]).then(l)})},window.CheckboxHelper=function(t){let l={};this.get=((t,l,a="checkbox",r="default")=>{let o=e("<div />").html("<input type='checkbox' />").data("uid",Math.random().toString(36).substr(2,12)).attr(e.attr.type,a).attr(e.attr.style,r).addClass(e.cl.checkbox.box);return l&&(o.children("input[type='checkbox']").attr(l),l[e.attr.name]&&o.attr(e.attr.name,l[e.attr.name])),this.isChecked(o)&&o.addClass(e.cl.general.active),i(o,t),o}),this.isChecked=(e=>e.find("input[type='checkbox']")[0].checked);let a=(l,a)=>{let r=l.children("input[type='checkbox']");r.trigger("change"),t.helper.utility&&t.helper.utility.triggerEvent("checkboxChanged",{container:l,checkbox:r,checked:l.hasClass(e.cl.general.active)},a.document()[0])},r=(t,i)=>{t.addClass(e.cl.checkbox.clicked),t.removeClass(e.cl.checkbox.focus),t.toggleClass(e.cl.general.active);let o=t.hasClass(e.cl.general.active),n=t.children("input[type='checkbox']");if("radio"===t.attr(e.attr.type)&&t.attr(e.attr.name))if(i){let l=t.attr(e.attr.name);t.addClass(e.cl.general.active),o&&(n.attr("checked",!0),a(t,i)),i.find("div."+e.cl.checkbox.box+"["+e.attr.type+"='radio']["+e.attr.name+"='"+l+"']").forEach(l=>{let a=e(l);l!==t[0]&&this.isChecked(a)&&r(a)})}else n.attr("checked",!1);else n.attr("checked",o),a(t,i);let s=t.data("uid");l[s]&&clearTimeout(l[s]),l[s]=setTimeout(()=>{t.removeClass(e.cl.checkbox.clicked)},300)},i=(t,l)=>{t.on("mousedown",t=>{t.preventDefault(),t.stopPropagation(),e(t.currentTarget).addClass(e.cl.checkbox.focus)}).on("click",t=>{t.preventDefault(),t.stopPropagation(),r(e(t.currentTarget),l)}),l.on("click",()=>{t.removeClass(e.cl.checkbox.focus)})}},window.ContextmenuHelper=function(t){let l={};this.create=((l,c)=>{if(t.helper.toggle.addSidebarHoverClass(),t.helper.tooltip.close(),!1===a(l,c)){this.close(),c.addClass(e.cl.general.active);let a=e("<div />").addClass(e.cl.contextmenu.wrapper).html("<ul class='"+e.cl.contextmenu.list+"'></ul><ul class='"+e.cl.contextmenu.icons+"'></ul>").attr(e.attr.type,l).data("elm",c).appendTo(t.elm.sidebar),h=l,p=c.attr(e.attr.id);switch(p&&a.attr(e.attr.id,p),l){case"list":{n(a,c);let e=t.helper.entry.getDataById(p);h=e&&e.isDir?"directory":"bookmark";break}case"separator":o(a,c);break;case"menu":i(a,c);break;case"sort":r(a,c)}t.helper.model.call("trackEvent",{category:"contextmenu",action:"open",label:h}),d(a),s(a,c,l),e.delay().then(()=>{a.addClass(e.cl.general.visible)})}}),this.close=(()=>{let l=t.elm.iframeBody.find("div."+e.cl.contextmenu.wrapper);l.forEach(t=>{e(t).removeClass(e.cl.general.visible),e(t).data("elm").removeClass(e.cl.general.active)}),e.delay(500).then(()=>{l.remove(),t.helper.toggle.removeSidebarHoverClass()})});let a=(l,a)=>{let r=a.attr(e.attr.id),i=a.attr(e.attr.value),o="div."+e.cl.contextmenu.wrapper+"["+e.attr.type+"='"+l+"']";return r?o+="["+e.attr.id+"='"+r+"']":i&&(o+="["+e.attr.value+"='"+i+"']"),t.elm.sidebar.find(o).length()>0},r=l=>{let a=t.helper.list.getSortList(),r=t.helper.list.getSort(),i=l.children("ul."+e.cl.contextmenu.list);l.children("ul."+e.cl.contextmenu.icons).remove(),Object.keys(a).forEach(a=>{let o=a.replace(/([A-Z])/g,"_$1").toLowerCase();e("<li />").append(t.helper.checkbox.get(t.elm.iframeBody,{[e.attr.name]:"sort",[e.attr.value]:a},"radio")).append("<a "+e.attr.name+"='sort'>"+t.helper.i18n.get("sort_label_"+o)+"</a>").appendTo(i),a===r.name&&l.find("input["+e.attr.name+"='sort']["+e.attr.value+"='"+a+"']").parent("div."+e.cl.checkbox.box).trigger("click")})},i=l=>{let a=l.children("ul."+e.cl.contextmenu.list),r=l.children("ul."+e.cl.contextmenu.icons);e("<li />").append(t.helper.checkbox.get(t.elm.iframeBody,{[e.attr.name]:"toggleHidden"})).append("<a "+e.attr.name+"='toggleHidden'>"+t.helper.i18n.get("contextmenu_toggle_hidden")+"</a>").appendTo(a),t.helper.model.getData("u/showHidden")&&l.find("input["+e.attr.name+"='toggleHidden']").parent("div."+e.cl.checkbox.box).trigger("click"),e("<li />").append("<a "+e.attr.name+"='reload'>"+t.helper.i18n.get("contextmenu_reload_sidebar")+"</a>").appendTo(a);let i=t.elm.bookmarkBox.all.children("ul"),o=i.hasClass(e.cl.sidebar.hideRoot),n=!1;i.find("a."+e.cl.sidebar.dirOpened).forEach(t=>{if(!1===o||e(t).parents("li").length()>1)return n=!0,!1}),n&&e("<li />").append("<a "+e.attr.name+"='closeAll'>"+t.helper.i18n.get("contextmenu_close_all_directories")+"</a>").appendTo(a),r.append("<li><a "+e.attr.name+"='settings' title='"+t.helper.i18n.get("settings_title")+"'></a></li>").append("<li><a "+e.attr.name+"='bookmarkManager' title='"+t.helper.i18n.get("contextmenu_bookmark_manager")+"'></a></li>").append("<li class='"+e.cl.contextmenu.right+"'><a "+e.attr.name+"='keyboardShortcuts' title='"+t.helper.i18n.get("contextmenu_keyboard_shortcuts")+"'></a></li>")},o=(l,a)=>{let r=a.attr(e.attr.id),i=t.helper.entry.getDataById(r);if(i&&i.parents&&i.parents.length>0){let a=l.children("ul."+e.cl.contextmenu.list);i.parents.length>0&&a.append("<li><a "+e.attr.name+"='delete'>"+t.helper.i18n.get("contextmenu_delete_separator")+"</a></li>")}l.children("ul."+e.cl.contextmenu.icons).remove()},n=(l,a)=>{let r=a.attr(e.attr.id),i=t.helper.entry.getDataById(r);if(i){let o=i.isDir?"_dir":"_bookmark",n=l.children("ul."+e.cl.contextmenu.list),s=l.children("ul."+e.cl.contextmenu.icons);if(t.helper.search.isResultsVisible()&&n.append("<li><a "+e.attr.name+"='showInDir'>"+t.helper.i18n.get("contextmenu_show_in_dir")+"</a></li>"),i.isDir){let l=i.children.filter(e=>e.url&&"about:blank"!==e.url);l.length>0&&n.append("<li><a "+e.attr.name+"='openChildren'>"+t.helper.i18n.get("contextmenu_open_children")+" <span>("+l.length+")</span></a></li>"),i.children.length>0&&n.append("<li><a "+e.attr.name+"='updateUrls'>"+t.helper.i18n.get("contextmenu_update_urls")+"</a></li>")}else n.append("<li><a "+e.attr.name+"='newTab'>"+t.helper.i18n.get("contextmenu_new_tab")+"</a></li>"),n.append("<li><a "+e.attr.name+"='newWindow'>"+t.helper.i18n.get("contextmenu_new_window")+"</a></li>"),!1===chrome.extension.inIncognitoContext&&n.append("<li><a "+e.attr.name+"='newIncognito'>"+t.helper.i18n.get("contextmenu_new_tab_incognito")+"</a></li>");s.append("<li><a "+e.attr.name+"='infos' title='"+t.helper.i18n.get("contextmenu_infos")+"'></a></li>"),i.parents.length>0&&s.append("<li><a "+e.attr.name+"='edit' title='"+t.helper.i18n.get("contextmenu_edit"+o)+"'></a></li>").append("<li><a "+e.attr.name+"='delete' title='"+t.helper.i18n.get("contextmenu_delete"+o)+"'></a></li>"),i.isDir?s.append("<li><a "+e.attr.name+"='add' title='"+t.helper.i18n.get("contextmenu_add")+"'></a></li>"):i.pinned?s.append("<li><a "+e.attr.name+"='unpin' title='"+t.helper.i18n.get("contextmenu_unpin")+"'></a></li>"):s.append("<li><a "+e.attr.name+"='pin' title='"+t.helper.i18n.get("contextmenu_pin")+"'></a></li>"),t.helper.entry.isVisible(r)?s.append("<li class='"+e.cl.contextmenu.right+"'><a "+e.attr.name+"='hide' title='"+t.helper.i18n.get("contextmenu_hide_from_sidebar")+"'></a></li>"):!1===t.helper.search.isResultsVisible()&&a.parents("li."+e.cl.general.hidden).length()<=1&&s.append("<li class='"+e.cl.contextmenu.right+"'><a "+e.attr.name+"='showHidden' title='"+t.helper.i18n.get("contextmenu_show_in_sidebar")+"'></a></li>")}},s=(l,a,r)=>{let i=l.realWidth(),o=l.realHeight(),n=a[0].getBoundingClientRect(),s=n.top+n.height;if(s+o>=window.innerHeight?l.css("top",s-o).addClass(e.cl.contextmenu.top):l.css("top",s+"px"),"sort"!==r&&"menu"!==r){let e=a.parent("li")[0].offsetLeft;t.helper.i18n.isRtl()&&(e=n.width-i),l.css("left",e+"px")}};l.settings=(()=>{t.helper.model.call("openLink",{href:chrome.extension.getURL("html/settings.html"),newTab:!0})}),l.checkbox=(t=>{t.eventObj.stopPropagation(),e(t.elm).prev("div."+e.cl.checkbox.box).trigger("click")}),l.bookmarkManager=(()=>{t.helper.model.call("openLink",{href:"chrome://bookmarks",newTab:!0,active:!0})}),l.newIncognito=(e=>{t.helper.model.call("trackEvent",{category:"url",action:"open",label:"new_window_incognito"}),e.data&&t.helper.utility.openUrl(e.data,"incognito")}),l.newWindow=(e=>{t.helper.model.call("trackEvent",{category:"url",action:"open",label:"new_window"}),e.data&&(t.helper.utility.openUrl(e.data,"newWindow"),t.helper.toggle.closeSidebar())}),l.newTab=(e=>{if(t.helper.model.call("trackEvent",{category:"url",action:"open",label:"new_tab_contextmenu"}),e.data){let l="foreground"===t.helper.model.getData("b/newTab");e.data.reopenSidebar=t.helper.model.getData("b/reopenSidebar"),t.helper.utility.openUrl(e.data,"newTab",l),l&&t.helper.toggle.closeSidebar()}}),l.delete=(e=>{t.helper.bookmark.removeEntry(e.data.id)}),l.showHidden=(e=>{t.startLoading();let l=t.helper.model.getData("u/hiddenEntries");delete l[e.id],t.helper.model.setData({"u/hiddenEntries":l}).then(()=>Promise.all([t.helper.model.call("removeCache",{name:"htmlList"}),t.helper.model.call("removeCache",{name:"htmlPinnedEntries"})])).then(()=>{t.helper.model.call("reload",{type:"Hide"})})}),l.openChildren=(e=>{if(e.data){let l=e.data.children.filter(e=>e.url&&"about:blank"!==e.url);l.length>t.helper.model.getData("b/openChildrenWarnLimit")?t.helper.overlay.create(e.name,t.helper.i18n.get("contextmenu_open_children"),e.data):t.helper.utility.openAllBookmarks(l)}}),l.pin=(e=>{t.helper.bookmark.pinEntry(e.data).then(()=>{t.helper.model.call("reload",{type:"Pin"})})}),l.unpin=(e=>{t.helper.bookmark.unpinEntry(e.data).then(()=>{t.helper.model.call("reload",{type:"Unpin"})})}),l.showInDir=(l=>{let a=t.helper.entry.getDataById(l.id);if(a&&a.parents){let r=i=>{if(a.parents[i]){let l=t.elm.bookmarkBox.all.find("ul > li > a."+e.cl.sidebar.bookmarkDir+"["+e.attr.id+"='"+a.parents[i]+"']");l.hasClass(e.cl.sidebar.dirOpened)?r(i+1):t.helper.list.toggleBookmarkDir(l,!0,!1).then(()=>{r(i+1)})}else Promise.all([t.helper.list.cacheList(),t.helper.search.clearSearch()]).then(()=>{let a=t.elm.bookmarkBox.all.find("ul > li > a["+e.attr.id+"='"+l.id+"']");t.helper.scroll.setScrollPos(t.elm.bookmarkBox.all,a[0].offsetTop-50),a.addClass(e.cl.sidebar.mark)})};r(0)}}),l.reload=(()=>{t.helper.model.call("reload",{type:"Force"})}),l.closeAll=(()=>{let l=t.elm.bookmarkBox.all.children("ul"),a=l.hasClass(e.cl.sidebar.hideRoot),r=[];l.find("a."+e.cl.sidebar.dirOpened).forEach(l=>{(!1===a||e(l).parents("li").length()>1)&&r.push(t.helper.list.toggleBookmarkDir(e(l),!1,!1))}),Promise.all(r).then(()=>{t.helper.list.cacheList()})});let d=a=>{a.find("input["+e.attr.name+"='sort']").on("change",l=>{if(l.currentTarget.checked){let a=e(l.currentTarget).attr(e.attr.value);t.helper.list.updateSort(a),this.close()}}),a.find("input["+e.attr.name+"='toggleHidden']").on("change",l=>{t.startLoading(),Promise.all([t.helper.model.call("removeCache",{name:"htmlList"}),t.helper.model.call("removeCache",{name:"htmlPinnedEntries"}),t.helper.model.setData({"u/showHidden":t.helper.checkbox.isChecked(e(l.currentTarget).parent("div"))})]).then(()=>{t.helper.model.call("reload",{type:"ToggleHidden"})}),this.close()}),a.on("mouseleave",t=>{e(t.currentTarget).find("a").removeClass(e.cl.general.hover)}),a.find("a").on("mouseenter",t=>{a.find("a").removeClass(e.cl.general.hover),e(t.currentTarget).addClass(e.cl.general.hover)}).on("mouseleave",t=>{e(t.currentTarget).removeClass(e.cl.general.hover)}).on("click",r=>{r.preventDefault();let i={elm:r.currentTarget,eventObj:r,name:e(r.currentTarget).attr(e.attr.name),id:a.attr(e.attr.id)};i.data=i.id?t.helper.entry.getDataById(i.id):null,"sort"!==i.name&&"toggleHidden"!==i.name||(i.name="checkbox"),"function"==typeof l[i.name]?l[i.name](i):t.helper.overlay.create(i.name,e(i.elm).attr("title")||e(i.elm).text(),i.data)})}},window.DragDropHelper=function(t){let l=null,a=null,r=0,i=null,o={running:!1,posY:null,previousDelta:0,fpsLimit:30};this.init=(async()=>{l=t.helper.model.getData("b/sidebarPosition"),u(),s()}),this.cancel=(()=>{let l=t.elm.iframeBody.children("a."+e.cl.drag.helper),a=t.elm.bookmarkBox.all.find("li."+e.cl.drag.dragInitial),r=l.data("elm");if(r){let t=r.children("a");r.insertAfter(a).removeClass(e.cl.drag.isDragged),c(t,{type:"end",cancel:!0})}a.remove(),l.remove(),t.elm.iframeBody.removeClass([e.cl.drag.isDragged,e.cl.drag.cancel]),e.delay(500).then(()=>{t.helper.toggle.removeSidebarHoverClass()})});let n=e=>{let a=0;if("object"==typeof e){a=e[0].getBoundingClientRect().left}else a=+e;return"right"===l&&(a=window.innerWidth-a),"object"==typeof e?.6*e.realWidth()+a>t.elm.sidebar.realWidth():a>t.elm.sidebar.realWidth()},s=async()=>{t.elm.iframeBody.on("dragenter",()=>{t.helper.contextmenu.close(),t.helper.tooltip.close(),t.elm.iframeBody.addClass(e.cl.drag.isDragged),t.helper.toggle.addSidebarHoverClass(),c("selection",{type:"start"}),o.running||window.requestAnimationFrame(h)}).on("drop dragend",l=>{if(l.preventDefault(),l.stopPropagation(),o.posY=null,t.elm.iframeBody.hasClass(e.cl.drag.isDragged)){if(n(l.pageX)||!1!==t.helper.search.isResultsVisible())c("selection",{type:"end",cancel:!0});else{let a=t.elm.bookmarkBox.all.find("li."+e.cl.drag.isDragged).eq(0);if(a&&a.length()>0){let r=l.dataTransfer.getData("URL"),i=l.dataTransfer.getData("text/plain");if(location.href===r)i=e(document).find("head > title").eq(0).text();else if(i===r){let t=l.dataTransfer.getData("text/html");i=t&&t.length>0?e("<div />").html(t).text():""}c("selection",{type:"end"}),t.helper.overlay.create("add",t.helper.i18n.get("contextmenu_add"),{values:{index:a.prevAll("li").length(),parentId:a.parent("ul").prev("a").attr(e.attr.id),title:i,url:r}})}}t.elm.iframeBody.removeClass([e.cl.drag.isDragged,e.cl.drag.cancel]),t.helper.toggle.removeSidebarHoverClass()}})},d=t=>{let l="bookmark";return"selection"===t?l=t:t.data("type")?l=t.data("type"):(t.hasClass(e.cl.sidebar.bookmarkDir)?l="directory":t.parents("div."+e.cl.sidebar.entryPinned).length()>0&&(l="pinned"),t.data("type",l)),l},c=(e,l={})=>{let a=null;"end"===l.type?a=l.cancel?"cancel":"dragend":"start"===l.type&&(a="dragstart"),a&&t.helper.model.call("trackEvent",{category:"dragndrop",action:d(e),label:a})},h=e=>{window.requestAnimationFrame(h);let l=e-o.previousDelta;if(!(o.fpsLimit&&l<1e3/o.fpsLimit)){if(null!==o.posY){let e=t.elm.bookmarkBox.all[0].offsetTop,l=t.elm.bookmarkBox.all[0].offsetHeight,a=t.helper.scroll.getScrollPos(t.elm.bookmarkBox.all),r=null;o.posY-e<60?r=a-Math.pow((50-o.posY+e)/10,2):o.posY+60>l&&(r=a+Math.pow((o.posY+50-l)/10,2)),r&&t.helper.scroll.setScrollPos(t.elm.bookmarkBox.all,r)}o.previousDelta=e}},p=()=>{m();let l=t.elm.iframeBody.children("a."+e.cl.drag.helper),a=t.elm.bookmarkBox.all.find("li."+e.cl.drag.dragInitial),r=l.data("elm"),i=r.children("a"),o=d(i);if(n(l))this.cancel();else{l.addClass(e.cl.drag.snap);let n=r.parent("ul").prev("a").attr(e.attr.id),s=0;r.prevAll("li").forEach(e=>{e!==a&&s++}),"pinned"===o?t.helper.bookmark.reorderPinnedEntries({id:r.children("a").attr(e.attr.id),prevId:r.prev("li").children("a").attr(e.attr.id)}):t.helper.model.call("moveBookmark",{id:r.children("a").attr(e.attr.id),parentId:n,index:s}),c(i,{type:"end"}),t.elm.iframeBody.removeClass(e.cl.drag.isDragged),e.delay().then(()=>{let t=r[0].getBoundingClientRect();return l.css({top:t.top+"px",left:t.left+"px"}),e.delay(200)}).then(()=>(r.removeClass(e.cl.drag.isDragged),a.remove(),l.remove(),e.delay(300))).then(()=>{t.helper.toggle.removeSidebarHoverClass()})}},m=(t=null)=>{null===i||null!==t&&i.id===t.attr(e.attr.id)||(i.elm.removeClass(e.cl.drag.dragHover),clearTimeout(i.instance),i=null)},g=(l,s,c)=>{let h=null,p=null,g=0,u=0;if("dragover"===l){if(u=s,(g=c-20)===r)return!1;r=g,t.elm.bookmarkBox.all.find("li."+e.cl.drag.isDragged).remove(),p=e("<li />").html("<a>&nbsp;</a>").addClass(e.cl.drag.isDragged)}else{let l=(h=t.elm.iframeBody.children("a."+e.cl.drag.helper)).data("startPos");g=c-l.top,u=s-l.left,h.css({top:g+"px",left:u+"px"}),p=h.data("elm")}if(n(h||u))return m(),t.elm.iframeBody.addClass(e.cl.drag.cancel),!1;t.elm.iframeBody.removeClass(e.cl.drag.cancel);let b={elm:null},f=d(p.children("a")),v=null;if("pinned"===f?v=[t.elm.pinnedBox.find("> ul > li")]:(o.posY=c,v=[t.elm.bookmarkBox.all.find("a."+e.cl.sidebar.dirOpened+" + ul > li"),t.elm.bookmarkBox.all.find("> ul > li > a."+e.cl.sidebar.dirOpened).parent("li")]),v.some(t=>{t.forEach(t=>{let l=e(t);if(l[0]!==p[0]&&!l.hasClass(e.cl.drag.dragInitial)){let e=l[0].getBoundingClientRect(),t=g-e.top;if(e.top>g)return!1;(null===b.elm||b.diff>t)&&(b={elm:l,height:l[0].offsetHeight,diff:t})}})}),b.elm&&b.elm!==a){a=b.elm;let l=b.elm.children("a").eq(0),r=l.hasClass(e.cl.sidebar.bookmarkDir),o=b.diff/b.height*100;if(m(l),0===b.elm.nextAll("li:not(."+e.cl.drag.isDragged+")").length()&&o>80){let e=p.insertAfter(b.elm.parents("li").eq(0));h&&h.data("elm",e)}else if(r&&o<50)if(l.hasClass(e.cl.sidebar.dirOpened)){let e=p.prependTo(l.next("ul"));h&&h.data("elm",e)}else if(h&&h.data("isDir")){let e=p.insertAfter(b.elm);h&&h.data("elm",e)}else l.hasClass(e.cl.sidebar.dirAnimated)?0===l.next("ul").length()&&(l.addClass(e.cl.sidebar.dirOpened),e("<ul />").insertAfter(l)):null===i&&((i={id:l.attr(e.attr.id),elm:l.addClass(e.cl.drag.dragHover)}).instance=setTimeout(()=>{t.helper.list.toggleBookmarkDir(l)},1e3));else{m();let e=p.insertAfter(b.elm);h&&h.data("elm",e)}}else if("pinned"===f){let e=p.prependTo(t.elm.pinnedBox.children("ul"));h&&h.data("elm",e)}},u=async()=>{t.elm.bookmarkBox.all.on("mousedown","span."+e.cl.drag.trigger,l=>{t.helper.toggle.addSidebarHoverClass(),((l,a,r)=>{t.helper.contextmenu.close(),t.helper.tooltip.close();let i=e(l).parent("a").removeClass(e.cl.sidebar.dirOpened),n=t.helper.entry.getDataById(i.attr(e.attr.id));if(null===n)return!1;let s=i.parent("li"),d=s.parent("ul").prev("a");t.elm.iframeBody.addClass(e.cl.drag.isDragged),s.clone().addClass(e.cl.drag.dragInitial).insertAfter(s);let p=i.clone().appendTo(t.elm.iframeBody),m=i[0].getBoundingClientRect(),g=0;s.prevAll("li").forEach(t=>{e(t).hasClass(e.cl.drag.dragInitial)||g++}),p.removeAttr("title").css({top:m.top+"px",left:m.left+"px",width:i.realWidth()+"px"}).data({elm:s,isDir:!!n.isDir,parentId:d.length()>0?d.attr(e.attr.id):null,index:g,startPos:{top:r-m.top,left:a-m.left}}).addClass(e.cl.drag.helper),s.addClass(e.cl.drag.isDragged),c(i,{type:"start"}),o.running||window.requestAnimationFrame(h)})(l.currentTarget,l.pageX,l.pageY),g(l.type,l.pageX,l.pageY)}),t.elm.iframeBody.on("mouseup",l=>{o.posY=null,t.elm.iframeBody.hasClass(e.cl.drag.isDragged)&&(l.preventDefault(),l.stopPropagation(),1===l.which?p():e.delay(0).then(()=>{this.cancel()}))}),t.elm.iframeBody.on("wheel",l=>{if(t.elm.iframeBody.hasClass(e.cl.drag.isDragged)){l.preventDefault(),l.stopPropagation();let e=t.elm.bookmarkBox.all[0].scrollTop;t.helper.scroll.setScrollPos(t.elm.bookmarkBox.all,e-l.wheelDelta,300)}}),t.elm.iframeBody.on("mousemove dragover",l=>{t.elm.iframeBody.hasClass(e.cl.drag.isDragged)&&1===l.which&&(l.preventDefault(),l.stopPropagation(),g(l.type,l.pageX,l.pageY))}),t.elm.iframeBody.on("contextmenu","a."+e.cl.drag.helper,e=>{e.preventDefault(),e.stopPropagation()})}},window.EntryHelper=function(e){let t=!1,l={},a={},r={},i={bookmarks:{},directories:{},pinned:{}};this.init=(e=>(t=!0,new Promise(t=>{this.update(e).then(t)}))),this.initOnce=(()=>new Promise(e=>{t?e():this.init().then(e)})),this.getAmount=(t=>{if(o(),0===Object.keys(l).length&&(l=e.helper.model.getData("u/entryAmounts")),l&&l[t]){let e=l[t].visible;return a.showHidden&&(e+=l[t].hidden),e}return null}),this.getAllDataByType=(e=>Object.values(i[e]||{})),this.getDataById=(e=>{let t=null;return"object"==typeof i.bookmarks[e]?(t=i.bookmarks[e],"object"==typeof i.pinned[e]&&(t.pinnedIndex=i.pinned[e].index)):"object"==typeof i.directories[e]&&(t=i.directories[e]),t}),this.addData=((e,t,l)=>{"object"==typeof i.bookmarks[e]?("pinnedIndex"===t&&"object"==typeof i.pinned[e]&&(i.pinned[e].index=l),i.bookmarks[e][t]=l):"object"==typeof i.directories[e]&&(i.directories[e][t]=l)}),this.isSeparator=(e=>{let t=!1;if("object"==typeof i.bookmarks[e]){let l=i.bookmarks[e].title.replace(/[^-_]/g,"");t="about:blank"===i.bookmarks[e].url&&l.length===i.bookmarks[e].title.length}return t}),this.isVisible=(e=>{let t=!1;return"object"==typeof i.bookmarks[e]?t=!1===i.bookmarks[e].hidden:"object"==typeof i.directories[e]&&(t=!1===i.directories[e].hidden),t}),this.update=((t=null)=>new Promise(a=>{o();let s=[e.helper.model.call("viewAmounts")];null===t&&s.push(e.helper.model.call("bookmarks",{id:0})),Promise.all(s).then(o=>{r=o[0],null===t&&o[1]&&o[1].bookmarks&&o[1].bookmarks[0]&&o[1].bookmarks[0].children&&(t=o[1].bookmarks[0].children),i={bookmarks:{},directories:{},pinned:{}},l={bookmarks:{visible:0,hidden:0},directories:{visible:0,hidden:0},pinned:{visible:0,hidden:0}},n(t),e.helper.model.setData({"u/entryAmounts":l}),a()})}));let o=()=>{a=e.helper.model.getData(["u/hiddenEntries","u/additionalInfo","u/pinnedEntries","u/showHidden"])},n=(e,t=[],l=!1)=>{e.forEach(e=>{let i=[...t];"0"!==e.parentId&&i.push(e.parentId),e.additionalInfo=a.additionalInfo[e.id]||{},e.hidden=l||!0===a.hiddenEntries[e.id],e.parents=i,e.views={startDate:+new Date(Math.max(e.dateAdded,r.counterStartDate)),total:0},e.url?d(e):e.children&&s(e)})},s=e=>{e.childrenAmount={bookmarks:0,directories:0,total:0},e.parents.forEach(e=>{i.directories[e].childrenAmount.directories++}),i.directories[e.id]=e,n(e.children,e.parents,e.hidden),e.isDir=!0,e.childrenAmount.total=e.childrenAmount.bookmarks+e.childrenAmount.directories,e.views.perMonth=Math.round(e.views.total/c(e.views.startDate)*100)/100,l.directories[e.hidden?"hidden":"visible"]++},d=e=>{let t=0,o=0;if(r.viewAmounts[e.id]&&(t=r.viewAmounts[e.id].c,o=r.viewAmounts[e.id].d||0),e.views.total=t,e.views.lastView=o,e.views.perMonth=Math.round(t/c(e.views.startDate)*100)/100,e.parents.forEach(e=>{i.directories[e]&&(i.directories[e].childrenAmount.bookmarks++,i.directories[e].views.total+=t,i.directories[e].views.lastView=Math.max(i.directories[e].views.lastView||0,o))}),e.pinned=!1,i.bookmarks[e.id]=e,!1===this.isSeparator(e.id)&&l.bookmarks[e.hidden?"hidden":"visible"]++,a.pinnedEntries[e.id]){e.pinned=!0;let t=Object.assign({},e);t.index=a.pinnedEntries[e.id].index,delete t.parents,delete t.parentId,i.pinned[e.id]=t,l.pinned[e.hidden?"hidden":"visible"]++}},c=e=>Math.max(1,Math.round((+new Date-e)/2627999942.4))},window.FontHelper=function(t){let l={custom:{fontWeights:{Thin:100,ExtraLight:200,Light:300,Normal:400,Medium:500,SemiBold:600,Bold:700,ExtraBold:800,Black:900}},general:{name:"Roboto",href:"https://fonts.googleapis.com/css?family=Roboto:100,200,300,400,500,100i,200i,300i,400i,500i",fontWeights:{Thin:100,ExtraLight:100,Light:200,Normal:300,Medium:400,SemiBold:400,Bold:500,ExtraBold:500,Black:500}},fa:{fontWeights:{Thin:100,ExtraLight:100,Light:200,Normal:300,Medium:400,SemiBold:500,Bold:600,ExtraBold:600,Black:600}},ar:{fontWeights:{Thin:100,ExtraLight:100,Light:200,Normal:300,Medium:400,SemiBold:500,Bold:600,ExtraBold:600,Black:600}},he:{fontWeights:{Thin:100,ExtraLight:100,Light:200,Normal:300,Medium:400,SemiBold:500,Bold:600,ExtraBold:600,Black:600}},ja:{name:"Noto Sans Japanese",href:"https://fonts.googleapis.com/earlyaccess/notosansjapanese.css",fontWeights:{Thin:100,ExtraLight:100,Light:100,Normal:200,Medium:300,SemiBold:400,Bold:500,ExtraBold:500,Black:500}},"zh-CN":{name:"Noto Sans SC",href:"https://fonts.googleapis.com/earlyaccess/notosanssc.css",fontWeights:{Thin:100,ExtraLight:100,Light:100,Normal:300,Medium:400,SemiBold:400,Bold:400,ExtraBold:500,Black:500}},"zh-TW":{name:"Noto Sans TC",href:"https://fonts.googleapis.com/earlyaccess/notosanstc.css",fontWeights:{Thin:100,ExtraLight:100,Light:100,Normal:300,Medium:400,SemiBold:400,Bold:400,ExtraBold:500,Black:500}}},a={};this.init=((e="config")=>{let l=t.helper.model.getData("a/styles");(a="default"!==e&&l.fontFamily&&"default"!==l.fontFamily?{name:l.fontFamily}:this.getDefaultFontInfo()).fontWeights=this.getFontWeights(a.name)}),this.isLoaded=(()=>!!a.name),this.getFontInfo=(()=>a),this.getFontWeights=(e=>{let a=t.helper.i18n.getLanguage(),r={};return l[a]&&void 0===l[a].name&&(l[a].name=l.general.name),Object.entries(l.custom.fontWeights).forEach(([t,i])=>{l[a]&&l[a].fontWeights&&l[a].fontWeights[t]&&l[a].name===e?i=l[a].fontWeights[t]:l.general.fontWeights[t]&&l.general.name===e&&(i=l.general.fontWeights[t]),r["fontWeight"+t]=i}),r}),this.addStylesheet=(t=>{a.href&&e("<link />").attr({rel:"stylesheet",type:"text/css",href:a.href}).appendTo(t.find("head"))}),this.getDefaultFontInfo=(()=>{let e=t.helper.i18n.getLanguage();return l[e]&&l[e].name&&l[e].href?Object.assign({},l[e]):Object.assign({},l.general)})},window.I18nHelper=function(t){let l=null,a={},r=null;this.init=(()=>new Promise(e=>{t.helper.model.call("langvars").then(t=>{l=t.language,a=t.vars,r=t.dir,e()})})),this.getLanguage=(()=>l),this.isRtl=(()=>"rtl"===r),this.getUILanguage=(()=>chrome.i18n.getUILanguage()),this.getDefaultLanguage=(()=>e.opts.manifest.default_locale),this.getLocaleSortCollator=(()=>new Intl.Collator([this.getUILanguage(),this.getDefaultLanguage()])),this.getLocaleDate=(e=>e.toLocaleDateString([this.getUILanguage(),this.getDefaultLanguage()],{year:"numeric",month:"2-digit",day:"2-digit"})),this.parseHtml=(t=>{e(t).find("["+e.attr.i18n+"]").forEach(t=>{let l=null,a=e(t).attr(e.attr.i18n);if(a){let r=[],i=e(t).attr(e.attr.i18nReplaces);i&&(r=i.split(",")),l=this.get(a,r)}l?(e(t).removeAttr(e.attr.i18n),e(t).html(l)):e(t).remove()})}),this.get=((e,t=[])=>{let l="",r=a[e];return r&&r.message&&(l=r.message,t.forEach((e,t)=>{l=l.replace(new RegExp("\\{"+(t+1)+"\\}"),e)}),l=(l=(l=l.replace(/\[b\](.*)\[\/b\]/,"<strong>$1</strong>")).replace(/\[a\](.*)\[\/a\]/,"<a href='#'>$1</a>")).replace(/\[em\](.*)\[\/em\]/,"<em>$1</em>")),l})},window.KeyboardHelper=function(t){let l=!1;this.init=(async()=>{r()}),this.initOverlayEvents=(l=>{e(l[0].contentDocument).on("keydown",e=>{if("Escape"===e.key||"Esc"===e.key)e.preventDefault(),t.helper.overlay.closeOverlay(!0);else if("Enter"===e.key){let t=l[0].contentDocument.activeElement;null!==t&&"TEXTAREA"===t.tagName||(e.preventDefault(),i(l))}else"Tab"===e.key&&(e.preventDefault(),s(l))})});let a=()=>{let l=!1;return t.elm.iframe.hasClass(e.cl.page.visible)&&document&&document.activeElement&&(l=document.activeElement===t.elm.iframe[0]),l},r=()=>{e([document,t.elm.iframe[0].contentDocument]).on("keydown.bs",l=>{if(a()){let a=["ArrowDown","ArrowUp","PageDown","PageUp","Home","End","Space"],r=t.elm.sidebar.find("div."+e.cl.contextmenu.wrapper).length()>0,i=t.elm.iframeBody.hasClass(e.cl.drag.isDragged);if(a.indexOf(l.key)>-1||a.indexOf(l.code)>-1)t.helper.scroll.focus();else if("Tab"===l.key)l.preventDefault(),r?d():c(l.shiftKey?"prev":"next");else if("Enter"===l.key)l.preventDefault(),r?o():n(l.shiftKey,l.ctrlKey||l.metaKey);else if("Escape"===l.key||"Esc"===l.key)l.preventDefault(),i?t.helper.dragndrop.cancel():r?t.helper.contextmenu.close():t.helper.toggle.closeSidebar();else if("Delete"===l.key)l.preventDefault(),h();else if("c"===l.key&&(l.ctrlKey||l.metaKey))l.preventDefault(),p();else{let l=t.elm.header.find("div."+e.cl.sidebar.searchBox+" > input[type='text']");l[0]!==t.elm.iframe[0].contentDocument.activeElement&&l[0].focus()}}}).on("keyup.bs",()=>{if(a()){let l=t.elm.header.find("div."+e.cl.sidebar.searchBox+" > input[type='text']");if(l&&l.length()>0){l[0].value.length>0&&!t.elm.header.hasClass(e.cl.sidebar.searchVisible)&&(t.helper.contextmenu.close(),t.helper.tooltip.close(),t.elm.header.addClass(e.cl.sidebar.searchVisible))}}})},i=l=>{let a=l.find("menu["+e.attr.name+"='select'] > a."+e.cl.general.hover);a.length()>0?a.trigger("click"):t.helper.overlay.performAction()},o=()=>{let l=t.elm.sidebar.find("div."+e.cl.contextmenu.wrapper).find("a."+e.cl.general.hover);l.length()>0&&l.trigger("click")},n=(l,a)=>{Object.values(t.elm.bookmarkBox).some(r=>{if(r.hasClass(e.cl.general.active)){let i=r.find("ul > li > a."+e.cl.general.hover+", ul > li > a."+e.cl.sidebar.mark);if(i.length()>0)if(l){let l="list";i.hasClass(e.cl.sidebar.separator)&&(l="separator"),t.helper.contextmenu.create(l,i)}else t.helper.sidebarEvents.handleEntryClick(i,{ctrlKey:a});return!0}})},s=t=>{let l=t.find("menu["+e.attr.name+"='select'] > a."+e.cl.general.hover),a=t[0].contentDocument;if(l.length()>0){let a=null;a=l.next("a").length()>0?l.next("a"):t.find("menu["+e.attr.name+"='select'] > a").eq(0),t.find("menu["+e.attr.name+"='select'] > a."+e.cl.general.hover).removeClass(e.cl.general.hover),a.addClass(e.cl.general.hover)}else if("INPUT"===a.activeElement.tagName){let l=e(a.activeElement).parent("li"),r=null;(r=l.length()>0&&l.next("li").length()>0?l.next("li").find("input"):t.find("input").eq(0))[0].focus()}else t.find("input").length()>0?t.find("input")[0].focus():t.find("menu["+e.attr.name+"='select']").length()>0&&t.find("menu["+e.attr.name+"='select'] > a").eq(0).addClass(e.cl.general.hover)},d=()=>{let l=t.elm.sidebar.find("div."+e.cl.contextmenu.wrapper),a=null,r=null;l.find("a."+e.cl.general.hover).length()>0&&(r=l.find("a."+e.cl.general.hover).eq(0)),a=null===r?l.find("a").eq(0):r.parent("li").next("li").length()>0?r.parent("li").next("li").find("a"):r.parents("ul").eq(0).next("ul").length()>0?r.parents("ul").eq(0).next("ul").find("a").eq(0):l.find("a").eq(0),l.find("a."+e.cl.general.hover).removeClass(e.cl.general.hover),a.addClass(e.cl.general.hover)},c=l=>{Object.values(t.elm.bookmarkBox).some(a=>{if(a.hasClass(e.cl.general.active)){let r=t.helper.scroll.getScrollPos(a),i=null;if(a.find("ul > li > a."+e.cl.sidebar.mark).length()>0?i=a.find("ul > li > a."+e.cl.sidebar.mark).eq(0).parent("li"):a.find("ul > li > a."+e.cl.general.hover).length()>0?i=a.find("ul > li > a."+e.cl.general.hover).eq(0).parent("li"):a.find("ul > li > a."+e.cl.sidebar.lastHover).length()>0?i=a.find("ul > li > a."+e.cl.sidebar.lastHover).eq(0).parent("li"):a.find("ul > li").forEach(t=>{if(t.offsetTop>=r)return i=e(t),!1}),i){let o=i.children("a"),n=null;if(o.hasClass(e.cl.general.hover)||o.hasClass(e.cl.sidebar.mark)?"prev"===l?n=(t=>{let l=null;if(t.prev("li").length()>0){let a=t.prev("li").children("a");for(;a.hasClass(e.cl.sidebar.dirOpened)&&a.next("ul").length()>0;)a=a.next("ul").find("> li:last-child > a");l=a}else{let e=t.parents("li").eq(0);e.length()>0&&(l=e.children("a"))}return l})(i):"next"===l&&(n=(t=>{let l=t.children("a"),a=null;if(l.hasClass(e.cl.sidebar.dirOpened)&&l.next("ul").length()>0)a=l.next("ul").find("> li:first-child > a");else if(t.next("li").length()>0)a=t.next("li").children("a");else{let e=!1,l=0;for(;!1===e;){let r=t.parents("li").eq(l);r.length()>0?r.next("li").length()>0?(a=r.next("li").children("a"),e=!0):l++:e=!0}}return a})(i)):n=o,n){a.find("ul > li > a."+e.cl.general.hover).removeClass(e.cl.general.hover),a.find("ul > li > a."+e.cl.sidebar.mark).removeClass(e.cl.sidebar.mark),n.addClass([e.cl.general.hover,e.cl.sidebar.lastHover]);let l=n[0].offsetTop-r,i=window.innerHeight-l;l<0?t.helper.scroll.setScrollPos(a,n[0].offsetTop):i<150&&t.helper.scroll.setScrollPos(a,r+(150-i))}}return!0}})},h=()=>{l||(l=!0,Object.values(t.elm.bookmarkBox).some(a=>{if(a.hasClass(e.cl.general.active)){let r=a.find("> ul a."+e.cl.general.hover).eq(0);return r.length()>0&&0===r.children("span."+e.cl.sidebar.removeMask).length()&&t.helper.bookmark.removeEntry(r.attr(e.attr.id)).then(()=>{l=!1}),!0}}))},p=()=>{Object.values(t.elm.bookmarkBox).some(l=>{if(l.hasClass(e.cl.general.active)){let a=l.find("> ul a."+e.cl.general.hover).eq(0);if(a.length()>0){let l=t.helper.entry.getDataById(a.attr(e.attr.id));if(l&&l.url&&t.helper.utility.copyToClipboard(l.url)){e(a).children("span."+e.cl.sidebar.copied).remove();let l=e("<span />").addClass(e.cl.sidebar.copied).text(t.helper.i18n.get("sidebar_copied_to_clipboard")).appendTo(a);e.delay(100).then(()=>(e(a).addClass(e.cl.sidebar.copied),e.delay(1500))).then(()=>(e(a).removeClass(e.cl.sidebar.copied),e.delay(500))).then(()=>{l.remove()})}}return!0}})}},window.ListHelper=function(t){let l=0,a=null;this.init=(async()=>{t.elm.bookmarkBox.all.addClass(e.cl.general.active),Object.values(t.elm.bookmarkBox).forEach(l=>{l.on(e.opts.events.scrollBoxLastPart,()=>{let a=l.children("ul"),r=a.data("remainingEntries");r&&r.length>0&&(this.addBookmarkDir(r,a,!1,!1),(t.refreshRun||!1===t.elm.iframe.hasClass(e.cl.page.visible))&&t.helper.scroll.restoreScrollPos(l))})}),this.updateBookmarkBox()}),this.getSortList=(()=>({custom:{dir:"ASC"},alphabetical:{dir:"ASC"},mostUsed:{dir:"DESC"},recentlyUsed:{dir:"DESC"},recentlyAdded:{dir:"DESC"}})),this.getSort=(()=>a),this.updateSort=((e,l)=>{let r=this.getSortList();r[e]&&(void 0===l&&(l=r[e].dir),a={name:e,dir:"ASC"===l?"ASC":"DESC"},t.startLoading(),Promise.all([t.helper.model.call("removeCache",{name:"htmlList"}),t.helper.model.call("removeCache",{name:"htmlPinnedEntries"}),t.helper.model.setData({"u/sort":a})]).then(()=>{t.helper.model.call("trackEvent",{category:"sorting",action:"change",label:a.name+"_"+a.dir}),t.helper.model.call("reload",{scrollTop:!0,type:"Sort"})}))}),this.updateDirection=(e=>{this.updateSort(a.name,e)}),this.updateBookmarkBox=(()=>new Promise(l=>{t.startLoading(),a=t.helper.model.getData("u/sort"),t.elm.sidebar.attr(e.attr.sort,a.name);let r=t.elm.bookmarkBox.all.children("ul"),i=null;t.updateBookmarkBoxStart=+new Date,i=t.helper.model.getData("u/viewAsTree")||"custom"===a.name?Promise.all([t.helper.model.call("getCache",{name:"htmlList"}),t.helper.model.call("getCache",{name:"htmlPinnedEntries"})]):new Promise(e=>{e()}),t.helper.scroll.focus(),i.then(l=>l&&l[0]&&l[0].val?(l[1]&&l[1].val?(t.elm.pinnedBox.html(l[1].val),t.helper.model.getData("u/lockPinned")&&(t.elm.lockPinned.addClass(e.cl.sidebar.fixed),t.elm.pinnedBox.addClass(e.cl.sidebar.fixed)),o(t.elm.pinnedBox)):t.elm.pinnedBox.addClass(e.cl.general.hidden),h(r,l[0].val)):p(r)).then(()=>{l()})})),this.toggleBookmarkDir=((l,a,r=!0)=>new Promise(i=>{l.addClass(e.cl.sidebar.dirAnimated);let o=l.attr(e.attr.id),n=l.next("ul"),s=n.length()>0,c=!0===t.refreshRun||!1===t.elm.iframe.hasClass(e.cl.page.visible);void 0===a&&(a=c||!1===t.helper.model.getData("b/animations"));let h=()=>{"nothing"===t.helper.model.getData("b/rememberState")||!r||c||t.helper.search.isResultsVisible()?i():this.cacheList().then(i)};if(l.hasClass(e.cl.sidebar.dirOpened)&&s)d(l,n,!1,a).then(h);else{if(t.helper.model.getData("b/dirAccordion")){let l=t.helper.search.isResultsVisible()?"search":"all";t.elm.bookmarkBox[l].find("a."+e.cl.sidebar.dirOpened).forEach(t=>{0===e(t).next("ul").find("a["+e.attr.id+"='"+o+"']").length()&&this.toggleBookmarkDir(e(t),a,!1)})}s?d(l,n,!0,a).then(h):t.helper.model.call("bookmarks",{id:o}).then(t=>{t.bookmarks&&t.bookmarks[0]&&t.bookmarks[0].children&&(n=e("<ul />").insertAfter(l),this.addBookmarkDir(t.bookmarks[0].children,n),d(l,n,!0,a).then(h))})}})),this.cacheList=(()=>(t.log("Cache sidebar html"),Promise.all([t.helper.model.call("setCache",{name:"htmlList",val:t.elm.bookmarkBox.all.children("ul").html()}),t.helper.model.call("setCache",{name:"htmlPinnedEntries",val:t.elm.pinnedBox.html()})]))),this.updateSidebarHeader=(()=>{let l=t.elm.header.find("div."+e.cl.sidebar.searchBox+" > input[type='text']"),a="";l.length()>0&&l[0]&&l[0].value&&(a=l[0].value),t.elm.header.text("");let r=t.helper.entry.getAmount("bookmarks"),i=e("<h1 />").html("<strong>"+r+"</strong> <span>"+t.helper.i18n.get("header_bookmarks"+(1===r?"_single":""))+"</span>").attr("title",r+" "+t.helper.i18n.get("header_bookmarks"+(1===r?"_single":""))).appendTo(t.elm.header),o=[];o.push(e("<a />").addClass(e.cl.sidebar.search).appendTo(t.elm.header)),o.push(e("<a />").addClass(e.cl.sidebar.sort).appendTo(t.elm.header)),o.push(e("<a />").addClass(e.cl.sidebar.menu).appendTo(t.elm.header)),["label","amount"].forEach(t=>{let l=null;o.some(a=>{if(null===l)l=a[0].offsetTop;else if(l!==a[0].offsetTop||0===i[0].offsetTop)return"label"===t?i.children("span").addClass(e.cl.general.hidden):"amount"===t&&i.addClass(e.cl.general.hidden),!0})}),e("<div />").addClass(e.cl.sidebar.searchBox).append("<input type='text' value='"+a.replace(/'/g,"&#x27;")+"' placeholder='"+t.helper.i18n.get("sidebar_search_placeholder").replace(/'/g,"&#x27;")+"' />").append("<a class='"+e.cl.sidebar.searchClose+"'></a>").appendTo(t.elm.header)}),this.restoreOpenStates=(a=>{let r=!1,i=t.helper.model.getData(["b/rememberState","u/openStates"]),o=()=>{r||0!==l||e.delay(100).then(()=>{m()})};"all"!==i.rememberState&&"openStatesAndPos"!==i.rememberState&&"openStates"!==i.rememberState&&"openStatesRoot"!==i.rememberState||Object.keys(i.openStates).forEach(t=>{if(!0===i.openStates[t]){let n=a.find("> li > a."+e.cl.sidebar.bookmarkDir+"["+e.attr.id+"='"+t+"']");n.length()>0&&("openStatesRoot"===i.rememberState&&1!==n.parents("ul").length()||(r=!0,l++,this.toggleBookmarkDir(n).then(()=>{l--,r=!1,o()})))}}),o()}),this.updateSortFilter=(()=>{t.elm.filterBox.removeClass(e.cl.general.hidden).text("");let l=0;if("custom"===a.name)t.elm.filterBox.addClass(e.cl.general.hidden);else{let r=t.helper.model.getData(["u/viewAsTree","u/mostViewedPerMonth"]),i=a.name.replace(/([A-Z])/g,"_$1").toLowerCase();e("<a />").attr(e.attr.direction,a.dir).text(t.helper.i18n.get("sort_label_"+i)).appendTo(t.elm.filterBox);let o=e("<ul />").appendTo(t.elm.filterBox);!1===t.helper.search.isResultsVisible()&&e("<li />").append(t.helper.checkbox.get(t.elm.iframeBody,{[e.attr.name]:"viewAsTree",checked:r.viewAsTree?"checked":""})).append("<a>"+t.helper.i18n.get("sort_view_as_tree")+"</a>").appendTo(o),"mostUsed"===a.name&&e("<li />").append(t.helper.checkbox.get(t.elm.iframeBody,{[e.attr.name]:"mostViewedPerMonth",checked:r.mostViewedPerMonth?"checked":""})).append("<a>"+t.helper.i18n.get("sort_most_used_per_month")+"</a>").appendTo(o),0===o.children("li").length()&&o.remove(),l=t.elm.filterBox.realHeight()}Object.values(t.elm.bookmarkBox).forEach(e=>{e.css("padding-top",l)});let r=navigator.userAgent.match(/Chrom(e|ium)\/([0-9]+)\./);(r?parseInt(r[2],10):null)<68&&t.elm.pinnedBox.css("top",t.helper.model.getData("u/lockPinned")?-l:0)}),this.addBookmarkDir=((l,o,n=!0,d=!0)=>{let c=!1,h=n&&"custom"===a.name&&o.prev("a").length()>0,p=t.helper.model.getData(["a/showBookmarkIcons","a/showDirectoryIcons","b/dirOpenDuration","u/showHidden"]);0===o.parents("li").length()?!1===t.helper.search.isResultsVisible()&&r(p):o.css("transition","height "+p.dirOpenDuration+"s");let m=0;return o.removeData("remainingEntries"),d&&s(l),l.some((a,r)=>{if((p.showHidden||t.helper.entry.isVisible(a.id))&&(a.children||a.url)&&(e.opts.demoMode&&(a.children?a.title="Directory "+(r+1):(a.title="Bookmark "+(r+1),a.url="https://example.com/")),(!1===t.helper.entry.isSeparator(a.id)||h)&&i(a,o,{config:p,asTree:n}),a.url&&m++,c=!0,!1===n&&m>=100)){let e=l.slice(100);return e.length>0&&o.data("remainingEntries",e),!0}}),c});let r=l=>{t.elm.lockPinned.removeClass(e.cl.sidebar.fixed),t.elm.pinnedBox.removeClass([e.cl.general.hidden,e.cl.sidebar.fixed]),t.elm.pinnedBox.children("ul").remove();let a=t.helper.entry.getAllDataByType("pinned");if(0===a.length)t.elm.pinnedBox.addClass(e.cl.general.hidden);else{s(a);let r=e("<ul />").appendTo(t.elm.pinnedBox);t.helper.model.getData("u/lockPinned")&&(t.elm.lockPinned.addClass(e.cl.sidebar.fixed),t.elm.pinnedBox.addClass(e.cl.sidebar.fixed)),a.forEach((e,a)=>{(l.showHidden||t.helper.entry.isVisible(e.id))&&i(e,r,{config:l,asTree:!1})})}},i=(l,a,r)=>{let i=e("<li />").appendTo(a),o=l.title&&l.title.trim().length?l.title:"",s=e("<a />").appendTo(i),d=e("<span />").addClass(e.cl.sidebar.bookmarkLabel).text(o.trim()).appendTo(s);e("<span />").addClass(e.cl.drag.trigger).appendTo(s);return l.id&&s.attr(e.attr.id,l.id),!1===t.helper.entry.isVisible(l.id)&&i.addClass(e.cl.general.hidden),t.helper.entry.isSeparator(l.id)?(s.addClass(e.cl.sidebar.separator),d.text("")):l.children?(s.addClass(e.cl.sidebar.bookmarkDir),r.config.showDirectoryIcons&&s.prepend("<span class='"+e.cl.sidebar.dirIcon+"' />")):l.url&&(s.addClass(e.cl.sidebar.bookmarkLink),r.config.showBookmarkIcons&&(e.opts.demoMode?s.prepend("<span class='"+e.cl.sidebar.dirIcon+"' data-color='"+(Math.floor(10*Math.random())+1)+"' />"):n(s,l.url))),i},o=(l,a=!1)=>new Promise(r=>{let i=[];l.find("a."+e.cl.sidebar.bookmarkLink+" > img["+e.attr.value+"]").forEach(t=>{let l=e(t).parent("a"),a=e(t).attr(e.attr.value);i.push(n(l,a))}),i.length>0?(t.log("Detected: Missing bookmark favicons"),Promise.all(i).then(()=>{a?this.cacheList().then(r):r()})):r()}),n=(l,a)=>{l.children("img").remove();let r=e("<img />").prependTo(l);return r.attr(e.attr.value,a),new Promise(l=>{t.helper.model.call("favicon",{url:a}).then(a=>{if(a.img){let l=t.elm.iframe.hasClass(e.cl.page.visible);r.attr(l?"src":e.attr.src,a.img)}r.removeAttr(e.attr.value),l()})})},s=e=>{if(e.length>1){let l=t.helper.i18n.getLocaleSortCollator(),r=(t,l)=>{e.sort((e,r)=>{let i=!!e.children,o=!!r.children;return"custom"!==a.name&&i!==o?i?-1:1:(t===a.dir?1:-1)*l(e,r)})};switch(a.name){case"custom":r("ASC",(e,t)=>e.index-t.index);break;case"alphabetical":r("ASC",(e,t)=>l.compare(e.title,t.title));break;case"recentlyAdded":r("DESC",(e,t)=>t.dateAdded-e.dateAdded);break;case"mostUsed":{let e=t.helper.model.getData("u/mostViewedPerMonth");r("DESC",(a,r)=>{let i=t.helper.entry.getDataById(a.id),o=t.helper.entry.getDataById(r.id),n=i?i.views[e?"perMonth":"total"]:0,s=o?o.views[e?"perMonth":"total"]:0;return n===s?l.compare(a.title,r.title):s-n});break}case"recentlyUsed":r("DESC",(e,a)=>{let r=t.helper.entry.getDataById(e.id),i=t.helper.entry.getDataById(a.id),o=r?r.views.lastView:0,n=i?i.views.lastView:0;return o===n?l.compare(e.title,a.title):n-o})}}},d=(l,a,r,i)=>new Promise(o=>{if(a.css("height",a[0].scrollHeight+"px"),!1===r&&e.delay(0).then(()=>{a.css("height",0)}),!0===t.refreshRun)this.restoreOpenStates(a);else{let a=t.helper.model.getData("u/openStates");a[l.attr(e.attr.id)]=r,!1===r?c(l,a):!1===t.helper.search.isResultsVisible()&&t.helper.model.setData({"u/openStates":a})}let n=t.helper.model.getData("b/dirOpenDuration");e.delay(i?0:1e3*+n).then(()=>{if(!1===r)l.removeClass(e.cl.sidebar.dirOpened);else if(l.addClass(e.cl.sidebar.dirOpened),t.helper.model.getData("b/dirAccordion")&&!1===t.refreshRun){let e=t.helper.search.isResultsVisible()?"search":"all";t.helper.scroll.getScrollPos(t.elm.bookmarkBox[e])>l[0].offsetTop&&t.helper.scroll.setScrollPos(t.elm.bookmarkBox[e],l[0].offsetTop,300)}a.css("height",""),l.removeClass(e.cl.sidebar.dirAnimated),o()})}),c=(l,a)=>{l.next("ul").find("a."+e.cl.sidebar.bookmarkDir).forEach(t=>{a[e(t).attr(e.attr.id)]=!1,e.delay(500).then(()=>{e(t).removeClass(e.cl.sidebar.dirOpened)})}),!1===t.helper.search.isResultsVisible()&&t.helper.model.setData({"u/openStates":a})},h=(l,a)=>new Promise(r=>{t.log("Load html from cache"),l.html(a),l.find("a."+e.cl.sidebar.mark).removeClass(e.cl.sidebar.mark),l.find("a."+e.cl.general.hover).removeClass(e.cl.general.hover),l.find("a."+e.cl.drag.dragHover).removeClass(e.cl.drag.dragHover),l.find("a."+e.cl.sidebar.lastHover).removeClass(e.cl.sidebar.lastHover),l.find("li."+e.cl.drag.dragInitial).removeClass(e.cl.drag.dragInitial),l.find("li."+e.cl.drag.isDragged).remove(),o(l,!0),t.elm.bookmarkBox.all.addClass(e.cl.sidebar.cached),this.updateSidebarHeader(),this.updateSortFilter(),1===l.children("li").length()&&l.addClass(e.cl.sidebar.hideRoot),m(),r()}),p=l=>new Promise(r=>{t.log("Load html from object");let i=[],o=t.helper.model.getData("u/viewAsTree");t.elm.bookmarkBox.all.removeClass(e.cl.sidebar.cached),t.helper.model.call("bookmarks",{id:0}).then(a=>(t.refreshRun=!0,l.removeClass(e.cl.sidebar.hideRoot).text(""),a.bookmarks&&a.bookmarks[0]&&a.bookmarks[0].children&&(i=a.bookmarks[0].children),t.helper.entry.init(i))).then(()=>{this.updateSidebarHeader(),o||"custom"===a.name?(this.addBookmarkDir(i,l,!0),1===l.children("li").length()?(l.addClass(e.cl.sidebar.hideRoot),this.toggleBookmarkDir(l.find("> li > a."+e.cl.sidebar.bookmarkDir).eq(0))):this.restoreOpenStates(l)):(this.addBookmarkDir(t.helper.entry.getAllDataByType("bookmarks"),l,!1),m()),this.updateSortFilter(),r()})}),m=()=>{t.helper.scroll.restoreScrollPos(t.elm.bookmarkBox.all).then(()=>{t.initImages(),t.endLoading(200),t.firstRun=!1,t.refreshRun=!1,!t.helper.model.getData("u/viewAsTree")&&"custom"!==a.name||t.elm.bookmarkBox.all.hasClass(e.cl.sidebar.cached)||this.cacheList(),t.loaded()})}},window.ModelHelper=function(e){let t={textColor:{light:"#646464",dark:"#c8c8c8"},sidebarMaskColor:{light:"rgba(255,255,255,0.8)",dark:"rgba(0,0,0,0.6)"},hoverColor:{light:"#f5f5f5",dark:"#555555"},colorScheme:{light:"#1b82f1",dark:"#1f4d80"},foregroundColor:{light:"#ffffff",dark:"#333333"}},l={u:{openStates:{},hiddenEntries:{},additionalInfo:{},scrollPos:{},separators:{},customCss:"",pinnedEntries:{},lockPinned:!0,translationHelp:!0,performReopening:!1,entryAmounts:{},lastOpened:null,sort:{name:"custom",dir:"ASC"},mostViewedPerMonth:!1,viewAsTree:!0},b:{animations:!0,contextmenu:!0,preventPageScroll:!1,toggleArea:{width:1,widthWindowed:20,height:100,top:0},blacklist:[],whitelist:[],sidebarPosition:"left",openAction:"mousedown",newTab:"foreground",newTabPosition:"afterCurrent",visibility:"always",linkAction:"current",dirAccordion:!1,reopenSidebar:!1,preventWindowed:!1,rememberState:"openStatesAndPos",tooltipDelay:1,tooltipContent:"all",dndOpen:!0,openChildrenWarnLimit:10,dirOpenDuration:.5,scrollBarHide:1.5,openDelay:0,closeTimeout:1},n:{override:!1,autoOpen:!0,searchEngine:"google",topPagesType:"topPages",shortcuts:[{label:"Google",url:"https://google.com"}],website:""},a:{showIndicator:!0,showIndicatorIcon:!0,darkMode:!1,highContrast:!1,showBookmarkIcons:!0,showDirectoryIcons:!0,styles:{colorScheme:t.colorScheme.light,foregroundColor:t.foregroundColor.light,textColor:t.textColor.light,hoverColor:t.hoverColor.light,indicatorWidth:"40px",indicatorIconSize:"32px",indicatorIconColor:"#ffffff",indicatorColor:"rgba(0,0,0,0.5)",sidebarWidth:"350px",sidebarHeaderHeight:"50px",sidebarMaskColor:t.sidebarMaskColor.light,bookmarksFontSize:"14px",directoriesIconSize:"16px",bookmarksIconSize:"16px",bookmarksLineHeight:"38px",bookmarksDirIcon:"dir-1",bookmarksDirColor:t.textColor.light,bookmarksDirIndentation:"25px",bookmarksHorizontalPadding:"16px",scrollBarWidth:"11px",tooltipFontSize:"9px",overlayMaskColor:"rgba(0,0,0,0.5)",overlayHeaderHeight:"50px",fontFamily:"default",iconShape:"bookmark",iconColor:"#555555"}}},a={},r=null,i={};this.init=(()=>new Promise(e=>{Promise.all([o(),n()]).then(e)}));let o=()=>new Promise(e=>{r&&r.disconnect(),(r=chrome.runtime.connect({name:"background"})).onMessage.addListener(e=>{i[e.uid]&&(i[e.uid](e.result),delete i[e.uid])}),e()}),n=()=>new Promise(e=>{let t=["utility","behaviour","appearance","newtab"],l={},r=t.length,i=0;t.forEach(t=>{chrome.storage["utility"===t?"local":"sync"].get([t],o=>{l[t]=o[t]||{},++i===r&&(a=l,e())})})});this.getAllData=(()=>a),this.getData=((t,r=!1)=>{let i=t;"string"==typeof i&&(i=[i]);let o={};if(i.forEach(t=>{let i=t.split("/")[0],n=t.split("/")[1],s=null,d=null;switch(i){case"u":d=a.utility;break;case"b":d=a.behaviour;break;case"a":d=a.appearance;break;case"n":d=a.newtab}if(null!==d)if(!0===r||void 0===d[n]){if("b/toggleArea"===t){let e=this.getData("n/pxTolerance");null!==e&&((s=l[i][n]).width=e.maximized,s.widthWindowed=e.windowed,i="__FOUND")}void 0!==l[i]&&void 0!==l[i][n]&&(s=l[i][n])}else s=d[n];let c=location.href.search(/chrome-extension:\/\//)>-1&&location.pathname.search(/settings\.html$/)>-1;if("b/toggleArea"===t&&matchMedia("(min-resolution: 1.25dppx)").matches&&!1===c&&(s=Object.assign({},s),Object.keys(s).forEach(e=>{e.startsWith("width")&&s[e]++})),"a/styles"===t&&(s=Object.assign({},l.a.styles,s),e.helper.font&&e.helper.font.isLoaded())){let t=e.helper.font.getFontInfo();s.fontFamily=t.name,Object.assign(s,t.fontWeights)}o[n]=s}),"string"==typeof t){let e=t.split("/")[1];o=o[e]}return o}),this.setData=(e=>new Promise(t=>{n().then(()=>{Object.keys(e).forEach(t=>{let l=t.split("/")[0],r=t.split("/")[1],i=e[t];switch(l){case"u":a.utility[r]=i;break;case"b":a.behaviour[r]=i;break;case"a":a.appearance[r]=i;break;case"n":a.newtab[r]=i}});let l=0,r=(e=1)=>{(l+=e)>=4&&t()};try{chrome.storage.local.set({utility:a.utility},()=>{r()}),chrome.storage.sync.set({behaviour:a.behaviour,appearance:a.appearance,newtab:a.newtab},()=>{chrome.runtime.lastError,r(3)})}catch(e){t()}})})),this.call=((e,t={})=>new Promise(l=>{t.type=e,t.uid=e+"_"+JSON.stringify(t)+"_"+ +new Date+Math.random().toString(36).substr(2,12),i[t.uid]=(e=>{l(e)}),r.postMessage(t)})),this.getDefaultColor=((e,l)=>t[e]?l&&t[e][l]?t[e][l]:t[e].light:null)},window.OverlayHelper=function(t){let l={};this.create=((r,i,u)=>{t.helper.tooltip.close();let b=t.helper.model.getData(["b/animations","a/darkMode","a/highContrast"]);l.overlay=e("<iframe />").attr("id",e.opts.ids.page.overlay).data("info",u||{}).appendTo("body"),t.helper.stylesheet.addStylesheets(["overlay"],l.overlay);let f=l.overlay.find("body");f.parent("html").attr("dir",t.helper.i18n.isRtl()?"rtl":"ltr"),l.modal=e("<div />").attr(e.attr.type,r).addClass(e.cl.overlay.modal).appendTo(f),!1===b.animations&&l.overlay.addClass(e.cl.page.noAnimations),b.darkMode?f.addClass(e.cl.page.darkMode):b.highContrast&&f.addClass(e.cl.page.highContrast);let v=e("<header />").appendTo(l.modal);switch(e("<h1 />").text(i).appendTo(v),e("<a />").addClass(e.cl.general.close).appendTo(v),l.buttonWrapper=e("<menu />").addClass(e.cl.overlay.buttonWrapper).appendTo(l.modal),e("<a />").addClass(e.cl.general.close).appendTo(l.buttonWrapper),a("infos"===r?"close":"cancel"),r){case"delete":s(u);break;case"edit":d(u);break;case"infos":m(u);break;case"add":p(u);break;case"hide":h(u);break;case"openChildren":c(u);break;case"updateUrls":g(u);break;case"keyboardShortcuts":o(u);break;case"shareInfoDesc":n(u)}l.overlay[0].focus(),l.modal.find("input").length()>0&&l.modal.find("input")[0].focus(),t.helper.keyboard.initOverlayEvents(l.overlay),t.helper.model.call("trackPageView",{page:"/overlay/"+r}),C(),e.delay(100).then(()=>{l.modal.addClass(e.cl.general.visible),l.overlay.addClass(e.cl.page.visible)})}),this.performAction=(()=>{let t=l.overlay.data("info");switch(l.modal.attr(e.attr.type)){case"delete":f(t);break;case"hide":b(t);break;case"openChildren":u(t);break;case"edit":k(t);break;case"add":w(t);break;case"updateUrls":x()}}),this.closeOverlay=((a=!1,r="")=>{t.helper.model.call("checkUrls",{abort:!0}),t.elm.bookmarkBox.all.find("li."+e.cl.drag.isDragged).remove(),l.overlay.removeClass(e.cl.page.visible),t.helper.model.call("trackEvent",{category:"overlay",action:a?"cancel":"action",label:l.modal.attr(e.attr.type)+r}),t.helper.scroll.focus(),e.delay(400).then(()=>{l.overlay.remove()})});let a=(a="close")=>{l.buttonWrapper.children("a."+e.cl.general.close).text(t.helper.i18n.get("overlay_"+a))},r=a=>{if(a.additionalInfo&&a.additionalInfo.desc){let r=e("<div />").addClass(e.cl.overlay.info).appendTo(l.modal);e("<h3 />").text(t.helper.i18n.get("overlay_bookmark_additional_info")).appendTo(r),e("<p />").text(a.additionalInfo.desc).appendTo(r)}},i=(a,r)=>{let i=e("<"+(a.isDir?"span":"a")+" />").attr("title",a.title).addClass(e.cl.overlay.preview).text(a.title).appendTo(l.modal);a.isDir?i.prepend("<span class='"+e.cl.sidebar.dirIcon+"' />"):e.opts.demoMode?i.prepend("<span class='"+e.cl.sidebar.dirIcon+"' data-color='"+(Math.floor(10*Math.random())+1)+"' />"):t.helper.model.call("favicon",{url:a.url}).then(e=>{e.img&&i.prepend("<img src='"+e.img+"' />")}),r&&!0===r&&!0!==a.isDir&&e("<a />").addClass(e.cl.overlay.previewUrl).attr("title",a.url).text(a.url).insertAfter(i)},o=r=>{let i=e("<div />").addClass(e.cl.scrollBox.wrapper).appendTo(l.modal),o=e("<ul />").appendTo(i),n={tab:"&#8633;",shift:"&#8679;",cmd:"&#8984;",enter:"&#9166;"};Object.entries({tab:["tab"],enter:["enter"],shift_enter:["shift","enter"],ctrl_c:[navigator.platform.indexOf("Mac")>-1?"cmd":"ctrl","c"],del:["del"],esc:["esc"]}).forEach(([l,a])=>{a=a.map(e=>{let l="<i>";return l+=t.helper.i18n.get("keyboard_shortcuts_key_"+e)||e,n[e]&&(l+=" "+n[e]),l+="</i>"}),e("<li />").append("<strong>"+a.join("+")+"</strong>").append("<span>"+t.helper.i18n.get("keyboard_shortcuts_"+l+"_desc")+"</span>").appendTo(o)}),a("close")},n=r=>{l.modal.attr(e.attr.value,r.type);let i=e("<div />").addClass(e.cl.scrollBox.wrapper).appendTo(l.modal);"activity"===r.type?(e("<p />").html(t.helper.i18n.get("contribute_share_activity_desc1")).appendTo(i),e("<p />").html(t.helper.i18n.get("contribute_share_activity_examples_intro")).appendTo(i),e("<ul />").append("<li>"+t.helper.i18n.get("contribute_share_activity_example_1")+"</li>").append("<li>"+t.helper.i18n.get("contribute_share_activity_example_2")+"</li>").append("<li>"+t.helper.i18n.get("contribute_share_activity_example_3")+"</li>").append("<li>"+t.helper.i18n.get("contribute_share_activity_example_4")+"</li>").append("<li>"+t.helper.i18n.get("contribute_share_activity_example_5")+"</li>").appendTo(i),e("<p />").html(t.helper.i18n.get("contribute_share_activity_desc2")).appendTo(i)):"config"===r.type&&e("<p />").html(t.helper.i18n.get("contribute_share_config_desc")).appendTo(i),a("close")},s=a=>{e("<p />").text(t.helper.i18n.get("overlay_delete_"+(a.isDir?"dir":"bookmark")+"_confirm")).appendTo(l.modal),i(a),r(a),e("<a />").addClass(e.cl.overlay.action).text(t.helper.i18n.get("overlay_delete")).appendTo(l.buttonWrapper)},d=a=>{i(a);let r=e("<ul />").appendTo(l.modal);e("<li />").append("<label>"+t.helper.i18n.get("overlay_bookmark_title")+"</label>").append("<input type='text' name='title' value='"+a.title.replace(/'/g,"&#x27;")+"' />").appendTo(r),a.isDir||e("<li />").append("<label>"+t.helper.i18n.get("overlay_bookmark_url")+"</label>").append("<input type='text' name='url' value='"+a.url.replace(/'/g,"&#x27;")+"' />").appendTo(r);let o=e("<li />").addClass(e.cl.overlay.info).append("<label>"+t.helper.i18n.get("overlay_bookmark_additional_info")+"</label>").appendTo(r),n=e("<textarea name='info' />").appendTo(o);n[0].value=a.additionalInfo&&a.additionalInfo.desc||"",o.append("<span>"+t.helper.i18n.get("settings_not_synced")+"</span>"),n.on("focus",()=>{o.addClass(e.cl.general.active)}).on("blur",()=>{o.removeClass(e.cl.general.active)}),e("<a />").addClass(e.cl.overlay.action).text(t.helper.i18n.get("overlay_save")).appendTo(l.buttonWrapper)},c=a=>{let r=a.children.filter(e=>e.url&&"about:blank"!==e.url),o=t.helper.i18n.get("overlay_confirm_open_children",[r.length]);e("<p />").text(o).appendTo(l.modal),i(a),e("<a />").addClass(e.cl.overlay.action).text(t.helper.i18n.get("overlay_open_children")).appendTo(l.buttonWrapper)},h=a=>{e("<p />").text(t.helper.i18n.get("overlay_hide_"+(a.isDir?"dir":"bookmark")+"_confirm")).appendTo(l.modal),i(a),r(a),e("<a />").addClass(e.cl.overlay.action).text(t.helper.i18n.get("overlay_hide_from_sidebar")).appendTo(l.buttonWrapper)},p=a=>{let r=e("<a />").addClass(e.cl.overlay.action).text(t.helper.i18n.get("overlay_save")).appendTo(l.buttonWrapper),i=e("<menu />").attr(e.attr.name,"select").appendTo(l.modal),o=e("<a />").attr(e.attr.type,"bookmark").attr("title",t.helper.i18n.get("overlay_label_bookmark")).appendTo(i);e("<a />").attr(e.attr.type,"dir").attr("title",t.helper.i18n.get("overlay_label_dir")).appendTo(i),e("<a />").attr(e.attr.type,"separator").attr("title",t.helper.i18n.get("overlay_label_separator")).appendTo(i),i.on("mouseleave",t=>{e(t.currentTarget).children("a").removeClass(e.cl.general.hover)}),i.children("a").on("mouseenter",t=>{i.children("a").removeClass(e.cl.general.hover),e(t.currentTarget).addClass(e.cl.general.hover)}).on("mouseleave",t=>{e(t.currentTarget).removeClass(e.cl.general.hover)}).on("click",o=>{o.preventDefault();let n=e(o.currentTarget).attr(e.attr.type);if("separator"===n)y(a);else{let s=e("<ul />").appendTo(l.modal),d="",c="";"bookmark"===n&&(d=e(document).find("head > title").eq(0).text(),c=location.href),a&&a.values&&(d=a.values.title||"",c=a.values.url||""),s.append("<li><h2>"+e(o.currentTarget).attr("title")+"</h2></li>"),s.append("<li><label>"+t.helper.i18n.get("overlay_bookmark_title")+"</label><input type='text' name='title' value='"+d.replace(/'/g,"&#x27;")+"' /></li>"),"bookmark"===n&&s.append("<li><label>"+t.helper.i18n.get("overlay_bookmark_url")+"</label><input type='text' name='url' value='"+c.replace(/'/g,"&#x27;")+"'  /></li>"),i.addClass(e.cl.general.hidden),i.children("a").removeClass(e.cl.general.hover),e.delay(a&&a.values?0:100).then(()=>{s.addClass(e.cl.general.visible),s.find("input")[0].focus(),r.addClass(e.cl.general.visible)})}}),a&&a.values&&o.trigger("click")},m=a=>{i(a,!0),r(a);let o=e("<ul />").appendTo(l.modal),n=new Date(a.dateAdded);if(e("<li />").html(t.helper.i18n.get("overlay_bookmark_created_date")+" "+t.helper.i18n.getLocaleDate(n)).appendTo(o),a.isDir){let l=e("<li />").addClass(e.cl.tooltip.wrapper).append("<span>"+a.childrenAmount.total+"</span>").append(" "+t.helper.i18n.get("overlay_dir_children"),!1).appendTo(o);e("<ul />").append("<li>"+a.childrenAmount.bookmarks+" "+t.helper.i18n.get("overlay_dir_children_bookmarks")+"</li>").append("<li>"+a.childrenAmount.directories+" "+t.helper.i18n.get("overlay_dir_children_dirs")+"</li>").appendTo(l)}let s=e("<li />").addClass(e.cl.tooltip.wrapper).append("<span>"+a.views.total+"</span>").append(" "+t.helper.i18n.get("overlay_bookmark_views"+(1===a.views.total?"_single":"")),!1).appendTo(o),d=new Date(a.views.startDate);e("<ul />").append("<li>"+t.helper.i18n.get("overlay_bookmark_views_since")+" "+t.helper.i18n.getLocaleDate(d)+"</li>").append("<li>"+a.views.perMonth+" "+t.helper.i18n.get("overlay_bookmark_views"+(1===a.views.perMonth?"_single":""))+" "+t.helper.i18n.get("overlay_bookmark_views_per_month")+"</li>").appendTo(s)},g=r=>{l.loader=t.helper.template.loading().appendTo(l.modal),l.desc=e("<p />").text(t.helper.i18n.get("overlay_check_urls_loading")).appendTo(l.modal),t.helper.model.call("websiteStatus").then(i=>{if("available"===i.status){let i=[],o=e=>{e.forEach(e=>{e.url&&!1===t.helper.utility.isUrlOnBlacklist(e.url)?i.push(e):e.children&&o(e.children)})};o(r.children);let n=i.length;l.progressBar=e("<div />").addClass(e.cl.overlay.progressBar).html("<div />").appendTo(l.modal),l.progressLabel=e("<span />").addClass(e.cl.overlay.checkUrlProgressLabel).html("<span>0</span>/<span>"+n+"</span>").appendTo(l.modal),e.delay(500).then(()=>{l.modal.addClass(e.cl.overlay.urlCheckLoading)});let s=0,d=[],c={},h=r=>{t.helper.model.call("checkUrls",{urls:r}).then(r=>{if(!r.error){let i=-1;Object.entries(r).forEach(([r,o])=>{e.delay(50*++i).then(()=>{s++,l.progressBar.children("div").css("width",s/n*100+"%"),l.progressLabel.children("span").eq(0).text(s),(404==+o.code||c[r].url!==o.url&&302!=+o.code)&&(c[r].newUrl=o.url,c[r].urlStatusCode=+o.code,d.push(c[r])),s===n&&(r=>{let i=r.length>0;e.delay(1e3).then(()=>(l.desc.remove(),l.progressBar.remove(),l.progressLabel.remove(),i&&l.modal.addClass(e.cl.overlay.urlCheckList),e.delay(i?1e3:0))).then(()=>{if(l.loader.remove(),l.modal.removeClass(e.cl.overlay.urlCheckLoading),a("close"),0===r.length)e("<p />").addClass(e.cl.general.success).text(t.helper.i18n.get("overlay_check_urls_no_results")).appendTo(l.modal);else{e("<a />").addClass(e.cl.overlay.action).text(t.helper.i18n.get("overlay_update")).appendTo(l.buttonWrapper);let a=t.helper.scroll.add(e.opts.ids.overlay.urlList,e("<ul />").appendTo(l.modal)),i=l.overlay.find("body");r.forEach(l=>{let r=e("<li />").data("entry",l).append(t.helper.checkbox.get(i,{checked:"checked"}));e("<strong />").text(l.title).appendTo(r),e("<a />").attr({href:l.url,title:l.url,target:"_blank"}).html("<span>"+l.url+"</span>").appendTo(r),404===l.urlStatusCode?e("<span />").text(t.helper.i18n.get("overlay_check_urls_not_found")).appendTo(r):l.newUrl!==l.url&&e("<a />").attr({href:l.newUrl,title:l.newUrl,target:"_blank"}).html("<span>"+l.newUrl+"</span>").appendTo(r),r=r.appendTo(a.children("ul")),t.helper.model.call("favicon",{url:l.url}).then(t=>{t.img&&e("<img src='"+t.img+"' />").insertAfter(r.children("div."+e.cl.checkbox.box))})})}})})(d)})})}})},p=0,m={};i.forEach(e=>{p++,m[e.id]=e.url,c[e.id]=e,(Object.keys(m).length>=10||p===n)&&(h(m),m={})})}else l.loader.remove(),l.desc.remove(),e("<div />").addClass(e.cl.general.error).append("<h3>"+t.helper.i18n.get("status_service_unavailable_headline")+"</h3>").append("<p>"+t.helper.i18n.get("status_check_urls_unavailable_desc")+"</p>").appendTo(l.modal),a("close")})},u=e=>{this.closeOverlay();let l=e.children.filter(e=>e.url&&"about:blank"!==e.url);t.helper.utility.openAllBookmarks(l)},b=e=>{t.startLoading(),this.closeOverlay();let l=t.helper.model.getData("u/hiddenEntries");l[e.id]=!0,t.helper.model.setData({"u/hiddenEntries":l}).then(()=>Promise.all([t.helper.model.call("removeCache",{name:"htmlList"}),t.helper.model.call("removeCache",{name:"htmlPinnedEntries"})])).then(()=>{t.helper.model.call("reload",{type:"Hide"})})},f=l=>{this.closeOverlay(),t.elm.bookmarkBox.all.find("a["+e.attr.id+"='"+l.id+"']").parent("li").remove(),t.helper.bookmark.performDeletion(l)},v=t=>{let a=l.modal.find("input[name='title']").removeClass(e.cl.general.error),r=l.modal.find("input[name='url']").removeClass(e.cl.general.error),i=l.modal.find("textarea[name='info']"),o={errors:!1,values:{title:a[0].value.trim(),url:t?null:r[0].value.trim(),additionalInfo:i.length()>0&&i[0].value||null}};return 0===o.values.title.length&&(a.addClass(e.cl.general.error),o.errors=!0),t||0!==o.values.url.length||(r.addClass(e.cl.general.error),o.errors=!0),null!==o.values.url&&0!==o.values.url.search(/^\w+\:\/\//)&&(o.values.url="http://"+o.values.url),o},k=a=>{let r=v(a.isDir);!1===r.errors&&t.helper.bookmark.editEntry({id:a.id,title:r.values.title,url:r.values.url,additionalInfo:r.values.additionalInfo}).then(([a])=>{a.error?l.modal.find("input[name='url']").addClass(e.cl.general.error):(t.helper.model.call("trackEvent",{category:"extension",action:"edit",label:r.values.url?"bookmark":"directory"}),t.helper.model.call("reload",{type:"Edit"}),this.closeOverlay())})},y=e=>{t.helper.model.call("createBookmark",{title:"----------",url:"about:blank",parentId:e.id||null,index:0}).then(()=>{t.helper.model.call("trackEvent",{category:"extension",action:"add",label:"separator"}),this.closeOverlay(!1,"_separator")})},w=a=>{let r=v(0===l.modal.find("input[name='url']").length());if(!1===r.errors){let i={title:r.values.title,url:r.values.url,parentId:a.id||null,index:0};a&&a.values&&(a.values.index&&(i.index=a.values.index),a.values.parentId&&(i.parentId=a.values.parentId)),t.helper.model.call("createBookmark",i).then(a=>{a.error?l.modal.find("input[name='url']").addClass(e.cl.general.error):(t.helper.model.call("trackEvent",{category:"extension",action:"add",label:i.url?"bookmark":"directory"}),this.closeOverlay(!1,"_"+(i.url?"bookmark":"directory")))})}},x=()=>{let a=l.modal.find("div#"+e.opts.ids.overlay.urlList+" ul > li");l.modal.find("a."+e.cl.overlay.action).remove(),new Promise(l=>{let r=(i=0)=>{if(a[i])if(e(a[i]).find("input[type='checkbox']")[0].checked){let l=e(a[i]).data("entry");new Promise(e=>{404===l.urlStatusCode?t.helper.model.call("deleteBookmark",{id:l.id,preventReload:!0}).then(e):l.url!==l.newUrl?t.helper.model.call("updateBookmark",{id:l.id,title:l.title,url:l.newUrl,preventReload:!0}).then(e):e()}).then(()=>{r(i+1)})}else r(i+1);else l()};r()}).then(()=>{t.helper.model.call("reload",{type:"Update"}),this.closeOverlay()})},C=()=>{l.overlay.find("body").on("click",e=>{"BODY"===e.target.tagName&&this.closeOverlay(!0)}),l.modal.find("a."+e.cl.general.close).on("click",e=>{e.preventDefault(),this.closeOverlay(!0)}),l.modal.on("click","a."+e.cl.overlay.action,e=>{e.preventDefault(),this.performAction()}),l.modal.on("focus","input",t=>{e(t.currentTarget).removeClass(e.cl.general.error)}),l.modal.find("a."+e.cl.overlay.preview+", a."+e.cl.overlay.previewUrl).on("click",e=>{e.preventDefault(),t.helper.model.call("trackEvent",{category:"url",action:"open",label:"new_tab_overlay"}),t.helper.utility.openUrl(l.overlay.data("info"),"newTab")})}},window.ScrollHelper=function(t){let l=+new Date,a={},r=[],i=0;this.init=(()=>{let e=t.helper.model.getData("b/scrollBarHide");i=1e3*+e}),this.add=((t,l)=>{let a=e("<div id='"+t+"' class='"+e.cl.scrollBox.wrapper+"' tabindex='0' />").insertBefore(l);return l=l.appendTo(a),a.data({list:l}),r.push(a),d(a),a}),this.focus=(()=>{t.elm.iframe.hasClass(e.cl.page.visible)&&null!==t.elm.iframe[0].contentDocument&&t.helper.toggle.sidebarHoveredOnce()&&t.elm.header.find("div."+e.cl.sidebar.searchBox+" > input[type='text']")[0]!==t.elm.iframe[0].contentDocument.activeElement&&r.forEach(t=>{t.hasClass(e.cl.general.active)&&t[0].focus()})}),this.updateAll=(()=>{r.forEach(t=>{t.hasClass(e.cl.general.active)&&this.update(t)})}),this.restoreScrollPos=(l=>new Promise(a=>{let r=t.helper.model.getData(["b/rememberState","u/scrollPos"]);"all"===r.rememberState||"openStatesAndPos"===r.rememberState?(this.setScrollPos(l,r.scrollPos[l.attr("id")]||0),e.delay(100).then(a)):a()})),this.setScrollPos=((e,t,l=0)=>{if(0===l)e[0].scrollTop=t,this.update(e);else{let a=e[0].scrollTop,r=0,i=()=>{let o=(r+=1/60)/(l/1e3),n=Math.sin(o*(Math.PI/2));o<1?(window.requestAnimationFrame(i),e[0].scrollTop=a+(t-a)*n):(e[0].scrollTop=t,this.update(e))};i()}}),this.getScrollPos=(e=>e[0].scrollTop),this.update=(l=>{t.helper.contextmenu.close(),t.helper.tooltip.close(),n(l);let r=s(l),d=o(l),c=l[0].scrollTop;c>10?l.addClass(e.cl.scrollBox.scrolled):l.removeClass(e.cl.scrollBox.scrolled);let h=l.data("lastPos")||0;c>h?l.attr(e.attr.direction,"down"):c<h?l.attr(e.attr.direction,"up"):l.removeAttr(e.attr.direction),l.data("lastPos",c),(d-c<2*r||d===c&&0===r)&&l.trigger(e.opts.events.scrollBoxLastPart),i>0&&(t.elm.iframe.hasClass(e.cl.page.visible)?(l.removeClass(e.cl.scrollBox.hideScrollbar),clearTimeout(a[l.attr("id")]),a[l.attr("id")]=setTimeout(()=>{l.addClass(e.cl.scrollBox.hideScrollbar)},i)):l.addClass(e.cl.scrollBox.hideScrollbar)),this.focus()});let o=t=>{let l=0;return t.children().forEach(t=>{l+=e(t).realHeight(!0)}),l},n=e=>{if(!1===t.refreshRun&&+new Date-l>500){l=+new Date;let a=t.helper.model.getData("u/scrollPos");a[e.attr("id")]=e[0].scrollTop,t.helper.model.setData({"u/scrollPos":a})}},s=e=>e.realHeight()-parseInt(e.css("padding-top")),d=e=>{e.on("scroll",()=>{this.update(e)})}},window.SearchHelper=function(t){let l=null;this.init=(()=>{o()}),this.isResultsVisible=(()=>t.elm.bookmarkBox.search.hasClass(e.cl.general.active)),this.clearSearch=(()=>new Promise(l=>{t.helper.contextmenu.close(),t.helper.tooltip.close(),t.elm.header.removeClass(e.cl.sidebar.searchVisible),this.update("").then(l)})),this.update=((l=null)=>new Promise(r=>{let o=t.elm.header.find("div."+e.cl.sidebar.searchBox+" > input[type='text']");null===l?l=o[0].value:o[0].value=l,l&&l.length>0?a(o,l).then(r):i(o).then(r)}));let a=(l,a)=>new Promise(i=>{let o=t.firstRun;t.elm.bookmarkBox.all.removeClass(e.cl.general.active).removeClass(e.cl.scrollBox.scrolled),t.elm.bookmarkBox.search.addClass(e.cl.general.active),t.helper.scroll.focus(),t.helper.list.updateSortFilter(),a!==l.data("lastVal")&&(t.startLoading(),l.data("lastVal",a),t.helper.entry.initOnce().then(()=>(t.helper.scroll.setScrollPos(t.elm.bookmarkBox.search,0),r(a))).then(l=>{t.elm.bookmarkBox.search.children("p").remove();let r=!1,n=t.elm.bookmarkBox.search.children("ul");n.text(""),l.length>0&&(r=t.helper.list.addBookmarkDir(l,n,!1)),!1===r&&e("<p />").text(t.helper.i18n.get("sidebar_search_no_results")).appendTo(t.elm.bookmarkBox.search),o||t.helper.model.call("trackEvent",{category:"search",action:"search",label:"search",value:a.length}),t.endLoading(500),i()}))}),r=e=>new Promise(l=>{t.helper.model.call("searchBookmarks",{searchVal:e}).then(a=>{let r=a.bookmarks||[];t.helper.entry.getAllDataByType("directories").forEach((t,l)=>{t.title.toLowerCase().search(e.toLowerCase())>-1&&(t.index=-1e3+l,r.push(t))}),l(r)})}),i=l=>new Promise(a=>{l.removeData("lastVal"),this.isResultsVisible()&&(t.startLoading(),t.elm.bookmarkBox.all.addClass(e.cl.general.active),t.elm.bookmarkBox.search.removeClass(e.cl.general.active),t.helper.scroll.restoreScrollPos(t.elm.bookmarkBox.all),t.helper.scroll.focus(),t.endLoading()),t.helper.list.updateSortFilter(),a()}),o=()=>{t.elm.header.on("click","a."+e.cl.sidebar.search,l=>{l.preventDefault(),l.stopPropagation(),t.helper.contextmenu.close(),t.helper.tooltip.close(),t.elm.header.addClass(e.cl.sidebar.searchVisible),t.elm.header.find("div."+e.cl.sidebar.searchBox+" > input[type='text']")[0].focus()}),t.elm.header.on("keyup","div."+e.cl.sidebar.searchBox+" > input[type='text']",e=>{e.preventDefault(),l&&(clearTimeout(l),l=null),l=setTimeout(()=>{this.update()},500)}),t.elm.header.on("click","a."+e.cl.sidebar.searchClose,e=>{e.preventDefault(),e.stopPropagation(),this.clearSearch()})}},window.SidebarEventsHelper=function(t){let l=null,a=null,r=!1;this.init=(async()=>{o(),i(),n(),s()}),this.handleEntryClick=((l,a)=>{let r=t.helper.entry.getDataById(l.attr(e.attr.id));if(!r)return!1;let i=t.helper.model.getData(["b/newTab","b/linkAction"]),o=2===a.which||a.ctrlKey||a.metaKey;if(r.isDir&&!l.hasClass(e.cl.sidebar.dirAnimated))if(o){let e=r.children.filter(e=>e.url&&"about:blank"!==e.url);e.length>t.helper.model.getData("b/openChildrenWarnLimit")?t.helper.overlay.create("openChildren",t.helper.i18n.get("contextmenu_open_children"),r):t.helper.utility.openAllBookmarks(e)}else t.helper.list.toggleBookmarkDir(l);else r.isDir||(o?t.helper.model.call("trackEvent",{category:"url",action:"open",label:"new_tab_middle_click"}):t.helper.model.call("trackEvent",{category:"url",action:"open",label:(2===a.which||"newtab"===i.linkAction?"new":"current")+"_tab_default"}),r.reopenSidebar=t.helper.model.getData("b/reopenSidebar"),o?t.helper.utility.openUrl(r,"newTab","background"===i.newTab&&"newtab"===i.linkAction):"newtab"===i.linkAction?t.helper.utility.openUrl(r,"newTab","foreground"===i.newTab):t.helper.utility.openUrl(r,"default",!0))});let i=async()=>{t.elm.filterBox.on("click","a["+e.attr.direction+"]",l=>{l.preventDefault();let a="ASC"===e(l.target).attr(e.attr.direction)?"DESC":"ASC";t.helper.list.updateDirection(a)}).on("click","div."+e.cl.checkbox.box+" + a",t=>{t.preventDefault(),e(t.target).prev("div["+e.attr.name+"]").trigger("click")})},o=async()=>{Object.values(t.elm.bookmarkBox).forEach((a,i)=>{let o=[a];0===i&&o.push(t.elm.pinnedBox),e(o).on("click mousedown","> ul a",l=>{l.preventDefault(),e(l.target).hasClass(e.cl.drag.trigger)||e(l.target).hasClass(e.cl.sidebar.separator)||e(l.target).parent().hasClass(e.cl.sidebar.removeMask)||!(1===l.which&&"click"===l.type||2===l.which&&"mousedown"===l.type||t.refreshRun)||this.handleEntryClick(e(l.currentTarget),l)}).on("mouseover","> ul a",r=>{if(0===e("iframe#"+e.opts.ids.page.overlay).length()){let i=e(r.currentTarget),o=i.attr(e.attr.id);a.find("a."+e.cl.general.hover).removeClass(e.cl.general.hover),a.find("a."+e.cl.sidebar.lastHover).removeClass(e.cl.sidebar.lastHover),i.hasClass(e.cl.sidebar.mark)||i.addClass([e.cl.general.hover,e.cl.sidebar.lastHover]),l&&clearTimeout(l),l=setTimeout(()=>{a.find("a["+e.attr.id+"='"+o+"']").removeClass(e.cl.sidebar.mark)},500),t.helper.tooltip.create(i)}}).on("contextmenu","> ul a",l=>{l.preventDefault();let a="list";e(l.target).hasClass(e.cl.sidebar.separator)&&(a="separator"),e(l.currentTarget).removeClass(e.cl.sidebar.mark),t.helper.contextmenu.create(a,e(l.currentTarget))}).on("mouseleave",l=>{t.helper.tooltip.close(),e(l.currentTarget).find("a."+e.cl.general.hover).removeClass(e.cl.general.hover)}).on("click","span."+e.cl.sidebar.removeMask+" > span",l=>{l.preventDefault();let a=e(l.target).parents("a").eq(0);!1===r&&(r=!0,t.helper.bookmark.restoreEntry(a).then(()=>{r=!1}))})})},n=async()=>{let l=()=>{a&&clearTimeout(a)},r=()=>{l(),a=setTimeout(()=>{t.elm.lockPinned.removeClass(e.cl.general.active),t.helper.toggle.removeSidebarHoverClass()},500)};t.elm.pinnedBox.on("mouseenter",()=>{l(),t.elm.lockPinned.addClass(e.cl.general.active)}).on("mouseleave",()=>{r()}),t.elm.lockPinned.on("mouseenter",()=>{l()}).on("mouseleave",()=>{r()}).on("click",l=>{l.preventDefault(),l.stopPropagation(),t.elm.lockPinned.toggleClass(e.cl.sidebar.fixed),t.elm.pinnedBox.toggleClass(e.cl.sidebar.fixed);let a=t.elm.pinnedBox.hasClass(e.cl.sidebar.fixed);t.helper.model.setData({"u/lockPinned":a}).then(()=>{!1===a&&(t.helper.scroll.setScrollPos(t.elm.bookmarkBox.all,0,200),t.elm.lockPinned.removeClass(e.cl.general.active)),t.helper.toggle.removeSidebarHoverClass(),t.helper.list.updateSortFilter()})})},s=async()=>{e(window).on("beforeunload.bs",()=>{t.elm.sidebar.hasClass(e.cl.sidebar.openedOnce)&&t.helper.scroll.updateAll()}),t.elm.iframe.find("body").on("click",()=>{t.helper.contextmenu.close(),t.helper.tooltip.close()}),e(t.elm.iframe[0].contentDocument).on(e.opts.events.checkboxChanged,l=>{let a=l.detail.checkbox.attr(e.attr.name);if("viewAsTree"===a||"mostViewedPerMonth"===a)t.helper.model.setData({["u/"+a]:l.detail.checked}).then(()=>{t.startLoading(),t.helper.model.call("reload",{scrollTop:!0,type:"Sort"})});else if("config"===a||"activity"===a){let l=!0;t.elm.iframeBody.find("div#"+e.opts.ids.sidebar.shareInfo+" input[type='checkbox']").forEach(a=>{let r=e(a).parent();if(!1===t.helper.checkbox.isChecked(r))return l=!1,!1}),l&&e.delay(300).then(()=>{c()})}}),chrome.extension.onMessage.removeListener(d),chrome.extension.onMessage.addListener(d),["menu","sort"].forEach(l=>{t.elm.header.on("click contextmenu","a."+e.cl.sidebar[l],a=>{a.preventDefault(),a.stopPropagation(),t.helper.contextmenu.create(l,e(a.currentTarget))})}),t.elm.iframeBody.on("click","#"+e.opts.ids.sidebar.reloadInfo+" a",e=>{e.preventDefault(),location.reload(!0)}),t.elm.iframeBody.on("click","#"+e.opts.ids.sidebar.shareInfo+" a",l=>{l.preventDefault();let a=e(l.currentTarget).data("title");a?t.helper.overlay.create("shareInfoDesc",a,{type:e(l.currentTarget).data("type")}):c()})},d=l=>{if(l&&l.action&&(null===l.reinitialized||t.initialized>l.reinitialized))if("reload"===l.action){let a=!0;if(("Removed"===l.type||"Created"===l.type&&!0===r)&&Object.values(t.elm.bookmarkBox).some(t=>{if(t.hasClass(e.cl.general.active))return(t.find("a."+e.cl.sidebar.restored).length()>0||t.find("span."+e.cl.sidebar.removeMask).length()>0)&&(a=!1),!0}),a){let a=0;l.scrollTop&&(t.helper.scroll.setScrollPos(t.elm.bookmarkBox.all,0),a=100),t.needsReload=!0,e.delay(a).then(t.reload)}}else"toggleSidebar"===l.action&&(t.helper.model.call("clearNotWorkingTimeout"),t.elm.iframe.hasClass(e.cl.page.visible)?t.helper.toggle.closeSidebar():(t.helper.toggle.setSidebarHoveredOnce(!0),t.helper.toggle.openSidebar()))},c=()=>{let l={config:!1,activity:!1};t.elm.iframeBody.find("div#"+e.opts.ids.sidebar.shareInfo+" input[type='checkbox']").forEach(a=>{let r=e(a).parent(),i=r.attr(e.attr.name);l[i]=t.helper.checkbox.isChecked(r)}),t.helper.model.call("updateShareInfo",l),t.elm.iframeBody.find("div#"+e.opts.ids.sidebar.shareInfo).addClass(e.cl.general.hidden)}},window.StylesheetHelper=function(t){let l={},a="";this.init=(()=>{l=t.helper.model.getData("a/styles"),a=t.helper.model.getData("u/customCss")}),this.addStylesheets=((r,i=null)=>{null===i?i=e(document):(t.helper.font.addStylesheet(i),e.cl&&e.cl.page&&!1===t.helper.model.getData("b/animations")&&e.cl.page.noAnimations&&i.find("body").addClass(e.cl.page.noAnimations));let o=null;o=0===i.find("head").length()?i.find("body"):i.find("head"),r.forEach(t=>{e.xhr(chrome.extension.getURL("css/"+t+".css")).then(r=>{if(r.response){let i=r.response;i+=a,Object.keys(l).forEach(e=>{i=i.replace(new RegExp('"?%'+e+'"?',"g"),l[e])}),e.cl&&e.cl.page&&e.cl.page.style&&e.attr&&e.attr.name?(o.find("style."+e.cl.page.style+"["+e.attr.name+"='"+t+"']").remove(),o.append("<style class='"+e.cl.page.style+"' "+e.attr.name+"='"+t+"'>"+i+"</style>")):o.append("<style>"+i+"</style>")}})})})},window.TemplateHelper=function(t){this.loading=(()=>e('<svg class="loading" width="36px" height="36px" viewBox="0 0 36 36" xmlns="http://www.w3.org/2000/svg"><circle fill="none" stroke-width="3" stroke-linecap="round" cx="18" cy="18" r="16"></circle></svg>'))},window.ToggleHelper=function(t){let l=null,a=null,r={},i=null,o=null,n=0,s=null,d=null,c=!1,h={},p=null,m=!1;this.init=(async()=>{t.elm.indicator=e("<div />").attr("id",e.opts.ids.page.indicator).appendTo("body"),!1===t.helper.model.getData("b/animations")&&t.elm.indicator.addClass(e.cl.page.noAnimations);let d=t.helper.model.getData(["b/toggleArea","b/preventPageScroll","a/showIndicator","a/showIndicatorIcon","a/styles","b/sidebarPosition","b/openDelay","b/openAction","b/preventWindowed","b/dndOpen","n/autoOpen","u/performReopening"]);Object.entries(d.toggleArea).forEach(([e,t])=>{r[e]=+t}),n=1e3*+d.openDelay,l=d.sidebarPosition,i=d.preventPageScroll,o=d.preventWindowed,a=d.dndOpen,t.elm.indicator.css({width:g()+"px",height:r.height+"%",top:r.top+"%"}),100===r.height&&t.elm.indicator.addClass(e.cl.page.fullHeight),t.elm.iframe.attr(e.attr.position,l),t.elm.sidebar.attr(e.attr.position,l),d.styles&&d.styles.indicatorWidth&&(s=parseInt(d.styles.indicatorWidth)),d.showIndicator&&"icon"!==d.openAction&&"mousemove"!==d.openAction&&(t.elm.indicator.html("<div />").attr(e.attr.position,l),d.showIndicatorIcon&&e("<span />").appendTo(t.elm.indicator.children("div")),e.delay(50).then(()=>{t.elm.indicator.addClass(e.cl.page.visible)})),y(),u();let c=f();(("newtab_website"===c||"newtab_replacement"===c||"newtab_fallback"===c)&&d.autoOpen||d.performReopening)&&(this.openSidebar(),t.helper.model.setData({"u/performReopening":!1})),!1===b()&&t.elm.iframe.addClass(e.cl.page.hideMask)}),this.closeSidebar=(()=>{t.elm.sidebar.hasClass(e.cl.sidebar.permanent)||(k("close"),k("open"),t.helper.contextmenu.close(),t.helper.tooltip.close(),t.helper.dragndrop.cancel(),t.elm.iframe.removeClass(e.cl.page.visible),e("body").removeClass(e.cl.page.noscroll),e(document).trigger("mousemove.bs"))}),this.openSidebar=(()=>{!1===t.helper.utility.isBackgroundConnected()?(t.elm.iframe.addClass(e.cl.page.visible),t.addReloadMask()):(t.helper.model.call("shareInfoMask").then(l=>{l&&l.showMask?t.addShareInfoMask():t.elm.sidebar.find("#"+e.opts.ids.sidebar.shareInfo).remove()}),t.elm.sidebar.hasClass(e.cl.sidebar.openedOnce)||(t.trackInitialEvents(),t.elm.sidebar.addClass(e.cl.sidebar.openedOnce),this.markLastUsed()),t.helper.model.call("trackPageView",{page:"/sidebar/"+f()}),t.elm.iframe.addClass(e.cl.page.visible),t.initImages(),i&&e("body").addClass(e.cl.page.noscroll),e.delay(t.helper.model.getData("b/animations")?300:0).then(()=>t.helper.entry.initOnce()).then(()=>{t.helper.scroll.focus()}),e(document).trigger("mousemove.bs"),t.helper.utility.triggerEvent("sidebarOpened"))}),this.markLastUsed=(()=>{let l=t.helper.model.getData(["u/lastOpened","b/rememberState"]);if("all"===l.rememberState&&l.lastOpened){let a=t.elm.bookmarkBox.all.find("ul > li > a["+e.attr.id+"='"+l.lastOpened+"']");a&&a.length()>0&&(a.addClass(e.cl.sidebar.mark),t.helper.model.setData({"u/lastOpened":null}))}}),this.sidebarHoveredOnce=(()=>m),this.setSidebarHoveredOnce=(()=>{m=!0}),this.addSidebarHoverClass=(()=>{t.elm.iframe.addClass(e.cl.page.hover),m=!0}),this.removeSidebarHoverClass=(()=>{let l=t.elm.iframeBody.find("div."+e.cl.contextmenu.wrapper),a=t.elm.iframeBody.find("div."+e.cl.tooltip.wrapper);0!==l.length()||0!==a.length()||t.elm.iframeBody.hasClass(e.cl.drag.isDragged)||t.elm.lockPinned.hasClass(e.cl.general.active)||t.elm.iframe.removeClass(e.cl.page.hover)});let g=()=>r[t.helper.utility.isWindowed()?"widthWindowed":"width"],u=async()=>{e(window).on("resize.bs",()=>{t.elm.indicator.css("width",g()+"px")}),t.elm.iframe.find("body").on("click",a=>{if(a.clientX){let r=a.clientX;"right"===l&&(r=b()?window.innerWidth-r+t.elm.sidebar.realWidth()-1:t.elm.iframe.realWidth()-r),r>t.elm.sidebar.realWidth()&&t.elm.iframe.hasClass(e.cl.page.visible)&&this.closeSidebar()}}),e(document).on(e.opts.events.openSidebar+".bs",()=>{this.openSidebar()}),e(document).on("mousedown.bs click.bs",l=>{l.isTrusted&&t.elm.iframe.hasClass(e.cl.page.visible)&&this.closeSidebar()}),e(window).on("keydown.bs",()=>{p=+new Date}).on("keyup.bs",()=>{p=null}),t.elm.sidebar.on("mouseleave",l=>{if((l.toElement||l.relatedTarget)&&(e.delay(100).then(()=>{this.removeSidebarHoverClass()}),0===e("iframe#"+e.opts.ids.page.overlay).length()&&!1===t.elm.iframeBody.hasClass(e.cl.drag.isDragged))){let l=t.helper.model.getData("b/closeTimeout");-1!=+l&&(h.close=setTimeout(()=>{!1===t.elm.iframeBody.hasClass(e.cl.drag.isDragged)&&this.closeSidebar()},1e3*+l))}}).on("mouseenter",()=>{this.addSidebarHoverClass(),k("close")}),e(document).on("visibilitychange.bs",()=>{document.hidden&&0===e("iframe#"+e.opts.ids.page.overlay).length()&&(t.elm.indicator.removeClass(e.cl.page.hover),t.elm.iframe.hasClass(e.cl.page.visible)&&this.closeSidebar())}).on("mouseout.bs",()=>{k("open")}).on("mousemove.bs",l=>{if(l.isTrusted&&v(l.clientX,l.clientY)){let l=+new Date-(d||0);h.indicator||(h.indicator=setTimeout(()=>{t.elm.indicator.addClass(e.cl.page.hover)},Math.max(n-l,0)))}else k("indicator"),t.elm.indicator.removeClass(e.cl.page.hover)},{passive:!0});let r=t.helper.model.getData("b/openAction");"icon"!==r&&e(document).on(r+".bs dragover.bs",e=>{let t=!1;t="dragover"===e.type?a:"mousedown"!==e.type||0===e.button,e.isTrusted&&t&&v(e.clientX,e.clientY)?(e.stopPropagation(),e.preventDefault(),"mousemove"===r?h.open||(h.open=setTimeout(()=>{this.openSidebar()},n)):(0===n||null===d||+new Date-d>n)&&this.openSidebar()):k("open")})},b=()=>{let e=f(),l=t.helper.model.getData("a/styles"),a=t.helper.model.getData("n/autoOpen"),r=l.sidebarMaskColor||null;return!(("newtab_website"===e||"newtab_replacement"===e||"newtab_fallback"===e)&&a||"onboarding"===e||"transparent"===r)},f=()=>{let e=location.href,t="other",l=!1;return Object.entries({newtab_default:["https?://www\\.google\\..+/_/chrome/newtab"],newtab_fallback:[chrome.extension.getURL("html/newtab.html")+".*[?&]type=\\w+"],newtab_replacement:[chrome.extension.getURL("html/newtab.html")],newtab_website:[".*[?&]bs_nt=1(&|#|$)"],website:["https?://"],onboarding:["chrome\\-extension://.*/intro.html"],chrome:["chrome://"],extension:["chrome\\-extension://"],local:["file://"]}).some(([a,r])=>{if(r.some(r=>{if(0===e.search(new RegExp(r,"gi")))return t=a,l=!0,!0}),l)return!0}),t},v=(a,i)=>{let n=!1;if(o&&t.helper.utility.isWindowed());else if(null!==p&&+new Date-p<500);else if(null!=a&&(a>0||i>0||c)){c=!0,"right"===l&&(a=window.innerWidth-a-1);let o={w:g(),h:i/window.innerHeight*100};t.elm.indicator.hasClass(e.cl.page.hover)&&s>o.w&&(o.w=s),n=a<o.w&&o.h>=r.top&&o.h<=r.top+r.height}return!1===n?d=null:null===d&&(d=+new Date),n},k=e=>{h[e]&&(clearTimeout(h[e]),h[e]=null)},y=async()=>{e(e.opts.leftsideBackSelector).length()>0?t.elm.indicator.addClass(e.cl.page.hasLeftsideBack):e(document).on(e.opts.events.lsbLoaded+".bs",l=>{l.detail.showIndicator&&t.elm.indicator.addClass(e.cl.page.hasLeftsideBack)})}},window.TooltipHelper=function(t){let l={},a={};this.init=(async()=>{a=t.helper.model.getData(["b/tooltipContent","b/tooltipDelay","b/sidebarPosition"]);let e=t.helper.model.getData("a/styles");a.scrollBarWidth=+e.scrollBarWidth.replace("px","")}),this.create=(n=>{let s=n.attr(e.attr.id);if(s&&!1===t.helper.entry.isSeparator(s)){t.helper.toggle.addSidebarHoverClass(),o(s);let d=t.elm.iframeBody.find("div."+e.cl.tooltip.wrapper+"["+e.attr.id+"='"+s+"']");if(d.length()>0)0!==d[0].getBoundingClientRect().top&&d.addClass(e.cl.general.visible);else if(-1!=+a.tooltipDelay){let o=t.helper.entry.getDataById(s);if(o){let d=e("<div />").addClass(e.cl.tooltip.wrapper).attr(e.attr.id,s).appendTo(t.elm.iframeBody);r(d,o),l[s]&&(clearTimeout(l[s]),l[s]=null),l[s]=setTimeout(()=>{d.addClass(e.cl.general.visible),d.css("top",n[0].getBoundingClientRect().top+n.realHeight()/2-d.realHeight()/2+"px"),i(d,n)},1e3*+a.tooltipDelay)}}}else o()}),this.close=(()=>{o()});let r=(l,r)=>{"all"!==a.tooltipContent&&"title"!==a.tooltipContent||e("<h3 />").text(r.title).appendTo(l),r.isDir?e("<span />").text(r.children.length+" "+t.helper.i18n.get("sidebar_dir_children")).appendTo(l):"all"!==a.tooltipContent&&"url"!==a.tooltipContent||e("<span />").text(r.url).appendTo(l)},i=(e,l)=>{let r=t.helper.i18n.isRtl(),i={l:t.elm.sidebar.realWidth()-a.scrollBarWidth,r:l.realWidth()+10};"right"===a.sidebarPosition?e.css("right",i[r?"l":"r"]+"px"):e.css("left",i[r?"r":"l"]+"px")},o=(a=null)=>{Object.values(l).forEach(e=>{e&&clearTimeout(l[e])}),l={};let r=t.elm.iframeBody.find("div."+e.cl.tooltip.wrapper+(a?":not(["+e.attr.id+"='"+a+"'])":"")),i=!1;r.forEach(t=>{if(e(t).hasClass(e.cl.general.visible))return i=!0,!1}),r.removeClass(e.cl.general.visible),e.delay(i?300:0).then(()=>{r.remove(),t.helper.toggle.removeSidebarHoverClass()})}},window.UtilityHelper=function(t){this.openUrl=((e,l="default",a=!0)=>{"about:blank"!==e.url&&(t.helper.model.setData({"u/lastOpened":e.id,"u/performReopening":a&&e.reopenSidebar||!1}),"incognito"===l?t.helper.model.call("openLink",{href:e.url,incognito:!0}):"newWindow"===l?t.helper.model.call("openLink",{href:e.url,newWindow:!0}):t.helper.model.call("openLink",{parentId:e.parentId,id:e.id,href:e.url,newTab:"newTab"===l,position:t.helper.model.getData("b/newTabPosition"),active:a}))}),this.openAllBookmarks=(e=>{t.helper.model.call("trackEvent",{category:"url",action:"open",label:"new_tab_all_children",value:e.length}),"afterCurrent"===t.helper.model.getData("b/newTabPosition")&&e.reverse(),e.forEach(e=>{this.openUrl(e,"newTab",!1)})}),this.isBackgroundConnected=(()=>{let e=chrome.runtime.connect();return!!e&&(e.disconnect(),!0)}),this.triggerEvent=((t,l={},a=null)=>{(a||document).dispatchEvent(new CustomEvent(e.opts.events[t],{detail:l,bubbles:!0,cancelable:!1}))}),this.copyToClipboard=(l=>{let a=e("<textarea />").text(l).appendTo(t.elm.iframeBody);a[0].select();let r=!1;try{r=t.elm.iframe[0].contentDocument.execCommand("copy")}catch(e){}return a.remove(),r}),this.isUrlOnBlacklist=(e=>{if(!e||0===e.trim().length)return!0;let t=!1;return["about:","https?://192.168.","192.168.","https?://localhost","localhost","https?://127.0.0.","127.0.0.","file://","chrome://","chrome-extension://"].some(l=>{if(0===e.search(new RegExp(l,"gi")))return t=!0,!0}),t}),this.isWindowed=(()=>{return window.screenX>12||window.screenY>12||Math.abs(window.screen.availWidth-window.innerWidth)>12||window.navigator&&window.navigator&&window.navigator.userAgent&&window.navigator.userAgent&&window.navigator.userAgent.search(/[/\s-_]mobile[/\s-_]/i)>-1})};(new function(){let t={},l=null,a=!1,r=Math.floor(99999*Math.random())+1e4;this.initialized=null,this.firstRun=!0,this.refreshRun=!0,this.isDev=!1,this.elm={},this.needsReload=!1,this.state=null,this.run=(()=>{e("html").attr(e.attr.uid,r),this.isDev="Dev"===e.opts.manifest.version_name||!("update_url"in e.opts.manifest);let t=d();o(),e(document).on("visibilitychange.bs",()=>{!0!==document.hidden&&(null===this.initialized?i():this.needsReload&&this.reload())},{capture:!1}),i(!1===t)});let i=(e=!1)=>{!1!==a||!e&&!0===document.hidden||(a=!0,this.helper.model.init().then(()=>{n()?this.helper.i18n.init().then(()=>(this.helper.font.init(),this.helper.stylesheet.init(),this.helper.stylesheet.addStylesheets(["content"]),c())).then(()=>{this.elm.iframe&&this.elm.iframe[0]&&(this.elm.iframeBody.parent("html").attr("dir",this.helper.i18n.isRtl()?"rtl":"ltr"),this.helper.toggle.init(),this.helper.list.init(),this.helper.scroll.init(),this.helper.tooltip.init(),this.helper.sidebarEvents.init(),this.helper.dragndrop.init(),this.helper.keyboard.init(),""===document.referrer&&this.helper.model.call("addViewAmount",{url:location.href}))}):(chrome.extension.onMessage.addListener(e=>{e&&e.action&&"toggleSidebar"===e.action&&this.helper.model.call("setNotWorkingReason",{reason:this.state})}),this.log("Don't load sidebar for url '"+location.href+"'"))}))};this.reload=(()=>{!1===a&&!1===document.hidden&&(this.needsReload=!1,a=!0,this.helper.model.init().then(()=>Promise.all([this.helper.i18n.init(),this.helper.entry.init()])).then(()=>this.helper.list.updateBookmarkBox()).then(()=>{this.helper.search.update()}))}),this.trackInitialEvents=(()=>{let t=()=>{let t=this.helper.list.getSort();this.helper.model.call("trackEvent",{category:"sorting",action:"initial",label:t.name+"_"+t.dir});let l=this.elm.header.find("div."+e.cl.sidebar.searchBox+" > input[type='text']")[0].value;l.length>0&&this.helper.model.call("trackEvent",{category:"search",action:"search",label:"initial",value:l.length})};this.firstRun?e(document).on(e.opts.events.loaded+".bs",()=>{t()}):t()}),this.log=(e=>{if(this.isDev){let t=["padding: 0 0 5px 0","font-size:90%","color:#666"].join(";");console.log(...["%c[] %cBookmark Sidebar %c-> %c"+e,t,t+";color:#fa8072;font-weight: bold",t+";color: #000;font-weight: bold",t])}}),this.loaded=(()=>{if(!this.elm.iframeBody.hasClass(e.cl.sidebar.extLoaded)){let t=this.helper.model.getData(["b/toggleArea","a/showIndicator"]);this.elm.iframeBody.addClass(e.cl.sidebar.extLoaded),this.helper.list.updateSidebarHeader(),this.helper.search.init(),this.elm.iframe.hasClass(e.cl.page.visible)&&this.helper.toggle.markLastUsed(),s(),this.initialized=+new Date,this.state="loaded",this.log("Finished loading in "+(this.initialized-this.updateBookmarkBoxStart)+"ms"),this.helper.utility.triggerEvent("loaded",{config:{toggleArea:t.toggleArea,showIndicator:t.showIndicator},elm:{iframe:this.elm.iframe,sidebar:this.elm.sidebar}})}a=!1}),this.startLoading=(()=>{this.elm.sidebar.addClass(e.cl.general.loading),t.timeout&&clearTimeout(t.timeout),void 0!==t.loader&&0!==t.loader.length()||(t.loader=this.helper.template.loading().appendTo(this.elm.sidebar))}),this.endLoading=((l=500)=>{t.timeout=setTimeout(()=>{this.elm.sidebar.removeClass(e.cl.general.loading),t.loader&&t.loader.remove(),t={}},l)}),this.initImages=(()=>{e.delay().then(()=>{this.elm.iframe.hasClass(e.cl.page.visible)&&this.elm.sidebar.find("img["+e.attr.src+"]").forEach(t=>{let l=e(t),a=l.attr(e.attr.src);l.removeAttr(e.attr.src),l.attr("src",a)})})}),this.addReloadMask=(()=>{this.elm.sidebar.text("");let t=e("<div />").attr("id",e.opts.ids.sidebar.reloadInfo).prependTo(this.elm.sidebar),l=e("<div />").prependTo(t);e("<p />").html(this.helper.i18n.get("status_background_disconnected_reload_desc")).appendTo(l),e("<a />").text(this.helper.i18n.get("status_background_disconnected_reload_action")).appendTo(l)}),this.addShareInfoMask=(()=>{this.elm.sidebar.find("#"+e.opts.ids.sidebar.shareInfo).remove();let t=e("<div />").attr("id",e.opts.ids.sidebar.shareInfo).prependTo(this.elm.sidebar),l=e("<div />").prependTo(t);e("<h2 />").html(this.helper.i18n.get("contribute_headline")).appendTo(l),e("<p />").html(this.helper.i18n.get("contribute_intro")).appendTo(l),["config","activity"].forEach(t=>{let a=e("<label />").text(this.helper.i18n.get("contribute_share_"+t+"_label")).appendTo(l);e("<a />").data({title:a.text(),type:t}).appendTo(a),this.helper.checkbox.get(this.elm.iframeBody,{[e.attr.name]:t},"checkbox","switch").appendTo(l)}),e("<a />").text(this.helper.i18n.get("contribute_dismiss")).appendTo(l)});let o=()=>{this.helper={model:new window.ModelHelper(this),toggle:new window.ToggleHelper(this),entry:new window.EntryHelper(this),list:new window.ListHelper(this),scroll:new window.ScrollHelper(this),template:new window.TemplateHelper(this),i18n:new window.I18nHelper(this),font:new window.FontHelper(this),sidebarEvents:new window.SidebarEventsHelper(this),search:new window.SearchHelper(this),stylesheet:new window.StylesheetHelper(this),dragndrop:new window.DragDropHelper(this),checkbox:new window.CheckboxHelper(this),keyboard:new window.KeyboardHelper(this),bookmark:new window.BookmarkHelper(this),overlay:new window.OverlayHelper(this),utility:new window.UtilityHelper(this),contextmenu:new window.ContextmenuHelper(this),tooltip:new window.TooltipHelper(this)}},n=()=>{let e=!0,t=this.helper.model.getData("b/visibility");if("always"===t||0===location.href.search(chrome.extension.getURL("html/newtab.html")))e=!0;else if("blacklist"===t||"whitelist"===t){let l=this.helper.model.getData("b/"+t),a=!1;l.some(e=>{e=(e=(e=e.replace(/^https?:\/\//i,"")).replace(/\./g,"\\.")).replace(/\*/g,".*");let t=new RegExp("^https?://"+e+"$");if(0===location.href.search(t))return a=!0,!0}),"blacklist"===t?!1==(e=!1===a)&&(this.state="blacklisted"):"whitelist"===t&&!1==(e=!0===a)&&(this.state="notWhitelisted")}return e},s=()=>{null!==l&&clearTimeout(l),l=setTimeout(()=>{let t=e("html").attr(e.attr.uid);void 0!==t&&r!==+t||(0===e("iframe#"+e.opts.ids.page.iframe).length()?(this.log("Detected: Sidebar missing from DOM"),d(),i(!0)):s())},2e3)},d=()=>{let t=!1,l=[];["iframe#"+e.opts.ids.page.iframe,"iframe#"+e.opts.ids.page.overlay,"div#"+e.opts.ids.page.indicator].forEach(t=>{l.push(e(t))});let a=e(l);return e(document).off("*.bs"),e(window).off("*.bs"),a.length()>0&&(a.remove(),t=!0,this.log("Destroyed old instance")),t},c=async()=>{let t=this.helper.model.getData(["b/animations","a/darkMode","a/highContrast"]);this.elm.iframe=e('<iframe id="'+e.opts.ids.page.iframe+'" />').appendTo("body"),!1===t.animations&&this.elm.iframe.addClass(e.cl.page.noAnimations),this.elm.iframeBody=this.elm.iframe.find("body"),this.elm.sidebar=e('<section id="'+e.opts.ids.sidebar.sidebar+'" />').appendTo(this.elm.iframeBody),this.elm.bookmarkBox={},["all","search"].forEach(t=>{this.elm.bookmarkBox[t]=this.helper.scroll.add(e.opts.ids.sidebar.bookmarkBox[t],e("<ul />").appendTo(this.elm.sidebar))}),this.elm.filterBox=e("<div />").addClass(e.cl.sidebar.filterBox).appendTo(this.elm.sidebar),this.elm.pinnedBox=e("<div />").addClass(e.cl.sidebar.entryPinned).prependTo(this.elm.bookmarkBox.all),this.elm.lockPinned=e("<a />").addClass(e.cl.sidebar.lockPinned).html("<span />").appendTo(this.elm.sidebar),this.elm.header=e("<header />").prependTo(this.elm.sidebar),this.helper.stylesheet.addStylesheets(["sidebar"],this.elm.iframe),!0===t.darkMode?this.elm.iframeBody.addClass(e.cl.page.darkMode):!0===t.highContrast&&this.elm.iframeBody.addClass(e.cl.page.highContrast),this.helper.utility.triggerEvent("elementsCreated",{elm:{iframe:this.elm.iframe,sidebar:this.elm.sidebar}})}}).run()})(jsu);