/*! (c) Philipp KÃ¶nig under GPL-3.0 */
"use strict";function a(a){if(Array.isArray(a)){for(var b=0,c=Array(a.length);b<a.length;b++)c[b]=a[b];return c}return Array.from(a)}function b(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}var c="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a},d=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}();!function(){var a="isDefined",e="forEach",f=function(){return function(){function c(){b(this,c)}return d(c,null,[{key:a,value:function(a){return"undefined"!=typeof a&&null!==a}},{key:e,value:function(b,c){var d=arguments.length>2&&void 0!==arguments[2]&&arguments[2],f=b.length;if(d){for(var g=f-1;g>=0;g--)if(this[a](b[g][e]))this[e](b[g],c,d);else if(c(b[g],g)===!1)break}else for(var h=0;h<f;h++)if(this[a](b[h][e]))this[e](b[h],c,d);else if(c(b[h],h)===!1)break}}]),c}()}(),g=function(f){var h=document,i=new WeakMap,j=new WeakMap,k=Symbol(),l="_fillNodeList",m="document",n="eq",o="get",p="length",q="remove",r="_addEventListener",s="_cloneEventListener",t="_addData",u="_cloneData",v="_cloneElement",w="clone",x="on",y="off",z="trigger",A="find",B="children",C="_htmlText",D="html",E="text",F="data",G="removeData",H="css",I="attr",J="removeAttr",K="addClass",L="removeClass",M="toggleClass",N="hasClass",O="_moveElement",P="_moveElementTo",Q="append",R="prepend",S="appendTo",T="prependTo",U="after",V="before",W="insertAfter",X="insertBefore",Y="_nextPrev",Z="next",$="prev",_="_siblings",aa="siblings",ba="nextAll",ca="prevAll",da="parent",ea="parents",fa="_realDimension",ga="realWidth",ha="realHeight";return function(){function ia(a){var c=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];b(this,ia);var d=a;if("string"==typeof a&&(c===!1||a.search("<")>-1)){var e=h.createElement("div");e.innerHTML=a,d=e.childNodes}this[l](d)}return d(ia,[{key:l,value:function(b){var d=this;if(f[a](b))if(b instanceof g)this[k]=b[o]();else if("string"==typeof b)this[k]=h.querySelectorAll(b);else if(b instanceof Node||b instanceof HTMLDocument||b instanceof Window)this[k]=[b];else if(b instanceof NodeList||b instanceof HTMLCollection)this[k]=b;else{if("object"!==("undefined"==typeof b?"undefined":c(b)))throw new DOMException("invalid parameter for jsu");this[k]=[],f[a](b[e])||(b=[b]),b[e](function(a){var b=function(a){d[k].indexOf(a)===-1&&d[k].push(a)};a instanceof g?a[e](b):Array.isArray(a)||a instanceof NodeList||a instanceof HTMLCollection||/^\[object (HTMLCollection|NodeList|Object)\]$/.test(a.toString())?f[e](a,b):d[k].push(a)})}else this[k]=[];this[e](function(a,b){d[b]=a})}},{key:e,value:function(a){var b=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return f[e](this[k],a,b),this}},{key:H,value:function(b,d){var g=!0,h=f[a](b),i=f[a](d),j=[];return this[e](function(a){h&&i&&"string"==typeof b?a.style[b]=d:h&&("string"==typeof b?(j.push(window.getComputedStyle(a)[b]),g=!1):"object"===("undefined"==typeof b?"undefined":c(b))&&Object.keys(b)[e](function(c){"string"==typeof c&&(a.style[c]=b[c])}))}),g?this:this[k].length>1?j:j[0]}},{key:I,value:function(b,d){var g=!0,h=f[a](b),i=f[a](d),j=[];return this[e](function(k){var l=function(b,c){f[a](k[b])?k[b]=c:k.setAttribute(b,c)},m=function(b){return f[a](k[b])?k[b]:k.getAttribute(b)};h&&i&&"string"==typeof b?l(b,d):h&&("string"==typeof b?(j.push(m(b)),g=!1):"object"===("undefined"==typeof b?"undefined":c(b))&&Object.keys(b)[e](function(a){"string"==typeof a&&l(a,b[a])}))}),g?this:this[k].length>1?j:j[0]}},{key:J,value:function(a){return this[e](function(b){b.removeAttribute(a)}),this}},{key:w,value:function(){return g[v](this)}},{key:F,value:function(b,d){var h=!0,i=f[a](b),l=f[a](d),m=[];return this[e](function(k){var n=j.get(k),o=f[a](n);i&&l?g[t](k,b,d):i?"string"==typeof b?(m.push(o?n[b]:void 0),h=!1):"object"===("undefined"==typeof b?"undefined":c(b))&&Object.keys(b)[e](function(a){"string"==typeof a&&g[t](k,a,b[a])}):(m.push(o?n:{}),h=!1)}),h?this:this[k].length>1?m:m[0]}},{key:G,value:function(b){var c=!f[a](b);return this[e](function(d){var e=j.get(d);f[a](e)&&(c?j.delete(d):f[a](e[b])&&delete e[b])}),this}},{key:x,value:function(a,b,c,d,h){var i=function(a,b){Object.keys(b)[e](function(c){try{Object.defineProperty(a,c,{value:b[c]})}catch(a){}})},j=c;"function"==typeof c?j=d:h=d,"undefined"==typeof j&&(j=null),"undefined"==typeof h&&(h=null);var k="string"==typeof b;return this[e](function(d){var l=a.split(/\s+/g);l[e](function(a){var l=function(g){i(g,{type:a}),k?f[e](d.querySelectorAll(":scope "+b),function(b){for(var e=g.target;e&&e!==d;){if(e===b){var f=new MouseEvent(a,g);i(f,{preventDefault:function(){g.preventDefault()},stopPropagation:function(){g.stopPropagation()},target:g.target,currentTarget:e}),c(f)}e=e.parentNode}}):"function"==typeof b&&b(g)};g[r](d,{event:a,fn:l,opts:j,wantsUntrusted:h})})},!0),this}},{key:y,value:function(b){return this[e](function(c){var d=i.get(c);if(f[a](d)){var g=b.split(/\s+/g);g[e](function(a){d[a]&&f[e](d[a],function(b,e){c.removeEventListener(a,b.fn),d[a].splice(e,1)},!0)})}}),this}},{key:z,value:function(a,b){var c=this,d=a.split(/\s+/g);return d[e](function(a){var d=new Event(a,b);c[e](function(a){a.dispatchEvent(d)})}),this}},{key:K,value:function(a){return this[e](function(b){b.classList.add(a)}),this}},{key:L,value:function(a){return this[e](function(b){b.classList.remove(a)}),this}},{key:M,value:function(a){return this[e](function(b){b.classList.toggle(a)}),this}},{key:N,value:function(a){var b=[];return this[e](function(c){b.push(c.classList.contains(a))}),this[k].length>1?b:b[0]}},{key:fa,value:function(a){var b=arguments.length>1&&void 0!==arguments[1]&&arguments[1],c=[],d="width",f=["left","right"];return"h"===a&&(d="height",f=["top","bottom"]),this[e](function(a){var e=a.getBoundingClientRect(),g=window.getComputedStyle(a),h=e[d];b&&(h+=parseInt(g.getPropertyValue("margin-"+f[0])),h+=parseInt(g.getPropertyValue("margin-"+f[1]))),c.push(h)}),this[k].length>1?c:c[0]}},{key:ga,value:function(){var a=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return this[fa]("w",a)}},{key:ha,value:function(){var a=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return this[fa]("h",a)}},{key:A,value:function(a){var b=[];return this[e](function(c){c instanceof HTMLIFrameElement?b.push(c.contentDocument.querySelectorAll(":scope "+a)):b.push(c.querySelectorAll(":scope "+a))}),new g(b)}},{key:B,value:function(a){var b=[];return this[e](function(c){b.push(c.querySelectorAll(":scope > "+a))}),new g(b)}},{key:C,value:function(b,c){var d=f[a](b),g=d?this:"";return this[e](function(a){d?a[c]=b:g+=a[c]}),g}},{key:D,value:function(a){return this[C](a,"innerHTML")}},{key:E,value:function(a){return this[C](a,"innerText")}},{key:q,value:function(){this[e](function(a){a&&a.parentElement&&(i.delete(a),j.delete(a),a.parentElement.removeChild(a))})}},{key:O,value:function(a){var b=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],c=arguments[2];"string"==typeof a&&a.search("<")>-1&&(b=!1);var d=new g(a,b);return this[e](function(a){var b=g[v](d);b[e](function(b){switch(c){case"append":a.appendChild(b);break;case"prepend":a.insertBefore(b,a.firstChild);break;case"before":a.parentNode.insertBefore(b,a);break;case"after":a.parentNode.insertBefore(b,a.nextSibling)}})}),d[q](),this}},{key:P,value:function(a,b){var c=this,d=[],f=new g(a);return f[e](function(a){var f=g[v](c);f[e](function(c){switch(b){case"append":a.appendChild(c);break;case"prepend":a.insertBefore(c,a.firstChild);break;case"before":a.parentNode.insertBefore(c,a);break;case"after":a.parentNode.insertBefore(c,a.nextSibling)}d.push(c)})}),this[q](),new g(d)}},{key:Q,value:function(a,b){return this[O](a,b,"append")}},{key:S,value:function(a){return this[P](a,"append")}},{key:R,value:function(a){var b=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return this[O](a,b,"prepend")}},{key:T,value:function(a){return this[P](a,"prepend")}},{key:V,value:function(a){var b=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return this[O](a,b,"before")}},{key:X,value:function(a){return this[P](a,"before")}},{key:U,value:function(a){var b=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return this[O](a,b,"after")}},{key:W,value:function(a){return this[P](a,"after")}},{key:Y,value:function(b,c){var d=f[a](b),h=[];return this[e](function(e){var g="prev"===c?e.previousElementSibling:e.nextElementSibling;f[a](g)&&(!d||f[a](g.matches)&&g.matches(b))&&h.push(g)}),new g(h)}},{key:Z,value:function(a){return this[Y](a,"next")}},{key:$,value:function(a){return this[Y](a,"prev")}},{key:_,value:function(b){var c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"siblings",d=f[a](b),h=[];return this[e](function(a){var e=null,f=[];for("siblings"===c&&a.parentNode.firstElementChild?(e=a.parentNode.firstElementChild,c="next"):"previous"!==c&&"next"!==c||(e=a[c+"ElementSibling"]);e&&e.matches;)e===a||d&&!e.matches(b)||f.push(e),e=e[c+"ElementSibling"];h.push(new g(f))}),this[k].length>1?h:h[0]}},{key:aa,value:function(a){return this[_](a)}},{key:ba,value:function(a){return this[_](a,"next")}},{key:ca,value:function(a){return this[_](a,"previous")}},{key:da,value:function(b){var c=f[a](b),d=[];return this[e](function(e){var h=e.parentNode;!c||f[a](h.matches)&&h.matches(b)||(h=null),d.push(new g(h))}),this[k].length>1?d:d[0]}},{key:ea,value:function(b){var c=this,d=f[a](b),h=[];return this[e](function(a){for(var e=[],f=a.parentNode;f&&f.matches&&f!==c;)d&&!f.matches(b)||e.push(f),f=f.parentNode;h.push(new g(e))}),this[k].length>1?h:h[0]}},{key:m,value:function(){var a=[];return this[e](function(b){a.push(new g(b.ownerDocument))}),this[k].length>1?a:a[0]}},{key:n,value:function(a){return a<0&&(a=this[k].length+a),new g(this[k][a])}},{key:o,value:function(b){return f[a](b)?(b<0&&(b=this[k].length+b),this[k][b]):this[k]}},{key:p,value:function(){return this[k].length}}],[{key:r,value:function(b,c){var d=i.get(b);f[a](d)||(d={},i.set(b,d)),d[c.event]||(d[c.event]=[]),d[c.event].push({fn:c.fn,opts:c.opts,wantsUntrusted:c.wantsUntrusted}),b.addEventListener(c.event,c.fn,c.opts,c.wantsUntrusted)}},{key:s,value:function(b,c){var d=i.get(b);f[a](d)&&Object.keys(d)[e](function(a){d[a][e](function(b){g[r](c,{event:a,fn:b.fn,opts:b.opts,wantsUntrusted:b.wantsUntrusted})})}),c.children&&f[e](c.children,function(a,c){g[s](b.children[c],a)})}},{key:t,value:function(b,c,d){var e=j.get(b);f[a](e)||(e={},j.set(b,e)),e[c]=d}},{key:u,value:function(b,c){var d=j.get(b);f[a](d)&&Object.keys(d)[e](function(a){g[t](c,a,d[a])}),c.children&&f[e](c.children,function(a,c){g[u](b.children[c],a)})}},{key:v,value:function(a){var b=[];return a[e](function(a){var c=a.cloneNode(!0);g[s](a,c),g[u](a,c),b.push(c)}),new g(b)}}]),ia}()}(f);window.jsu=function(a){return new g(a)}}(),function(b){window.CheckboxHelper=function(a){var c=this,d=null;this.get=function(d,f){var g=b("<div />").data("contextBody",d).html("<input type='checkbox' />").addClass(a.opts.classes.checkbox.box);return"undefined"!=typeof f&&g.children("input[type='checkbox']").attr(f),c.isChecked(g)&&g.addClass(a.opts.classes.checkbox.active),e(g),g},this.isChecked=function(a){return a.find("input[type='checkbox']")[0].checked};var e=function(c){c.on("mousedown",function(c){c.preventDefault(),c.stopPropagation(),b(c.currentTarget).addClass(a.opts.classes.checkbox.focus)}).on("click",function(c){c.preventDefault(),c.stopPropagation();var e=b(c.currentTarget);e.addClass(a.opts.classes.checkbox.clicked),e.removeClass(a.opts.classes.checkbox.focus),e.toggleClass(a.opts.classes.checkbox.active);var f=e.hasClass(a.opts.classes.checkbox.active);e.children("input[type='checkbox']").attr("checked",f).trigger("change"),d&&clearTimeout(d),d=setTimeout(function(){e.removeClass(a.opts.classes.checkbox.clicked)},300)}),c.data("contextBody").on("click",function(b){c.removeClass(a.opts.classes.checkbox.focus)})}},window.ContextmenuHelper=function(a){this.create=function(f,g){g.addClass(a.opts.classes.sidebar.active);var h=b("<div />").addClass(a.opts.classes.contextmenu.wrapper).html("<ul />").attr(a.opts.attr.type,f).data("elm",g).appendTo(a.elements.sidebar);switch(f){case"list":d(h,g);break;case"settings":c(h,g)}e(h),setTimeout(function(){h.addClass(a.opts.classes.contextmenu.visible);var b=parseInt(h.css("top")),c=h.realHeight();b+c>=window.innerHeight&&h.css("top",b-c).addClass(a.opts.classes.contextmenu.top)},0)},this.close=function(){var c=a.elements.iframeBody.find("div."+a.opts.classes.contextmenu.wrapper);c.forEach(function(c){b(c).removeClass(a.opts.classes.contextmenu.visible),b(c).data("elm").removeClass(a.opts.classes.sidebar.active)}),setTimeout(function(){c.remove()},500)};var c=function(b,c){b.children("ul").append("<li><a "+a.opts.attr.type+"='settings'><span></span>"+a.lang("contextmenu_settings")+"</a></li>").append("<li><a "+a.opts.attr.type+"='bookmarkManager'><span></span>"+a.lang("contextmenu_bookmark_manager")+"</a></li>").append("<li><a "+a.opts.attr.type+"='updateUrls'><span></span>"+a.lang("contextmenu_update_urls")+"</a></li>").append("<li class='"+a.opts.classes.contextmenu.separator+"'></li>").append("<li><a "+a.opts.attr.type+"='toggleFix'><span></span>"+a.lang("contextmenu_toggle_fix")+"</a></li>");var d=c[0].getBoundingClientRect();b.css("top",d.top+d.height+"px")},d=function(b,c){var d=c.data("infos"),e=a.elements.sidebar.realWidth()-c[0].offsetLeft,f=window.getComputedStyle(b[0]);e-=parseInt(f.getPropertyValue("margin-left")),e-=parseInt(f.getPropertyValue("margin-right")),b.css({width:e+"px",top:c[0].getBoundingClientRect().top+c.realHeight()+"px",left:c[0].offsetLeft+"px"});var g=d.children?"_dir":"_bookmark";b.children("ul").append("<li><a "+a.opts.attr.type+"='infos'><span></span>"+a.lang("contextmenu_infos")+"</a></li>").append("<li><a "+a.opts.attr.type+"='edit'><span></span>"+a.lang("contextmenu_edit"+g)+"</a></li>").append("<li><a "+a.opts.attr.type+"='delete'><span></span>"+a.lang("contextmenu_delete"+g)+"</a></li>").append("<li class='"+a.opts.classes.contextmenu.separator+"'></li>").append("<li><a "+a.opts.attr.type+"='hide'><span></span>"+a.lang("contextmenu_hide_from_sidebar")+"</a></li>"),d.children||(b.children("ul").prepend("<li class='"+a.opts.classes.contextmenu.separator+"'></li>"),a.elements.bookmarkBox.search.hasClass(a.opts.classes.sidebar.active)&&b.children("ul").prepend("<li><a "+a.opts.attr.type+"='showInDir'><span></span>"+a.lang("contextmenu_show_in_dir")+"</a></li>"),b.children("ul").prepend("<li><a "+a.opts.attr.type+"='newTab'><span></span>"+a.lang("contextmenu_new_tab")+"</a></li>"))},e=function(c){c.find("a").on("click",function(d){d.preventDefault();var e=b(d.currentTarget).attr(a.opts.attr.type),f=c.data("elm").data("infos")||{};switch(e){case"settings":a.helper.model.call("openLink",{href:chrome.extension.getURL("html/settings.html"),newTab:!0});break;case"toggleFix":a.elements.iframeBody.toggleClass(a.opts.classes.sidebar.entriesUnlocked),a.helper.model.setData({"u/entriesLocked":a.elements.iframeBody.hasClass(a.opts.classes.sidebar.entriesUnlocked)===!1});break;case"bookmarkManager":a.helper.model.call("openLink",{href:"chrome://bookmarks",newTab:!0,active:!0});break;case"newTab":a.helper.model.call("openLink",{parentId:f.parentId,id:f.id,href:f.url,newTab:!0,active:"foreground"===a.helper.model.getData("b/newTab")});break;case"showInDir":a.entries.bookmarks[f.id]&&a.entries.bookmarks[f.id].parents&&!function(){var b=a.entries.bookmarks[f.id].parents,c=function c(d){if(b[d]){var e=a.elements.bookmarkBox.all.find("ul > li > a."+a.opts.classes.sidebar.bookmarkDir+"["+a.opts.attr.id+"='"+b[d]+"']");e.hasClass(a.opts.classes.sidebar.dirOpened)?c(d+1):a.helper.sidebarEvents.toggleBookmarkDir(e,!0,function(){c(d+1)})}else{a.helper.search.clearSearch();var g=a.elements.bookmarkBox.all.find("ul > li > a["+a.opts.attr.id+"='"+f.id+"']");a.helper.scroll.updateScrollbox(a.elements.bookmarkBox.all,g[0].offsetTop-50),g.addClass(a.opts.classes.sidebar.mark)}};c(0)}();break;default:a.helper.overlay.create(e,b(d.currentTarget).text(),f)}})}},window.DragDropHelper=function(a){var c=null;this.init=function(){c=a.helper.model.getData("b/scrollSensitivity"),e()};var d=function(b){var c=b[0].getBoundingClientRect(),d=c.left;return"right"===a.elements.iframe.attr(a.opts.attr.position)&&(d=window.innerWidth-d),.6*b.realWidth()+d>a.elements.sidebar.realWidth()},e=function(){a.elements.bookmarkBox.all.children("ul").on("mousedown","span."+a.opts.classes.drag.trigger,function(c){a.helper.contextmenu.close();var d=b(c.currentTarget).parent("a").removeClass(a.opts.classes.sidebar.dirOpened),e=d.parent("li");a.elements.iframeBody.addClass(a.opts.classes.drag.isDragged),e.clone().addClass(a.opts.classes.drag.dragInitial).insertAfter(e);var f=d.clone().appendTo(a.elements.iframeBody),g=d[0].getBoundingClientRect();f.removeAttr("title").css({top:g.top+"px",left:g.left+"px",width:d.realWidth()+"px"}).data({elm:e,isDir:!!d.data("infos").children,startPos:{top:c.pageY-g.top,left:c.pageX-g.left}}).addClass(a.opts.classes.drag.helper),e.addClass(a.opts.classes.drag.isDragged)}),a.elements.iframeBody.on("mouseup",function(b){a.elements.iframeBody.hasClass(a.opts.classes.drag.isDragged)&&!function(){b.preventDefault(),b.stopPropagation();var c=a.elements.iframeBody.children("a."+a.opts.classes.drag.helper),e=a.elements.iframeBody.find("li."+a.opts.classes.drag.dragInitial),f=c.data("elm");if(d(c))f.insertAfter(e).removeClass(a.opts.classes.drag.isDragged),e.remove(),c.remove();else{c.addClass(a.opts.classes.drag.snap);var g=f.children("a").data("infos"),h=f.parent("ul").prev("a").data("infos"),i=f.prevAll("li").length();a.helper.model.call("moveBookmark",{id:g.id,parentId:h.id,index:i}),setTimeout(function(){var b=f[0].getBoundingClientRect();c.css({top:b.top+"px",left:b.left+"px"}),setTimeout(function(){f.removeClass(a.opts.classes.drag.isDragged),e.remove(),c.remove()},200)},0)}a.elements.iframeBody.removeClass(a.opts.classes.drag.isDragged)}()}),a.elements.iframeBody.on("wheel",function(d){if(b(d.target).hasClass(a.opts.classes.drag.trigger)){d.preventDefault(),d.stopPropagation();var e=a.elements.bookmarkBox.all.data("scrollpos")||0,f=Math.abs(d.wheelDelta)<60?"trackpad":"mouse";a.elements.bookmarkBox.all.data("scrollpos",e-d.wheelDelta*c[f]),a.helper.scroll.update(a.elements.bookmarkBox.all)}}),a.elements.iframe.find("body").on("mousemove",function(c){a.elements.iframeBody.hasClass(a.opts.classes.drag.isDragged)&&1===c.which&&!function(){c.preventDefault(),c.stopPropagation();var e=a.elements.iframeBody.children("a."+a.opts.classes.drag.helper),f=e.data("startPos"),g=c.pageY-f.top,h=c.pageX-f.left;e.css({top:g+"px",left:h+"px"}),d(e)?a.elements.iframeBody.addClass(a.opts.classes.drag.cancel):a.elements.iframeBody.removeClass(a.opts.classes.drag.cancel);var i=null,j=e.data("elm");if(b([a.elements.bookmarkBox.all.find("> ul > li > a."+a.opts.classes.sidebar.dirOpened).parent("li"),a.elements.bookmarkBox.all.find("a."+a.opts.classes.sidebar.dirOpened+" + ul > li")]).forEach(function(c){var d=b(c);if(c!==j[0]&&!d.hasClass(a.opts.classes.drag.dragInitial)){var e=c.getBoundingClientRect();if(e.top>g)return!1;i=d}}),i){var k=i.children("a").eq(0);k.hasClass(a.opts.classes.sidebar.bookmarkDir)?k.hasClass(a.opts.classes.sidebar.dirOpened)?e.data("elm",j.prependTo(k.next("ul"))):e.data("isDir")?e.data("elm",j.insertAfter(i)):k.hasClass(a.opts.classes.sidebar.dirAnimated)||a.helper.sidebarEvents.toggleBookmarkDir(k):e.data("elm",j.insertAfter(i))}}()}),a.elements.iframeBody.on("contextmenu","a."+a.opts.classes.drag.helper,function(a){a.preventDefault(),a.stopPropagation()})}},window.ModelHelper=function(a){var b=this,c={u:{openStates:{},hiddenBookmarks:{},scrollPos:{},entriesLocked:!0},b:{pxTolerance:{windowed:20,maximized:1},scrollSensitivity:{mouse:1,trackpad:1},openAction:"mousedown",newTab:"foreground",rememberScroll:!0,rememberSearch:!0,hideEmptyDirs:!0,closeTimeout:1},a:{sidebarPosition:"left",showIndicator:!0,showBookmarkIcons:!0,styles:{colorScheme:"Dev"===a.opts.manifest.version_name?"rgb(255,184,0)":"rgb(0,137,123)",indicatorWidth:"50px",indicatorIconSize:"40px",indicatorColor:"rgba(0,0,0,0.5)",sidebarWidth:"350px",sidebarMaskColor:"rgba(255,255,255,0.8)",bookmarksFontSize:"14px",bookmarksIconSize:"16px",bookmarksLineHeight:"40px",bookmarksDirIndentation:"25px",bookmarksHorizontalPadding:"16px",overlayMaskColor:"rgba(0,0,0,0.5)"}}},d={};this.init=function(a){var b=["utility","behaviour","appearance"];chrome.storage.sync.get(b,function(c){d=c,b.forEach(function(a){"undefined"==typeof d[a]&&(d[a]={})}),"function"==typeof a&&a()})},this.getData=function(a){var b=a;"string"==typeof b&&(b=[b]);var e={};if(b.forEach(function(a){var b=a.split("/")[0],f=a.split("/")[1],g=null,h=null;switch(b){case"u":h=d.utility;break;case"b":h=d.behaviour;break;case"a":h=d.appearance}null!==h&&("undefined"==typeof h[f]?"undefined"!=typeof c[b]&&"undefined"!=typeof c[b][f]&&(g=c[b][f]):g=h[f]),"a/showIndicator"===a&&g===!0&&"undefined"!=typeof d.behaviour.openAction&&"mousemove"===d.behaviour.openAction&&(g=!1),e[f]=g}),"string"==typeof a){var f=a.split("/")[1];e=e[f]}return e},this.setData=function(a){b.init(function(){Object.keys(a).forEach(function(b){var c=b.split("/")[0],e=b.split("/")[1],f=a[b],g=null;switch(c){case"u":d.utility[e]=f,g=d.utility;break;case"b":d.behaviour[e]=f;break;case"a":d.appearance[e]=f}}),chrome.storage.sync.set(d)})},this.call=function(a,b,c){b.type=a,chrome.extension.sendMessage(b,function(a){"function"==typeof c&&c(a)})}},window.OverlayHelper=function(a){var c={};this.create=function(d,e,h){var i=!!h.children;switch(c.overlay=b("<iframe />").attr("id",a.opts.ids.page.overlay).appendTo("body"),a.helper.stylesheet.addStylesheets(["overlay"],c.overlay),c.modal=b("<div />").attr(a.opts.attr.type,d).data("infos",h).addClass(a.opts.classes.overlay.modal).appendTo(c.overlay.find("body")),c.modal.append("<h1>"+e+"</h1>"),b("<a />").addClass(a.opts.classes.overlay.close).appendTo(c.modal),c.buttonWrapper=b("<menu />").appendTo(c.modal),b("<a />").addClass(a.opts.classes.overlay.close).text(a.lang("overlay_"+("infos"===d?"close":"cancel"))).appendTo(c.buttonWrapper),d){case"delete":f(h,i);break;case"edit":g(h,i);break;case"infos":k(h,i);break;case"hide":j(h,i);break;case"updateUrls":m(h,i)}r(),setTimeout(function(){c.modal.addClass(a.opts.classes.overlay.visible),c.overlay.addClass(a.opts.classes.page.visible)},100)};var d=function(){a.helper.model.call("realUrl",{abort:!0}),c.overlay.removeClass(a.opts.classes.page.visible),setTimeout(function(){c.overlay.remove()},500)},e=function(d,e,f){var g=b("<"+(e?"span":"a")+" />").attr("title",d.title+(d.url?"\n"+d.url:"")).data("infos",d).addClass(a.opts.classes.overlay.preview).html("<img src='"+d.icon+"' />"+d.title).appendTo(c.modal);f&&f===!0&&e===!1&&b("<a />").addClass(a.opts.classes.overlay.previewUrl).attr("title",d.url).data("infos",d).text(d.url).insertAfter(g)},f=function(d,f){b("<p />").text(a.lang("overlay_delete_"+(f?"dir":"bookmark")+"_confirm")).appendTo(c.modal),e(d,f),b("<a />").addClass(a.opts.classes.overlay.action).text(a.lang("overlay_delete")).appendTo(c.buttonWrapper)},g=function(d,f){e(d,f);var g=b("<ul />").appendTo(c.modal);g.append("<li><label>"+a.lang("overlay_bookmark_title")+"</label><input type='text' name='title' value='"+d.title+"' /></li>"),f||g.append("<li><label>"+a.lang("overlay_bookmark_url")+"</label><input type='text' name='url' value='"+d.url+"' /></li>"),b("<a />").addClass(a.opts.classes.overlay.action).text(a.lang("overlay_save")).appendTo(c.buttonWrapper)},h=function(b){return b.toLocaleDateString([chrome.i18n.getUILanguage(),a.opts.manifest.default_locale],{year:"numeric",month:"2-digit",day:"2-digit"})},i=function(c,d,e){var f=0;"undefined"!=typeof e.views?f=e.views:"undefined"!=typeof e.clickAmount&&(f=e.clickAmount);var g=new Date(Math.max(d.dateAdded,e.counterStartDate)),i=Math.max(1,Math.round((+new Date-g)/2627999942.4)),j=Math.round(f/i*100)/100,k=b("<li />").addClass(a.opts.classes.overlay.hasTooltip).append("<span>"+f+"</span>").append(" "+a.lang("overlay_bookmark_views"+(1===f?"_single":"")),!1).appendTo(c);b("<ul />").append("<li>"+a.lang("overlay_bookmark_views_since")+" "+h(g)+"</li>").append("<li>"+j+" "+a.lang("overlay_bookmark_views"+(1===j?"_single":""))+" "+a.lang("overlay_bookmark_views_per_month")+"</li>").appendTo(k)},j=function(d,f){b("<p />").text(a.lang("overlay_hide_"+(f?"dir":"bookmark")+"_confirm")).appendTo(c.modal),e(d,f,!0),b("<a />").addClass(a.opts.classes.overlay.action).text(a.lang("overlay_hide")).appendTo(c.buttonWrapper)},k=function(d,f){e(d,f,!0);var g=b("<ul />").appendTo(c.modal),j=new Date(d.dateAdded);b("<li />").html(a.lang("overlay_bookmark_created_date")+" "+h(j)).appendTo(g),f?a.helper.model.call("dirInfos",{id:d.id},function(c){var e=b("<li />").addClass(a.opts.classes.overlay.hasTooltip).append("<span>"+c.childrenAmount.total+"</span>").append(" "+a.lang("overlay_dir_children"),!1).appendTo(g);b("<ul />").append("<li>"+c.childrenAmount.bookmarks+" "+a.lang("overlay_dir_children_bookmarks")+"</li>").append("<li>"+c.childrenAmount.dirs+" "+a.lang("overlay_dir_children_dirs")+"</li>").appendTo(e),i(g,d,c)}):a.helper.model.call("viewAmount",{id:d.id},function(a){i(g,d,a)})},l=function(d){setTimeout(function(){c.desc.remove(),c.progressBar.remove(),c.progressLabel.remove(),c.modal.addClass(a.opts.classes.overlay.urlCheckFinished),setTimeout(function(){c.loader.remove(),b("<a />").addClass(a.opts.classes.overlay.action).text(a.lang("overlay_update")).appendTo(c.buttonWrapper),c.modal.removeClass(a.opts.classes.overlay.urlCheckLoading);var e=a.helper.scroll.add(a.opts.ids.overlay.urlList,b("<ul />").appendTo(c.modal)),f=c.overlay.find("body");d.forEach(function(c){var d=b("<li />").data("infos",c).append(a.helper.checkbox.get(f,{checked:"checked"})).append("<strong>"+c.title+"</strong>");b("<a />").attr({href:c.url,title:c.url,target:"_blank"}).text(c.url).appendTo(d),404===c.urlStatusCode?b("<span />").text(a.lang("overlay_check_urls_not_found")).appendTo(d):c.newUrl!==c.url&&b("<a />").attr({href:c.newUrl,title:c.newUrl,target:"_blank"}).text(c.newUrl).appendTo(d),d=d.appendTo(e.children("ul")),a.helper.model.call("favicon",{url:c.url},function(c){c.img&&b("<img src='"+c.img+"' />").insertAfter(d.children("div."+a.opts.classes.checkbox.box))})}),a.helper.scroll.update(e)},1e3)},1e3)},m=function(){var d=Object.keys(a.entries.bookmarks).length;c.desc=b("<p />").text(a.lang("overlay_check_urls_loading")).appendTo(c.modal),c.progressBar=b("<div />").addClass(a.opts.classes.overlay.progressBar).html("<div />").appendTo(c.modal),c.progressLabel=b("<span />").addClass(a.opts.classes.overlay.checkUrlProgressLabel).html("<span>0</span>/<span>"+d+"</span>").appendTo(c.modal),c.loader=a.getLoaderHtml().appendTo(c.modal),setTimeout(function(){c.modal.addClass(a.opts.classes.overlay.urlCheckLoading)},500);var e=0,f=[];Object.keys(a.entries.bookmarks).forEach(function(b){return c.overlay.length()>0&&void!function(){var g=a.entries.bookmarks[b];a.helper.model.call("realUrl",{url:g.url},function(a){e++,c.progressBar.children("div").css("width",e/d*100+"%"),c.progressLabel.children("span").eq(0).text(e),(404===+a.code||g.url!==a.url&&302!==+a.code)&&(g.newUrl=a.url,g.urlStatusCode=+a.code,f.push(g)),e===d&&l(f)})}()})},n=function(b){d();var c=a.helper.model.getData("u/hiddenBookmarks");c[b.id]=!0,a.helper.model.setData({"u/hiddenBookmarks":c}),b.element.parent("li").remove()},o=function(b){d(),a.helper.model.call("deleteBookmark",{id:b.id},function(){b.element.parent("li").remove()})},p=function(b){var e=!!b.children,f=c.modal.find("input[name='title']"),g=c.modal.find("input[name='url']"),h=f[0].value.trim(),i=e?null:g[0].value.trim();0===h.length?f.addClass(a.opts.classes.overlay.inputError):e||0!==i.length?(d(),a.helper.model.call("updateBookmark",{id:b.id,title:h,url:i},function(){b.title=h,b.url=i,b.element.data("infos",b),b.element.children("span."+a.opts.classes.sidebar.bookmarkLabel).text(b.title)})):g.addClass(a.opts.classes.overlay.inputError)},q=function(){c.modal.find("div#"+a.opts.ids.overlay.urlList+" ul > li").forEach(function(c){if(b(c).find("input[type='checkbox']")[0].checked){var d=b(c).data("infos");404===d.urlStatusCode?a.helper.model.call("deleteBookmark",{id:d.id}):d.url!==d.newUrl&&a.helper.model.call("updateBookmark",{id:d.id,title:d.title,url:d.newUrl})}}),a.elements.iframe.removeClass(a.opts.classes.page.visible),d(),setTimeout(function(){a.updateBookmarkBox()},300)},r=function(){c.overlay.find("body").on("click",function(a){"BODY"===a.target.tagName&&d()}),c.overlay.find("body").on("wheel",function(c){b(c.target).hasClass(a.opts.classes.scrollBox.wrapper)||0!==b(c.target).parents("."+a.opts.classes.scrollBox.wrapper).length()||(c.preventDefault(),c.stopPropagation())}),c.modal.find("a."+a.opts.classes.overlay.close).on("click",function(a){a.preventDefault(),d()}),c.modal.on("click","a."+a.opts.classes.overlay.action,function(b){b.preventDefault();var d=c.modal.data("infos");switch(c.modal.attr(a.opts.attr.type)){case"delete":o(d);break;case"hide":n(d);break;case"edit":p(d);break;case"updateUrls":q(d)}}),c.modal.on("focus","input",function(c){b(c.currentTarget).removeClass(a.opts.classes.overlay.inputError)}),c.modal.find("a."+a.opts.classes.overlay.preview+", a."+a.opts.classes.overlay.previewUrl).on("click",function(c){c.preventDefault();var d=b(c.currentTarget).data("infos");a.helper.model.call("openLink",{parentId:d.parentId,id:d.id,href:d.url,newTab:!0})})}},window.ScrollHelper=function(a){var c=this,d=+new Date,e={};this.add=function(d,e){var f=b("<div id='"+d+"' class='"+a.opts.classes.scrollBox.wrapper+"' />").insertBefore(e);e=e.appendTo(f);var h=b("<div class='"+a.opts.classes.scrollBox.scrollbar+"' />").html("<div />").appendTo(f);return f.data({content:e,scrollbar:h}),g(f),c.updateScrollbox(f,0),f},this.update=function(a){var b=arguments.length>1&&void 0!==arguments[1]&&arguments[1],d=a.data("scrollpos")||0;c.updateScrollbox(a,d),b&&f(a)},this.restoreScrollPos=function(b,d){var e=a.helper.model.getData(["b/rememberScroll","u/scrollPos"]);e.rememberScroll?(c.updateScrollbox(b,e.scrollPos[b.attr("id")]||0),setTimeout(function(){"function"==typeof d&&d()},100)):"function"==typeof d&&d()},this.updateScrollbox=function(b,c){a.helper.contextmenu.close();var d=b.realHeight(),f=b.data("content").realHeight(!0);c=Math.max(0,c),d>=f?(b.data("scrollbar").addClass(a.opts.classes.scrollBox.inactive),c=0):(b.data("scrollbar").removeClass(a.opts.classes.scrollBox.inactive),c>=f-d?(c=f-d,b.addClass(a.opts.classes.scrollBox.scrolledEnd)):b.removeClass(a.opts.classes.scrollBox.scrolledEnd)),c>10?b.addClass(a.opts.classes.scrollBox.scrolled):b.removeClass(a.opts.classes.scrollBox.scrolled);var g=parseInt(b.data("scrollbar").css("padding-top")),h=c/f*(d-2*g)+g;b.data("scrollbar").removeClass(a.opts.classes.scrollBox.hidden),b.data("scrollbar").find("> div").css({height:(d-2*g)/f*100+"%",transform:"translate3d(0,"+h+"px,0)"}),b.data("scrollpos",c),b.data("content").css("transform","translate3d(0,-"+c+"px,0)"),clearTimeout(e[b.attr("id")]),e[b.attr("id")]=setTimeout(function(){b.data("scrollbar").addClass(a.opts.classes.scrollBox.hidden)},1500)};var f=function(b){if(a.firstRun===!1&&+new Date-d>500){d=+new Date;var c=a.helper.model.getData("u/scrollPos");c[b.attr("id")]=b.data("scrollpos")||0,a.helper.model.setData({"u/scrollPos":c})}},g=function(d){var e=d.data("scrollbar"),g=e.children("div"),h=a.helper.model.getData("b/scrollSensitivity");d.on("wheel",function(b){b.preventDefault(),b.stopPropagation();var e=d.data("scrollpos")||0,g="mouse";Math.abs(b.wheelDelta)<60&&(g="trackpad",
d.addClass(a.opts.classes.scrollBox.scrollTrackpad)),c.updateScrollbox(d,e-b.wheelDelta*h[g]),f(d),d.removeClass(a.opts.classes.scrollBox.scrollTrackpad)}),g.on("mousedown",function(a){a.preventDefault(),a.stopPropagation(),b(a.currentTarget).data("startPos",a.pageY-a.currentTarget.getBoundingClientRect().top)}),d.document().on("mouseup",function(b){b.preventDefault(),b.stopPropagation(),d.removeClass(a.opts.classes.scrollBox.scrollDrag),g.removeData("startPos")}),d.document().on("mousemove",function(b){var e=g.data("startPos");if(e){d.hasClass(a.opts.classes.scrollBox.scrollDrag)||d.addClass(a.opts.classes.scrollBox.scrollDrag);var f=d.realHeight(),h=d.data("content").realHeight(),i=Math.max(0,b.pageY-d[0].getBoundingClientRect().top-e);c.updateScrollbox(d,i*h/f)}})}},window.SearchHelper=function(a){var c=this,d={};this.init=function(){var b=a.helper.model.getData(["b/rememberSearch","u/searchValue"]);b.rememberSearch&&b.searchValue&&b.searchValue.length>0&&(a.elements.header.addClass(a.opts.classes.sidebar.searchVisible),g(b.searchValue),setTimeout(function(){a.helper.scroll.restoreScrollPos(a.elements.bookmarkBox.search)},100)),j()},this.clearSearch=function(){a.helper.contextmenu.close(),a.elements.header.removeClass(a.opts.classes.sidebar.searchVisible),g("")};var e=function(){a.elements.sidebar.addClass(a.opts.classes.sidebar.searchLoading),d.timeout&&clearTimeout(d.timeout),"undefined"!=typeof d.loader&&0!==d.loader.length()||(d.loader=a.getLoaderHtml().appendTo(a.elements.sidebar))},f=function(){var b=arguments.length>0&&void 0!==arguments[0]?arguments[0]:500;d.timeout=setTimeout(function(){a.elements.sidebar.removeClass(a.opts.classes.sidebar.searchLoading),d.loader&&d.loader.remove(),d={}},b)},g=function(){var b=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,c=a.elements.header.find("div."+a.opts.classes.sidebar.searchBox+" > input[type='text']");null===b?(b=c[0].value,a.helper.scroll.updateScrollbox(a.elements.bookmarkBox.search,0)):c[0].value=b,b&&b.length>0?h(c,b):i(c)},h=function(c,d){a.elements.bookmarkBox.all.removeClass(a.opts.classes.sidebar.active),a.elements.bookmarkBox.search.addClass(a.opts.classes.sidebar.active),d!==c.data("lastVal")&&(c.data("lastVal",d),a.helper.model.setData({"u/searchValue":d}),e(),a.helper.model.call("searchBookmarks",{searchVal:d},function(c){a.elements.bookmarkBox.search.children("p").remove();var d=!1,e=a.elements.bookmarkBox.search.children("ul");e.text(""),c.bookmarks&&c.bookmarks.length>0&&(d=a.addBookmarkDir(c.bookmarks,e)>0),d===!1&&b("<p />").text(a.lang("sidebar_search_no_results")).prependTo(a.elements.bookmarkBox.search),a.helper.scroll.update(a.elements.bookmarkBox.search),f()}))},i=function(b){b.removeData("lastVal"),a.helper.model.setData({"u/searchValue":null}),a.elements.bookmarkBox.search.hasClass(a.opts.classes.sidebar.active)&&(e(),a.elements.bookmarkBox.all.addClass(a.opts.classes.sidebar.active),a.elements.bookmarkBox.search.removeClass(a.opts.classes.sidebar.active),a.helper.scroll.restoreScrollPos(a.elements.bookmarkBox.all),f())},j=function(){a.elements.header.on("click","a."+a.opts.classes.sidebar.search,function(b){b.preventDefault(),b.stopPropagation(),a.helper.contextmenu.close(),a.elements.header.addClass(a.opts.classes.sidebar.searchVisible),a.elements.header.find("div."+a.opts.classes.sidebar.searchBox+" > input[type='text']")[0].focus()}),a.elements.header.on("keyup","div."+a.opts.classes.sidebar.searchBox+" > input[type='text']",function(a){a.preventDefault(),g()}),a.elements.header.on("click","a."+a.opts.classes.sidebar.searchClose,function(a){a.preventDefault(),a.stopPropagation(),c.clearSearch()})}},window.SidebarEventsHelper=function(a){var c=this;this.toggleBookmarkDir=function(c,d,e){c.addClass(a.opts.classes.sidebar.dirAnimated);var g=c.next("ul");"undefined"==typeof d&&(d=a.firstRun===!0);var h=function(b){if(g.css("height",g[0].scrollHeight+"px"),b===!1&&setTimeout(function(){g.css("height",0)},0),a.firstRun===!0)a.restoreOpenStates(g);else{var h=a.helper.model.getData("u/openStates");h[c.data("infos").id]=b,delete h["node_"+c.data("infos").id],b===!1?f(c,h):a.helper.model.setData({"u/openStates":h})}setTimeout(function(){b===!1?c.removeClass(a.opts.classes.sidebar.dirOpened):c.addClass(a.opts.classes.sidebar.dirOpened),g.css("height",""),c.removeClass(a.opts.classes.sidebar.dirAnimated),a.helper.scroll.update(a.elements.bookmarkBox.all,!0),"function"==typeof e&&e()},d?0:500)};c.hasClass(a.opts.classes.sidebar.dirOpened)?h(!1):0===g.length()?a.helper.model.call("bookmarks",{id:c.data("infos").id},function(d){d.bookmarks&&d.bookmarks[0]&&d.bookmarks[0].children&&d.bookmarks[0].children.length>0&&(g=b("<ul />").insertAfter(c),a.addBookmarkDir(d.bookmarks[0].children,g),h(!0))}):h(!0)},this.init=function(){e()};var d=function(){Object.keys(a.elements.bookmarkBox).forEach(function(b){var c=a.elements.bookmarkBox[b];c.hasClass(a.opts.classes.sidebar.active)&&a.helper.scroll.update(c,!0)})},e=function(){b(window).on("beforeunload",function(){a.elements.iframe.data("visibleOnce")&&d()}).on("resize",function(){d()}),a.elements.iframe.find("body").on("click",function(){a.helper.contextmenu.close()}),chrome.extension.onMessage.addListener(function(b){b&&b.action&&"showShareUserdataMask"===b.action&&a.initShareUserdataMask()}),a.elements.header.on("click contextmenu","a."+a.opts.classes.sidebar.settings,function(c){c.preventDefault(),c.stopPropagation(),a.helper.contextmenu.close(),a.helper.contextmenu.create("settings",b(c.currentTarget))}),a.elements.iframeBody.on("click","div#"+a.opts.ids.sidebar.shareUserdata+" a",function(c){c.preventDefault(),a.helper.model.call("shareUserdata",{share:b(c.currentTarget).data("accept")}),a.elements.iframeBody.find("div#"+a.opts.ids.sidebar.shareUserdata).addClass(a.opts.classes.sidebar.shareUserdataHidden)}),Object.keys(a.elements.bookmarkBox).forEach(function(d){a.elements.bookmarkBox[d].children("ul").on("click mousedown","a",function(d){if(d.preventDefault(),!b(d.target).hasClass(a.opts.classes.drag.trigger)&&(1===d.which&&"click"===d.type||2===d.which&&"mousedown"===d.type||a.firstRun)){var e=b(d.currentTarget),f=2===d.which,g=e.data("infos"),h=!!g.children;if(h&&!e.hasClass(a.opts.classes.sidebar.dirAnimated))c.toggleBookmarkDir(e);else if(!h){var i=a.helper.model.getData("b/newTab");a.helper.model.call("openLink",{parentId:g.parentId,id:g.id,href:g.url,newTab:f,active:!f||"foreground"===i})}}}).on("mouseover","a",function(c){b(c.currentTarget).hasClass(a.opts.classes.sidebar.mark)&&b(c.currentTarget).removeClass(a.opts.classes.sidebar.mark)}).on("contextmenu","a",function(c){c.preventDefault(),a.helper.contextmenu.close(),a.helper.contextmenu.create("list",b(c.currentTarget))})})},f=function(c,d){c.next("ul").find("a.dir").forEach(function(c){d[b(c).data("infos").id]=!1,setTimeout(function(){b(c).removeClass(a.opts.classes.sidebar.dirOpened)},500)}),a.helper.model.setData({"u/openStates":d})}},window.StylesheetHelper=function(a){var c={};this.init=function(){c=a.helper.model.getData("a/styles")},this.addStylesheets=function(d){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,f=null;null===e?f=b("html > head"):(f=e.find("head"),b("<link />").attr({rel:"stylesheet",type:"text/css",href:a.opts.fontHref}).appendTo(f)),d.forEach(function(a){var b=new XMLHttpRequest;b.open("GET",chrome.extension.getURL("css/"+a+".css"),!0),b.onload=function(){b.response&&!function(){var a=b.response;Object.keys(c).forEach(function(b){a=a.replace(new RegExp('"?%'+b+'"?',"g"),c[b])}),f.append("<style>"+a+"</style>")}()},b.send()})}},window.ToggleHelper=function(a){var c=null,d=null,e=null,f=null;this.init=function(){a.elements.toggle=b("<div />").attr("id",a.opts.ids.page.visual).appendTo("body");var d=a.helper.model.getData(["b/pxTolerance","b/closeTimeout","a/showIndicator","a/sidebarPosition"]);f=1e3*+d.closeTimeout,e=d.pxTolerance,a.elements.toggle.css("width",g()+"px"),c=d.sidebarPosition,a.elements.iframe.attr(a.opts.attr.position,c),a.elements.sidebar.attr(a.opts.attr.position,c),d.showIndicator>0&&a.elements.toggle.addClass(a.opts.classes.page.addVisual).attr(a.opts.attr.position,c),l(),h()};var g=function(){return e[a.isWindowed()?"windowed":"maximized"]},h=function(){b(window).on("resize",function(){a.elements.toggle.css("width",g()+"px")}),a.elements.iframe.find("body").on("click",function(b){if(b.pageX){var d=b.pageX;"right"===c&&(d=window.innerWidth-d+a.elements.sidebar.realWidth()-1),d>a.elements.sidebar.realWidth()&&a.elements.iframe.hasClass(a.opts.classes.page.visible)&&j()}}),a.elements.sidebar.on("mouseleave",function(){0===b("iframe#"+a.opts.ids.page.overlay).length()&&0===a.elements.sidebar.find("."+a.opts.classes.scrollBox.scrollDrag).length()&&0===a.elements.iframeBody.find("li."+a.opts.classes.drag.dragInitial).length()&&(d=setTimeout(function(){j()},f))}).on("mouseenter",function(){d&&(clearTimeout(d),d=null)}),b(document).on("visibilitychange",function(){document.hidden&&0===b("iframe#"+a.opts.ids.page.overlay).length()&&(a.elements.toggle.removeClass(a.opts.classes.page.hover),a.elements.iframe.hasClass(a.opts.classes.page.visible)&&j())}).on("mousemove",function(b){i(b.pageX)?a.elements.toggle.addClass(a.opts.classes.page.hover):a.elements.toggle.removeClass(a.opts.classes.page.hover)},{passive:!0}),chrome.extension.onMessage.addListener(function(b){b&&b.action&&"toggleSidebar"===b.action&&(a.elements.iframe.hasClass(a.opts.classes.page.visible)?j():k())});var e=a.helper.model.getData("b/openAction");b(document).on(e,function(a){"mousedown"===e&&0!==a.button||!i(a.pageX)||(a.stopPropagation(),a.preventDefault(),k())})},i=function(a){return"undefined"!=typeof a&&null!==a&&("right"===c&&(a=window.innerWidth-a-1),a<g())},j=function(){d&&(clearTimeout(d),d=null),a.helper.contextmenu.close(),a.elements.iframe.removeClass(a.opts.classes.page.visible),b(document).trigger("mousemove")},k=function(){a.initImages(),a.elements.iframe.addClass(a.opts.classes.page.visible).data("visibleOnce",!0),b(document).trigger("mousemove")},l=function(){b(a.opts.leftsideBackSelector).length()>0?a.elements.toggle.addClass(a.opts.classes.page.hasLeftsideBack):b(document).on(a.opts.events.lsbLoaded,function(b){b.detail.addVisual&&a.elements.toggle.addClass(a.opts.classes.page.hasLeftsideBack)})}},window.ext=function(d){var e=this;this.firstRun=!0,this.elements={},this.opts=d,this.entries={},this.run=function(){g(),e.helper.model.init(function(){e.helper.stylesheet.init(),h(),e.helper.sidebarEvents.init(),e.helper.dragndrop.init(),""===document.referrer&&e.helper.model.call("addViewAmount",{url:location.href})})},this.getLoaderHtml=function(){var a='<div class="loading"> <div>  <div class="circle-clipper left">   <div></div>  </div>  <div class="gap-patch">   <div></div>  </div>  <div class="circle-clipper right">   <div></div>  </div> </div></div>';return b(a)},this.isEntryVisible=function(a){return"object"===c(e.entries.bookmarks[a])||"object"===c(e.entries.directories[a])},this.isWindowed=function(){return 0!==window.screenX||0!==window.screenY||window.screen.availWidth!==window.innerWidth},this.lang=function(a){return chrome.i18n.getMessage(a)},this.restoreOpenStates=function(a){f++;var b=e.helper.model.getData("u/openStates"),c=0;Object.keys(b).forEach(function(d){if(b[d]===!0){var f=+d.replace(/^node_/,""),g=a.find("> li > a."+e.opts.classes.sidebar.bookmarkDir+"["+e.opts.attr.id+"='"+f+"']");g.length()>0&&(c++,e.helper.sidebarEvents.toggleBookmarkDir(g))}}),f--,0===c&&0===f&&setTimeout(function(){e.firstRun=!1,e.helper.scroll.restoreScrollPos(e.elements.bookmarkBox.all,function(){k()})},100)},this.addBookmarkDir=function(a,c){var f=0,g=e.elements.iframe.hasClass(e.opts.classes.page.visible),h=e.helper.model.getData(["b/hideEmptyDirs","a/showBookmarkIcons"]);return a.forEach(function(a,i){e.isEntryVisible(a.id)&&(a.children||a.url)&&!function(){d.demoMode&&(a.children?a.title="Directory "+(i+1):(a.title="Bookmark "+(i+1),a.url="https://example.com/"));var j=b("<li />").appendTo(c),k=b("<a />").html("<span class='"+e.opts.classes.sidebar.bookmarkLabel+"'>"+a.title+"</span><span class='"+e.opts.classes.drag.trigger+"' />").attr(e.opts.attr.id,a.id).appendTo(j);a.element=k,a.children?h.hideEmptyDirs===!1||a.children.length>0?(a.icon=chrome.extension.getURL("img/dir.webp"),k.data("infos",a).attr("title",a.title+"\n-------------\n"+a.children.length+" "+e.lang("sidebar_dir_children")).addClass(e.opts.classes.sidebar.bookmarkDir),h.showBookmarkIcons&&k.prepend("<img "+(g?"src":e.opts.attr.src)+"='"+a.icon+"' />")):j.remove():(k.data("infos",a).attr("title",a.title+"\n-------------\n"+a.url).addClass(e.opts.classes.sidebar.bookmarkLink),h.showBookmarkIcons&&e.helper.model.call("favicon",{url:a.url},function(b){d.demoMode&&(b.img=chrome.extension.getURL("img/demo/favicon-"+(Math.floor(10*Math.random())+1)+".webp")),b.img&&(a.icon=b.img,k.data("infos",a).prepend("<img "+(g?"src":e.opts.attr.src)+"='"+a.icon+"' />"))})),f++}()}),f},this.initImages=function(){e.elements.sidebar.find("img["+e.opts.attr.src+"]").forEach(function(a){var c=b(a),d=c.attr(e.opts.attr.src);c.removeAttr(e.opts.attr.src),c.attr("src",d)})},this.updateBookmarkBox=function(){e.helper.model.call("bookmarks",{id:0},function(a){if(a.bookmarks&&a.bookmarks[0]&&a.bookmarks[0].children&&a.bookmarks[0].children.length>0){e.firstRun=!0;var b=e.elements.bookmarkBox.all.children("ul");b.text(""),i(a.bookmarks[0].children),e.helper.search.init(),e.addBookmarkDir(a.bookmarks[0].children,b),e.restoreOpenStates(b)}})},this.initShareUserdataMask=function(){if(!e.elements.iframe.hasClass(e.opts.classes.page.visible)){var a=b("<div />").attr("id",d.ids.sidebar.shareUserdata).prependTo(e.elements.sidebar),c=b("<div />").prependTo(a);b("<h2 />").html(e.lang("share_userdata_headline")).appendTo(c),b("<p />").html(e.lang("share_userdata_desc")).appendTo(c),b("<p />").html(e.lang("share_userdata_desc2")).appendTo(c);var f=e.lang("share_userdata_notice").replace(/\[u\](.*)\[\/u\]/,"<span>$1</span>");b("<p />").addClass(d.classes.sidebar.shareUserdataNotice).html(f).appendTo(c),b("<a href='#' />").data("accept",!0).html(e.lang("share_userdata_accept")).appendTo(c),b("<a href='#' />").data("accept",!1).html(e.lang("share_userdata_decline")).appendTo(c)}};var f=0,g=function(){e.helper={model:new window.ModelHelper(e),toggle:new window.ToggleHelper(e),scroll:new window.ScrollHelper(e),sidebarEvents:new window.SidebarEventsHelper(e),search:new window.SearchHelper(e),stylesheet:new window.StylesheetHelper(e),dragndrop:new window.DragDropHelper(e),checkbox:new window.CheckboxHelper(e),overlay:new window.OverlayHelper(e),contextmenu:new window.ContextmenuHelper(e)}},h=function(){e.helper.stylesheet.addStylesheets(["content"]),e.elements.iframe=b('<iframe id="'+e.opts.ids.page.iframe+'" />').appendTo("body"),e.elements.iframeBody=e.elements.iframe.find("body"),e.elements.sidebar=b('<section id="'+e.opts.ids.sidebar.sidebar+'" />').appendTo(e.elements.iframeBody),e.elements.bookmarkBox={all:e.helper.scroll.add(e.opts.ids.sidebar.bookmarkBox,b("<ul />").appendTo(e.elements.sidebar)),search:e.helper.scroll.add(e.opts.ids.sidebar.bookmarkBoxSearch,b("<ul />").appendTo(e.elements.sidebar))},e.elements.header=b("<header />").prependTo(e.elements.sidebar),e.helper.stylesheet.addStylesheets(["sidebar"],e.elements.iframe);var a=e.helper.model.getData("u/entriesLocked");a===!1&&e.elements.iframeBody.addClass(e.opts.classes.sidebar.entriesUnlocked),e.elements.bookmarkBox.all.addClass(e.opts.classes.sidebar.active),e.updateBookmarkBox(),e.helper.toggle.init()},i=function(b){var c=e.helper.model.getData("u/hiddenBookmarks");e.entries={bookmarks:{},directories:{}};var d=function b(d,f){for(var g=0;g<d.length;g++){var h=d[g];if(c[h.id]!==!0){var i=[].concat(a(f));"0"!==h.parentId&&i.push(h.parentId),h.parents=i,h.url?e.entries.bookmarks[h.id]=h:h.children&&(e.entries.directories[h.id]=h,b(h.children,i))}}};d(b,[]),j()},j=function(){e.elements.header.text("");var a=Object.keys(e.entries.bookmarks).length;b("<span />").html("<span>"+a+"</span> "+e.lang("header_bookmarks"+(1===a?"_single":""))).appendTo(e.elements.header),b("<a />").addClass(e.opts.classes.sidebar.settings).appendTo(e.elements.header),b("<a />").addClass(e.opts.classes.sidebar.search).appendTo(e.elements.header),b("<div />").addClass(e.opts.classes.sidebar.searchBox).append("<input type='text' placeholder='"+e.lang("sidebar_search_placeholder")+"' />").append("<a href='#' class='"+e.opts.classes.sidebar.searchClose+"'></a>").appendTo(e.elements.header)},k=function(){var a=e.helper.model.getData(["b/pxTolerance","a/showIndicator"]);e.elements.iframeBody.addClass(e.opts.classes.sidebar.extLoaded),document.dispatchEvent(new CustomEvent(e.opts.events.loaded,{detail:{pxTolerance:a.pxTolerance,showIndicator:a.showIndicator},bubbles:!0,cancelable:!1}))}};var d={ids:{page:{iframe:"moonware-bs-sidebar",overlay:"moonware-bs-overlay",visual:"moonware-bs-visual"},sidebar:{sidebar:"sidebar",bookmarkBox:"bookmarkBox",bookmarkBoxSearch:"bookmarkBoxSearch",shareUserdata:"shareUserdata"},overlay:{urlList:"urlList"}},classes:{page:{addVisual:"moonware-bs-add-visual",visible:"moonware-bs-visible",hover:"moonware-bs-hover",hasLeftsideBack:"moonware-bs-has-lsb"},sidebar:{extLoaded:"loaded",active:"active",mark:"mark",entriesUnlocked:"entriesUnlocked",dirAnimated:"animated",dirOpened:"opened",bookmarkDir:"dir",bookmarkLink:"link",bookmarkLabel:"label",settings:"settings",search:"search",searchBox:"searchBox",searchClose:"searchClose",searchVisible:"searchVisible",searchLoading:"searchLoading",shareUserdataNotice:"shareNotice",shareUserdataHidden:"hidden"},contextmenu:{wrapper:"contextmenu",top:"top",visible:"visible",separator:"separator"},drag:{trigger:"drag",helper:"dragHelper",isDragged:"isDragged",cancel:"dragCancel",snap:"snap",dragInitial:"dragInitial"},scrollBox:{wrapper:"scrollBox",scrollbar:"scrollbar",inactive:"inactive",hidden:"hidden",scrolled:"scrolled",scrolledEnd:"scrolledEnd",scrollDrag:"scrollDrag",scrollTrackpad:"scrollTrackpad"},checkbox:{box:"checkbox",active:"active",clicked:"clicked",focus:"focus"},overlay:{modal:"modal",visible:"visible",preview:"preview",previewUrl:"previewUrl",action:"action",close:"close",hasTooltip:"tooltip",inputError:"error",progressBar:"progressBar",checkUrlProgressLabel:"progressLabel",urlCheckLoading:"urlCheckLoading",urlCheckFinished:"urlCheckFinished"}},attr:{src:"data-src",position:"data-pos",type:"data-type",id:"data-id"},events:{loaded:"moonware-bs-loaded",lsbLoaded:"moonware-lsb-loaded"},leftsideBackSelector:"div#moonware-lsb-main.moonware-lsb-add-visual",fontHref:"https://fonts.googleapis.com/css?family=Roboto:100,300,500,100i,300i,500i",manifest:chrome.runtime.getManifest(),demoMode:!1};new window.ext(d).run()}(jsu);