/*! (c) Philipp KÃ¶nig under GPL-3.0 */
"use strict";function _toConsumableArray(e){if(Array.isArray(e)){for(var t=0,a=Array(e.length);t<e.length;t++)a[t]=e[t];return a}return Array.from(e)}function _defineProperty(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},_createClass=function(){function e(e,t){for(var a=0;a<t.length;a++){var s=t[a];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}return function(t,a,s){return a&&e(t.prototype,a),s&&e(t,s),t}}();!function(){var e="isDefined",t="forEach",a=function(s){var o=document,n=new WeakMap,r=new WeakMap,l=Symbol(),i="_fillNodeList";return function(){function d(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];_classCallCheck(this,d);var a=e;if("string"==typeof e&&(!1===t||e.search("<")>-1)){var s=o.createElement("div");s.innerHTML=e,a=s.childNodes}this[i](a)}return _createClass(d,[{key:i,value:function(n){var r=this;if(s[e](n))if(n instanceof a)this[l]=n.get();else if("string"==typeof n)this[l]=o.querySelectorAll(n);else if(n instanceof Node||n instanceof HTMLDocument||n instanceof Window)this[l]=[n];else if(n instanceof NodeList||n instanceof HTMLCollection)this[l]=n;else{if("object"!==(void 0===n?"undefined":_typeof(n)))throw new DOMException("invalid parameter for jsu");this[l]=[],s[e](n[t])||(n=[n]),n[t](function(e){var o=function(e){-1===r[l].indexOf(e)&&r[l].push(e)};e instanceof a?e[t](o):Array.isArray(e)||e instanceof NodeList||e instanceof HTMLCollection||/^\[object (HTMLCollection|NodeList|Object)\]$/.test(e.toString())?s[t](e,o):r[l].push(e)})}else this[l]=[];this[t](function(e,t){r[t]=e})}},{key:t,value:function(e){var a=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return s[t](this[l],e,a),this}},{key:"css",value:function(a,o){var n=!0,r=s[e](a),i=s[e](o),d=[];return this[t](function(e){r&&i&&"string"==typeof a?e.style[a]=o:r&&("string"==typeof a?(d.push(window.getComputedStyle(e)[a]),n=!1):"object"===(void 0===a?"undefined":_typeof(a))&&Object.keys(a)[t](function(t){"string"==typeof t&&(e.style[t]=a[t])}))}),n?this:this[l].length>1?d:d[0]}},{key:"attr",value:function(a,o){var n=!0,r=s[e](a),i=s[e](o),d=[];return this[t](function(l){var c=function(t,a){s[e](l[t])?l[t]=a:l.setAttribute(t,a)};r&&i&&"string"==typeof a?c(a,o):r&&("string"==typeof a?(d.push(function(t){return s[e](l[t])?l[t]:l.getAttribute(t)}(a)),n=!1):"object"===(void 0===a?"undefined":_typeof(a))&&Object.keys(a)[t](function(e){"string"==typeof e&&c(e,a[e])}))}),n?this:this[l].length>1?d:d[0]}},{key:"removeAttr",value:function(e){return this[t](function(t){t.removeAttribute(e)}),this}},{key:"clone",value:function(){return a._cloneElement(this)}},{key:"data",value:function(o,n){var i=!0,d=s[e](o),c=s[e](n),p=[];return this[t](function(l){var u=r.get(l),h=s[e](u);d&&c?a._addData(l,o,n):d?"string"==typeof o?(p.push(h?u[o]:void 0),i=!1):"object"===(void 0===o?"undefined":_typeof(o))&&Object.keys(o)[t](function(e){"string"==typeof e&&a._addData(l,e,o[e])}):(p.push(h?u:{}),i=!1)}),i?this:this[l].length>1?p:p[0]}},{key:"removeData",value:function(a){var o=!s[e](a);return this[t](function(t){var n=r.get(t);s[e](n)&&(o?r.delete(t):s[e](n[a])&&delete n[a])}),this}},{key:"on",value:function(e,o,n,r,l){var i=function(e,a){Object.keys(a)[t](function(t){try{Object.defineProperty(e,t,{value:a[t]})}catch(e){}})},d=n;"function"==typeof n?d=r:l=r,void 0===d&&(d=null),void 0===l&&(l=null);var c="string"==typeof o;return this[t](function(r){e.split(/\s+/g)[t](function(e){var p=function(a){i(a,{type:e}),c?s[t](r.querySelectorAll(":scope "+o),function(t){for(var s=a.target;s&&s!==r;){if(s===t){var o=new MouseEvent(e,a);i(o,{preventDefault:function(){a.preventDefault()},stopPropagation:function(){a.stopPropagation()},target:a.target,currentTarget:s}),n(o)}s=s.parentNode}}):"function"==typeof o&&o(a)};a._addEventListener(r,{event:e,fn:p,opts:d,wantsUntrusted:l})})},!0),this}},{key:"off",value:function(a){return this[t](function(o){var r=n.get(o);s[e](r)&&a.split(/\s+/g)[t](function(e){r[e]&&s[t](r[e],function(t,a){o.removeEventListener(e,t.fn),r[e].splice(a,1)},!0)})}),this}},{key:"trigger",value:function(e,a){var s=this;return e.split(/\s+/g)[t](function(e){var o=new Event(e,a);s[t](function(e){e.dispatchEvent(o)})}),this}},{key:"addClass",value:function(e){return this[t](function(t){t.classList.add(e)}),this}},{key:"removeClass",value:function(e){return this[t](function(t){t.classList.remove(e)}),this}},{key:"toggleClass",value:function(e){return this[t](function(t){t.classList.toggle(e)}),this}},{key:"hasClass",value:function(e){var a=[];return this[t](function(t){a.push(t.classList.contains(e))}),this[l].length>1?a:a[0]}},{key:"_realDimension",value:function(e){var a=arguments.length>1&&void 0!==arguments[1]&&arguments[1],s=[],o="width",n=["left","right"];return"h"===e&&(o="height",n=["top","bottom"]),this[t](function(e){var t=e.getBoundingClientRect(),r=window.getComputedStyle(e),l=t[o];a&&(l+=parseInt(r.getPropertyValue("margin-"+n[0])),l+=parseInt(r.getPropertyValue("margin-"+n[1]))),s.push(l)}),this[l].length>1?s:s[0]}},{key:"realWidth",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return this._realDimension("w",e)}},{key:"realHeight",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return this._realDimension("h",e)}},{key:"find",value:function(e){var s=[];return this[t](function(t){t instanceof HTMLIFrameElement?s.push(t.contentDocument.querySelectorAll(":scope "+e)):s.push(t.querySelectorAll(":scope "+e))}),new a(s)}},{key:"children",value:function(e){var s=[];return e||(e="*"),this[t](function(t){s.push(t.querySelectorAll(":scope > "+e))}),new a(s)}},{key:"_htmlText",value:function(a,o){var n=s[e](a),r=n?this:"";return this[t](function(e){n?e[o]=a:r+=e[o]}),r}},{key:"html",value:function(e){return this._htmlText(e,"innerHTML")}},{key:"text",value:function(e){return this._htmlText(e,"innerText")}},{key:"remove",value:function(){this[t](function(e){e&&e.parentElement&&(n.delete(e),r.delete(e),e.parentElement.removeChild(e))})}},{key:"_moveElement",value:function(e){var s=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],o=arguments[2];"string"==typeof e&&e.search("<")>-1&&(s=!1);var n=new a(e,s);return this[t](function(e){a._cloneElement(n)[t](function(t){switch(o){case"append":e.appendChild(t);break;case"prepend":e.insertBefore(t,e.firstChild);break;case"before":e.parentNode.insertBefore(t,e);break;case"after":e.parentNode.insertBefore(t,e.nextSibling)}})}),n.remove(),this}},{key:"_moveElementTo",value:function(e,s){var o=this,n=[];return new a(e)[t](function(e){a._cloneElement(o)[t](function(t){switch(s){case"append":e.appendChild(t);break;case"prepend":e.insertBefore(t,e.firstChild);break;case"before":e.parentNode.insertBefore(t,e);break;case"after":e.parentNode.insertBefore(t,e.nextSibling)}n.push(t)})}),this.remove(),new a(n)}},{key:"append",value:function(e,t){return this._moveElement(e,t,"append")}},{key:"appendTo",value:function(e){return this._moveElementTo(e,"append")}},{key:"prepend",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return this._moveElement(e,t,"prepend")}},{key:"prependTo",value:function(e){return this._moveElementTo(e,"prepend")}},{key:"before",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return this._moveElement(e,t,"before")}},{key:"insertBefore",value:function(e){return this._moveElementTo(e,"before")}},{key:"after",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return this._moveElement(e,t,"after")}},{key:"insertAfter",value:function(e){return this._moveElementTo(e,"after")}},{key:"_nextPrev",value:function(o,n){var r=s[e](o),l=[];return this[t](function(t){var a="prev"===n?t.previousElementSibling:t.nextElementSibling;s[e](a)&&(!r||s[e](a.matches)&&a.matches(o))&&l.push(a)}),new a(l)}},{key:"next",value:function(e){return this._nextPrev(e,"next")}},{key:"prev",value:function(e){return this._nextPrev(e,"prev")}},{key:"_siblings",value:function(o){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"siblings",r=s[e](o),i=[];return this[t](function(e){var t=null,s=[];for("siblings"===n&&e.parentNode.firstElementChild?(t=e.parentNode.firstElementChild,n="next"):"previous"!==n&&"next"!==n||(t=e[n+"ElementSibling"]);t&&t.matches;)t===e||r&&!t.matches(o)||s.push(t),t=t[n+"ElementSibling"];i.push(new a(s))}),this[l].length>1?i:i[0]}},{key:"siblings",value:function(e){return this._siblings(e)}},{key:"nextAll",value:function(e){return this._siblings(e,"next")}},{key:"prevAll",value:function(e){return this._siblings(e,"previous")}},{key:"parent",value:function(o){var n=s[e](o),r=[];return this[t](function(t){var l=t.parentNode;!n||s[e](l.matches)&&l.matches(o)||(l=null),r.push(new a(l))}),this[l].length>1?r:r[0]}},{key:"parents",value:function(o){var n=this,r=s[e](o),i=[];return this[t](function(e){for(var t=[],s=e.parentNode;s&&s.matches&&s!==n;)r&&!s.matches(o)||t.push(s),s=s.parentNode;i.push(new a(t))}),this[l].length>1?i:i[0]}},{key:"document",value:function(){var e=[];return this[t](function(t){e.push(new a(t.ownerDocument))}),this[l].length>1?e:e[0]}},{key:"eq",value:function(e){return e<0&&(e=this[l].length+e),new a(this[l][e])}},{key:"get",value:function(t){return s[e](t)?(t<0&&(t=this[l].length+t),this[l][t]):this[l]}},{key:"length",value:function(){return this[l].length}}],[{key:"_addEventListener",value:function(t,a){var o=n.get(t);s[e](o)||(o={},n.set(t,o)),o[a.event]||(o[a.event]=[]),o[a.event].push({fn:a.fn,opts:a.opts,wantsUntrusted:a.wantsUntrusted}),t.addEventListener(a.event,a.fn,a.opts,a.wantsUntrusted)}},{key:"_cloneEventListener",value:function(o,r){var l=n.get(o);s[e](l)&&Object.keys(l)[t](function(e){l[e][t](function(t){a._addEventListener(r,{event:e,fn:t.fn,opts:t.opts,wantsUntrusted:t.wantsUntrusted})})}),r.children&&s[t](r.children,function(e,t){a._cloneEventListener(o.children[t],e)})}},{key:"_addData",value:function(t,a,o){var n=r.get(t);s[e](n)||(n={},r.set(t,n)),n[a]=o}},{key:"_cloneData",value:function(o,n){var l=r.get(o);s[e](l)&&Object.keys(l)[t](function(e){a._addData(n,e,l[e])}),n.children&&s[t](n.children,function(e,t){a._cloneData(o.children[t],e)})}},{key:"_cloneElement",value:function(e){var s=[];return e[t](function(e){var t=e.cloneNode(!0);a._cloneEventListener(e,t),a._cloneData(e,t),s.push(t)}),new a(s)}}]),d}()}(function(){return function(){function a(){_classCallCheck(this,a)}return _createClass(a,null,[{key:e,value:function(e){return void 0!==e&&null!==e}},{key:t,value:function(a,s){var o=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=a.length;if(o){for(var r=n-1;r>=0;r--)if(this[e](a[r][t]))this[t](a[r],s,o);else if(!1===s(a[r],r))break}else for(var l=0;l<n;l++)if(this[e](a[l][t]))this[t](a[l],s,o);else if(!1===s(a[l],l))break}}]),a}()}());window.jsu=function(e){return new a(e)}}(),function(e){window.CheckboxHelper=function(t){var a=this,s={};this.get=function(s,o){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"checkbox",l=e("<div />").html("<input type='checkbox' />").data("uid",Math.random().toString(36).substr(2,12)).attr(t.opts.attr.type,n).addClass(t.opts.classes.checkbox.box);return void 0!==o&&(l.children("input[type='checkbox']").attr(o),o[t.opts.attr.name]&&l.attr(t.opts.attr.name,o[t.opts.attr.name])),a.isChecked(l)&&l.addClass(t.opts.classes.checkbox.active),r(l,s),l},this.isChecked=function(e){return e.find("input[type='checkbox']")[0].checked};var o=function(e,a){var s=e.children("input[type='checkbox']");s.trigger("change"),a.document()[0].dispatchEvent(new CustomEvent(t.opts.events.checkboxChanged,{detail:{container:e,checkbox:s,checked:e.hasClass(t.opts.classes.checkbox.active)},bubbles:!0,cancelable:!1}))},n=function n(r,l){r.addClass(t.opts.classes.checkbox.clicked),r.removeClass(t.opts.classes.checkbox.focus),r.toggleClass(t.opts.classes.checkbox.active);var i=r.hasClass(t.opts.classes.checkbox.active),d=r.children("input[type='checkbox']");if("radio"===r.attr(t.opts.attr.type)&&r.attr(t.opts.attr.name))if(l){var c=r.attr(t.opts.attr.name);r.addClass(t.opts.classes.checkbox.active),i&&(d.attr("checked",!0),o(r,l)),l.find("div."+t.opts.classes.checkbox.box+"["+t.opts.attr.type+"='radio']["+t.opts.attr.name+"='"+c+"']").forEach(function(t){var s=e(t);t!==r[0]&&a.isChecked(s)&&n(s)})}else d.attr("checked",!1);else d.attr("checked",i),o(r,l);var p=r.data("uid");s[p]&&clearTimeout(s[p]),s[p]=setTimeout(function(){r.removeClass(t.opts.classes.checkbox.clicked)},300)},r=function(a,s){a.on("mousedown",function(a){a.preventDefault(),a.stopPropagation(),e(a.currentTarget).addClass(t.opts.classes.checkbox.focus)}).on("click",function(t){t.preventDefault(),t.stopPropagation(),n(e(t.currentTarget),s)}),s.on("click",function(){a.removeClass(t.opts.classes.checkbox.focus)})}},window.ContextmenuHelper=function(t){var a=this;this.create=function(l,d){if(!1===s(l,d)){a.close(),d.addClass(t.opts.classes.sidebar.active);var c=e("<div />").addClass(t.opts.classes.contextmenu.wrapper).html("<ul class='"+t.opts.classes.contextmenu.list+"'></ul><ul class='"+t.opts.classes.contextmenu.icons+"'></ul>").attr(t.opts.attr.type,l).data("elm",d).appendTo(t.elements.sidebar),p=d.attr(t.opts.attr.id);switch(p&&c.attr(t.opts.attr.id,p),l){case"list":r(c,d);break;case"menu":n(c,d);break;case"sort":o(c,d)}i(c),setTimeout(function(){c.addClass(t.opts.classes.contextmenu.visible);var e=parseInt(c.css("top")),a=c.realHeight();e+a>=window.innerHeight&&c.css("top",e-a).addClass(t.opts.classes.contextmenu.top)},0)}};var s=function(e,a){var s=a.attr(t.opts.attr.id),o="div."+t.opts.classes.contextmenu.wrapper+"["+t.opts.attr.type+"='"+e+"']";return s&&(o+="["+t.opts.attr.id+"='"+s+"']"),t.elements.sidebar.find(o).length()>0};this.close=function(){var a=t.elements.iframeBody.find("div."+t.opts.classes.contextmenu.wrapper);a.forEach(function(a){e(a).removeClass(t.opts.classes.contextmenu.visible),e(a).data("elm").removeClass(t.opts.classes.sidebar.active)}),setTimeout(function(){a.remove()},500)};var o=function(a,s){var o=t.helper.list.getSortList(),n=t.helper.list.getSort(),r=a.children("ul."+t.opts.classes.contextmenu.list);a.children("ul."+t.opts.classes.contextmenu.icons).remove(),Object.keys(o).forEach(function(s){var o,l=s.replace(/([A-Z])/g,"_$1").toLowerCase();e("<li />").append(t.helper.checkbox.get(t.elements.iframeBody,(o={},_defineProperty(o,t.opts.attr.name,"sort"),_defineProperty(o,t.opts.attr.value,s),o),"radio")).append("<a "+t.opts.attr.name+"='sort'>"+t.helper.i18n.get("sort_label_"+l)+"</a>").appendTo(r),s===n.name&&a.find("input["+t.opts.attr.name+"='sort']["+t.opts.attr.value+"='"+s+"']").parent("div."+t.opts.classes.checkbox.box).trigger("click")});var l=s[0].getBoundingClientRect();a.css("top",l.top+l.height+"px")},n=function(a,s){var o=a.children("ul."+t.opts.classes.contextmenu.list),n=a.children("ul."+t.opts.classes.contextmenu.icons);"custom"===t.helper.list.getSort().name&&(e("<li />").append(t.helper.checkbox.get(t.elements.iframeBody,_defineProperty({},t.opts.attr.name,"toggleFix"))).append("<a "+t.opts.attr.name+"='toggleFix'>"+t.helper.i18n.get("contextmenu_toggle_fix")+"</a>").appendTo(o),!1===t.elements.sidebar.hasClass(t.opts.classes.sidebar.entriesUnlocked)&&a.find("input["+t.opts.attr.name+"='toggleFix']").parent("div."+t.opts.classes.checkbox.box).trigger("click")),e("<li />").append(t.helper.checkbox.get(t.elements.iframeBody,_defineProperty({},t.opts.attr.name,"toggleHidden"))).append("<a "+t.opts.attr.name+"='toggleHidden'>"+t.helper.i18n.get("contextmenu_toggle_hidden")+"</a>").appendTo(o),!0===t.elements.sidebar.hasClass(t.opts.classes.sidebar.showHidden)&&a.find("input["+t.opts.attr.name+"='toggleHidden']").parent("div."+t.opts.classes.checkbox.box).trigger("click"),n.append("<li><a "+t.opts.attr.name+"='settings' title='"+t.helper.i18n.get("contextmenu_settings")+"'></a></li>").append("<li><a "+t.opts.attr.name+"='bookmarkManager' title='"+t.helper.i18n.get("contextmenu_bookmark_manager")+"'></a></li>");var r=s[0].getBoundingClientRect();a.css("top",r.top+r.height+"px")},r=function(e,a){var s=a.attr(t.opts.attr.id),o=t.helper.entry.getData(s);e.css({top:a[0].getBoundingClientRect().top+a.realHeight()+"px",left:a[0].offsetLeft+"px"});var n=o.isDir?"_dir":"_bookmark",r=e.children("ul."+t.opts.classes.contextmenu.list),l=e.children("ul."+t.opts.classes.contextmenu.icons),i=t.elements.bookmarkBox.search.hasClass(t.opts.classes.sidebar.active);o.isDir?(r.append("<li><a "+t.opts.attr.name+"='openChildren'>"+t.helper.i18n.get("contextmenu_open_children")+"</a></li>"),o.children.length>0&&r.append("<li><a "+t.opts.attr.name+"='updateUrls'>"+t.helper.i18n.get("contextmenu_update_urls")+"</a></li>")):(i&&r.append("<li><a "+t.opts.attr.name+"='showInDir'>"+t.helper.i18n.get("contextmenu_show_in_dir")+"</a></li>"),r.append("<li><a "+t.opts.attr.name+"='newTab'>"+t.helper.i18n.get("contextmenu_new_tab")+"</a></li>"),!1===chrome.extension.inIncognitoContext&&r.append("<li><a "+t.opts.attr.name+"='newTabIncognito'>"+t.helper.i18n.get("contextmenu_new_tab_incognito")+"</a></li>")),l.append("<li><a "+t.opts.attr.name+"='infos' title='"+t.helper.i18n.get("contextmenu_infos")+"'></a></li>"),o.parents.length>0&&l.append("<li><a "+t.opts.attr.name+"='edit' title='"+t.helper.i18n.get("contextmenu_edit"+n)+"'></a></li>").append("<li><a "+t.opts.attr.name+"='delete' title='"+t.helper.i18n.get("contextmenu_delete"+n)+"'></a></li>"),o.isDir&&l.append("<li><a "+t.opts.attr.name+"='add' title='"+t.helper.i18n.get("contextmenu_add")+"'></a></li>"),t.helper.entry.isVisible(s)?l.append("<li class='"+t.opts.classes.contextmenu.right+"'><a "+t.opts.attr.name+"='hide' title='"+t.helper.i18n.get("contextmenu_hide_from_sidebar")+"'></a></li>"):!i&&a.parents("li."+t.opts.classes.sidebar.hidden).length()<=1&&l.append("<li class='"+t.opts.classes.contextmenu.right+"'><a "+t.opts.attr.name+"='show' title='"+t.helper.i18n.get("contextmenu_show_in_sidebar")+"'></a></li>")},l=function(s){s.find("input["+t.opts.attr.name+"='sort']").on("change",function(s){if(s.currentTarget.checked){var o=e(s.currentTarget).attr(t.opts.attr.value);t.helper.list.updateSort(o),a.close()}})},i=function(s){l(s),s.find("input["+t.opts.attr.name+"='toggleFix']").on("change",function(){t.elements.sidebar.toggleClass(t.opts.classes.sidebar.entriesUnlocked),t.helper.model.setData({"u/entriesLocked":!1===t.elements.sidebar.hasClass(t.opts.classes.sidebar.entriesUnlocked)}),a.close()}),s.find("input["+t.opts.attr.name+"='toggleHidden']").on("change",function(){t.startLoading(),t.elements.sidebar.toggleClass(t.opts.classes.sidebar.showHidden),t.helper.model.setData({"u/showHidden":!0===t.elements.sidebar.hasClass(t.opts.classes.sidebar.showHidden)},function(){t.helper.model.call("refreshAllTabs",{type:"ToggleHidden"})}),a.close()}),s.find("a").on("click",function(a){a.preventDefault();var o=e(a.currentTarget).attr(t.opts.attr.name),n=s.attr(t.opts.attr.id),r=n?t.helper.entry.getData(n):null;switch(o){case"settings":t.helper.model.call("openLink",{href:chrome.extension.getURL("html/settings.html"),newTab:!0});break;case"sort":case"toggleFix":case"toggleHidden":a.stopPropagation(),e(a.currentTarget).prev("div."+t.opts.classes.checkbox.box).trigger("click");break;case"bookmarkManager":t.helper.model.call("openLink",{href:"chrome://bookmarks",newTab:!0,active:!0});break;case"newTabIncognito":t.helper.sidebarEvents.openUrl(r,"incognito");break;case"newTab":t.helper.sidebarEvents.openUrl(r,"newTab","foreground"===t.helper.model.getData("b/newTab"));break;case"show":t.startLoading();var l=t.helper.model.getData("u/hiddenEntries");delete l[n],t.helper.model.setData({"u/hiddenEntries":l},function(){t.helper.model.call("refreshAllTabs",{type:"Hide"})});break;case"openChildren":var i=r.children.filter(function(e){return!!e.url});i.length>10?t.helper.overlay.create(o,e(a.currentTarget).attr("title")||e(a.currentTarget).text(),r):i.forEach(function(e){t.helper.sidebarEvents.openUrl(e,"newTab","foreground"===t.helper.model.getData("b/newTab"))});break;case"showInDir":var d=t.helper.entry.getData(n);if(d&&d.parents){!function e(a){if(d.parents[a]){var s=t.elements.bookmarkBox.all.find("ul > li > a."+t.opts.classes.sidebar.bookmarkDir+"["+t.opts.attr.id+"='"+d.parents[a]+"']");s.hasClass(t.opts.classes.sidebar.dirOpened)?e(a+1):t.helper.list.toggleBookmarkDir(s,!0,function(){e(a+1)})}else{t.helper.search.clearSearch();var o=t.elements.bookmarkBox.all.find("ul > li > a["+t.opts.attr.id+"='"+n+"']");t.helper.scroll.setScrollPos(t.elements.bookmarkBox.all,o[0].offsetTop-50),o.addClass(t.opts.classes.sidebar.mark)}}(0)}break;default:t.helper.overlay.create(o,e(a.currentTarget).attr("title")||e(a.currentTarget).text(),r)}})}},window.DragDropHelper=function(t){var a=null,s=0,o=null,n={running:!1,posY:null,previousDelta:0,fpsLimit:30};this.init=function(){h(),l()};var r=function(e){var a=0;return a="object"===(void 0===e?"undefined":_typeof(e))?e[0].getBoundingClientRect().left:+e,"right"===t.elements.iframe.attr(t.opts.attr.position)&&(a=window.innerWidth-a),"object"===(void 0===e?"undefined":_typeof(e))?.6*e.realWidth()+a>t.elements.sidebar.realWidth():a>t.elements.sidebar.realWidth()},l=function(){t.elements.iframeBody.on("dragenter",function(){t.helper.contextmenu.close(),t.elements.iframeBody.addClass(t.opts.classes.drag.isDragged),t.elements.iframe.removeClass(t.opts.classes.page.isNewTab),n.running||window.requestAnimationFrame(d)}).on("drop dragend",function(a){if(a.preventDefault(),a.stopPropagation(),n.posY=null,t.elements.iframeBody.hasClass(t.opts.classes.drag.isDragged)){if(!r(a.pageX)){var s=t.elements.bookmarkBox.all.find("li."+t.opts.classes.drag.isDragged).eq(0);if(s&&s.length()>0){var o=a.dataTransfer.getData("URL"),l="";location.href===o&&(l=e(document).find("title").text()),t.helper.overlay.create("add",t.helper.i18n.get("contextmenu_add"),{values:{index:s.prevAll("li").length(),parentId:s.parent("ul").prev("a").attr(t.opts.attr.id),title:l,url:o}})}}t.elements.iframeBody.removeClass(t.opts.classes.drag.isDragged),t.isNewTab&&t.elements.iframe.addClass(t.opts.classes.page.isNewTab)}})},i=function(a,s,o){t.helper.contextmenu.close();var r=e(a).parent("a").removeClass(t.opts.classes.sidebar.dirOpened),l=r.parent("li");t.elements.iframeBody.addClass(t.opts.classes.drag.isDragged),l.clone().addClass(t.opts.classes.drag.dragInitial).insertAfter(l);var i=r.clone().appendTo(t.elements.iframeBody),c=t.helper.entry.getData(r.attr(t.opts.attr.id)),p=r[0].getBoundingClientRect();i.removeAttr("title").css({top:p.top+"px",left:p.left+"px",width:r.realWidth()+"px"}).data({elm:l,isDir:c.isDir,startPos:{top:o-p.top,left:s-p.left}}).addClass(t.opts.classes.drag.helper),l.addClass(t.opts.classes.drag.isDragged),n.running||window.requestAnimationFrame(d)},d=function e(a){window.requestAnimationFrame(e);var s=a-n.previousDelta;if(!(n.fpsLimit&&s<1e3/n.fpsLimit)){if(null!==n.posY){var o=t.elements.bookmarkBox.all[0].offsetTop,r=t.elements.bookmarkBox.all[0].offsetHeight,l=t.elements.bookmarkBox.all[0].scrollTop,i=null;n.posY-o<60?i=l-Math.pow((50-n.posY+o)/10,2):n.posY+60>r&&(i=l+Math.pow((n.posY+50-r)/10,2)),i&&t.helper.scroll.setScrollPos(t.elements.bookmarkBox.all,i)}n.previousDelta=a}},c=function(){p();var e=t.elements.iframeBody.children("a."+t.opts.classes.drag.helper),a=t.elements.bookmarkBox.all.find("li."+t.opts.classes.drag.dragInitial),s=e.data("elm");r(e)?(s.insertAfter(a).removeClass(t.opts.classes.drag.isDragged),a.remove(),e.remove()):(e.addClass(t.opts.classes.drag.snap),t.helper.model.call("moveBookmark",{id:s.children("a").attr(t.opts.attr.id),parentId:s.parent("ul").prev("a").attr(t.opts.attr.id),index:s.prevAll("li").length()}),setTimeout(function(){var o=s[0].getBoundingClientRect();e.css({top:o.top+"px",left:o.left+"px"}),setTimeout(function(){s.removeClass(t.opts.classes.drag.isDragged),a.remove(),e.remove()},200)},0)),t.elements.iframeBody.removeClass(t.opts.classes.drag.isDragged),t.isNewTab&&setTimeout(function(){t.elements.iframe.addClass(t.opts.classes.page.isNewTab)},500)},p=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;null===o||null!==e&&o.id===e.attr(t.opts.attr.id)||(o.elm.removeClass(t.opts.classes.drag.dragHover),clearTimeout(o.instance),o=null)},u=function(l,i,d){n.posY=d;var c=null,u=null,h=0,m=0;if("dragover"===l){if(h=d-20,m=i,h===s)return!1;s=h,t.elements.bookmarkBox.all.find("li."+t.opts.classes.drag.isDragged).remove(),u=e("<li />").html("<a>&nbsp;</a>").addClass(t.opts.classes.drag.isDragged)}else{var f=(c=t.elements.iframeBody.children("a."+t.opts.classes.drag.helper)).data("startPos");h=d-f.top,m=i-f.left,c.css({top:h+"px",left:m+"px"}),u=c.data("elm")}if(r(c||m))return p(),t.elements.iframeBody.addClass(t.opts.classes.drag.cancel),!1;t.elements.iframeBody.removeClass(t.opts.classes.drag.cancel);var v=null;if(e([t.elements.bookmarkBox.all.find("> ul > li > a."+t.opts.classes.sidebar.dirOpened).parent("li"),t.elements.bookmarkBox.all.find("a."+t.opts.classes.sidebar.dirOpened+" + ul > li")]).forEach(function(a){var s=e(a);if(a!==u[0]&&!s.hasClass(t.opts.classes.drag.dragInitial)){if(a.getBoundingClientRect().top>h)return!1;v=s}}),v&&v!==a){a=v;var g=v.children("a").eq(0);if(p(g),g.hasClass(t.opts.classes.sidebar.bookmarkDir))if(g.hasClass(t.opts.classes.sidebar.dirOpened)){var b=u.prependTo(g.next("ul"));c&&c.data("elm",b)}else if(c&&c.data("isDir")){var k=u.insertAfter(v);c&&c.data("elm",k)}else g.hasClass(t.opts.classes.sidebar.dirAnimated)?0===g.next("ul").length()&&(g.addClass(t.opts.classes.sidebar.dirOpened),e("<ul />").insertAfter(g)):null===o&&((o={id:g.attr(t.opts.attr.id),elm:g.addClass(t.opts.classes.drag.dragHover)}).instance=setTimeout(function(){t.helper.list.toggleBookmarkDir(g)},700));else{var y=u.insertAfter(v);c&&c.data("elm",y)}}},h=function(){t.elements.bookmarkBox.all.children("ul").on("mousedown","span."+t.opts.classes.drag.trigger,function(e){var a=e.pageX;if(t.isNewTab&&"right"===t.elements.iframe.attr(t.opts.attr.position)){var s=t.elements.iframe.realWidth();t.elements.iframe.removeClass(t.opts.classes.page.isNewTab),a+=t.elements.iframe.realWidth()-s}else t.isNewTab&&t.elements.iframe.removeClass(t.opts.classes.page.isNewTab);i(e.currentTarget,a,e.pageY)}),t.elements.iframeBody.on("mouseup",function(e){n.posY=null,t.elements.iframeBody.hasClass(t.opts.classes.drag.isDragged)&&(e.preventDefault(),e.stopPropagation(),c())}),t.elements.iframeBody.on("wheel",function(e){if(t.elements.iframeBody.hasClass(t.opts.classes.drag.isDragged)){e.preventDefault(),e.stopPropagation();var a=t.elements.bookmarkBox.all[0].scrollTop;t.helper.scroll.setScrollPos(t.elements.bookmarkBox.all,a-e.wheelDelta,300)}}),t.elements.iframeBody.on("mousemove dragover",function(e){t.elements.iframeBody.hasClass(t.opts.classes.drag.isDragged)&&1===e.which&&(e.preventDefault(),e.stopPropagation(),u(e.type,e.pageX,e.pageY))}),t.elements.iframeBody.on("contextmenu","a."+t.opts.classes.drag.helper,function(e){e.preventDefault(),e.stopPropagation()})}},window.EntryHelper=function(e){var t={};this.update=function(a,s){e.helper.model.call("viewAmounts",function(o){var n=e.helper.model.getData("u/hiddenEntries"),r=e.elements.sidebar.hasClass(e.opts.classes.sidebar.showHidden);t={bookmarks:{},directories:{}};!function a(s){var l=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];s.forEach(function(s,d){if(r||!0!==n[s.id]){var c=[].concat(_toConsumableArray(l));"0"!==s.parentId&&c.push(s.parentId),s.hidden=i||!0===n[s.id],s.parents=c;var p=new Date(Math.max(s.dateAdded,o.counterStartDate)),u=Math.max(1,Math.round((+new Date-p)/2627999942.4));if(s.views={startDate:p,total:0},s.url){e.opts.demoMode&&(s.title=e.helper.i18n.get("overlay_label_bookmark")+" "+(d+1),s.url="https://example.com/");var h=0,m=o.viewAmounts[s.id]?o.viewAmounts[s.id].d||0:0;o.viewAmounts[s.id]?h=o.viewAmounts[s.id].c||+o.viewAmounts[s.id]:o.viewAmounts["node_"+s.id]&&(h=o.viewAmounts["node_"+s.id].c||+o.viewAmounts["node_"+s.id]),s.views.total=h,s.views.lastView=m,s.views.perMonth=Math.round(h/u*100)/100,c.forEach(function(e){t.directories[e].childrenAmount.bookmarks++,t.directories[e].views.total+=h,t.directories[e].views.lastView=Math.max(t.directories[e].views.lastView||0,m)}),t.bookmarks[s.id]=s}else s.children&&(e.opts.demoMode&&(s.title=e.helper.i18n.get("overlay_label_dir")+" "+(d+1)),s.childrenAmount={bookmarks:0,directories:0,total:0},c.forEach(function(e){t.directories[e].childrenAmount.directories++}),t.directories[s.id]=s,a(s.children,c,s.hidden),s.isDir=!0,s.childrenAmount.total=s.childrenAmount.bookmarks+s.childrenAmount.directories,s.views.perMonth=Math.round(s.views.total/u*100)/100)}})}(a),"function"==typeof s&&s()})},this.getAllDirectoryData=function(){return Object.values(t.directories)},this.getAllBookmarkData=function(){return Object.values(t.bookmarks)},this.getData=function(e){var a=null;return"object"===_typeof(t.bookmarks[e])?a=t.bookmarks[e]:"object"===_typeof(t.directories[e])&&(a=t.directories[e]),a},this.addData=function(e,a,s){"object"===_typeof(t.bookmarks[e])?t.bookmarks[e][a]=s:"object"===_typeof(t.directories[e])&&(t.directories[e][a]=s)},this.isVisible=function(e){var a=!1;return"object"===_typeof(t.bookmarks[e])?a=!1===t.bookmarks[e].hidden:"object"===_typeof(t.directories[e])&&(a=!1===t.directories[e].hidden),a}},window.FontHelper=function(t){var a=this,s={general:{name:"Roboto",href:"https://fonts.googleapis.com/css?family=Roboto:100,200,300,400,500,100i,200i,300i,400i,500i"},ja:{name:"Noto Sans Japanese",href:"https://fonts.googleapis.com/earlyaccess/notosansjapanese.css"},"zh-CN":{name:"Noto Sans SC",href:"https://fonts.googleapis.com/earlyaccess/notosanssc.css"}},o={__default:{Thin:100,ExtraLight:200,Light:300,Normal:400,Medium:500,SemiBold:600,Bold:700,ExtraBold:800,Black:900},Roboto:{Thin:100,ExtraLight:100,Light:200,Normal:300,Medium:400,SemiBold:400,Bold:500,ExtraBold:500,Black:500},"Noto Sans Japanese":{Thin:100,ExtraLight:100,Light:100,Normal:200,Medium:300,SemiBold:400,Bold:500,ExtraBold:500,Black:500},"Noto Sans SC":{Thin:100,ExtraLight:100,Light:100,Normal:300,Medium:400,SemiBold:400,Bold:400,ExtraBold:500,Black:500}},n={};this.init=function(){var e=t.helper.model.getData("a/styles");(n=e.fontFamily&&"default"!==e.fontFamily&&"Roboto"!==e.fontFamily?{name:e.fontFamily}:a.getDefaultFontInfo()).fontWeights=a.getFontWeights(n.name)},this.isLoaded=function(){return!!n.name},this.getFontInfo=function(){return n},this.getFontWeights=function(e){var t={};return Object.keys(o.__default).forEach(function(a){var s=o.__default[a];o[e]&&o[e][a]&&(s=o[e][a]),t["fontWeight"+a]=s}),t},this.addStylesheet=function(t){n.href&&e("<link />").attr({rel:"stylesheet",type:"text/css",href:n.href}).appendTo(t.find("head"))},this.getDefaultFontInfo=function(){var e=t.helper.i18n.getLanguage();return s[e]?s[e]:s.general}},window.I18nHelper=function(t){var a=this,s=null,o={},n={i18n:"data-i18n",i18nReplaces:"data-i18nReplaces"};this.init=function(e){o={},t.helper.model.call("languageInfos",function(n){var r=t.helper.model.getData("a/language");"default"===r&&(r=chrome.i18n.getUILanguage());var l=a.getDefaultLanguage();[r,l].some(function(a){if(n.infos&&n.infos[a]&&n.infos[a].available)return s=a,t.helper.model.call("langvars",{lang:a,defaultLang:l},function(t){t&&t.langVars&&(o=t.langVars,"function"==typeof e&&e())}),!0})})},this.getLanguage=function(){return s},this.getDefaultLanguage=function(){return t.opts.manifest.default_locale},this.getLocaleSortCollator=function(){return new Intl.Collator([chrome.i18n.getUILanguage(),a.getDefaultLanguage()])},this.getLocaleDate=function(e){return e.toLocaleDateString([chrome.i18n.getUILanguage(),a.getDefaultLanguage()],{year:"numeric",month:"2-digit",day:"2-digit"})},this.parseHtml=function(t){e(t).find("["+n.i18n+"]").forEach(function(t){var s=null,o=e(t).attr(n.i18n);if(o){var r=[],l=e(t).attr(n.i18nReplaces);l&&(r=l.split(",")),s=a.get(o,r)}s?(e(t).removeAttr(n.i18n),e(t).html(s)):e(t).remove()})},this.get=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],a="",s=o[e];return s&&s.message&&(a=s.message,t.forEach(function(e,t){a=a.replace(new RegExp("\\{"+(t+1)+"\\}"),e)}),a=a.replace(/\[b\](.*)\[\/b\]/,"<strong>$1</strong>"),a=a.replace(/\[a\](.*)\[\/a\]/,"<a href='#'>$1</a>"),a=a.replace(/\[em\](.*)\[\/em\]/,"<em>$1</em>")),a}},window.ListHelper=function(t){var a=this,s=0,o=null;this.init=function(){t.elements.bookmarkBox.all.addClass(t.opts.classes.sidebar.active),Object.values(t.elements.bookmarkBox).forEach(function(e){e.on(t.opts.events.scrollBoxLastPart,function(){var s=e.children("ul"),o=s.data("remainingEntries");o&&o.length>0&&(a.addBookmarkDir(o,s,!1,!1),(t.firstRun||!1===t.elements.iframe.hasClass(t.opts.classes.page.visible))&&t.helper.scroll.restoreScrollPos(e))})}),a.updateBookmarkBox()},this.getSortList=function(){return{custom:{dir:"ASC"},alphabetical:{dir:"ASC"},mostUsed:{dir:"DESC"},recentlyUsed:{dir:"DESC"},recentlyAdded:{dir:"DESC"}}},this.getSort=function(){return o},this.updateSort=function(e,s){var n=a.getSortList();n[e]&&(void 0===s&&(s=n[e].dir),o={name:e,dir:"ASC"===s?"ASC":"DESC"},t.startLoading(),t.helper.model.setData({"u/sort":o},function(){t.helper.model.call("refreshAllTabs",{scrollTop:!0,type:"Sort"})}))},this.updateDirection=function(e){a.updateSort(o.name,e)},this.updateBookmarkBox=function(){t.startLoading(),o=t.helper.model.getData("u/sort"),t.elements.sidebar.attr(t.opts.attr.sort,o.name),t.helper.model.call("bookmarks",{id:0},function(e){if(e.bookmarks&&e.bookmarks[0]&&e.bookmarks[0].children&&e.bookmarks[0].children.length>0){t.firstRun=!0;var s=t.elements.bookmarkBox.all.children("ul");s.removeClass(t.opts.classes.sidebar.hideRoot).text(""),t.helper.entry.update(e.bookmarks[0].children,function(){i(),a.updateSortFilter(),t.helper.search.init(),t.helper.model.getData("u/viewAsTree")||"custom"===o.name?a.addBookmarkDir(e.bookmarks[0].children,s,!0):a.addBookmarkDir(t.helper.entry.getAllBookmarkData(),s,!1),1===s.children("li").length()?(s.addClass(t.opts.classes.sidebar.hideRoot),a.toggleBookmarkDir(s.find("> li > a."+t.opts.classes.sidebar.bookmarkDir).eq(0))):a.restoreOpenStates(s)})}})},this.toggleBookmarkDir=function(s,o,n){s.addClass(t.opts.classes.sidebar.dirAnimated);var l=s.attr(t.opts.attr.id),i=s.next("ul");void 0===o&&(o=!0===t.firstRun||!1===t.elements.iframe.hasClass(t.opts.classes.page.visible)),s.hasClass(t.opts.classes.sidebar.dirOpened)?r(s,i,!1,o,n):(t.helper.model.getData("b/dirAccordion")&&t.elements.bookmarkBox.all.find("a."+t.opts.classes.sidebar.dirOpened).forEach(function(s){0===e(s).next("ul").find("a["+t.opts.attr.id+"='"+l+"']").length()&&a.toggleBookmarkDir(e(s),o)}),0===i.length()?t.helper.model.call("bookmarks",{id:l},function(t){t.bookmarks&&t.bookmarks[0]&&t.bookmarks[0].children&&t.bookmarks[0].children.length>0&&(i=e("<ul />").insertAfter(s),a.addBookmarkDir(t.bookmarks[0].children,i),r(s,i,!0,o,n))}):r(s,i,!0,o,n))},this.restoreOpenStates=function(e){var o=0,n=t.helper.model.getData(["b/rememberState","u/openStates"]);"all"!==n.rememberState&&"openStates"!==n.rememberState||(s++,Object.keys(n.openStates).forEach(function(s){if(!0===n.openStates[s]){var r=+s.replace(/^node_/,""),l=e.find("> li > a."+t.opts.classes.sidebar.bookmarkDir+"["+t.opts.attr.id+"='"+r+"']");l.length()>0&&(o++,a.toggleBookmarkDir(l))}}),s--),0===o&&0===s&&setTimeout(function(){t.firstRun=!1,t.helper.scroll.restoreScrollPos(t.elements.bookmarkBox.all,function(){t.initImages(),t.endLoading(200),t.loaded()})},100)},this.updateSortFilter=function(){t.elements.filterBox.removeClass(t.opts.classes.sidebar.hidden).text("");var a=0;if("custom"===o.name)t.elements.filterBox.addClass(t.opts.classes.sidebar.hidden);else{var s=t.helper.model.getData(["u/viewAsTree","u/mostViewedPerMonth"]),n=o.name.replace(/([A-Z])/g,"_$1").toLowerCase();e("<a />").attr(t.opts.attr.direction,o.dir).text(t.helper.i18n.get("sort_label_"+n)).appendTo(t.elements.filterBox);var r=e("<ul />").appendTo(t.elements.filterBox);if(!t.elements.bookmarkBox.search.hasClass(t.opts.classes.sidebar.active)){var l;e("<li />").append(t.helper.checkbox.get(t.elements.iframeBody,(l={},_defineProperty(l,t.opts.attr.name,"viewAsTree"),_defineProperty(l,"checked",s.viewAsTree?"checked":""),l))).append("<a>"+t.helper.i18n.get("sort_view_as_tree")+"</a>").appendTo(r)}if("mostUsed"===o.name){var i;e("<li />").append(t.helper.checkbox.get(t.elements.iframeBody,(i={},_defineProperty(i,t.opts.attr.name,"mostViewedPerMonth"),_defineProperty(i,"checked",s.mostViewedPerMonth?"checked":""),i))).append("<a>"+t.helper.i18n.get("sort_most_used_per_month")+"</a>").appendTo(r)}0===r.children("li").length()&&r.remove(),a=t.elements.filterBox.realHeight()}Object.values(t.elements.bookmarkBox).forEach(function(e){e.css("padding-top",a)})},this.addBookmarkDir=function(a,s){var o=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],r=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],l=!1,i=t.helper.model.getData(["a/showBookmarkIcons","b/dirOpenDuration"]),d=t.elements.iframe.hasClass(t.opts.classes.page.visible),c=t.elements.sidebar.hasClass(t.opts.classes.sidebar.showHidden);s.parents("li").length()>0&&s.css("transition","height "+i.dirOpenDuration+"s");var p=0;return s.removeData("remainingEntries"),r&&n(a),a.some(function(n,r){if((c||t.helper.entry.isVisible(n.id))&&(n.children||n.url)){t.opts.demoMode&&(n.children?n.title="Directory "+(r+1):(n.title="Bookmark "+(r+1),n.url="https://example.com/"));var u=e("<li />").appendTo(s),h=e("<a />").html("<span class='"+t.opts.classes.sidebar.bookmarkLabel+"'>"+n.title+"</span><span class='"+t.opts.classes.drag.trigger+"' />").attr(t.opts.attr.id,n.id).appendTo(u);if(!1===t.helper.entry.isVisible(n.id)&&u.addClass(t.opts.classes.sidebar.hidden),t.helper.entry.addData(n.id,"element",h),n.children&&o?(h.attr("title",n.title+"\n-------------\n"+n.children.length+" "+t.helper.i18n.get("sidebar_dir_children")).addClass(t.opts.classes.sidebar.bookmarkDir),i.showBookmarkIcons&&h.prepend("<span class='"+t.opts.classes.sidebar.dirIcon+"' />")):n.url&&(h.attr("title",n.title+"\n-------------\n"+n.url).addClass(t.opts.classes.sidebar.bookmarkLink),i.showBookmarkIcons&&(t.opts.demoMode?h.prepend("<span class='"+t.opts.classes.sidebar.dirIcon+"' data-color='"+(Math.floor(10*Math.random())+1)+"' />"):t.helper.model.call("favicon",{url:n.url},function(e){e.img&&(t.helper.entry.addData(n.id,"icon",e.img),h.prepend("<img "+(d?"src":t.opts.attr.src)+"='"+e.img+"' />"))})),p++),l=!0,!1===o&&p>=100){var m=a.slice(100);return m.length>0&&s.data("remainingEntries",m),!0}}}),l};var n=function(e){if(e.length>1){var a=t.helper.i18n.getLocaleSortCollator(),s=function(t,a){e.sort(function(e,s){return!!e.children!=!!s.children?e.children?-1:1:(t===o.dir?1:-1)*a(e,s)})};switch(o.name){case"alphabetical":s("ASC",function(e,t){return a.compare(e.title,t.title)});break;case"recentlyAdded":s("DESC",function(e,t){return t.dateAdded-e.dateAdded});break;case"mostUsed":var n=t.helper.model.getData("u/mostViewedPerMonth");s("DESC",function(e,s){var o=t.helper.entry.getData(e.id),r=t.helper.entry.getData(s.id),l=o?o.views[n?"perMonth":"total"]:0,i=r?r.views[n?"perMonth":"total"]:0;return l===i?a.compare(e.title,s.title):i-l});break;case"recentlyUsed":s("DESC",function(e,s){var o=t.helper.entry.getData(e.id),n=t.helper.entry.getData(s.id),r=o?o.views.lastView:0,l=n?n.views.lastView:0;return r===l?a.compare(e.title,s.title):l-r})}}},r=function(e,s,o,n,r){if(s.css("height",s[0].scrollHeight+"px"),!1===o&&setTimeout(function(){s.css("height",0)},0),!0===t.firstRun)a.restoreOpenStates(s);else{var i=t.helper.model.getData("u/openStates");i[e.attr(t.opts.attr.id)]=o,delete i["node_"+e.attr(t.opts.attr.id)],!1===o?l(e,i):t.helper.model.setData({"u/openStates":i})}var d=t.helper.model.getData("b/dirOpenDuration");setTimeout(function(){!1===o?e.removeClass(t.opts.classes.sidebar.dirOpened):(e.addClass(t.opts.classes.sidebar.dirOpened),t.helper.model.getData("b/dirAccordion")&&t.helper.scroll.setScrollPos(t.elements.bookmarkBox.all,e[0].offsetTop,300)),s.css("height",""),e.removeClass(t.opts.classes.sidebar.dirAnimated),"function"==typeof r&&r()},n?0:1e3*+d)},l=function(a,s){a.next("ul").find("a."+t.opts.classes.sidebar.bookmarkDir).forEach(function(a){s[e(a).attr(t.opts.attr.id)]=!1,setTimeout(function(){e(a).removeClass(t.opts.classes.sidebar.dirOpened)},500)}),t.helper.model.setData({"u/openStates":s})},i=function(){t.elements.header.text("");var a=t.helper.entry.getAllBookmarkData().length,s=e("<h1 />").html("<strong>"+a+"</strong> <span>"+t.helper.i18n.get("header_bookmarks"+(1===a?"_single":""))+"</span>").attr("title",a+" "+t.helper.i18n.get("header_bookmarks"+(1===a?"_single":""))).appendTo(t.elements.header),o=[];o.push(e("<a />").addClass(t.opts.classes.sidebar.menu).appendTo(t.elements.header)),o.push(e("<a />").addClass(t.opts.classes.sidebar.sort).appendTo(t.elements.header)),o.push(e("<a />").addClass(t.opts.classes.sidebar.search).appendTo(t.elements.header));var n=window.getComputedStyle(t.elements.header[0]),r=parseInt(n.getPropertyValue("padding-top"));o.some(function(e){if(e[0].offsetTop>r)return s.children("span").addClass(t.opts.classes.sidebar.hidden),!0}),e("<div />").addClass(t.opts.classes.sidebar.searchBox).append("<input type='text' placeholder='"+t.helper.i18n.get("sidebar_search_placeholder")+"' />").append("<a class='"+t.opts.classes.sidebar.searchClose+"'></a>").appendTo(t.elements.header)}},window.ModelHelper=function(e){var t=this,a={u:{openStates:{},hiddenEntries:{},scrollPos:{},entriesLocked:!1,sort:{name:"custom",dir:"ASC"},mostViewedPerMonth:!1,viewAsTree:!0},b:{pxTolerance:{windowed:20,maximized:1},openAction:"mousedown",newTab:"foreground",linkAction:"current",preventPageScroll:!1,dirAccordion:!1,rememberState:"all",rememberSearch:!0,dirOpenDuration:.5,openDelay:0,closeTimeout:1,initialOpenOnNewTab:!0},a:{sidebarPosition:"left",language:"default",showIndicator:!0,showIndicatorIcon:!0,showBookmarkIcons:!0,styles:{colorScheme:"rgb(27,130,241)",textColor:"rgb(102,102,102)",indicatorWidth:"40px",indicatorIconSize:"32px",indicatorIconColor:"rgb(255,255,255)",indicatorColor:"rgba(0,0,0,0.5)",sidebarWidth:"350px",sidebarMaskColor:"rgba(255,255,255,0.8)",bookmarksFontSize:"14px",bookmarksIconSize:"16px",bookmarksLineHeight:"40px",bookmarksDirIcon:"dir-1",bookmarksDirColor:"rgb(102,102,102)",bookmarksDirIndentation:"25px",bookmarksHorizontalPadding:"16px",overlayMaskColor:"rgba(0,0,0,0.5)",fontFamily:"default"}}},s={};this.init=function(e){var t=["utility","behaviour","appearance"];chrome.storage.sync.get(t,function(a){s=a,t.forEach(function(e){void 0===s[e]&&(s[e]={})}),"function"==typeof e&&e()})},this.getData=function(t){var o=t;"string"==typeof o&&(o=[o]);var n={};if(o.forEach(function(t){var o=t.split("/")[0],r=t.split("/")[1],l=null,i=null;switch(o){case"u":i=s.utility;break;case"b":i=s.behaviour;break;case"a":i=s.appearance}if(null!==i&&(void 0===i[r]?"rememberState"===r&&void 0!==i.rememberScroll?l=!1===i.rememberScroll?"openStates":"all":void 0!==a[o]&&void 0!==a[o][r]&&(l=a[o][r]):l=i[r]),"a/styles"===t&&(l=Object.assign({},a.a.styles,l),e.helper.font&&e.helper.font.isLoaded())){var d=e.helper.font.getFontInfo();l.fontFamily=d.name,Object.assign(l,d.fontWeights)}"a/showIndicator"===t&&!0===l&&void 0!==s.behaviour.openAction&&"mousemove"===s.behaviour.openAction&&(l=!1),n[r]=l}),"string"==typeof t){var r=t.split("/")[1];n=n[r]}return n},this.setData=function(e,a){t.init(function(){Object.keys(e).forEach(function(t){var a=t.split("/")[0],o=t.split("/")[1],n=e[t];switch(a){case"u":s.utility[o]=n,s.utility;break;case"b":s.behaviour[o]=n;break;case"a":s.appearance[o]=n}});try{chrome.storage.sync.set(s,function(){"function"==typeof a&&a()})}catch(e){"function"==typeof a&&a()}})},this.call=function(e,t,a){"function"==typeof t&&(a=t,t={}),t.type=e,chrome.extension.sendMessage(t,function(e){"function"==typeof a&&a(e)})}},window.OverlayHelper=function(t){var a={};this.create=function(s,o,p){switch(a.overlay=e("<iframe />").attr("id",t.opts.ids.page.overlay).appendTo("body"),t.helper.stylesheet.addStylesheets(["overlay"],a.overlay),a.modal=e("<div />").attr(t.opts.attr.type,s).addClass(t.opts.classes.overlay.modal).appendTo(a.overlay.find("body")),a.modal.append("<h1>"+o+"</h1>"),e("<a />").addClass(t.opts.classes.overlay.close).appendTo(a.modal),a.buttonWrapper=e("<menu />").addClass(t.opts.classes.overlay.buttonWrapper).appendTo(a.modal),e("<a />").addClass(t.opts.classes.overlay.close).text(t.helper.i18n.get("overlay_"+("infos"===s?"close":"cancel"))).appendTo(a.buttonWrapper),s){case"delete":n(p);break;case"edit":r(p);break;case"infos":c(p);break;case"add":d(p);break;case"hide":i(p);break;case"openChildren":l(p);break;case"updateUrls":u(p)}y(p),setTimeout(function(){a.modal.addClass(t.opts.classes.overlay.visible),a.overlay.addClass(t.opts.classes.page.visible)},100)};var s=function(){t.helper.model.call("realUrl",{abort:!0}),t.elements.bookmarkBox.all.find("li."+t.opts.classes.drag.isDragged).remove(),a.overlay.removeClass(t.opts.classes.page.visible),setTimeout(function(){a.overlay.remove()},500)},o=function(s,o){var n=e("<"+(s.isDir?"span":"a")+" />").attr("title",s.title+(s.url?"\n"+s.url:"")).addClass(t.opts.classes.overlay.preview).html(s.title).appendTo(a.modal);s.isDir?n.prepend("<span class='"+t.opts.classes.sidebar.dirIcon+"' />"):s.icon?n.prepend("<img src='"+s.icon+"' />"):t.opts.demoMode&&n.prepend("<span class='"+t.opts.classes.sidebar.dirIcon+"' data-color='"+(Math.floor(10*Math.random())+1)+"' />"),o&&!0===o&&!0!==s.isDir&&e("<a />").addClass(t.opts.classes.overlay.previewUrl).attr("title",s.url).text(s.url).insertAfter(n)},n=function(s){e("<p />").text(t.helper.i18n.get("overlay_delete_"+(s.isDir?"dir":"bookmark")+"_confirm")).appendTo(a.modal),o(s),e("<a />").addClass(t.opts.classes.overlay.action).text(t.helper.i18n.get("overlay_delete")).appendTo(a.buttonWrapper)},r=function(s){o(s);var n=e("<ul />").appendTo(a.modal);n.append("<li><label>"+t.helper.i18n.get("overlay_bookmark_title")+"</label><input type='text' name='title' value='"+s.title+"' /></li>"),s.isDir||n.append("<li><label>"+t.helper.i18n.get("overlay_bookmark_url")+"</label><input type='text' name='url' value='"+s.url+"' /></li>"),e("<a />").addClass(t.opts.classes.overlay.action).text(t.helper.i18n.get("overlay_save")).appendTo(a.buttonWrapper)},l=function(s){var n=s.children.filter(function(e){return!!e.url}),r=t.helper.i18n.get("overlay_confirm_open_children",[n.length]);e("<p />").text(r).appendTo(a.modal),o(s),e("<a />").addClass(t.opts.classes.overlay.action).text(t.helper.i18n.get("overlay_open_children")).appendTo(a.buttonWrapper)},i=function(s){e("<p />").text(t.helper.i18n.get("overlay_hide_"+(s.isDir?"dir":"bookmark")+"_confirm")).appendTo(a.modal),o(s),e("<a />").addClass(t.opts.classes.overlay.action).text(t.helper.i18n.get("overlay_hide_from_sidebar")).appendTo(a.buttonWrapper)},d=function(s){var o=e("<a />").addClass(t.opts.classes.overlay.action).text(t.helper.i18n.get("overlay_save")).appendTo(a.buttonWrapper),n=e("<menu />").appendTo(a.modal),r=e("<a />").attr(t.opts.attr.type,"bookmark").attr("title",t.helper.i18n.get("overlay_label_bookmark")).appendTo(n);e("<a />").attr(t.opts.attr.type,"dir").attr("title",t.helper.i18n.get("overlay_label_dir")).appendTo(n),n.children("a").on("click",function(r){r.preventDefault();var l=e(r.currentTarget).attr(t.opts.attr.type),i=e("<ul />").appendTo(a.modal),d=s&&s.values&&s.values.title?s.values.title:"",c=s&&s.values&&s.values.url?s.values.url:"";i.append("<li><h2>"+e(r.currentTarget).attr("title")+"</h2></li>"),i.append("<li><label>"+t.helper.i18n.get("overlay_bookmark_title")+"</label><input type='text' name='title' value='"+d+"' /></li>"),"bookmark"===l&&i.append("<li><label>"+t.helper.i18n.get("overlay_bookmark_url")+"</label><input type='text' name='url' value='"+c+"'  /></li>"),n.addClass(t.opts.classes.sidebar.hidden),setTimeout(function(){i.addClass(t.opts.classes.overlay.visible),o.addClass(t.opts.classes.overlay.visible)},s&&s.values?0:100)}),s&&s.values&&r.trigger("click")},c=function(s){o(s,!0);var n=e("<ul />").appendTo(a.modal),r=new Date(s.dateAdded);if(e("<li />").html(t.helper.i18n.get("overlay_bookmark_created_date")+" "+t.helper.i18n.getLocaleDate(r)).appendTo(n),s.isDir){var l=e("<li />").addClass(t.opts.classes.overlay.hasTooltip).append("<span>"+s.childrenAmount.total+"</span>").append(" "+t.helper.i18n.get("overlay_dir_children"),!1).appendTo(n);e("<ul />").append("<li>"+s.childrenAmount.bookmarks+" "+t.helper.i18n.get("overlay_dir_children_bookmarks")+"</li>").append("<li>"+s.childrenAmount.directories+" "+t.helper.i18n.get("overlay_dir_children_dirs")+"</li>").appendTo(l)}var i=e("<li />").addClass(t.opts.classes.overlay.hasTooltip).append("<span>"+s.views.total+"</span>").append(" "+t.helper.i18n.get("overlay_bookmark_views"+(1===s.views.total?"_single":"")),!1).appendTo(n);e("<ul />").append("<li>"+t.helper.i18n.get("overlay_bookmark_views_since")+" "+t.helper.i18n.getLocaleDate(s.views.startDate)+"</li>").append("<li>"+s.views.perMonth+" "+t.helper.i18n.get("overlay_bookmark_views"+(1===s.views.perMonth?"_single":""))+" "+t.helper.i18n.get("overlay_bookmark_views_per_month")+"</li>").appendTo(i)},p=function(s){var o=s.length>0;setTimeout(function(){a.desc.remove(),a.progressBar.remove(),a.progressLabel.remove(),o&&a.modal.addClass(t.opts.classes.overlay.urlCheckList),setTimeout(function(){if(a.loader.remove(),a.modal.removeClass(t.opts.classes.overlay.urlCheckLoading),a.buttonWrapper.children("a."+t.opts.classes.overlay.close).text(t.helper.i18n.get("overlay_close")),0===s.length)e("<p />").addClass(t.opts.classes.overlay.success).text(t.helper.i18n.get("overlay_check_urls_no_results")).appendTo(a.modal);else{e("<a />").addClass(t.opts.classes.overlay.action).text(t.helper.i18n.get("overlay_update")).appendTo(a.buttonWrapper);var o=t.helper.scroll.add(t.opts.ids.overlay.urlList,e("<ul />").appendTo(a.modal)),n=a.overlay.find("body");s.forEach(function(a){var s=e("<li />").data("entry",a).append(t.helper.checkbox.get(n,{checked:"checked"})).append("<strong>"+a.title+"</strong>");e("<a />").attr({href:a.url,title:a.url,target:"_blank"}).html("<span>"+a.url+"</span>").appendTo(s),404===a.urlStatusCode?e("<span />").text(t.helper.i18n.get("overlay_check_urls_not_found")).appendTo(s):a.newUrl!==a.url&&e("<a />").attr({href:a.newUrl,title:a.newUrl,target:"_blank"}).html("<span>"+a.newUrl+"</span>").appendTo(s),s=s.appendTo(o.children("ul")),t.helper.model.call("favicon",{url:a.url},function(a){a.img&&e("<img src='"+a.img+"' />").insertAfter(s.children("div."+t.opts.classes.checkbox.box))})})}},o?1e3:0)},1e3)},u=function(s){var o=[];!function e(t){t.forEach(function(t){t.url?o.push(t):t.children&&e(t.children)})}(s.children);var n=o.length;a.desc=e("<p />").text(t.helper.i18n.get("overlay_check_urls_loading")).appendTo(a.modal),a.progressBar=e("<div />").addClass(t.opts.classes.overlay.progressBar).html("<div />").appendTo(a.modal),a.progressLabel=e("<span />").addClass(t.opts.classes.overlay.checkUrlProgressLabel).html("<span>0</span>/<span>"+n+"</span>").appendTo(a.modal),a.loader=t.helper.template.loading().appendTo(a.modal),setTimeout(function(){a.modal.addClass(t.opts.classes.overlay.urlCheckLoading)},500);var r=0,l=[];o.forEach(function(e){t.helper.model.call("realUrl",{url:e.url},function(t){r++,a.progressBar.children("div").css("width",r/n*100+"%"),a.progressLabel.children("span").eq(0).text(r),(404==+t.code||e.url!==t.url&&302!=+t.code)&&(e.newUrl=t.url,e.urlStatusCode=+t.code,l.push(e)),r===n&&p(l)})})},h=function(e){s(),e.children.filter(function(e){return!!e.url}).forEach(function(e){t.helper.sidebarEvents.openUrl(e,"newTab","foreground"===t.helper.model.getData("b/newTab"))})},m=function(e){t.startLoading(),s();var a=t.helper.model.getData("u/hiddenEntries");a[e.id]=!0,t.helper.model.setData({"u/hiddenEntries":a},function(){t.helper.model.call("refreshAllTabs",{type:"Hide"})})},f=function(e){s(),t.helper.model.call("deleteBookmark",{id:e.id},function(){e.element.parent("li").remove()})},v=function(e){var s=a.modal.find("input[name='title']").removeClass(t.opts.classes.overlay.inputError),o=a.modal.find("input[name='url']").removeClass(t.opts.classes.overlay.inputError),n={errors:!1,values:{title:s[0].value.trim(),url:e?null:o[0].value.trim()}};return 0===n.values.title.length&&(s.addClass(t.opts.classes.overlay.inputError),n.errors=!0),e||0!==n.values.url.length||(o.addClass(t.opts.classes.overlay.inputError),n.errors=!0),null!==n.values.url&&0!==n.values.url.search(/^\w+\:\/\//)&&(n.values.url="http://"+n.values.url),n},g=function(e){var o=v(e.isDir);!1===o.errors&&t.helper.model.call("updateBookmark",{id:e.id,title:o.values.title,url:o.values.url},function(n){n.error?a.modal.find("input[name='url']").addClass(t.opts.classes.overlay.inputError):(s(),e.title=o.values.title,e.url=o.values.url,e.element.children("span."+t.opts.classes.sidebar.bookmarkLabel).text(e.title))})},b=function(e){var o=v(0===a.modal.find("input[name='url']").length());if(!1===o.errors){var n={title:o.values.title,url:o.values.url,parentId:e.id||null,index:0};e&&e.values&&(e.values.index&&(n.index=e.values.index),e.values.parentId&&(n.parentId=e.values.parentId)),t.helper.model.call("createBookmark",n,function(e){e.error?a.modal.find("input[name='url']").addClass(t.opts.classes.overlay.inputError):s()})}},k=function(){a.modal.find("div#"+t.opts.ids.overlay.urlList+" ul > li").forEach(function(a){if(e(a).find("input[type='checkbox']")[0].checked){var s=e(a).data("entry");404===s.urlStatusCode?t.helper.model.call("deleteBookmark",{id:s.id}):s.url!==s.newUrl&&t.helper.model.call("updateBookmark",{id:s.id,title:s.title,url:s.newUrl})}}),s()},y=function(o){a.overlay.find("body").on("click",function(e){"BODY"===e.target.tagName&&s()}),a.modal.find("a."+t.opts.classes.overlay.close).on("click",function(e){e.preventDefault(),s()}),a.modal.on("click","a."+t.opts.classes.overlay.action,function(e){switch(e.preventDefault(),a.modal.attr(t.opts.attr.type)){case"delete":f(o);break;case"hide":m(o);break;case"openChildren":h(o);break;case"edit":g(o);break;case"add":b(o);break;case"updateUrls":k()}}),a.modal.on("focus","input",function(a){e(a.currentTarget).removeClass(t.opts.classes.overlay.inputError)}),a.modal.find("a."+t.opts.classes.overlay.preview+", a."+t.opts.classes.overlay.previewUrl).on("click",function(e){e.preventDefault(),t.helper.sidebarEvents.openUrl(o,"newTab")})}},window.ScrollHelper=function(t){var a=this,s=+new Date,o={},n=[];this.add=function(a,s){var o=e("<div id='"+a+"' class='"+t.opts.classes.scrollBox.wrapper+"' />").insertBefore(s);return s=s.appendTo(o),o.data({list:s}),n.push(o),d(o),o},this.updateAll=function(){n.forEach(function(e){e.hasClass(t.opts.classes.sidebar.active)&&a.update(e)})},this.restoreScrollPos=function(e,s){var o=t.helper.model.getData(["b/rememberState","u/scrollPos"]);"all"===o.rememberState?(a.setScrollPos(e,o.scrollPos[e.attr("id")]||0),setTimeout(function(){"function"==typeof s&&s()},100)):"function"==typeof s&&s()},this.setAllScrollPos=function(e){var s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;n.forEach(function(o){o.hasClass(t.opts.classes.sidebar.active)&&a.setScrollPos(o,e,s)})},this.setScrollPos=function(e,t){var s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;if(0===s)e[0].scrollTop=t,a.update(e);else{var o=e[0].scrollTop,n=0;!function r(){var l=(n+=1/60)/(s/1e3),i=Math.sin(l*(Math.PI/2));l<1?(window.requestAnimationFrame(r),e[0].scrollTop=o+(t-o)*i):(e[0].scrollTop=t,a.update(e))}()}};var r=function(t){var a=0;return t.children().forEach(function(t){a+=e(t).realHeight(!0)}),a},l=function(e){if(!1===t.firstRun&&+new Date-s>500){s=+new Date;var a=t.helper.model.getData("u/scrollPos");a[e.attr("id")]=e[0].scrollTop,t.helper.model.setData({"u/scrollPos":a})}};this.update=function(e){t.helper.contextmenu.close(),l(e);var a=i(e),s=r(e),n=e[0].scrollTop;n>10?e.addClass(t.opts.classes.scrollBox.scrolled):e.removeClass(t.opts.classes.scrollBox.scrolled);var d=e.data("lastPos")||0;n>d?e.attr(t.opts.attr.direction,"down"):n<d?e.attr(t.opts.attr.direction,"up"):e.removeAttr(t.opts.attr.direction),e.data("lastPos",n),(s-n<2*a||s===n&&0===a)&&e.trigger(t.opts.events.scrollBoxLastPart),t.elements.iframe.hasClass(t.opts.classes.page.visible)?(e.removeClass(t.opts.classes.scrollBox.hideScrollbar),clearTimeout(o[e.attr("id")]),o[e.attr("id")]=setTimeout(function(){e.addClass(t.opts.classes.scrollBox.hideScrollbar)},1500)):e.addClass(t.opts.classes.scrollBox.hideScrollbar)};var i=function(e){return e.realHeight()-parseInt(e.css("padding-top"))},d=function(e){e.on("scroll",function(){a.update(e)})}},window.SearchHelper=function(t){var a=this;this.init=function(){var e=t.helper.model.getData(["b/rememberSearch","u/searchValue"]);e.rememberSearch&&e.searchValue&&e.searchValue.length>0&&(t.elements.header.addClass(t.opts.classes.sidebar.searchVisible),s(e.searchValue)),r()},this.clearSearch=function(){t.helper.contextmenu.close(),t.elements.header.removeClass(t.opts.classes.sidebar.searchVisible),s("")};var s=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,a=t.elements.header.find("div."+t.opts.classes.sidebar.searchBox+" > input[type='text']");null===e?e=a[0].value:a[0].value=e,e&&e.length>0?o(a,e):n(a)},o=function(a,s){t.elements.bookmarkBox.all.removeClass(t.opts.classes.sidebar.active),t.elements.bookmarkBox.search.addClass(t.opts.classes.sidebar.active),t.helper.list.updateSortFilter(),s!==a.data("lastVal")&&(t.startLoading(),a.data("lastVal",s),t.helper.model.setData({"u/searchValue":s},function(){t.helper.scroll.setScrollPos(t.elements.bookmarkBox.search,0),t.helper.model.call("searchBookmarks",{searchVal:s},function(a){t.elements.bookmarkBox.search.children("p").remove();var s=!1,o=t.elements.bookmarkBox.search.children("ul");o.text(""),a.bookmarks&&a.bookmarks.length>0&&(s=t.helper.list.addBookmarkDir(a.bookmarks,o,!1)),!1===s&&e("<p />").text(t.helper.i18n.get("sidebar_search_no_results")).appendTo(t.elements.bookmarkBox.search),t.endLoading()})}))},n=function(e){e.removeData("lastVal"),t.helper.model.setData({"u/searchValue":null},function(){t.elements.bookmarkBox.search.hasClass(t.opts.classes.sidebar.active)&&(t.startLoading(),t.elements.bookmarkBox.all.addClass(t.opts.classes.sidebar.active),t.elements.bookmarkBox.search.removeClass(t.opts.classes.sidebar.active),t.helper.scroll.restoreScrollPos(t.elements.bookmarkBox.all),t.endLoading()),t.helper.list.updateSortFilter()})},r=function(){t.elements.header.on("click","a."+t.opts.classes.sidebar.search,function(e){e.preventDefault(),e.stopPropagation(),t.helper.contextmenu.close(),t.elements.header.addClass(t.opts.classes.sidebar.searchVisible),t.elements.header.find("div."+t.opts.classes.sidebar.searchBox+" > input[type='text']")[0].focus()}),t.elements.header.on("keyup","div."+t.opts.classes.sidebar.searchBox+" > input[type='text']",function(e){e.preventDefault(),s()}),t.elements.header.on("click","a."+t.opts.classes.sidebar.searchClose,function(e){e.preventDefault(),e.stopPropagation(),a.clearSearch()})}},window.SidebarEventsHelper=function(t){var a=this;this.init=function(){o(),s(),n()},this.openUrl=function(e){var a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"default",s=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];"incognito"===a?t.helper.model.call("openLink",{href:e.url,incognito:!0}):t.helper.model.call("openLink",{parentId:e.parentId,id:e.id,href:e.url,newTab:"newTab"===a,active:s})};var s=function(){e([document,t.elements.iframe[0].contentDocument]).on("keydown",function(a){t.elements.iframe.hasClass(t.opts.classes.page.visible)&&("Home"===a.key?(a.preventDefault(),t.helper.scroll.setAllScrollPos(0,500)):"c"===a.key&&(a.ctrlKey||a.metaKey)&&(a.preventDefault(),Object.values(t.elements.bookmarkBox).forEach(function(a){if(a.hasClass(t.opts.classes.sidebar.active)){var s=a.find("> ul a."+t.opts.classes.sidebar.hover).eq(0);if(s.length()>0){var o=t.helper.entry.getData(s.attr(t.opts.attr.id));if(o&&o.url&&t.copyToClipboard(o.url)){e(s).children("span."+t.opts.classes.sidebar.copied).remove();var n=e("<span />").addClass(t.opts.classes.sidebar.copied).text(t.helper.i18n.get("sidebar_copied_to_clipboard")).appendTo(s);setTimeout(function(){e(s).addClass(t.opts.classes.sidebar.copied),setTimeout(function(){e(s).removeClass(t.opts.classes.sidebar.copied),setTimeout(function(){n.remove()},500)},1500)},100)}}}})))})},o=function(){Object.values(t.elements.bookmarkBox).forEach(function(s){s.children("ul").on("click mousedown","a",function(s){if(s.preventDefault(),!e(s.target).hasClass(t.opts.classes.drag.trigger)&&(1===s.which&&"click"===s.type||2===s.which&&"mousedown"===s.type||t.firstRun)){var o=e(s.currentTarget),n=t.helper.entry.getData(o.attr(t.opts.attr.id));if(n.isDir&&!o.hasClass(t.opts.classes.sidebar.dirAnimated))t.helper.list.toggleBookmarkDir(o);else if(!n.isDir){var r=t.helper.model.getData(["b/newTab","b/linkAction"]),l=2===s.which||"newtab"===r.linkAction;a.openUrl(n,l?"newTab":"default",!l||"foreground"===r.newTab)}}}).on("mouseover","a",function(a){s.find("> ul a."+t.opts.classes.sidebar.hover).removeClass(t.opts.classes.sidebar.hover),e(a.currentTarget).addClass(t.opts.classes.sidebar.hover).removeClass(t.opts.classes.sidebar.mark)}).on("contextmenu","a",function(a){a.preventDefault(),t.helper.contextmenu.create("list",e(a.currentTarget))}),s.children("ul").on("mouseleave",function(a){e(a.currentTarget).find("a."+t.opts.classes.sidebar.hover).removeClass(t.opts.classes.sidebar.hover)}),s.children("div."+t.opts.classes.sidebar.filterBox).on("click","a["+t.opts.attr.direction+"]",function(a){a.preventDefault();var s="ASC"===e(a.target).attr(t.opts.attr.direction)?"DESC":"ASC";t.helper.list.updateDirection(s)}).on("click","div."+t.opts.classes.checkbox.box+" + a",function(a){a.preventDefault(),e(a.target).prev("div["+t.opts.attr.name+"]").trigger("click")})})},n=function(){e(window).on("beforeunload",function(){t.elements.sidebar.hasClass(t.opts.classes.sidebar.openedOnce)&&t.helper.scroll.updateAll()}),t.elements.iframe.find("body").on("click",function(){t.helper.contextmenu.close()}),chrome.extension.onMessage.addListener(function(e){if(e&&e.action&&"refresh"===e.action){var a=0;e.scrollTop&&(t.helper.scroll.setScrollPos(t.elements.bookmarkBox.all,0),a=100),setTimeout(function(){t.refresh()},a)}}),["menu","sort"].forEach(function(a){t.elements.header.on("click contextmenu","a."+t.opts.classes.sidebar[a],function(s){s.preventDefault(),s.stopPropagation(),t.helper.contextmenu.create(a,e(s.currentTarget))})}),t.elements.iframeBody.on("click","#"+t.opts.ids.sidebar.shareUserdata+" a",function(a){a.preventDefault(),t.helper.model.call("shareUserdata",{share:e(a.currentTarget).data("accept")}),t.elements.iframeBody.find("div#"+t.opts.ids.sidebar.shareUserdata).addClass(t.opts.classes.sidebar.hidden)}),e(t.elements.iframe[0].contentDocument).on(t.opts.events.checkboxChanged,function(e){var a=e.detail.checkbox.attr(t.opts.attr.name);"viewAsTree"!==a&&"mostViewedPerMonth"!==a||t.helper.model.setData(_defineProperty({},"u/"+a,e.detail.checked),function(){t.startLoading(),t.helper.model.call("refreshAllTabs",{scrollTop:!0,type:"Sort"})})})}},window.StylesheetHelper=function(t){var a={};this.init=function(){a=t.helper.model.getData("a/styles")},this.addStylesheets=function(s){var o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;null===o?o=e(document):t.helper.font.addStylesheet(o);var n=null;n=0===o.find("head").length()?o.find("body"):o.find("head"),s.forEach(function(e){var t=new XMLHttpRequest;t.open("GET",chrome.extension.getURL("css/"+e+".css"),!0),t.onload=function(){if(t.response){var e=t.response;Object.keys(a).forEach(function(t){e=e.replace(new RegExp('"?%'+t+'"?',"g"),a[t])}),n.append("<style>"+e+"</style>")}},t.send()})}},window.TemplateHelper=function(t){this.loading=function(){return e('<svg class="loading" width="36px" height="36px" viewBox="0 0 36 36" xmlns="http://www.w3.org/2000/svg"><circle fill="none" stroke-width="3" stroke-linecap="round" cx="18" cy="18" r="16"></circle></svg>')},this.footer=function(){var t=e('<footer> <a id="copyright" href="https://blockbyte.de/extensions" target="_blank">  &copy; <span class="created">2016</span>&ensp;<strong>Blockbyte</strong> </a></footer>'),a=+t.find("span.created").text(),s=(new Date).getFullYear();return s>a&&t.find("span.created").text(a+" - "+s),t}},window.ToggleHelper=function(t){var a=null,s=null,o=null,n=0,r=null,l=null,i={};this.init=function(){t.elements.toggle=e("<div />").attr("id",t.opts.ids.page.indicator).appendTo("body");var l=t.helper.model.getData(["b/pxTolerance","b/preventPageScroll","a/showIndicator","a/showIndicatorIcon","a/styles","a/sidebarPosition","b/openDelay","b/openAction","b/initialOpenOnNewTab"]);s=l.pxTolerance,n=1e3*+l.openDelay,a=l.sidebarPosition,o=l.preventPageScroll,t.elements.toggle.css("width",d()+"px"),t.elements.iframe.attr(t.opts.attr.position,a),t.elements.sidebar.attr(t.opts.attr.position,a),l.styles&&l.styles.indicatorWidth&&(r=parseInt(l.styles.indicatorWidth)),l.showIndicator&&"icon"!==l.openAction&&(t.elements.toggle.addClass(t.opts.classes.page.visible).attr(t.opts.attr.position,a),l.showIndicatorIcon&&t.elements.toggle.addClass(t.opts.classes.page.indicatorIcon)),f(),c(),t.isNewTab&&(t.elements.toggle.addClass(t.opts.classes.page.isNewTab),t.elements.iframe.addClass(t.opts.classes.page.isNewTab),l.initialOpenOnNewTab&&m())};var d=function(){return s[t.isWindowed()?"windowed":"maximized"]},c=function(){e(window).on("resize",function(){t.elements.toggle.css("width",d()+"px")}),t.elements.iframe.find("body").on("click",function(e){if(e.pageX){var s=e.pageX;"right"===a&&(s=t.isNewTab?t.elements.iframe.realWidth()-s:window.innerWidth-s+t.elements.sidebar.realWidth()-1),s>t.elements.sidebar.realWidth()&&t.elements.iframe.hasClass(t.opts.classes.page.visible)&&h()}}),e(document).on("click",function(e){e.isTrusted&&h()}),t.elements.sidebar.on("mouseleave",function(){if(0===e("iframe#"+t.opts.ids.page.overlay).length()&&!1===t.elements.iframeBody.hasClass(t.opts.classes.drag.isDragged)){var a=t.helper.model.getData("b/closeTimeout");-1!=+a&&(i.close=setTimeout(function(){!1===t.elements.iframeBody.hasClass(t.opts.classes.drag.isDragged)&&h()},1e3*+a))}}).on("mouseenter",function(){u("close")}),e([document,t.elements.iframe[0].contentDocument]).on("keydown",function(e){"Escape"!==e.key&&"Esc"!==e.key||!t.elements.iframe.hasClass(t.opts.classes.page.visible)||(e.preventDefault(),h())}),e(document).on("visibilitychange",function(){document.hidden&&0===e("iframe#"+t.opts.ids.page.overlay).length()&&(t.elements.toggle.removeClass(t.opts.classes.page.hover),t.elements.iframe.hasClass(t.opts.classes.page.visible)&&h())}).on("mouseout",function(){u("open")}).on("mousemove dragover",function(e){if(e.isTrusted&&p(e.pageX)){var a=+new Date-(l||0);i.indicator||(i.indicator=setTimeout(function(){t.elements.toggle.addClass(t.opts.classes.page.hover)},Math.max(n-a,0)))}else u("indicator"),t.elements.toggle.removeClass(t.opts.classes.page.hover)},{passive:!0}),chrome.extension.onMessage.addListener(function(e){e&&e.action&&"toggleSidebar"===e.action&&(t.elements.iframe.hasClass(t.opts.classes.page.visible)?h():m())});var s=t.helper.model.getData("b/openAction");"icon"!==s&&e(document).on(s+" dragover",function(e){e.isTrusted&&("dragover"===e.type||"mousedown"!==s||0===e.button)&&p(e.pageX)?(e.stopPropagation(),e.preventDefault(),"mousemove"===s?i.open||(i.open=setTimeout(function(){m()},n)):(0===n||null===l||+new Date-l>n)&&m()):u("open")})},p=function(e){var s=!1;if(void 0!==e&&null!==e){"right"===a&&(e=window.innerWidth-e-1);var o=d();t.elements.toggle.hasClass(t.opts.classes.page.hover)&&r>o&&(o=r),s=e<o}return!1===s?l=null:null===l&&(l=+new Date),s},u=function(e){i[e]&&(clearTimeout(i[e]),i[e]=null)},h=function(){u("close"),u("open"),t.helper.contextmenu.close(),t.elements.iframe.removeClass(t.opts.classes.page.visible),e("body").removeClass(t.opts.classes.page.noscroll),e(document).trigger("mousemove")},m=function(){t.helper.model.call("shareUserdataMask",function(e){e&&e.showMask?t.addShareUserdataMask():t.elements.sidebar.find("#"+t.opts.ids.sidebar.shareUserdata).remove()}),t.elements.iframe.addClass(t.opts.classes.page.visible),t.elements.sidebar.addClass(t.opts.classes.sidebar.openedOnce),t.initImages(),o&&e("body").addClass(t.opts.classes.page.noscroll),e(document).trigger("mousemove")},f=function(){e(t.opts.leftsideBackSelector).length()>0?t.elements.toggle.addClass(t.opts.classes.page.hasLeftsideBack):e(document).on(t.opts.events.lsbLoaded,function(e){e.detail.showIndicator&&t.elements.toggle.addClass(t.opts.classes.page.hasLeftsideBack)})}},window.ext=function(t){var a=this,s={};this.firstRun=!0,this.isNewTab=!1,this.elements={},this.opts=t,this.run=function(){o(),a.helper.model.init(function(){a.helper.i18n.init(function(){a.helper.font.init(),a.helper.stylesheet.init(),n(),a.helper.list.init(),a.helper.toggle.init(),a.helper.sidebarEvents.init(),a.helper.dragndrop.init(),""===document.referrer&&a.helper.model.call("addViewAmount",{url:location.href})})})},this.isWindowed=function(){return 0!==window.screenX||0!==window.screenY||window.screen.availWidth!==window.innerWidth},this.refresh=function(){a.helper.model.init(function(){a.helper.i18n.init(function(){var e=a.helper.model.getData(["u/entriesLocked","u/showHidden"]);!1===e.entriesLocked?a.elements.sidebar.addClass(t.classes.sidebar.entriesUnlocked):a.elements.sidebar.removeClass(t.classes.sidebar.entriesUnlocked),!0===e.showHidden?a.elements.sidebar.addClass(t.classes.sidebar.showHidden):a.elements.sidebar.removeClass(t.classes.sidebar.showHidden),a.helper.list.updateBookmarkBox()})})},this.loaded=function(){var e=a.helper.model.getData(["b/pxTolerance","a/showIndicator"]);a.elements.iframeBody.addClass(t.classes.sidebar.extLoaded),document.dispatchEvent(new CustomEvent(t.events.loaded,{detail:{pxTolerance:e.pxTolerance,showIndicator:e.showIndicator},bubbles:!0,cancelable:!1}))},this.startLoading=function(){a.elements.sidebar.addClass(t.classes.sidebar.loading),s.timeout&&clearTimeout(s.timeout),void 0!==s.loader&&0!==s.loader.length()||(s.loader=a.helper.template.loading().appendTo(a.elements.sidebar))},this.endLoading=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:500;s.timeout=setTimeout(function(){a.elements.sidebar.removeClass(t.classes.sidebar.loading),s.loader&&s.loader.remove(),s={}},e)},this.copyToClipboard=function(t){var s=e("<textarea />").text(t).appendTo(a.elements.iframeBody);s[0].select();var o=!1;try{o=a.elements.iframe[0].contentDocument.execCommand("copy")}catch(e){}return s.remove(),o},this.initImages=function(){a.elements.iframe.hasClass(a.opts.classes.page.visible)&&a.elements.sidebar.find("img["+t.attr.src+"]").forEach(function(a){var s=e(a),o=s.attr(t.attr.src);s.removeAttr(t.attr.src),s.attr("src",o)})},this.addShareUserdataMask=function(){a.elements.sidebar.find("#"+t.ids.sidebar.shareUserdata).remove();var s=e("<div />").attr("id",t.ids.sidebar.shareUserdata).prependTo(a.elements.sidebar),o=e("<div />").prependTo(s);e("<h2 />").html(a.helper.i18n.get("share_userdata_headline")).appendTo(o),e("<p />").html(a.helper.i18n.get("share_userdata_desc")).appendTo(o),e("<p />").html(a.helper.i18n.get("share_userdata_desc2")).appendTo(o),e("<p />").addClass(t.classes.sidebar.shareUserdataNotice).html(a.helper.i18n.get("share_userdata_notice")).appendTo(o),e("<a />").data("accept",!0).html(a.helper.i18n.get("share_userdata_accept")).appendTo(o),e("<a />").data("accept",!1).html(a.helper.i18n.get("share_userdata_decline")).appendTo(o)};var o=function(){a.helper={model:new window.ModelHelper(a),toggle:new window.ToggleHelper(a),entry:new window.EntryHelper(a),list:new window.ListHelper(a),scroll:new window.ScrollHelper(a),template:new window.TemplateHelper(a),i18n:new window.I18nHelper(a),font:new window.FontHelper(a),sidebarEvents:new window.SidebarEventsHelper(a),search:new window.SearchHelper(a),stylesheet:new window.StylesheetHelper(a),dragndrop:new window.DragDropHelper(a),checkbox:new window.CheckboxHelper(a),overlay:new window.OverlayHelper(a),contextmenu:new window.ContextmenuHelper(a)}},n=function(){a.isNewTab=0===location.href.search("https://www.google.de/_/chrome/newtab"),a.helper.stylesheet.addStylesheets(["content"]),a.elements.iframe=e('<iframe id="'+t.ids.page.iframe+'" />').appendTo("body"),a.elements.iframeBody=a.elements.iframe.find("body"),a.elements.sidebar=e('<section id="'+t.ids.sidebar.sidebar+'" />').appendTo(a.elements.iframeBody),a.elements.bookmarkBox={},["all","search"].forEach(function(s){a.elements.bookmarkBox[s]=a.helper.scroll.add(t.ids.sidebar.bookmarkBox[s],e("<ul />").appendTo(a.elements.sidebar))}),a.elements.filterBox=e("<div />").addClass(t.classes.sidebar.filterBox).appendTo(a.elements.sidebar),a.elements.iframeBody.attr(t.attr.dragCancel,a.helper.i18n.get("sidebar_drag_cancel")),a.elements.header=e("<header />").prependTo(a.elements.sidebar),a.helper.stylesheet.addStylesheets(["sidebar"],a.elements.iframe);var s=a.helper.model.getData(["u/entriesLocked","u/showHidden"]);!1===s.entriesLocked&&a.elements.sidebar.addClass(t.classes.sidebar.entriesUnlocked),!0===s.showHidden&&a.elements.sidebar.addClass(t.classes.sidebar.showHidden)}};var t={ids:{page:{iframe:"blockbyte-bs-sidebar",overlay:"blockbyte-bs-overlay",indicator:"blockbyte-bs-indicator"},sidebar:{sidebar:"sidebar",shareUserdata:"shareUserdata",bookmarkBox:{all:"bookmarkBox",search:"bookmarkBoxSearch"}},overlay:{urlList:"urlList"}},classes:{page:{indicatorIcon:"blockbyte-bs-icon",visible:"blockbyte-bs-visible",isNewTab:"blockbyte-bs-isNewTab",hover:"blockbyte-bs-hover",noscroll:"blockbyte-bs-noscroll",hasLeftsideBack:"blockbyte-bs-has-lsb"},sidebar:{extLoaded:"loaded",openedOnce:"openedOnce",active:"active",mark:"mark",hideRoot:"hideRoot",entriesUnlocked:"entriesUnlocked",showHidden:"showHidden",dirAnimated:"animated",dirOpened:"opened",bookmarkDir:"dir",dirIcon:"icon",bookmarkLink:"link",bookmarkLabel:"label",menu:"menu",sort:"sort",hidden:"hidden",hover:"hover",loading:"loading",copied:"copied",filterBox:"filter",search:"search",searchBox:"searchBox",searchClose:"searchClose",searchVisible:"searchVisible",shareUserdataNotice:"shareNotice"},contextmenu:{wrapper:"contextmenu",top:"top",visible:"visible",list:"list",icons:"icons",right:"right",separator:"separator"},drag:{trigger:"drag",helper:"dragHelper",isDragged:"isDragged",cancel:"dragCancel",dragHover:"dragHover",snap:"snap",dragInitial:"dragInitial"},scrollBox:{wrapper:"scrollBox",scrollbar:"scrollbar",inactive:"inactive",hideScrollbar:"hideScrollbar",hidden:"hidden",scrolled:"scrolled"},checkbox:{box:"checkbox",active:"active",clicked:"clicked",focus:"focus"},overlay:{modal:"modal",visible:"visible",preview:"preview",previewUrl:"previewUrl",action:"action",close:"close",hasTooltip:"tooltip",inputError:"error",success:"success",progressBar:"progressBar",buttonWrapper:"buttons",checkUrlProgressLabel:"progressLabel",urlCheckLoading:"urlCheckLoading",urlCheckList:"urlCheckList"}},attr:{src:"data-src",position:"data-pos",type:"data-type",name:"data-name",value:"data-value",sort:"data-sort",direction:"data-direction",dragCancel:"data-dragCancel",id:"data-id"},events:{loaded:"blockbyte-bs-loaded",checkboxChanged:"blockbyte-bs-checkboxChanged",scrollBoxLastPart:"blockbyte-bs-scrollBoxLastPart",lsbLoaded:"blockbyte-lsb-loaded"},leftsideBackSelector:"div#blockbyte-lsb-indicator.blockbyte-lsb-visible",manifest:chrome.runtime.getManifest(),demoMode:!1};new window.ext(t).run()}(jsu);