/*! (c) Philipp KÃ¶nig under GPL-3.0 */
(e=>{"use strict";window.BookmarkHelper=function(t){this.removeEntry=(s=>new Promise(a=>{let l=t.helper.entry.getData(s);l&&l.url?(Object.values(t.elements.bookmarkBox).some(s=>{if(s.hasClass(t.opts.classes.sidebar.active)){let a=s.find("a["+t.opts.attr.id+"='"+l.id+"']");a.data("restore",l);let r=e("<span />").addClass(t.opts.classes.sidebar.removeMask).append("<em>"+t.helper.i18n.get("sidebar_deleted")+"</em>").append("<span>"+t.helper.i18n.get("sidebar_undo_deletion")+"</span>").appendTo(a);return e.delay(100).then(()=>{a.addClass(t.opts.classes.sidebar.removed),r.children("span")[0].offsetTop>0&&r.children("em").remove()}),!0}}),this.performDeletion(l).then(a)):(t.helper.overlay.create("delete",t.helper.i18n.get("contextmenu_delete_dir"),l),a())})),this.editEntry=(e=>new Promise(s=>{let a=t.helper.model.getData("u/additionalInfo");a[e.id]={desc:e.additionalInfo},Promise.all([t.helper.model.call("updateBookmark",{id:e.id,title:e.title,url:e.url,preventReload:!0}),t.helper.model.setData({"u/additionalInfo":a})]).then(s)})),this.restoreEntry=(s=>new Promise(a=>{if(s&&s.length()>0){let l=s.data("restore");s.removeClass(t.opts.classes.sidebar.removed).addClass(t.opts.classes.sidebar.restored),e.delay(500).then(()=>(s.children("span."+t.opts.classes.sidebar.removeMask).remove(),t.helper.model.call("createBookmark",l))).then(e=>{let a=[];if(e&&e.created){s.attr(t.opts.attr.id,e.created),t.helper.model.call("trackEvent",{category:"extension",action:"restore",label:l.url?"bookmark":"directory"});let r=t.helper.model.getData("u/additionalInfo");r[l.id]&&(r[e.created]=r[l.id],a.push(t.helper.model.setData({"u/additionalInfo":r})))}return a.push(t.helper.entry.init()),Promise.all(a)}).then(()=>{a()})}else a()})),this.performDeletion=(e=>new Promise(s=>{t.helper.model.call("trackEvent",{category:"extension",action:"remove",label:e.url?"bookmark":"directory"}),t.helper.model.call("deleteBookmark",{id:e.id}).then(()=>{s()})})),this.pinEntry=(e=>new Promise(a=>{let l=t.helper.model.getData("u/pinnedEntries"),r=-1;Object.values(l).forEach(e=>{r=Math.max(r,e.index)}),l[e.id]={index:r+1},t.helper.model.call("trackEvent",{category:"extension",action:"pinnedEntry",label:"pin"}),s(l).then(a)})),this.unpinEntry=(e=>new Promise(a=>{let l=t.helper.model.getData("u/pinnedEntries");delete l[e.id],t.helper.model.call("trackEvent",{category:"extension",action:"pinnedEntry",label:"unpin"}),s(l).then(a)})),this.reorderPinnedEntries=(e=>new Promise(a=>{let l=t.helper.model.getData("u/pinnedEntries"),r=0;if(e.prevId){let s=t.helper.entry.getData(e.prevId);r=s.pinnedIndex+1}Object.keys(l).forEach(s=>{+s==+e.id?(l[s].index=r,t.helper.entry.addData(s,"pinnedIndex",r)):l[s].index>=r&&(l[s].index++,t.helper.entry.addData(s,"pinnedIndex",l[s].index))}),s(l).then(a)}));let s=e=>new Promise(s=>{Promise.all([t.helper.model.call("removeCache",{name:"htmlList"}),t.helper.model.call("removeCache",{name:"htmlPinnedEntries"}),t.helper.model.setData({"u/pinnedEntries":e})]).then(s)})},window.CheckboxHelper=function(t){let s={};this.get=((s,a,l="checkbox",o="default")=>{let i=e("<div />").html("<input type='checkbox' />").data("uid",Math.random().toString(36).substr(2,12)).attr(t.opts.attr.type,l).attr(t.opts.attr.style,o).addClass(t.opts.classes.checkbox.box);return a&&(i.children("input[type='checkbox']").attr(a),a[t.opts.attr.name]&&i.attr(t.opts.attr.name,a[t.opts.attr.name])),this.isChecked(i)&&i.addClass(t.opts.classes.checkbox.active),r(i,s),i}),this.isChecked=(e=>e.find("input[type='checkbox']")[0].checked);let a=(e,s)=>{let a=e.children("input[type='checkbox']");a.trigger("change"),t.opts.events&&t.opts.events.checkboxChanged&&t.helper.utility.triggerEvent("checkboxChanged",{container:e,checkbox:a,checked:e.hasClass(t.opts.classes.checkbox.active)},s.document()[0])},l=(r,o)=>{r.addClass(t.opts.classes.checkbox.clicked),r.removeClass(t.opts.classes.checkbox.focus),r.toggleClass(t.opts.classes.checkbox.active);let i=r.hasClass(t.opts.classes.checkbox.active),n=r.children("input[type='checkbox']");if("radio"===r.attr(t.opts.attr.type)&&r.attr(t.opts.attr.name))if(o){let s=r.attr(t.opts.attr.name);r.addClass(t.opts.classes.checkbox.active),i&&(n.attr("checked",!0),a(r,o)),o.find("div."+t.opts.classes.checkbox.box+"["+t.opts.attr.type+"='radio']["+t.opts.attr.name+"='"+s+"']").forEach(t=>{let s=e(t);t!==r[0]&&this.isChecked(s)&&l(s)})}else n.attr("checked",!1);else n.attr("checked",i),a(r,o);let d=r.data("uid");s[d]&&clearTimeout(s[d]),s[d]=setTimeout(()=>{r.removeClass(t.opts.classes.checkbox.clicked)},300)},r=(s,a)=>{s.on("mousedown",s=>{s.preventDefault(),s.stopPropagation(),e(s.currentTarget).addClass(t.opts.classes.checkbox.focus)}).on("click",t=>{t.preventDefault(),t.stopPropagation(),l(e(t.currentTarget),a)}),a.on("click",()=>{s.removeClass(t.opts.classes.checkbox.focus)})}},window.ContextmenuHelper=function(t){let s={};this.create=((s,p)=>{if(t.helper.toggle.addSidebarHoverClass(),t.helper.tooltip.close(),!1===a(s,p)){this.close(),p.addClass(t.opts.classes.sidebar.active);let a=e("<div />").addClass(t.opts.classes.contextmenu.wrapper).html("<ul class='"+t.opts.classes.contextmenu.list+"'></ul><ul class='"+t.opts.classes.contextmenu.icons+"'></ul>").attr(t.opts.attr.type,s).data("elm",p).appendTo(t.elements.sidebar),c=s,h=p.attr(t.opts.attr.id);switch(h&&a.attr(t.opts.attr.id,h),s){case"list":{i(a,p);let e=t.helper.entry.getData(h);c=e&&e.isDir?"directory":"bookmark";break}case"separator":o(a,p);break;case"menu":r(a,p);break;case"sort":l(a,p)}t.helper.model.call("trackEvent",{category:"contextmenu",action:"open",label:c}),d(a),n(a,p,s),e.delay().then(()=>{a.addClass(t.opts.classes.contextmenu.visible)})}}),this.close=(()=>{let s=t.elements.iframeBody.find("div."+t.opts.classes.contextmenu.wrapper);s.forEach(s=>{e(s).removeClass(t.opts.classes.contextmenu.visible),e(s).data("elm").removeClass(t.opts.classes.sidebar.active)}),e.delay(500).then(()=>{s.remove(),t.helper.toggle.removeSidebarHoverClass()})});let a=(e,s)=>{let a=s.attr(t.opts.attr.id),l=s.attr(t.opts.attr.value),r="div."+t.opts.classes.contextmenu.wrapper+"["+t.opts.attr.type+"='"+e+"']";return a?r+="["+t.opts.attr.id+"='"+a+"']":l&&(r+="["+t.opts.attr.value+"='"+l+"']"),t.elements.sidebar.find(r).length()>0},l=(s,a)=>{let l=t.helper.list.getSortList(),r=t.helper.list.getSort(),o=s.children("ul."+t.opts.classes.contextmenu.list);s.children("ul."+t.opts.classes.contextmenu.icons).remove(),Object.keys(l).forEach(a=>{let l=a.replace(/([A-Z])/g,"_$1").toLowerCase();e("<li />").append(t.helper.checkbox.get(t.elements.iframeBody,{[t.opts.attr.name]:"sort",[t.opts.attr.value]:a},"radio")).append("<a "+t.opts.attr.name+"='sort'>"+t.helper.i18n.get("sort_label_"+l)+"</a>").appendTo(o),a===r.name&&s.find("input["+t.opts.attr.name+"='sort']["+t.opts.attr.value+"='"+a+"']").parent("div."+t.opts.classes.checkbox.box).trigger("click")})},r=(s,a)=>{let l=s.children("ul."+t.opts.classes.contextmenu.list),r=s.children("ul."+t.opts.classes.contextmenu.icons);e("<li />").append(t.helper.checkbox.get(t.elements.iframeBody,{[t.opts.attr.name]:"toggleHidden"})).append("<a "+t.opts.attr.name+"='toggleHidden'>"+t.helper.i18n.get("contextmenu_toggle_hidden")+"</a>").appendTo(l),t.helper.model.getData("u/showHidden")&&s.find("input["+t.opts.attr.name+"='toggleHidden']").parent("div."+t.opts.classes.checkbox.box).trigger("click"),e("<li />").append("<a "+t.opts.attr.name+"='reload'>"+t.helper.i18n.get("contextmenu_reload_sidebar")+"</a>").appendTo(l);let o=t.elements.bookmarkBox.all.children("ul"),i=o.hasClass(t.opts.classes.sidebar.hideRoot),n=!1;o.find("a."+t.opts.classes.sidebar.dirOpened).forEach(t=>{if(!1===i||e(t).parents("li").length()>1)return n=!0,!1}),n&&e("<li />").append("<a "+t.opts.attr.name+"='closeAll'>"+t.helper.i18n.get("contextmenu_close_all_directories")+"</a>").appendTo(l),r.append("<li><a "+t.opts.attr.name+"='settings' title='"+t.helper.i18n.get("settings_title")+"'></a></li>").append("<li><a "+t.opts.attr.name+"='bookmarkManager' title='"+t.helper.i18n.get("contextmenu_bookmark_manager")+"'></a></li>").append("<li class='"+t.opts.classes.contextmenu.right+"'><a "+t.opts.attr.name+"='keyboardShortcuts' title='"+t.helper.i18n.get("contextmenu_keyboard_shortcuts")+"'></a></li>")},o=(e,s)=>{let a=s.attr(t.opts.attr.id),l=t.helper.entry.getData(a);if(l&&l.parents&&l.parents.length>0){let s=e.children("ul."+t.opts.classes.contextmenu.list);l.parents.length>0&&s.append("<li><a "+t.opts.attr.name+"='delete'>"+t.helper.i18n.get("contextmenu_delete_separator")+"</a></li>")}e.children("ul."+t.opts.classes.contextmenu.icons).remove()},i=(e,s)=>{let a=s.attr(t.opts.attr.id),l=t.helper.entry.getData(a);if(l){let r=l.isDir?"_dir":"_bookmark",o=e.children("ul."+t.opts.classes.contextmenu.list),i=e.children("ul."+t.opts.classes.contextmenu.icons),n=t.elements.bookmarkBox.search.hasClass(t.opts.classes.sidebar.active);if(l.isDir){let e=l.children.filter(e=>e.url&&"about:blank"!==e.url);e.length>0&&o.append("<li><a "+t.opts.attr.name+"='openChildren'>"+t.helper.i18n.get("contextmenu_open_children")+" <span>("+e.length+")</span></a></li>"),l.children.length>0&&o.append("<li><a "+t.opts.attr.name+"='updateUrls'>"+t.helper.i18n.get("contextmenu_update_urls")+"</a></li>")}else n&&o.append("<li><a "+t.opts.attr.name+"='showInDir'>"+t.helper.i18n.get("contextmenu_show_in_dir")+"</a></li>"),o.append("<li><a "+t.opts.attr.name+"='newTab'>"+t.helper.i18n.get("contextmenu_new_tab")+"</a></li>"),o.append("<li><a "+t.opts.attr.name+"='newWindow'>"+t.helper.i18n.get("contextmenu_new_window")+"</a></li>"),!1===chrome.extension.inIncognitoContext&&o.append("<li><a "+t.opts.attr.name+"='newIncognito'>"+t.helper.i18n.get("contextmenu_new_tab_incognito")+"</a></li>");i.append("<li><a "+t.opts.attr.name+"='infos' title='"+t.helper.i18n.get("contextmenu_infos")+"'></a></li>"),l.parents.length>0&&i.append("<li><a "+t.opts.attr.name+"='edit' title='"+t.helper.i18n.get("contextmenu_edit"+r)+"'></a></li>").append("<li><a "+t.opts.attr.name+"='delete' title='"+t.helper.i18n.get("contextmenu_delete"+r)+"'></a></li>"),l.isDir?i.append("<li><a "+t.opts.attr.name+"='add' title='"+t.helper.i18n.get("contextmenu_add")+"'></a></li>"):l.pinned?i.append("<li><a "+t.opts.attr.name+"='unpin' title='"+t.helper.i18n.get("contextmenu_unpin")+"'></a></li>"):i.append("<li><a "+t.opts.attr.name+"='pin' title='"+t.helper.i18n.get("contextmenu_pin")+"'></a></li>"),t.helper.entry.isVisible(a)?i.append("<li class='"+t.opts.classes.contextmenu.right+"'><a "+t.opts.attr.name+"='hide' title='"+t.helper.i18n.get("contextmenu_hide_from_sidebar")+"'></a></li>"):!n&&s.parents("li."+t.opts.classes.sidebar.hidden).length()<=1&&i.append("<li class='"+t.opts.classes.contextmenu.right+"'><a "+t.opts.attr.name+"='showHidden' title='"+t.helper.i18n.get("contextmenu_show_in_sidebar")+"'></a></li>")}},n=(e,s,a)=>{let l={w:e.realWidth(),h:e.realHeight()},r=s[0].getBoundingClientRect(),o=r.top+r.height;if(o+l.h>=window.innerHeight?e.css("top",o-l.h).addClass(t.opts.classes.contextmenu.top):e.css("top",o+"px"),"sort"!==a&&"menu"!==a){let a=s.parent("li")[0].offsetLeft;t.helper.i18n.isRtl()&&(a=r.width-l.w),e.css("left",a+"px")}};s.settings=(e=>{t.helper.model.call("openLink",{href:chrome.extension.getURL("html/settings.html"),newTab:!0})}),s.checkbox=(s=>{s.eventObj.stopPropagation(),e(s.elm).prev("div."+t.opts.classes.checkbox.box).trigger("click")}),s.bookmarkManager=(e=>{t.helper.model.call("openLink",{href:"chrome://bookmarks",newTab:!0,active:!0})}),s.newIncognito=(e=>{t.helper.model.call("trackEvent",{category:"url",action:"open",label:"new_window_incognito"}),e.data&&t.helper.utility.openUrl(e.data,"incognito")}),s.newWindow=(e=>{t.helper.model.call("trackEvent",{category:"url",action:"open",label:"new_window"}),e.data&&(t.helper.utility.openUrl(e.data,"newWindow"),t.helper.toggle.closeSidebar())}),s.newTab=(e=>{if(t.helper.model.call("trackEvent",{category:"url",action:"open",label:"new_tab_contextmenu"}),e.data){let s="foreground"===t.helper.model.getData("b/newTab");e.data.reopenSidebar=t.helper.model.getData("b/reopenSidebar"),t.helper.utility.openUrl(e.data,"newTab",s),s&&t.helper.toggle.closeSidebar()}}),s.delete=(e=>{t.helper.bookmark.removeEntry(e.data.id)}),s.showHidden=(e=>{t.startLoading();let s=t.helper.model.getData("u/hiddenEntries");delete s[e.id],t.helper.model.setData({"u/hiddenEntries":s}).then(()=>Promise.all([t.helper.model.call("removeCache",{name:"htmlList"}),t.helper.model.call("removeCache",{name:"htmlPinnedEntries"})])).then(()=>{t.helper.model.call("reload",{type:"Hide"})})}),s.openChildren=(e=>{if(e.data){let s=e.data.children.filter(e=>e.url&&"about:blank"!==e.url);s.length>t.helper.model.getData("b/openChildrenWarnLimit")?t.helper.overlay.create(e.name,t.helper.i18n.get("contextmenu_open_children"),e.data):t.helper.utility.openAllBookmarks(s)}}),s.pin=(e=>{t.helper.bookmark.pinEntry(e.data).then(()=>{t.helper.model.call("reload",{type:"Pin"})})}),s.unpin=(e=>{t.helper.bookmark.unpinEntry(e.data).then(()=>{t.helper.model.call("reload",{type:"Unpin"})})}),s.showInDir=(e=>{let s=t.helper.entry.getData(e.id);if(s&&s.parents){let a=l=>{if(s.parents[l]){let e=t.elements.bookmarkBox.all.find("ul > li > a."+t.opts.classes.sidebar.bookmarkDir+"["+t.opts.attr.id+"='"+s.parents[l]+"']");e.hasClass(t.opts.classes.sidebar.dirOpened)?a(l+1):t.helper.list.toggleBookmarkDir(e,!0,!1).then(()=>{a(l+1)})}else Promise.all([t.helper.list.cacheList(),t.helper.search.clearSearch()]).then(()=>{let s=t.elements.bookmarkBox.all.find("ul > li > a["+t.opts.attr.id+"='"+e.id+"']");t.helper.scroll.setScrollPos(t.elements.bookmarkBox.all,s[0].offsetTop-50),s.addClass(t.opts.classes.sidebar.mark)})};a(0)}}),s.reload=(e=>{t.helper.model.call("reload",{type:"Force"})}),s.closeAll=(s=>{let a=t.elements.bookmarkBox.all.children("ul"),l=a.hasClass(t.opts.classes.sidebar.hideRoot),r=[];a.find("a."+t.opts.classes.sidebar.dirOpened).forEach(s=>{(!1===l||e(s).parents("li").length()>1)&&r.push(t.helper.list.toggleBookmarkDir(e(s),!1,!1))}),Promise.all(r).then(()=>{t.helper.list.cacheList()})});let d=a=>{a.find("input["+t.opts.attr.name+"='sort']").on("change",s=>{if(s.currentTarget.checked){let a=e(s.currentTarget).attr(t.opts.attr.value);t.helper.list.updateSort(a),this.close()}}),a.find("input["+t.opts.attr.name+"='toggleHidden']").on("change",s=>{t.startLoading(),Promise.all([t.helper.model.call("removeCache",{name:"htmlList"}),t.helper.model.call("removeCache",{name:"htmlPinnedEntries"}),t.helper.model.setData({"u/showHidden":t.helper.checkbox.isChecked(e(s.currentTarget).parent("div"))})]).then(()=>{t.helper.model.call("reload",{type:"ToggleHidden"})}),this.close()}),a.on("mouseleave",s=>{e(s.currentTarget).find("a").removeClass(t.opts.classes.sidebar.hover)}),a.find("a").on("mouseenter",s=>{a.find("a").removeClass(t.opts.classes.sidebar.hover),e(s.currentTarget).addClass(t.opts.classes.sidebar.hover)}).on("mouseleave",s=>{e(s.currentTarget).removeClass(t.opts.classes.sidebar.hover)}).on("click",l=>{l.preventDefault();let r={elm:l.currentTarget,eventObj:l,name:e(l.currentTarget).attr(t.opts.attr.name),id:a.attr(t.opts.attr.id)};r.data=r.id?t.helper.entry.getData(r.id):null,"sort"!==r.name&&"toggleHidden"!==r.name||(r.name="checkbox"),"function"==typeof s[r.name]?s[r.name](r):t.helper.overlay.create(r.name,e(r.elm).attr("title")||e(r.elm).text(),r.data)})}},window.DragDropHelper=function(t){let s=null,a=null,l=0,r=null,o={running:!1,posY:null,previousDelta:0,fpsLimit:30};this.init=(async()=>{s=t.helper.model.getData("b/sidebarPosition"),b(),n()}),this.cancel=(()=>{let s=t.elements.iframeBody.children("a."+t.opts.classes.drag.helper),a=t.elements.bookmarkBox.all.find("li."+t.opts.classes.drag.dragInitial),l=s.data("elm");if(l){let e=l.children("a");l.insertAfter(a).removeClass(t.opts.classes.drag.isDragged),p(e,{type:"end",cancel:!0})}a.remove(),s.remove(),t.elements.iframeBody.removeClass([t.opts.classes.drag.isDragged,t.opts.classes.drag.cancel]),e.delay(500).then(()=>{t.helper.toggle.removeSidebarHoverClass()})});let i=e=>{let a=0;return a="object"==typeof e?e[0].getBoundingClientRect().left:+e,"right"===s&&(a=window.innerWidth-a),"object"==typeof e?.6*e.realWidth()+a>t.elements.sidebar.realWidth():a>t.elements.sidebar.realWidth()},n=async()=>{t.elements.iframeBody.on("dragenter",()=>{t.helper.contextmenu.close(),t.helper.tooltip.close(),t.elements.iframeBody.addClass(t.opts.classes.drag.isDragged),t.helper.toggle.addSidebarHoverClass(),p("selection",{type:"start"}),o.running||window.requestAnimationFrame(h)}).on("drop dragend",s=>{if(s.preventDefault(),s.stopPropagation(),o.posY=null,t.elements.iframeBody.hasClass(t.opts.classes.drag.isDragged)){if(i(s.pageX))p("selection",{type:"end",cancel:!0});else{let a=t.elements.bookmarkBox.all.find("li."+t.opts.classes.drag.isDragged).eq(0);if(a&&a.length()>0){let l=s.dataTransfer.getData("URL"),r=s.dataTransfer.getData("text/plain");if(location.href===l)r=e(document).find("title").text();else if(r===l){let t=s.dataTransfer.getData("text/html");r=t&&t.length>0?e("<div />").html(t).text():""}p("selection",{type:"end"}),t.helper.overlay.create("add",t.helper.i18n.get("contextmenu_add"),{values:{index:a.prevAll("li").length(),parentId:a.parent("ul").prev("a").attr(t.opts.attr.id),title:r,url:l}})}}t.elements.iframeBody.removeClass(t.opts.classes.drag.isDragged),t.helper.toggle.removeSidebarHoverClass()}})},d=e=>{let s="bookmark";return"selection"===e?s=e:e.data("type")?s=e.data("type"):(e.hasClass(t.opts.classes.sidebar.bookmarkDir)?s="directory":e.parents("div."+t.opts.classes.sidebar.entryPinned).length()>0&&(s="pinned"),e.data("type",s)),s},p=(e,s={})=>{let a=null;"end"===s.type?a=s.cancel?"cancel":"dragend":"start"===s.type&&(a="dragstart"),a&&t.helper.model.call("trackEvent",{category:"dragndrop",action:d(e),label:a})},c=(s,a,l)=>{t.helper.contextmenu.close(),t.helper.tooltip.close();let r=e(s).parent("a").removeClass(t.opts.classes.sidebar.dirOpened),i=t.helper.entry.getData(r.attr(t.opts.attr.id));if(null===i)return!1;let n=r.parent("li"),d=n.parent("ul").prev("a");t.elements.iframeBody.addClass(t.opts.classes.drag.isDragged),n.clone().addClass(t.opts.classes.drag.dragInitial).insertAfter(n);let c=r.clone().appendTo(t.elements.iframeBody),m=r[0].getBoundingClientRect(),u=0;n.prevAll("li").forEach(s=>{e(s).hasClass(t.opts.classes.drag.dragInitial)||u++}),c.removeAttr("title").css({top:m.top+"px",left:m.left+"px",width:r.realWidth()+"px"}).data({elm:n,isDir:!!i.isDir,parentId:d.length()>0?d.attr(t.opts.attr.id):null,index:u,startPos:{top:l-m.top,left:a-m.left}}).addClass(t.opts.classes.drag.helper),n.addClass(t.opts.classes.drag.isDragged),p(r,{type:"start"}),o.running||window.requestAnimationFrame(h)},h=e=>{window.requestAnimationFrame(h);let s=e-o.previousDelta;if(!(o.fpsLimit&&s<1e3/o.fpsLimit)){if(null!==o.posY){let e=t.elements.bookmarkBox.all[0].offsetTop,s=t.elements.bookmarkBox.all[0].offsetHeight,a=t.helper.scroll.getScrollPos(t.elements.bookmarkBox.all),l=null;o.posY-e<60?l=a-Math.pow((50-o.posY+e)/10,2):o.posY+60>s&&(l=a+Math.pow((o.posY+50-s)/10,2)),l&&t.helper.scroll.setScrollPos(t.elements.bookmarkBox.all,l)}o.previousDelta=e}},m=()=>{u();let s=t.elements.iframeBody.children("a."+t.opts.classes.drag.helper),a=t.elements.bookmarkBox.all.find("li."+t.opts.classes.drag.dragInitial),l=s.data("elm"),r=(s.data("parentId"),s.data("index"),l.children("a")),o=d(r);if(i(s))this.cancel();else{s.addClass(t.opts.classes.drag.snap);let i=l.parent("ul").prev("a").attr(t.opts.attr.id),n=0;l.prevAll("li").forEach(e=>{e!==a&&n++}),"pinned"===o?t.helper.bookmark.reorderPinnedEntries({id:l.children("a").attr(t.opts.attr.id),prevId:l.prev("li").children("a").attr(t.opts.attr.id)}):t.helper.model.call("moveBookmark",{id:l.children("a").attr(t.opts.attr.id),parentId:i,index:n}),p(r,{type:"end"}),t.elements.iframeBody.removeClass(t.opts.classes.drag.isDragged),e.delay().then(()=>{let t=l[0].getBoundingClientRect();return s.css({top:t.top+"px",left:t.left+"px"}),e.delay(200)}).then(()=>(l.removeClass(t.opts.classes.drag.isDragged),a.remove(),s.remove(),e.delay(300))).then(()=>{t.helper.toggle.removeSidebarHoverClass()})}},u=(e=null)=>{null===r||null!==e&&r.id===e.attr(t.opts.attr.id)||(r.elm.removeClass(t.opts.classes.drag.dragHover),clearTimeout(r.instance),r=null)},g=(s,n,p)=>{let c=null,h=null,m=0,g=0;if("dragover"===s){if(m=p-20,g=n,m===l)return!1;l=m,t.elements.bookmarkBox.all.find("li."+t.opts.classes.drag.isDragged).remove(),h=e("<li />").html("<a>&nbsp;</a>").addClass(t.opts.classes.drag.isDragged)}else{let e=(c=t.elements.iframeBody.children("a."+t.opts.classes.drag.helper)).data("startPos");m=p-e.top,g=n-e.left,c.css({top:m+"px",left:g+"px"}),h=c.data("elm")}if(i(c||g))return u(),t.elements.iframeBody.addClass(t.opts.classes.drag.cancel),!1;t.elements.iframeBody.removeClass(t.opts.classes.drag.cancel);let b={elm:null},f=d(h.children("a")),v=null;if("pinned"===f?v=[t.elements.pinnedBox.find("> ul > li")]:(o.posY=p,v=[t.elements.bookmarkBox.all.find("a."+t.opts.classes.sidebar.dirOpened+" + ul > li"),t.elements.bookmarkBox.all.find("> ul > li > a."+t.opts.classes.sidebar.dirOpened).parent("li")]),v.some(s=>{s.forEach(s=>{let a=e(s);if(a[0]!==h[0]&&!a.hasClass(t.opts.classes.drag.dragInitial)){let e=a[0].getBoundingClientRect(),t=m-e.top;if(e.top>m)return!1;(null===b.elm||b.diff>t)&&(b={elm:a,diff:t})}})}),b.elm&&b.elm!==a){a=b.elm;let s=b.elm.children("a").eq(0);if(u(s),s.hasClass(t.opts.classes.sidebar.bookmarkDir))if(s.hasClass(t.opts.classes.sidebar.dirOpened)){let e=h.prependTo(s.next("ul"));c&&c.data("elm",e)}else if(c&&c.data("isDir")){let e=h.insertAfter(b.elm);c&&c.data("elm",e)}else s.hasClass(t.opts.classes.sidebar.dirAnimated)?0===s.next("ul").length()&&(s.addClass(t.opts.classes.sidebar.dirOpened),e("<ul />").insertAfter(s)):null===r&&((r={id:s.attr(t.opts.attr.id),elm:s.addClass(t.opts.classes.drag.dragHover)}).instance=setTimeout(()=>{t.helper.list.toggleBookmarkDir(s)},700));else{let e=h.insertAfter(b.elm);c&&c.data("elm",e)}}else if("pinned"===f){let e=h.prependTo(t.elements.pinnedBox.children("ul"));c&&c.data("elm",e)}},b=async()=>{t.elements.bookmarkBox.all.on("mousedown","span."+t.opts.classes.drag.trigger,e=>{t.helper.toggle.addSidebarHoverClass(),c(e.currentTarget,e.pageX,e.pageY),g(e.type,e.pageX,e.pageY)}),t.elements.iframeBody.on("mouseup",e=>{o.posY=null,t.elements.iframeBody.hasClass(t.opts.classes.drag.isDragged)&&(e.preventDefault(),e.stopPropagation(),m())}),t.elements.iframeBody.on("wheel",e=>{if(t.elements.iframeBody.hasClass(t.opts.classes.drag.isDragged)){e.preventDefault(),e.stopPropagation();let s=t.elements.bookmarkBox.all[0].scrollTop;t.helper.scroll.setScrollPos(t.elements.bookmarkBox.all,s-e.wheelDelta,300)}}),t.elements.iframeBody.on("mousemove dragover",e=>{t.elements.iframeBody.hasClass(t.opts.classes.drag.isDragged)&&1===e.which&&(e.preventDefault(),e.stopPropagation(),g(e.type,e.pageX,e.pageY))}),t.elements.iframeBody.on("contextmenu","a."+t.opts.classes.drag.helper,e=>{e.preventDefault(),e.stopPropagation()})}},window.EntryHelper=function(e){let t=!1,s={},a={},l={},r={bookmarks:{},directories:{},pinned:{}};this.init=(e=>(t=!0,new Promise(t=>{this.update(e).then(t)}))),this.initOnce=(()=>new Promise(e=>{t?e():this.init().then(e)})),this.getAmount=(t=>{if(o(),0===Object.keys(s).length&&(s=e.helper.model.getData("u/entryAmounts")),s&&s[t]){let e=s[t].visible;return a.showHidden&&(e+=s[t].hidden),e}return null}),this.getAllPinnedData=(()=>Object.values(r.pinned)),this.getAllBookmarkData=(()=>Object.values(r.bookmarks)),this.getData=(e=>{let t=null;return"object"==typeof r.bookmarks[e]?(t=r.bookmarks[e],"object"==typeof r.pinned[e]&&(t.pinnedIndex=r.pinned[e].index)):"object"==typeof r.directories[e]&&(t=r.directories[e]),t}),this.addData=((e,t,s)=>{"object"==typeof r.bookmarks[e]?("pinnedIndex"===t&&"object"==typeof r.pinned[e]&&(r.pinned[e].index=s),r.bookmarks[e][t]=s):"object"==typeof r.directories[e]&&(r.directories[e][t]=s)}),this.isSeparator=(e=>{let t=!1;if("object"==typeof r.bookmarks[e]){let s=r.bookmarks[e].title.replace(/[^-_]/g,"");t="about:blank"===r.bookmarks[e].url&&s.length===r.bookmarks[e].title.length}return t}),this.isVisible=(e=>{let t=!1;return"object"==typeof r.bookmarks[e]?t=!1===r.bookmarks[e].hidden:"object"==typeof r.directories[e]&&(t=!1===r.directories[e].hidden),t}),this.update=((t=null)=>new Promise(a=>{o();let n=[e.helper.model.call("viewAmounts")];null===t&&n.push(e.helper.model.call("bookmarks",{id:0})),Promise.all(n).then(o=>{l=o[0],null===t&&o[1]&&o[1].bookmarks&&o[1].bookmarks[0]&&o[1].bookmarks[0].children&&(t=o[1].bookmarks[0].children),r={bookmarks:{},directories:{},pinned:{}},s={bookmarks:{visible:0,hidden:0},directories:{visible:0,hidden:0},pinned:{visible:0,hidden:0}},i(t),e.helper.model.setData({"u/entryAmounts":s}),a()})}));let o=()=>{a=e.helper.model.getData(["u/hiddenEntries","u/additionalInfo","u/pinnedEntries","u/showHidden"])},i=(e,t=[],s=!1)=>{e.forEach(e=>{let r=[...t];"0"!==e.parentId&&r.push(e.parentId),e.additionalInfo=a.additionalInfo[e.id]||{},e.hidden=s||!0===a.hiddenEntries[e.id],e.parents=r,e.views={startDate:+new Date(Math.max(e.dateAdded,l.counterStartDate)),total:0},e.url?d(e):e.children&&n(e)})},n=e=>{e.childrenAmount={bookmarks:0,directories:0,total:0},e.parents.forEach(e=>{r.directories[e].childrenAmount.directories++}),r.directories[e.id]=e,i(e.children,e.parents,e.hidden),e.isDir=!0,e.childrenAmount.total=e.childrenAmount.bookmarks+e.childrenAmount.directories,e.views.perMonth=Math.round(e.views.total/p(e.views.startDate)*100)/100,s.directories[e.hidden?"hidden":"visible"]++},d=e=>{let t=0,o=0;if(l.viewAmounts[e.id]&&(t=l.viewAmounts[e.id].c,o=l.viewAmounts[e.id].d||0),e.views.total=t,e.views.lastView=o,e.views.perMonth=Math.round(t/p(e.views.startDate)*100)/100,e.parents.forEach(e=>{r.directories[e]&&(r.directories[e].childrenAmount.bookmarks++,r.directories[e].views.total+=t,r.directories[e].views.lastView=Math.max(r.directories[e].views.lastView||0,o))}),e.pinned=!1,r.bookmarks[e.id]=e,!1===this.isSeparator(e.id)&&s.bookmarks[e.hidden?"hidden":"visible"]++,a.pinnedEntries[e.id]){e.pinned=!0;let t=Object.assign({},e);t.index=a.pinnedEntries[e.id].index,delete t.parents,delete t.parentId,r.pinned[e.id]=t,s.pinned[e.hidden?"hidden":"visible"]++}},p=e=>Math.max(1,Math.round((+new Date-e)/2627999942.4))},window.FontHelper=function(t){let s={custom:{fontWeights:{Thin:100,ExtraLight:200,Light:300,Normal:400,Medium:500,SemiBold:600,Bold:700,ExtraBold:800,Black:900}},general:{name:"Roboto",href:"https://fonts.googleapis.com/css?family=Roboto:100,200,300,400,500,100i,200i,300i,400i,500i",fontWeights:{Thin:100,ExtraLight:100,Light:200,Normal:300,Medium:400,SemiBold:400,Bold:500,ExtraBold:500,Black:500}},fa:{fontWeights:{Thin:100,ExtraLight:100,Light:200,Normal:300,Medium:400,SemiBold:500,Bold:600,ExtraBold:600,Black:600}},ja:{name:"Noto Sans Japanese",href:"https://fonts.googleapis.com/earlyaccess/notosansjapanese.css",fontWeights:{Thin:100,ExtraLight:100,Light:100,Normal:200,Medium:300,SemiBold:400,Bold:500,ExtraBold:500,Black:500}},"zh-CN":{name:"Noto Sans SC",href:"https://fonts.googleapis.com/earlyaccess/notosanssc.css",fontWeights:{Thin:100,ExtraLight:100,Light:100,Normal:300,Medium:400,SemiBold:400,Bold:400,ExtraBold:500,Black:500}},"zh-TW":{name:"Noto Sans TC",href:"https://fonts.googleapis.com/earlyaccess/notosanstc.css",fontWeights:{Thin:100,ExtraLight:100,Light:100,Normal:300,Medium:400,SemiBold:400,Bold:400,ExtraBold:500,Black:500}}},a={};this.init=((e="config")=>{let s=t.helper.model.getData("a/styles");(a="default"!==e&&s.fontFamily&&"default"!==s.fontFamily?{name:s.fontFamily}:this.getDefaultFontInfo()).fontWeights=this.getFontWeights(a.name)}),this.isLoaded=(()=>!!a.name),this.getFontInfo=(()=>a),this.getFontWeights=(e=>{let a=t.helper.i18n.getLanguage(),l={};return s[a]&&void 0===s[a].name&&(s[a].name=s.general.name),Object.entries(s.custom.fontWeights).forEach(([t,r])=>{s[a]&&s[a].fontWeights&&s[a].fontWeights[t]&&s[a].name===e?r=s[a].fontWeights[t]:s.general.fontWeights[t]&&s.general.name===e&&(r=s.general.fontWeights[t]),l["fontWeight"+t]=r}),l}),this.addStylesheet=(t=>{a.href&&e("<link />").attr({rel:"stylesheet",type:"text/css",href:a.href}).appendTo(t.find("head"))}),this.getDefaultFontInfo=(()=>{let e=t.helper.i18n.getLanguage();return s[e]&&s[e].name&&s[e].href?Object.assign({},s[e]):Object.assign({},s.general)})},window.I18nHelper=function(t){let s=null,a={},l=null,r={i18n:"data-i18n",i18nReplaces:"data-i18nReplaces"};this.init=(()=>new Promise(e=>{t.helper.model.call("langvars").then(t=>{s=t.language,a=t.vars,l=t.dir,e()})})),this.getLanguage=(()=>s),this.isRtl=(()=>"rtl"===l),this.getUILanguage=(()=>chrome.i18n.getUILanguage()),this.getDefaultLanguage=(()=>t.opts.manifest.default_locale),this.getLocaleSortCollator=(()=>new Intl.Collator([this.getUILanguage(),this.getDefaultLanguage()])),this.getLocaleDate=(e=>e.toLocaleDateString([this.getUILanguage(),this.getDefaultLanguage()],{year:"numeric",month:"2-digit",day:"2-digit"})),this.parseHtml=(t=>{e(t).find("["+r.i18n+"]").forEach(t=>{let s=null,a=e(t).attr(r.i18n);if(a){let l=[],o=e(t).attr(r.i18nReplaces);o&&(l=o.split(",")),s=this.get(a,l)}s?(e(t).removeAttr(r.i18n),e(t).html(s)):e(t).remove()})}),this.get=((e,t=[])=>{let s="",l=a[e];return l&&l.message&&(s=l.message,t.forEach((e,t)=>{s=s.replace(new RegExp("\\{"+(t+1)+"\\}"),e)}),s=s.replace(/\[b\](.*)\[\/b\]/,"<strong>$1</strong>"),s=s.replace(/\[a\](.*)\[\/a\]/,"<a href='#'>$1</a>"),s=s.replace(/\[em\](.*)\[\/em\]/,"<em>$1</em>")),s})},window.KeyboardHelper=function(t){let s=!1;this.init=(async()=>{l()}),this.initOverlayEvents=(s=>{e(s[0].contentDocument).on("keydown",e=>{if("Escape"===e.key||"Esc"===e.key)e.preventDefault(),t.helper.overlay.closeOverlay(!0);else if("Enter"===e.key){let t=s[0].contentDocument.activeElement;null!==t&&"TEXTAREA"===t.tagName||(e.preventDefault(),r(s))}else"Tab"===e.key&&(e.preventDefault(),n(s))})});let a=()=>{let e=!1;return t.elements.iframe.hasClass(t.opts.classes.page.visible)&&document&&document.activeElement&&(e=document.activeElement===t.elements.iframe[0]),e},l=()=>{e([document,t.elements.iframe[0].contentDocument]).on("keydown.bs",e=>{if(a()){let s=["ArrowDown","ArrowUp","PageDown","PageUp","Home","End","Space"],a=t.elements.sidebar.find("div."+t.opts.classes.contextmenu.wrapper).length()>0,l=t.elements.iframeBody.hasClass(t.opts.classes.drag.isDragged);if(s.indexOf(e.key)>-1||s.indexOf(e.code)>-1)t.helper.scroll.focus();else if("Tab"===e.key)e.preventDefault(),a?d():p();else if("Enter"===e.key)e.preventDefault(),a?o():i(e.shiftKey,e.ctrlKey||e.metaKey);else if("Escape"===e.key||"Esc"===e.key)e.preventDefault(),l?t.helper.dragndrop.cancel():a?t.helper.contextmenu.close():t.helper.toggle.closeSidebar();else if("Delete"===e.key)e.preventDefault(),c();else if("c"===e.key&&(e.ctrlKey||e.metaKey))e.preventDefault(),h();else{let e=t.elements.header.find("div."+t.opts.classes.sidebar.searchBox+" > input[type='text']");e[0]!==t.elements.iframe[0].contentDocument.activeElement&&e[0].focus()}}}).on("keyup.bs",()=>{if(a()){let e=t.elements.header.find("div."+t.opts.classes.sidebar.searchBox+" > input[type='text']");e&&e.length()>0&&e[0].value.length>0&&!t.elements.header.hasClass(t.opts.classes.sidebar.searchVisible)&&(t.helper.contextmenu.close(),t.helper.tooltip.close(),t.elements.header.addClass(t.opts.classes.sidebar.searchVisible))}})},r=e=>{let s=e.find("menu["+t.opts.attr.name+"='select'] > a."+t.opts.classes.sidebar.hover);s.length()>0?s.trigger("click"):t.helper.overlay.performAction()},o=()=>{let e=t.elements.sidebar.find("div."+t.opts.classes.contextmenu.wrapper).find("a."+t.opts.classes.sidebar.hover);e.length()>0&&e.trigger("click")},i=(e,s)=>{Object.values(t.elements.bookmarkBox).some(a=>{if(a.hasClass(t.opts.classes.sidebar.active)){let l=a.find("ul > li > a."+t.opts.classes.sidebar.hover+", ul > li > a."+t.opts.classes.sidebar.mark);if(l.length()>0)if(e){let e="list";l.hasClass(t.opts.classes.sidebar.separator)&&(e="separator"),t.helper.contextmenu.create(e,l)}else t.helper.sidebarEvents.handleEntryClick(l,{ctrlKey:s});return!0}})},n=s=>{let a=s.find("menu["+t.opts.attr.name+"='select'] > a."+t.opts.classes.sidebar.hover),l=s[0].contentDocument;if(a.length()>0){let e=null;e=a.next("a").length()>0?a.next("a"):s.find("menu["+t.opts.attr.name+"='select'] > a").eq(0),s.find("menu["+t.opts.attr.name+"='select'] > a."+t.opts.classes.sidebar.hover).removeClass(t.opts.classes.sidebar.hover),e.addClass(t.opts.classes.sidebar.hover)}else if("INPUT"===l.activeElement.tagName){let t=e(l.activeElement).parent("li"),a=null;(a=t.length()>0&&t.next("li").length()>0?t.next("li").find("input"):s.find("input").eq(0))[0].focus()}else s.find("input").length()>0?s.find("input")[0].focus():s.find("menu["+t.opts.attr.name+"='select']").length()>0&&s.find("menu["+t.opts.attr.name+"='select'] > a").eq(0).addClass(t.opts.classes.sidebar.hover)},d=()=>{let e=t.elements.sidebar.find("div."+t.opts.classes.contextmenu.wrapper),s=null,a=null;e.find("a."+t.opts.classes.sidebar.hover).length()>0&&(a=e.find("a."+t.opts.classes.sidebar.hover).eq(0)),s=null===a?e.find("a").eq(0):a.parent("li").next("li").length()>0?a.parent("li").next("li").find("a"):a.parents("ul").eq(0).next("ul").length()>0?a.parents("ul").eq(0).next("ul").find("a").eq(0):e.find("a").eq(0),e.find("a."+t.opts.classes.sidebar.hover).removeClass(t.opts.classes.sidebar.hover),s.addClass(t.opts.classes.sidebar.hover)},p=()=>{Object.values(t.elements.bookmarkBox).some(s=>{if(s.hasClass(t.opts.classes.sidebar.active)){let a=t.helper.scroll.getScrollPos(s),l=null;if(s.find("ul > li > a."+t.opts.classes.sidebar.mark).length()>0?l=s.find("ul > li > a."+t.opts.classes.sidebar.mark).eq(0).parent("li"):s.find("ul > li > a."+t.opts.classes.sidebar.hover).length()>0?l=s.find("ul > li > a."+t.opts.classes.sidebar.hover).eq(0).parent("li"):s.find("ul > li > a."+t.opts.classes.sidebar.lastHover).length()>0?l=s.find("ul > li > a."+t.opts.classes.sidebar.lastHover).eq(0).parent("li"):s.find("ul > li").forEach(t=>{if(t.offsetTop>=a)return l=e(t),!1}),l){let e=l.children("a"),r=null;if(e.hasClass(t.opts.classes.sidebar.hover)||e.hasClass(t.opts.classes.sidebar.mark))if(e.hasClass(t.opts.classes.sidebar.dirOpened)&&e.next("ul").length()>0)r=e.next("ul").find("> li:first-child > a");else if(l.next("li").length()>0)r=l.next("li").children("a");else{let e=!1,t=0;for(;!1===e;){let s=l.parents("li").eq(t);s.length()>0?s.next("li").length()>0?(r=s.next("li").children("a"),e=!0):t++:e=!0}}else r=e;if(r){s.find("ul > li > a."+t.opts.classes.sidebar.hover).removeClass(t.opts.classes.sidebar.hover),s.find("ul > li > a."+t.opts.classes.sidebar.mark).removeClass(t.opts.classes.sidebar.mark),r.addClass([t.opts.classes.sidebar.hover,t.opts.classes.sidebar.lastHover]);let e=r[0].offsetTop-a,l=window.innerHeight-e;e<0?t.helper.scroll.setScrollPos(s,r[0].offsetTop):l<150&&t.helper.scroll.setScrollPos(s,a+(150-l))}}return!0}})},c=()=>{s||(s=!0,Object.values(t.elements.bookmarkBox).some(e=>{if(e.hasClass(t.opts.classes.sidebar.active)){let a=e.find("> ul a."+t.opts.classes.sidebar.hover).eq(0);return a.length()>0&&0===a.children("span."+t.opts.classes.sidebar.removeMask).length()&&t.helper.bookmark.removeEntry(a.attr(t.opts.attr.id)).then(()=>{s=!1}),!0}}))},h=()=>{Object.values(t.elements.bookmarkBox).some(s=>{if(s.hasClass(t.opts.classes.sidebar.active)){let a=s.find("> ul a."+t.opts.classes.sidebar.hover).eq(0);if(a.length()>0){let s=t.helper.entry.getData(a.attr(t.opts.attr.id));if(s&&s.url&&t.helper.utility.copyToClipboard(s.url)){e(a).children("span."+t.opts.classes.sidebar.copied).remove();let s=e("<span />").addClass(t.opts.classes.sidebar.copied).text(t.helper.i18n.get("sidebar_copied_to_clipboard")).appendTo(a);e.delay(100).then(()=>(e(a).addClass(t.opts.classes.sidebar.copied),e.delay(1500))).then(()=>(e(a).removeClass(t.opts.classes.sidebar.copied),e.delay(500))).then(()=>{s.remove()})}}return!0}})}},window.ListHelper=function(t){let s=0,a=null;this.init=(async()=>{t.elements.bookmarkBox.all.addClass(t.opts.classes.sidebar.active),Object.values(t.elements.bookmarkBox).forEach(e=>{e.on(t.opts.events.scrollBoxLastPart,()=>{let s=e.children("ul"),a=s.data("remainingEntries");a&&a.length>0&&(this.addBookmarkDir(a,s,!1,!1),(t.refreshRun||!1===t.elements.iframe.hasClass(t.opts.classes.page.visible))&&t.helper.scroll.restoreScrollPos(e))})}),this.updateBookmarkBox()}),this.getSortList=(()=>({custom:{dir:"ASC"},alphabetical:{dir:"ASC"},mostUsed:{dir:"DESC"},recentlyUsed:{dir:"DESC"},recentlyAdded:{dir:"DESC"}})),this.getSort=(()=>a),this.updateSort=((e,s)=>{let l=this.getSortList();l[e]&&(void 0===s&&(s=l[e].dir),a={name:e,dir:"ASC"===s?"ASC":"DESC"},t.startLoading(),Promise.all([t.helper.model.call("removeCache",{name:"htmlList"}),t.helper.model.call("removeCache",{name:"htmlPinnedEntries"}),t.helper.model.setData({"u/sort":a})]).then(()=>{t.helper.model.call("trackEvent",{category:"sorting",action:"change",label:a.name+"_"+a.dir}),t.helper.model.call("reload",{scrollTop:!0,type:"Sort"})}))}),this.updateDirection=(e=>{this.updateSort(a.name,e)}),this.updateBookmarkBox=(()=>new Promise(e=>{t.startLoading(),a=t.helper.model.getData("u/sort"),t.elements.sidebar.attr(t.opts.attr.sort,a.name);let s=t.elements.bookmarkBox.all.children("ul"),l=null;t.updateBookmarkBoxStart=+new Date,l=t.helper.model.getData("u/viewAsTree")||"custom"===a.name?Promise.all([t.helper.model.call("getCache",{name:"htmlList"}),t.helper.model.call("getCache",{name:"htmlPinnedEntries"})]):new Promise(e=>{e()}),t.helper.scroll.focus(),l.then(e=>e&&e[0]&&e[0].val?(e[1]&&e[1].val?(t.elements.pinnedBox.html(e[1].val),t.helper.model.getData("u/lockPinned")&&(t.elements.lockPinned.addClass(t.opts.classes.sidebar.fixed),t.elements.pinnedBox.addClass(t.opts.classes.sidebar.fixed))):t.elements.pinnedBox.addClass(t.opts.classes.sidebar.hidden),d(s,e[0].val)):p(s)).then(()=>{e()})})),this.toggleBookmarkDir=((s,a,l=!0)=>new Promise(r=>{s.addClass(t.opts.classes.sidebar.dirAnimated);let o=s.attr(t.opts.attr.id),n=s.next("ul"),d=n.length()>0,p=!0===t.refreshRun||!1===t.elements.iframe.hasClass(t.opts.classes.page.visible);void 0===a&&(a=p||!1===t.helper.model.getData("b/animations"));let c=()=>{"nothing"!==t.helper.model.getData("b/rememberState")&&l&&!p?this.cacheList().then(r):r()};s.hasClass(t.opts.classes.sidebar.dirOpened)&&d?i(s,n,!1,a).then(c):(t.helper.model.getData("b/dirAccordion")&&t.elements.bookmarkBox.all.find("a."+t.opts.classes.sidebar.dirOpened).forEach(s=>{0===e(s).next("ul").find("a["+t.opts.attr.id+"='"+o+"']").length()&&this.toggleBookmarkDir(e(s),a,!1)}),d?i(s,n,!0,a).then(c):t.helper.model.call("bookmarks",{id:o}).then(t=>{t.bookmarks&&t.bookmarks[0]&&t.bookmarks[0].children&&(n=e("<ul />").insertAfter(s),this.addBookmarkDir(t.bookmarks[0].children,n),i(s,n,!0,a).then(c))}))})),this.cacheList=(()=>(t.log("CACHE"),Promise.all([t.helper.model.call("setCache",{name:"htmlList",val:t.elements.bookmarkBox.all.children("ul").html()}),t.helper.model.call("setCache",{name:"htmlPinnedEntries",val:t.elements.pinnedBox.html()})]))),this.updateSidebarHeader=(()=>{t.elements.header.text("");let s=t.helper.entry.getAmount("bookmarks"),a=e("<h1 />").html("<strong>"+s+"</strong> <span>"+t.helper.i18n.get("header_bookmarks"+(1===s?"_single":""))+"</span>").attr("title",s+" "+t.helper.i18n.get("header_bookmarks"+(1===s?"_single":""))).appendTo(t.elements.header),l=[];l.push(e("<a />").addClass(t.opts.classes.sidebar.search).appendTo(t.elements.header)),l.push(e("<a />").addClass(t.opts.classes.sidebar.sort).appendTo(t.elements.header)),l.push(e("<a />").addClass(t.opts.classes.sidebar.menu).appendTo(t.elements.header)),["label","amount"].forEach(e=>{let s=null;l.some(l=>{if(null===s)s=l[0].offsetTop;else if(s!==l[0].offsetTop||0===a[0].offsetTop)return"label"===e?a.children("span").addClass(t.opts.classes.sidebar.hidden):"amount"===e&&a.addClass(t.opts.classes.sidebar.hidden),!0})}),e("<div />").addClass(t.opts.classes.sidebar.searchBox).append("<input type='text' placeholder='"+t.helper.i18n.get("sidebar_search_placeholder").replace(/'/g,"&#x27;")+"' />").append("<a class='"+t.opts.classes.sidebar.searchClose+"'></a>").appendTo(t.elements.header)}),this.restoreOpenStates=(a=>{let l=!1,r=t.helper.model.getData(["b/rememberState","u/openStates"]),o=()=>{l||0!==s||e.delay(100).then(()=>{c()})};"all"!==r.rememberState&&"openStatesAndPos"!==r.rememberState&&"openStates"!==r.rememberState&&"openStatesRoot"!==r.rememberState||Object.keys(r.openStates).forEach(e=>{if(!0===r.openStates[e]){let i=a.find("> li > a."+t.opts.classes.sidebar.bookmarkDir+"["+t.opts.attr.id+"='"+e+"']");i.length()>0&&("openStatesRoot"===r.rememberState&&1!==i.parents("ul").length()||(l=!0,s++,this.toggleBookmarkDir(i).then(()=>{s--,l=!1,o()})))}}),o()}),this.updateSortFilter=(()=>{t.elements.filterBox.removeClass(t.opts.classes.sidebar.hidden).text("");let s=0;if("custom"===a.name)t.elements.filterBox.addClass(t.opts.classes.sidebar.hidden);else{let l=t.helper.model.getData(["u/viewAsTree","u/mostViewedPerMonth"]),r=a.name.replace(/([A-Z])/g,"_$1").toLowerCase();e("<a />").attr(t.opts.attr.direction,a.dir).text(t.helper.i18n.get("sort_label_"+r)).appendTo(t.elements.filterBox);let o=e("<ul />").appendTo(t.elements.filterBox);t.elements.bookmarkBox.search.hasClass(t.opts.classes.sidebar.active)||e("<li />").append(t.helper.checkbox.get(t.elements.iframeBody,{[t.opts.attr.name]:"viewAsTree",checked:l.viewAsTree?"checked":""})).append("<a>"+t.helper.i18n.get("sort_view_as_tree")+"</a>").appendTo(o),"mostUsed"===a.name&&e("<li />").append(t.helper.checkbox.get(t.elements.iframeBody,{[t.opts.attr.name]:"mostViewedPerMonth",checked:l.mostViewedPerMonth?"checked":""})).append("<a>"+t.helper.i18n.get("sort_most_used_per_month")+"</a>").appendTo(o),0===o.children("li").length()&&o.remove(),s=t.elements.filterBox.realHeight()}Object.values(t.elements.bookmarkBox).forEach(e=>{e.css("padding-top",s)}),t.elements.pinnedBox.css("top",t.helper.model.getData("u/lockPinned")?-s:0)}),this.addBookmarkDir=((e,s,i=!0,n=!0)=>{let d=!1,p=i&&"custom"===a.name&&s.prev("a").length()>0,c=t.helper.model.getData(["a/showBookmarkIcons","a/showDirectoryIcons","b/dirOpenDuration","u/showHidden"]);0===s.parents("li").length()?t.elements.bookmarkBox.search.hasClass(t.opts.classes.sidebar.active)||l(c):s.css("transition","height "+c.dirOpenDuration+"s");let h=0;return s.removeData("remainingEntries"),n&&o(e),e.some((a,l)=>{if((c.showHidden||t.helper.entry.isVisible(a.id))&&(a.children||a.url)&&(t.opts.demoMode&&(a.children?a.title="Directory "+(l+1):(a.title="Bookmark "+(l+1),a.url="https://example.com/")),(!1===t.helper.entry.isSeparator(a.id)||p)&&r(a,s,{config:c,asTree:i}),a.url&&h++,d=!0,!1===i&&h>=100)){let t=e.slice(100);return t.length>0&&s.data("remainingEntries",t),!0}}),d});let l=s=>{t.elements.lockPinned.removeClass(t.opts.classes.sidebar.fixed),t.elements.pinnedBox.removeClass([t.opts.classes.sidebar.hidden,t.opts.classes.sidebar.fixed]),t.elements.pinnedBox.children("ul").remove();let a=t.helper.entry.getAllPinnedData();if(0===a.length)t.elements.pinnedBox.addClass(t.opts.classes.sidebar.hidden);else{o(a);let l=e("<ul />").appendTo(t.elements.pinnedBox);t.helper.model.getData("u/lockPinned")&&(t.elements.lockPinned.addClass(t.opts.classes.sidebar.fixed),t.elements.pinnedBox.addClass(t.opts.classes.sidebar.fixed)),a.forEach((e,a)=>{(s.showHidden||t.helper.entry.isVisible(e.id))&&r(e,l,{config:s,asTree:!1})})}},r=(s,a,l)=>{let r=e("<li />").appendTo(a),o=s.title&&s.title.trim().length?s.title:"",i=e("<a />").appendTo(r),n=e("<span />").addClass(t.opts.classes.sidebar.bookmarkLabel).text(o.trim()).appendTo(i);e("<span />").addClass(t.opts.classes.drag.trigger).appendTo(i);return s.id&&i.attr(t.opts.attr.id,s.id),!1===t.helper.entry.isVisible(s.id)&&r.addClass(t.opts.classes.sidebar.hidden),t.helper.entry.isSeparator(s.id)?(i.addClass(t.opts.classes.sidebar.separator),n.text("")):s.children&&l.asTree?(i.addClass(t.opts.classes.sidebar.bookmarkDir),l.config.showDirectoryIcons&&i.prepend("<span class='"+t.opts.classes.sidebar.dirIcon+"' />")):s.url&&(i.addClass(t.opts.classes.sidebar.bookmarkLink),l.config.showBookmarkIcons&&(t.opts.demoMode?i.prepend("<span class='"+t.opts.classes.sidebar.dirIcon+"' data-color='"+(Math.floor(10*Math.random())+1)+"' />"):t.helper.model.call("favicon",{url:s.url}).then(e=>{if(e.img){let s=t.elements.iframe.hasClass(t.opts.classes.page.visible);i.prepend("<img "+(s?"src":t.opts.attr.src)+"='"+e.img+"' />")}}))),r},o=e=>{if(e.length>1){let s=t.helper.i18n.getLocaleSortCollator(),l=(t,s)=>{e.sort((e,l)=>{let r=!!e.children,o=!!l.children;return"custom"!==a.name&&r!==o?r?-1:1:(t===a.dir?1:-1)*s(e,l)})};switch(a.name){case"custom":l("ASC",(e,t)=>e.index-t.index);break;case"alphabetical":l("ASC",(e,t)=>s.compare(e.title,t.title));break;case"recentlyAdded":l("DESC",(e,t)=>t.dateAdded-e.dateAdded);break;case"mostUsed":{let e=t.helper.model.getData("u/mostViewedPerMonth");l("DESC",(a,l)=>{let r=t.helper.entry.getData(a.id),o=t.helper.entry.getData(l.id),i=r?r.views[e?"perMonth":"total"]:0,n=o?o.views[e?"perMonth":"total"]:0;return i===n?s.compare(a.title,l.title):n-i});break}case"recentlyUsed":l("DESC",(e,a)=>{let l=t.helper.entry.getData(e.id),r=t.helper.entry.getData(a.id),o=l?l.views.lastView:0,i=r?r.views.lastView:0;return o===i?s.compare(e.title,a.title):i-o})}}},i=(s,a,l,r)=>new Promise(o=>{if(a.css("height",a[0].scrollHeight+"px"),!1===l&&e.delay(0).then(()=>{a.css("height",0)}),!0===t.refreshRun)this.restoreOpenStates(a);else{let e=t.helper.model.getData("u/openStates");e[s.attr(t.opts.attr.id)]=l,!1===l?n(s,e):t.helper.model.setData({"u/openStates":e})}let i=t.helper.model.getData("b/dirOpenDuration");e.delay(r?0:1e3*+i).then(()=>{!1===l?s.removeClass(t.opts.classes.sidebar.dirOpened):(s.addClass(t.opts.classes.sidebar.dirOpened),t.helper.model.getData("b/dirAccordion")&&!1===t.refreshRun&&t.helper.scroll.getScrollPos(t.elements.bookmarkBox.all)>s[0].offsetTop&&t.helper.scroll.setScrollPos(t.elements.bookmarkBox.all,s[0].offsetTop,300)),a.css("height",""),s.removeClass(t.opts.classes.sidebar.dirAnimated),o()})}),n=(s,a)=>{s.next("ul").find("a."+t.opts.classes.sidebar.bookmarkDir).forEach(s=>{a[e(s).attr(t.opts.attr.id)]=!1,e.delay(500).then(()=>{e(s).removeClass(t.opts.classes.sidebar.dirOpened)})}),t.helper.model.setData({"u/openStates":a})},d=(e,s)=>new Promise(a=>{t.log("LOAD FROM CACHE"),e.html(s),e.find("a."+t.opts.classes.sidebar.mark).removeClass(t.opts.classes.sidebar.mark),e.find("a."+t.opts.classes.sidebar.hover).removeClass(t.opts.classes.sidebar.hover),e.find("a."+t.opts.classes.sidebar.lastHover).removeClass(t.opts.classes.sidebar.lastHover),t.elements.bookmarkBox.all.addClass(t.opts.classes.sidebar.cached),this.updateSidebarHeader(),this.updateSortFilter(),1===e.children("li").length()&&e.addClass(t.opts.classes.sidebar.hideRoot),c(),a()}),p=e=>new Promise(s=>{t.log("LOAD FROM OBJECT");let l=[],r=t.helper.model.getData("u/viewAsTree");t.elements.bookmarkBox.all.removeClass(t.opts.classes.sidebar.cached),t.helper.model.call("bookmarks",{id:0}).then(s=>(t.refreshRun=!0,e.removeClass(t.opts.classes.sidebar.hideRoot).text(""),s.bookmarks&&s.bookmarks[0]&&s.bookmarks[0].children&&(l=s.bookmarks[0].children),t.helper.entry.init(l))).then(()=>{this.updateSidebarHeader(),r||"custom"===a.name?(this.addBookmarkDir(l,e,!0),1===e.children("li").length()?(e.addClass(t.opts.classes.sidebar.hideRoot),this.toggleBookmarkDir(e.find("> li > a."+t.opts.classes.sidebar.bookmarkDir).eq(0))):this.restoreOpenStates(e)):(this.addBookmarkDir(t.helper.entry.getAllBookmarkData(),e,!1),c()),this.updateSortFilter(),s()})}),c=()=>{t.helper.scroll.restoreScrollPos(t.elements.bookmarkBox.all).then(()=>{t.initImages(),t.endLoading(200),t.firstRun=!1,t.refreshRun=!1,!t.helper.model.getData("u/viewAsTree")&&"custom"!==a.name||t.elements.bookmarkBox.all.hasClass(t.opts.classes.sidebar.cached)||this.cacheList(),t.loaded()})}},window.ModelHelper=function(e){let t={textColor:{light:"#646464",dark:"#c8c8c8"},sidebarMaskColor:{light:"rgba(255,255,255,0.8)",dark:"rgba(0,0,0,0.6)"},hoverColor:{light:"#f5f5f5",dark:"#555555"},colorScheme:{light:"#1b82f1",dark:"#1f4d80"},foregroundColor:{light:"#ffffff",dark:"#333333"}},s={u:{openStates:{},hiddenEntries:{},additionalInfo:{},scrollPos:{},separators:{},customCss:"",pinnedEntries:{},lockPinned:!0,translationHelp:!0,performReopening:!1,entryAmounts:{},lastOpened:null,sort:{name:"custom",dir:"ASC"},mostViewedPerMonth:!1,viewAsTree:!0},b:{animations:!0,preventPageScroll:!1,pxTolerance:{windowed:20,maximized:1},sidebarPosition:"left",openAction:"mousedown",newTab:"foreground",newTabPosition:"afterCurrent",linkAction:"current",dirAccordion:!1,reopenSidebar:!1,rememberState:"openStatesAndPos",tooltipDelay:1,tooltipContent:"all",dndOpen:!0,openChildrenWarnLimit:10,dirOpenDuration:.5,scrollBarHide:1.5,openDelay:0,closeTimeout:1},n:{override:!1,autoOpen:!0,searchEngine:"google",topPagesType:"topPages",shortcuts:[{label:"Google",url:"https://google.com"}],website:""},a:{showIndicator:!0,showIndicatorIcon:!0,darkMode:!1,highContrast:!1,showBookmarkIcons:!0,showDirectoryIcons:!0,styles:{colorScheme:t.colorScheme.light,foregroundColor:t.foregroundColor.light,textColor:t.textColor.light,hoverColor:t.hoverColor.light,indicatorWidth:"40px",indicatorIconSize:"32px",indicatorIconColor:"#ffffff",indicatorColor:"rgba(0,0,0,0.5)",sidebarWidth:"350px",sidebarHeaderHeight:"50px",sidebarMaskColor:t.sidebarMaskColor.light,bookmarksFontSize:"14px",directoriesIconSize:"16px",bookmarksIconSize:"16px",bookmarksLineHeight:"38px",bookmarksDirIcon:"dir-1",bookmarksDirColor:t.textColor.light,bookmarksDirIndentation:"25px",bookmarksHorizontalPadding:"16px",scrollBarWidth:"11px",tooltipFontSize:"9px",overlayMaskColor:"rgba(0,0,0,0.5)",overlayHeaderHeight:"50px",fontFamily:"default",iconShape:"bookmark",iconColor:"#555555"}}},a={},l=null,r={};this.init=(()=>new Promise(e=>{Promise.all([o(),i()]).then(e)}));let o=()=>new Promise(e=>{l&&l.disconnect(),(l=chrome.runtime.connect({name:"background"})).onMessage.addListener(e=>{r[e.uid]&&(r[e.uid](e.result),delete r[e.uid])}),e()}),i=()=>new Promise(e=>{let t=["utility","behaviour","appearance","newtab"],s={},l=t.length,r=0;t.forEach(t=>{chrome.storage["utility"===t?"local":"sync"].get([t],o=>{s[t]=o[t]||{},++r===l&&(a=s,e())})})});this.getAllData=(()=>a),this.getData=((t,l=!1)=>{let r=t;"string"==typeof r&&(r=[r]);let o={};if(r.forEach(t=>{let r=t.split("/")[0],i=t.split("/")[1],n=null,d=null;switch(r){case"u":d=a.utility;break;case"b":d=a.behaviour;break;case"a":d=a.appearance;break;case"n":d=a.newtab}null!==d&&(!0===l||void 0===d[i]?(["sidebarPosition","language"].some(e=>{if(t==="b/"+e)return null!==(n=this.getData("a/"+e))&&(r="__FOUND"),!0}),"n/autoOpen"===t&&null!==(n=this.getData("n/initialOpen"))&&(r="__FOUND"),"b/reopenSidebar"===t&&null!==(n=this.getData("b/autoOpen"))&&(r="__FOUND"),void 0!==s[r]&&void 0!==s[r][i]&&(n=s[r][i])):n=d[i]);let p=location.href.search(/chrome\-extension\:\/\//)>-1&&location.pathname.search(/settings\.html$/)>-1;if("b/pxTolerance"===t&&matchMedia("(min-resolution: 1.25dppx)").matches&&!1===p&&(n=Object.assign({},n),Object.keys(n).forEach(e=>{n[e]++})),"a/styles"===t&&(n=Object.assign({},s.a.styles,n),e.helper.font&&e.helper.font.isLoaded())){let t=e.helper.font.getFontInfo();n.fontFamily=t.name,Object.assign(n,t.fontWeights)}o[i]=n}),"string"==typeof t){let e=t.split("/")[1];o=o[e]}return o}),this.setData=(e=>new Promise(t=>{i().then(()=>{Object.keys(e).forEach(t=>{let s=t.split("/")[0],l=t.split("/")[1],r=e[t];switch(s){case"u":a.utility[l]=r;break;case"b":a.behaviour[l]=r;break;case"a":a.appearance[l]=r;break;case"n":a.newtab[l]=r}});let s=0,l=(e=1)=>{(s+=e)>=4&&t()};try{chrome.storage.local.set({utility:a.utility},()=>{l()}),chrome.storage.sync.set({behaviour:a.behaviour,appearance:a.appearance,newtab:a.newtab},()=>{chrome.runtime.lastError,l(3)})}catch(e){t()}})})),this.call=((e,t={})=>new Promise(s=>{t.type=e,t.uid=e+"_"+JSON.stringify(t)+"_"+ +new Date+Math.random().toString(36).substr(2,12),r[t.uid]=(e=>{s(e)}),l.postMessage(t)})),this.getDefaultColor=((e,s)=>t[e]?s&&t[e][s]?t[e][s]:t[e].light:null)},window.OverlayHelper=function(t){let s={};this.create=((l,r,u)=>{t.helper.tooltip.close();let b=t.helper.model.getData(["b/animations","a/darkMode","a/highContrast"]);s.overlay=e("<iframe />").attr("id",t.opts.ids.page.overlay).data("info",u||{}).appendTo("body"),t.helper.stylesheet.addStylesheets(["overlay"],s.overlay);let f=s.overlay.find("body");f.parent("html").attr("dir",t.helper.i18n.isRtl()?"rtl":"ltr"),s.modal=e("<div />").attr(t.opts.attr.type,l).addClass(t.opts.classes.overlay.modal).appendTo(f),!1===b.animations&&s.overlay.addClass(t.opts.classes.page.noAnimations),b.darkMode?f.addClass(t.opts.classes.page.darkMode):b.highContrast&&f.addClass(t.opts.classes.page.highContrast);let v=e("<header />").appendTo(s.modal);switch(e("<h1 />").text(r).appendTo(v),e("<a />").addClass(t.opts.classes.overlay.close).appendTo(v),s.buttonWrapper=e("<menu />").addClass(t.opts.classes.overlay.buttonWrapper).appendTo(s.modal),e("<a />").addClass(t.opts.classes.overlay.close).appendTo(s.buttonWrapper),a("infos"===l?"close":"cancel"),l){case"delete":n(u);break;case"edit":d(u);break;case"infos":m(u);break;case"add":h(u);break;case"hide":c(u);break;case"openChildren":p(u);break;case"updateUrls":g(u);break;case"keyboardShortcuts":o(u);break;case"shareInfoDesc":i(u)}s.overlay[0].focus(),s.modal.find("input").length()>0&&s.modal.find("input")[0].focus(),t.helper.keyboard.initOverlayEvents(s.overlay),t.helper.model.call("trackPageView",{page:"/overlay/"+l}),D(),e.delay(100).then(()=>{s.modal.addClass(t.opts.classes.overlay.visible),s.overlay.addClass(t.opts.classes.page.visible)})}),this.performAction=(()=>{let e=s.overlay.data("info");switch(s.modal.attr(t.opts.attr.type)){case"delete":v(e);break;case"hide":f(e);break;case"openChildren":b(e);break;case"edit":y(e);break;case"add":w(e);break;case"updateUrls":C()}}),this.closeOverlay=((a=!1,l="")=>{t.helper.model.call("checkUrls",{abort:!0}),t.elements.bookmarkBox.all.find("li."+t.opts.classes.drag.isDragged).remove(),s.overlay.removeClass(t.opts.classes.page.visible),t.helper.model.call("trackEvent",{category:"overlay",action:a?"cancel":"action",label:s.modal.attr(t.opts.attr.type)+l}),t.helper.scroll.focus(),e.delay(400).then(()=>{s.overlay.remove()})});let a=(e="close")=>{s.buttonWrapper.children("a."+t.opts.classes.overlay.close).text(t.helper.i18n.get("overlay_"+e))},l=a=>{if(a.additionalInfo&&a.additionalInfo.desc){let l=e("<div />").addClass(t.opts.classes.overlay.info).appendTo(s.modal);e("<h3 />").text(t.helper.i18n.get("overlay_bookmark_additional_info")).appendTo(l),e("<p />").text(a.additionalInfo.desc).appendTo(l)}},r=(a,l)=>{let r=e("<"+(a.isDir?"span":"a")+" />").attr("title",a.title).addClass(t.opts.classes.overlay.preview).text(a.title).appendTo(s.modal);a.isDir?r.prepend("<span class='"+t.opts.classes.sidebar.dirIcon+"' />"):t.opts.demoMode?r.prepend("<span class='"+t.opts.classes.sidebar.dirIcon+"' data-color='"+(Math.floor(10*Math.random())+1)+"' />"):t.helper.model.call("favicon",{url:a.url}).then(e=>{e.img&&r.prepend("<img src='"+e.img+"' />")}),l&&!0===l&&!0!==a.isDir&&e("<a />").addClass(t.opts.classes.overlay.previewUrl).attr("title",a.url).text(a.url).insertAfter(r)},o=l=>{let r=e("<div />").addClass(t.opts.classes.scrollBox.wrapper).appendTo(s.modal),o=e("<ul />").appendTo(r),i={tab:"&#8633;",shift:"&#8679;",cmd:"&#8984;",enter:"&#9166;"};Object.entries({tab:["tab"],enter:["enter"],shift_enter:["shift","enter"],ctrl_c:[navigator.platform.indexOf("Mac")>-1?"cmd":"ctrl","c"],del:["del"],esc:["esc"]}).forEach(([s,a])=>{a=a.map(e=>{let s="<i>";return s+=t.helper.i18n.get("keyboard_shortcuts_key_"+e)||e,i[e]&&(s+=" "+i[e]),s+="</i>"}),e("<li />").append("<strong>"+a.join("+")+"</strong>").append("<span>"+t.helper.i18n.get("keyboard_shortcuts_"+s+"_desc")+"</span>").appendTo(o)}),a("close")},i=l=>{s.modal.attr(t.opts.attr.value,l.type);let r=e("<div />").addClass(t.opts.classes.scrollBox.wrapper).appendTo(s.modal);"activity"===l.type?(e("<p />").html(t.helper.i18n.get("contribute_share_activity_desc1")).appendTo(r),e("<p />").html(t.helper.i18n.get("contribute_share_activity_examples_intro")).appendTo(r),e("<ul />").append("<li>"+t.helper.i18n.get("contribute_share_activity_example_1")+"</li>").append("<li>"+t.helper.i18n.get("contribute_share_activity_example_2")+"</li>").append("<li>"+t.helper.i18n.get("contribute_share_activity_example_3")+"</li>").append("<li>"+t.helper.i18n.get("contribute_share_activity_example_4")+"</li>").append("<li>"+t.helper.i18n.get("contribute_share_activity_example_5")+"</li>").appendTo(r),e("<p />").html(t.helper.i18n.get("contribute_share_activity_desc2")).appendTo(r)):"config"===l.type&&e("<p />").html(t.helper.i18n.get("contribute_share_config_desc")).appendTo(r),a("close")},n=a=>{e("<p />").text(t.helper.i18n.get("overlay_delete_"+(a.isDir?"dir":"bookmark")+"_confirm")).appendTo(s.modal),r(a),l(a),e("<a />").addClass(t.opts.classes.overlay.action).text(t.helper.i18n.get("overlay_delete")).appendTo(s.buttonWrapper)},d=a=>{r(a);let l=e("<ul />").appendTo(s.modal);e("<li />").append("<label>"+t.helper.i18n.get("overlay_bookmark_title")+"</label>").append("<input type='text' name='title' value='"+a.title.replace(/'/g,"&#x27;")+"' />").appendTo(l),a.isDir||e("<li />").append("<label>"+t.helper.i18n.get("overlay_bookmark_url")+"</label>").append("<input type='text' name='url' value='"+a.url.replace(/'/g,"&#x27;")+"' />").appendTo(l);let o=e("<li />").addClass(t.opts.classes.overlay.info).append("<label>"+t.helper.i18n.get("overlay_bookmark_additional_info")+"</label>").appendTo(l),i=e("<textarea name='info' />").appendTo(o);i[0].value=a.additionalInfo?a.additionalInfo.desc||"":"",o.append("<span>"+t.helper.i18n.get("settings_not_synced")+"</span>"),i.on("focus",()=>{o.addClass(t.opts.classes.sidebar.active)}).on("blur",()=>{o.removeClass(t.opts.classes.sidebar.active)}),e("<a />").addClass(t.opts.classes.overlay.action).text(t.helper.i18n.get("overlay_save")).appendTo(s.buttonWrapper)},p=a=>{let l=a.children.filter(e=>e.url&&"about:blank"!==e.url),o=t.helper.i18n.get("overlay_confirm_open_children",[l.length]);e("<p />").text(o).appendTo(s.modal),r(a),e("<a />").addClass(t.opts.classes.overlay.action).text(t.helper.i18n.get("overlay_open_children")).appendTo(s.buttonWrapper)},c=a=>{e("<p />").text(t.helper.i18n.get("overlay_hide_"+(a.isDir?"dir":"bookmark")+"_confirm")).appendTo(s.modal),r(a),l(a),e("<a />").addClass(t.opts.classes.overlay.action).text(t.helper.i18n.get("overlay_hide_from_sidebar")).appendTo(s.buttonWrapper)},h=a=>{let l=e("<a />").addClass(t.opts.classes.overlay.action).text(t.helper.i18n.get("overlay_save")).appendTo(s.buttonWrapper),r=e("<menu />").attr(t.opts.attr.name,"select").appendTo(s.modal),o=e("<a />").attr(t.opts.attr.type,"bookmark").attr("title",t.helper.i18n.get("overlay_label_bookmark")).appendTo(r);e("<a />").attr(t.opts.attr.type,"dir").attr("title",t.helper.i18n.get("overlay_label_dir")).appendTo(r),e("<a />").attr(t.opts.attr.type,"separator").attr("title",t.helper.i18n.get("overlay_label_separator")).appendTo(r),r.on("mouseleave",s=>{e(s.currentTarget).children("a").removeClass(t.opts.classes.sidebar.hover)}),r.children("a").on("mouseenter",s=>{r.children("a").removeClass(t.opts.classes.sidebar.hover),e(s.currentTarget).addClass(t.opts.classes.sidebar.hover)}).on("mouseleave",s=>{e(s.currentTarget).removeClass(t.opts.classes.sidebar.hover)}).on("click",o=>{o.preventDefault();let i=e(o.currentTarget).attr(t.opts.attr.type);if("separator"===i)x(a);else{let n=e("<ul />").appendTo(s.modal),d="",p="";"bookmark"===i&&(d=e(document).find("title").text(),p=location.href),a&&a.values&&(d=a.values.title||"",p=a.values.url||""),n.append("<li><h2>"+e(o.currentTarget).attr("title")+"</h2></li>"),n.append("<li><label>"+t.helper.i18n.get("overlay_bookmark_title")+"</label><input type='text' name='title' value='"+d.replace(/'/g,"&#x27;")+"' /></li>"),"bookmark"===i&&n.append("<li><label>"+t.helper.i18n.get("overlay_bookmark_url")+"</label><input type='text' name='url' value='"+p.replace(/'/g,"&#x27;")+"'  /></li>"),r.addClass(t.opts.classes.sidebar.hidden),r.children("a").removeClass(t.opts.classes.sidebar.hover),e.delay(a&&a.values?0:100).then(()=>{n.addClass(t.opts.classes.overlay.visible),n.find("input")[0].focus(),l.addClass(t.opts.classes.overlay.visible)})}}),a&&a.values&&o.trigger("click")},m=a=>{r(a,!0),l(a);let o=e("<ul />").appendTo(s.modal),i=new Date(a.dateAdded);if(e("<li />").html(t.helper.i18n.get("overlay_bookmark_created_date")+" "+t.helper.i18n.getLocaleDate(i)).appendTo(o),a.isDir){let s=e("<li />").addClass(t.opts.classes.overlay.hasTooltip).append("<span>"+a.childrenAmount.total+"</span>").append(" "+t.helper.i18n.get("overlay_dir_children"),!1).appendTo(o);e("<ul />").append("<li>"+a.childrenAmount.bookmarks+" "+t.helper.i18n.get("overlay_dir_children_bookmarks")+"</li>").append("<li>"+a.childrenAmount.directories+" "+t.helper.i18n.get("overlay_dir_children_dirs")+"</li>").appendTo(s)}let n=e("<li />").addClass(t.opts.classes.overlay.hasTooltip).append("<span>"+a.views.total+"</span>").append(" "+t.helper.i18n.get("overlay_bookmark_views"+(1===a.views.total?"_single":"")),!1).appendTo(o),d=new Date(a.views.startDate);e("<ul />").append("<li>"+t.helper.i18n.get("overlay_bookmark_views_since")+" "+t.helper.i18n.getLocaleDate(d)+"</li>").append("<li>"+a.views.perMonth+" "+t.helper.i18n.get("overlay_bookmark_views"+(1===a.views.perMonth?"_single":""))+" "+t.helper.i18n.get("overlay_bookmark_views_per_month")+"</li>").appendTo(n)},u=l=>{let r=l.length>0;e.delay(1e3).then(()=>(s.desc.remove(),s.progressBar.remove(),s.progressLabel.remove(),r&&s.modal.addClass(t.opts.classes.overlay.urlCheckList),e.delay(r?1e3:0))).then(()=>{if(s.loader.remove(),s.modal.removeClass(t.opts.classes.overlay.urlCheckLoading),a("close"),0===l.length)e("<p />").addClass(t.opts.classes.overlay.success).text(t.helper.i18n.get("overlay_check_urls_no_results")).appendTo(s.modal);else{e("<a />").addClass(t.opts.classes.overlay.action).text(t.helper.i18n.get("overlay_update")).appendTo(s.buttonWrapper);let a=t.helper.scroll.add(t.opts.ids.overlay.urlList,e("<ul />").appendTo(s.modal)),r=s.overlay.find("body");l.forEach(s=>{let l=e("<li />").data("entry",s).append(t.helper.checkbox.get(r,{checked:"checked"}));e("<strong />").text(s.title).appendTo(l),e("<a />").attr({href:s.url,title:s.url,target:"_blank"}).html("<span>"+s.url+"</span>").appendTo(l),404===s.urlStatusCode?e("<span />").text(t.helper.i18n.get("overlay_check_urls_not_found")).appendTo(l):s.newUrl!==s.url&&e("<a />").attr({href:s.newUrl,title:s.newUrl,target:"_blank"}).html("<span>"+s.newUrl+"</span>").appendTo(l),l=l.appendTo(a.children("ul")),t.helper.model.call("favicon",{url:s.url}).then(s=>{s.img&&e("<img src='"+s.img+"' />").insertAfter(l.children("div."+t.opts.classes.checkbox.box))})})}})},g=l=>{s.loader=t.helper.template.loading().appendTo(s.modal),s.desc=e("<p />").text(t.helper.i18n.get("overlay_check_urls_loading")).appendTo(s.modal),t.helper.model.call("websiteStatus").then(r=>{if("available"===r.status){let a=[],r=e=>{e.forEach(e=>{e.url?a.push(e):e.children&&r(e.children)})};r(l.children);let o=a.length;s.progressBar=e("<div />").addClass(t.opts.classes.overlay.progressBar).html("<div />").appendTo(s.modal),s.progressLabel=e("<span />").addClass(t.opts.classes.overlay.checkUrlProgressLabel).html("<span>0</span>/<span>"+o+"</span>").appendTo(s.modal),e.delay(500).then(()=>{s.modal.addClass(t.opts.classes.overlay.urlCheckLoading)});let i=0,n=[],d={},p=a=>{t.helper.model.call("checkUrls",{urls:a}).then(t=>{if(!t.error){let a=-1;Object.entries(t).forEach(([t,l])=>{e.delay(50*++a).then(()=>{i++,s.progressBar.children("div").css("width",i/o*100+"%"),s.progressLabel.children("span").eq(0).text(i),(404==+l.code||d[t].url!==l.url&&302!=+l.code)&&(d[t].newUrl=l.url,d[t].urlStatusCode=+l.code,n.push(d[t])),i===o&&u(n)})})}})},c=0,h={};a.forEach(e=>{c++,h[e.id]=e.url,d[e.id]=e,(Object.keys(h).length>=10||c===o)&&(p(h),h={})})}else s.loader.remove(),s.desc.remove(),e("<div />").addClass(t.opts.classes.overlay.inputError).append("<h3>"+t.helper.i18n.get("status_service_unavailable_headline")+"</h3>").append("<p>"+t.helper.i18n.get("status_check_urls_unavailable_desc")+"</p>").appendTo(s.modal),a("close")})},b=e=>{this.closeOverlay();let s=e.children.filter(e=>e.url&&"about:blank"!==e.url);t.helper.utility.openAllBookmarks(s)},f=e=>{t.startLoading(),this.closeOverlay();let s=t.helper.model.getData("u/hiddenEntries");s[e.id]=!0,t.helper.model.setData({"u/hiddenEntries":s}).then(()=>Promise.all([t.helper.model.call("removeCache",{name:"htmlList"}),t.helper.model.call("removeCache",{name:"htmlPinnedEntries"})])).then(()=>{t.helper.model.call("reload",{type:"Hide"})})},v=e=>{this.closeOverlay(),t.elements.bookmarkBox.all.find("a["+t.opts.attr.id+"='"+e.id+"']").parent("li").remove(),t.helper.bookmark.performDeletion(e)},k=e=>{let a=s.modal.find("input[name='title']").removeClass(t.opts.classes.overlay.inputError),l=s.modal.find("input[name='url']").removeClass(t.opts.classes.overlay.inputError),r=s.modal.find("textarea[name='info']"),o={errors:!1,values:{title:a[0].value.trim(),url:e?null:l[0].value.trim(),additionalInfo:r.length()>0?r[0].value||null:null}};return 0===o.values.title.length&&(a.addClass(t.opts.classes.overlay.inputError),o.errors=!0),e||0!==o.values.url.length||(l.addClass(t.opts.classes.overlay.inputError),o.errors=!0),null!==o.values.url&&0!==o.values.url.search(/^\w+\:\/\//)&&(o.values.url="http://"+o.values.url),o},y=e=>{let a=k(e.isDir);!1===a.errors&&t.helper.bookmark.editEntry({id:e.id,title:a.values.title,url:a.values.url,additionalInfo:a.values.additionalInfo}).then(([e])=>{e.error?s.modal.find("input[name='url']").addClass(t.opts.classes.overlay.inputError):(t.helper.model.call("trackEvent",{category:"extension",action:"edit",label:a.values.url?"bookmark":"directory"}),t.helper.model.call("reload",{type:"Edit"}),this.closeOverlay())})},x=e=>{console.log(e),t.helper.model.call("createBookmark",{title:"----------",url:"about:blank",parentId:e.id||null,index:0}).then(()=>{t.helper.model.call("trackEvent",{category:"extension",action:"add",label:"separator"}),this.closeOverlay(!1,"_separator")})},w=e=>{let a=k(0===s.modal.find("input[name='url']").length());if(!1===a.errors){let l={title:a.values.title,url:a.values.url,parentId:e.id||null,index:0};e&&e.values&&(e.values.index&&(l.index=e.values.index),e.values.parentId&&(l.parentId=e.values.parentId)),t.helper.model.call("createBookmark",l).then(e=>{e.error?s.modal.find("input[name='url']").addClass(t.opts.classes.overlay.inputError):(t.helper.model.call("trackEvent",{category:"extension",action:"add",label:l.url?"bookmark":"directory"}),this.closeOverlay(!1,"_"+(l.url?"bookmark":"directory")))})}},C=()=>{s.modal.find("div#"+t.opts.ids.overlay.urlList+" ul > li").forEach(s=>{if(e(s).find("input[type='checkbox']")[0].checked){let a=e(s).data("entry");404===a.urlStatusCode?t.helper.model.call("deleteBookmark",{id:a.id,preventReload:!0}):a.url!==a.newUrl&&t.helper.model.call("updateBookmark",{id:a.id,title:a.title,url:a.newUrl,preventReload:!0})}}),t.helper.model.call("reload",{type:"Update"}),this.closeOverlay()},D=()=>{s.overlay.find("body").on("click",e=>{"BODY"===e.target.tagName&&this.closeOverlay(!0)}),s.modal.find("a."+t.opts.classes.overlay.close).on("click",e=>{e.preventDefault(),this.closeOverlay(!0)}),s.modal.on("click","a."+t.opts.classes.overlay.action,e=>{e.preventDefault(),this.performAction()}),s.modal.on("focus","input",s=>{e(s.currentTarget).removeClass(t.opts.classes.overlay.inputError)}),s.modal.find("a."+t.opts.classes.overlay.preview+", a."+t.opts.classes.overlay.previewUrl).on("click",e=>{e.preventDefault(),t.helper.model.call("trackEvent",{category:"url",action:"open",label:"new_tab_overlay"}),t.helper.utility.openUrl(s.overlay.data("info"),"newTab")})}},window.ScrollHelper=function(t){let s=+new Date,a={},l=[],r=0;this.init=(()=>{let e=t.helper.model.getData("b/scrollBarHide");r=1e3*+e}),this.add=((s,a)=>{let r=e("<div id='"+s+"' class='"+t.opts.classes.scrollBox.wrapper+"' tabindex='0' />").insertBefore(a);return a=a.appendTo(r),r.data({list:a}),l.push(r),d(r),r}),this.focus=(()=>{t.elements.iframe.hasClass(t.opts.classes.page.visible)&&null!==t.elements.iframe[0].contentDocument&&t.elements.header.find("div."+t.opts.classes.sidebar.searchBox+" > input[type='text']")[0]!==t.elements.iframe[0].contentDocument.activeElement&&l.forEach(e=>{e.hasClass(t.opts.classes.sidebar.active)&&e[0].focus()})}),this.updateAll=(()=>{l.forEach(e=>{e.hasClass(t.opts.classes.sidebar.active)&&this.update(e)})}),this.restoreScrollPos=(s=>new Promise(a=>{let l=t.helper.model.getData(["b/rememberState","u/scrollPos"]);"all"===l.rememberState||"openStatesAndPos"===l.rememberState?(this.setScrollPos(s,l.scrollPos[s.attr("id")]||0),e.delay(100).then(a)):a()})),this.setScrollPos=((e,t,s=0)=>{if(0===s)e[0].scrollTop=t,this.update(e);else{let a=e[0].scrollTop,l=0,r=()=>{let o=(l+=1/60)/(s/1e3),i=Math.sin(o*(Math.PI/2));o<1?(window.requestAnimationFrame(r),e[0].scrollTop=a+(t-a)*i):(e[0].scrollTop=t,this.update(e))};r()}}),this.getScrollPos=(e=>e[0].scrollTop),this.update=(e=>{t.helper.contextmenu.close(),t.helper.tooltip.close(),i(e);let s=n(e),l=o(e),d=e[0].scrollTop;d>10?e.addClass(t.opts.classes.scrollBox.scrolled):e.removeClass(t.opts.classes.scrollBox.scrolled);let p=e.data("lastPos")||0;d>p?e.attr(t.opts.attr.direction,"down"):d<p?e.attr(t.opts.attr.direction,"up"):e.removeAttr(t.opts.attr.direction),e.data("lastPos",d),(l-d<2*s||l===d&&0===s)&&e.trigger(t.opts.events.scrollBoxLastPart),r>0&&(t.elements.iframe.hasClass(t.opts.classes.page.visible)?(e.removeClass(t.opts.classes.scrollBox.hideScrollbar),clearTimeout(a[e.attr("id")]),a[e.attr("id")]=setTimeout(()=>{e.addClass(t.opts.classes.scrollBox.hideScrollbar)},r)):e.addClass(t.opts.classes.scrollBox.hideScrollbar)),t.helper.scroll.focus()});let o=t=>{let s=0;return t.children().forEach(t=>{s+=e(t).realHeight(!0)}),s},i=e=>{if(!1===t.refreshRun&&+new Date-s>500){s=+new Date;let a=t.helper.model.getData("u/scrollPos");a[e.attr("id")]=e[0].scrollTop,t.helper.model.setData({"u/scrollPos":a})}},n=e=>e.realHeight()-parseInt(e.css("padding-top")),d=e=>{e.on("scroll",()=>{this.update(e)})}},window.SearchHelper=function(t){let s=null;this.init=(()=>{o()}),this.clearSearch=(()=>new Promise(e=>{t.helper.contextmenu.close(),t.helper.tooltip.close(),t.elements.header.removeClass(t.opts.classes.sidebar.searchVisible),a("").then(e)}));let a=(e=null)=>new Promise(s=>{let a=t.elements.header.find("div."+t.opts.classes.sidebar.searchBox+" > input[type='text']");null===e?e=a[0].value:a[0].value=e,e&&e.length>0?l(a,e).then(s):r(a).then(s)}),l=(s,a)=>new Promise(l=>{let r=t.firstRun;t.elements.bookmarkBox.all.removeClass(t.opts.classes.sidebar.active).removeClass(t.opts.classes.scrollBox.scrolled),t.elements.bookmarkBox.search.addClass(t.opts.classes.sidebar.active),t.helper.scroll.focus(),t.helper.list.updateSortFilter(),a!==s.data("lastVal")&&(t.startLoading(),s.data("lastVal",a),t.helper.entry.initOnce().then(()=>(t.helper.scroll.setScrollPos(t.elements.bookmarkBox.search,0),t.helper.model.call("searchBookmarks",{searchVal:a}))).then(s=>{t.elements.bookmarkBox.search.children("p").remove();let o=!1,i=t.elements.bookmarkBox.search.children("ul");i.text(""),s.bookmarks&&s.bookmarks.length>0&&(o=t.helper.list.addBookmarkDir(s.bookmarks,i,!1)),!1===o&&e("<p />").text(t.helper.i18n.get("sidebar_search_no_results")).appendTo(t.elements.bookmarkBox.search),r||t.helper.model.call("trackEvent",{category:"search",action:"search",label:"search",value:a.length}),t.endLoading(500),l()}))}),r=e=>new Promise(s=>{e.removeData("lastVal"),t.elements.bookmarkBox.search.hasClass(t.opts.classes.sidebar.active)&&(t.startLoading(),t.elements.bookmarkBox.all.addClass(t.opts.classes.sidebar.active),t.elements.bookmarkBox.search.removeClass(t.opts.classes.sidebar.active),t.helper.scroll.restoreScrollPos(t.elements.bookmarkBox.all),t.helper.scroll.focus(),t.endLoading()),t.helper.list.updateSortFilter(),s()}),o=()=>{t.elements.header.on("click","a."+t.opts.classes.sidebar.search,e=>{e.preventDefault(),e.stopPropagation(),t.helper.contextmenu.close(),t.helper.tooltip.close(),t.elements.header.addClass(t.opts.classes.sidebar.searchVisible),t.elements.header.find("div."+t.opts.classes.sidebar.searchBox+" > input[type='text']")[0].focus()}),t.elements.header.on("keyup","div."+t.opts.classes.sidebar.searchBox+" > input[type='text']",e=>{e.preventDefault(),s&&(clearTimeout(s),s=null),s=setTimeout(()=>{a()},500)}),t.elements.header.on("click","a."+t.opts.classes.sidebar.searchClose,e=>{e.preventDefault(),e.stopPropagation(),this.clearSearch()})}},window.SidebarEventsHelper=function(t){let s=null,a=null,l=!1;this.init=(async()=>{o(),r(),i(),n()}),this.handleEntryClick=((e,s)=>{let a=t.helper.entry.getData(e.attr(t.opts.attr.id));if(!a)return!1;let l=t.helper.model.getData(["b/newTab","b/linkAction"]),r=2===s.which||s.ctrlKey||s.metaKey;if(a.isDir&&!e.hasClass(t.opts.classes.sidebar.dirAnimated))if(r){let e=a.children.filter(e=>e.url&&"about:blank"!==e.url);e.length>t.helper.model.getData("b/openChildrenWarnLimit")?t.helper.overlay.create("openChildren",t.helper.i18n.get("contextmenu_open_children"),a):t.helper.utility.openAllBookmarks(e)}else t.helper.list.toggleBookmarkDir(e);else a.isDir||(r?t.helper.model.call("trackEvent",{category:"url",action:"open",label:"new_tab_middle_click"}):t.helper.model.call("trackEvent",{category:"url",action:"open",label:(2===s.which||"newtab"===l.linkAction?"new":"current")+"_tab_default"}),a.reopenSidebar=t.helper.model.getData("b/reopenSidebar"),r?t.helper.utility.openUrl(a,"newTab","background"===l.newTab&&"newtab"===l.linkAction):"newtab"===l.linkAction?t.helper.utility.openUrl(a,"newTab","foreground"===l.newTab):t.helper.utility.openUrl(a,"default",!0))});let r=async()=>{t.elements.filterBox.on("click","a["+t.opts.attr.direction+"]",s=>{s.preventDefault();let a="ASC"===e(s.target).attr(t.opts.attr.direction)?"DESC":"ASC";t.helper.list.updateDirection(a)}).on("click","div."+t.opts.classes.checkbox.box+" + a",s=>{s.preventDefault(),e(s.target).prev("div["+t.opts.attr.name+"]").trigger("click")})},o=async()=>{Object.values(t.elements.bookmarkBox).forEach((a,r)=>{let o=[a];0===r&&o.push(t.elements.pinnedBox),e(o).on("click mousedown","> ul a",s=>{s.preventDefault(),e(s.target).hasClass(t.opts.classes.drag.trigger)||e(s.target).hasClass(t.opts.classes.sidebar.separator)||e(s.target).parent().hasClass(t.opts.classes.sidebar.removeMask)||!(1===s.which&&"click"===s.type||2===s.which&&"mousedown"===s.type||t.refreshRun)||this.handleEntryClick(e(s.currentTarget),s)}).on("mouseover","> ul a",l=>{if(0===e("iframe#"+t.opts.ids.page.overlay).length()){let r=e(l.currentTarget),o=r.attr(t.opts.attr.id);a.find("a."+t.opts.classes.sidebar.hover).removeClass(t.opts.classes.sidebar.hover),a.find("a."+t.opts.classes.sidebar.lastHover).removeClass(t.opts.classes.sidebar.lastHover),r.hasClass(t.opts.classes.sidebar.mark)||r.addClass([t.opts.classes.sidebar.hover,t.opts.classes.sidebar.lastHover]),s&&clearTimeout(s),s=setTimeout(()=>{a.find("a["+t.opts.attr.id+"='"+o+"']").removeClass(t.opts.classes.sidebar.mark)},500),t.helper.tooltip.create(r)}}).on("contextmenu","> ul a",s=>{s.preventDefault();let a="list";e(s.target).hasClass(t.opts.classes.sidebar.separator)&&(a="separator"),e(s.currentTarget).removeClass(t.opts.classes.sidebar.mark),t.helper.contextmenu.create(a,e(s.currentTarget))}).on("mouseleave",s=>{t.helper.tooltip.close(),e(s.currentTarget).find("a."+t.opts.classes.sidebar.hover).removeClass(t.opts.classes.sidebar.hover)}).on("click","span."+t.opts.classes.sidebar.removeMask+" > span",s=>{s.preventDefault();let a=e(s.target).parents("a").eq(0);!1===l&&(l=!0,t.helper.bookmark.restoreEntry(a).then(()=>{l=!1}))})})},i=async()=>{let e=()=>{a&&clearTimeout(a)},s=()=>{e(),a=setTimeout(()=>{t.elements.lockPinned.removeClass(t.opts.classes.sidebar.active),t.helper.toggle.removeSidebarHoverClass()},500)};t.elements.pinnedBox.on("mouseenter",()=>{e(),t.elements.lockPinned.addClass(t.opts.classes.sidebar.active)}).on("mouseleave",()=>{s()}),t.elements.lockPinned.on("mouseenter",()=>{e()}).on("mouseleave",()=>{s()}).on("click",e=>{e.preventDefault(),e.stopPropagation(),t.elements.lockPinned.toggleClass(t.opts.classes.sidebar.fixed),t.elements.pinnedBox.toggleClass(t.opts.classes.sidebar.fixed);let s=t.elements.pinnedBox.hasClass(t.opts.classes.sidebar.fixed);t.helper.model.setData({"u/lockPinned":s}).then(()=>{!1===s&&(t.helper.scroll.setScrollPos(t.elements.bookmarkBox.all,0,200),t.elements.lockPinned.removeClass(t.opts.classes.sidebar.active)),t.helper.toggle.removeSidebarHoverClass(),t.helper.list.updateSortFilter()})})},n=async()=>{e(window).on("beforeunload.bs",()=>{t.elements.sidebar.hasClass(t.opts.classes.sidebar.openedOnce)&&t.helper.scroll.updateAll()}),t.elements.iframe.find("body").on("click",()=>{t.helper.contextmenu.close(),t.helper.tooltip.close()}),e(t.elements.iframe[0].contentDocument).on(t.opts.events.checkboxChanged,s=>{let a=s.detail.checkbox.attr(t.opts.attr.name);if("viewAsTree"===a||"mostViewedPerMonth"===a)t.helper.model.setData({["u/"+a]:s.detail.checked}).then(()=>{t.startLoading(),t.helper.model.call("reload",{scrollTop:!0,type:"Sort"})});else if("config"===a||"activity"===a){let s=!0;t.elements.iframeBody.find("div#"+t.opts.ids.sidebar.shareInfo+" input[type='checkbox']").forEach(a=>{let l=e(a).parent();if(!1===t.helper.checkbox.isChecked(l))return s=!1,!1}),s&&e.delay(300).then(()=>{d()})}}),chrome.extension.onMessage.addListener(s=>{if(s&&s.action&&(null===s.reinitialized||t.initialized>s.reinitialized))if("reload"===s.action){let a=!0;if(("Removed"===s.type||"Created"===s.type&&!0===l)&&Object.values(t.elements.bookmarkBox).some(e=>{if(e.hasClass(t.opts.classes.sidebar.active))return(e.find("a."+t.opts.classes.sidebar.restored).length()>0||e.find("span."+t.opts.classes.sidebar.removeMask).length()>0)&&(a=!1),!0}),a){let a=0;s.scrollTop&&(t.helper.scroll.setScrollPos(t.elements.bookmarkBox.all,0),a=100),t.needsReload=!0,e.delay(a).then(t.reload)}}else"toggleSidebar"===s.action&&(t.helper.model.call("clearNotWorkingTimeout"),t.elements.iframe.hasClass(t.opts.classes.page.visible)?t.helper.toggle.closeSidebar():t.helper.toggle.openSidebar())}),["menu","sort"].forEach(s=>{t.elements.header.on("click contextmenu","a."+t.opts.classes.sidebar[s],a=>{a.preventDefault(),a.stopPropagation(),t.helper.contextmenu.create(s,e(a.currentTarget))})}),t.elements.iframeBody.on("click","#"+t.opts.ids.sidebar.reloadInfo+" a",e=>{e.preventDefault(),location.reload(!0)}),t.elements.iframeBody.on("click","#"+t.opts.ids.sidebar.shareInfo+" a",s=>{s.preventDefault();let a=e(s.currentTarget).data("title");a?t.helper.overlay.create("shareInfoDesc",a,{type:e(s.currentTarget).data("type")}):d()})},d=()=>{let s={config:!1,activity:!1};t.elements.iframeBody.find("div#"+t.opts.ids.sidebar.shareInfo+" input[type='checkbox']").forEach(a=>{let l=e(a).parent(),r=l.attr(t.opts.attr.name);s[r]=t.helper.checkbox.isChecked(l)}),t.helper.model.call("updateShareInfo",s),t.elements.iframeBody.find("div#"+t.opts.ids.sidebar.shareInfo).addClass(t.opts.classes.sidebar.hidden)}},window.StylesheetHelper=function(t){let s={},a="";this.init=(()=>{s=t.helper.model.getData("a/styles"),a=t.helper.model.getData("u/customCss")}),this.addStylesheets=((l,r=null)=>{null===r?r=e(document):(t.helper.font.addStylesheet(r),t.opts.classes&&t.opts.classes.page&&!1===t.helper.model.getData("b/animations")&&t.opts.classes.page.noAnimations&&r.find("body").addClass(t.opts.classes.page.noAnimations));let o=null;o=0===r.find("head").length()?r.find("body"):r.find("head"),l.forEach(l=>{e.xhr(chrome.extension.getURL("css/"+l+".css")).then(e=>{if(e.response){let r=e.response;r+=a,Object.keys(s).forEach(e=>{r=r.replace(new RegExp('"?%'+e+'"?',"g"),s[e])}),t.opts.classes&&t.opts.classes.page&&t.opts.classes.page.style&&t.opts.attr&&t.opts.attr.name?(o.find("style."+t.opts.classes.page.style+"["+t.opts.attr.name+"='"+l+"']").remove(),o.append("<style class='"+t.opts.classes.page.style+"' "+t.opts.attr.name+"='"+l+"'>"+r+"</style>")):o.append("<style>"+r+"</style>")}})})})},window.TemplateHelper=function(t){this.loading=(()=>e('<svg class="loading" width="36px" height="36px" viewBox="0 0 36 36" xmlns="http://www.w3.org/2000/svg"><circle fill="none" stroke-width="3" stroke-linecap="round" cx="18" cy="18" r="16"></circle></svg>')),this.footer=(()=>{let t=e('<footer> <a id="copyright" href="https://extensions.blockbyte.de/" target="_blank">  &copy; <span class="created">2016</span>&ensp;<strong>Blockbyte</strong> </a></footer>'),s=+t.find("span.created").text(),a=(new Date).getFullYear();return a>s&&t.find("span.created").text(s+" - "+a),t})},window.ToggleHelper=function(t){let s=null,a=null,l=null,r=null,o=0,i=null,n=null,d=!1,p={},c=null;this.init=(async()=>{t.elements.indicator=e("<div />").attr("id",t.opts.ids.page.indicator).appendTo("body"),!1===t.helper.model.getData("b/animations")&&t.elements.indicator.addClass(t.opts.classes.page.noAnimations);let n=t.helper.model.getData(["b/pxTolerance","b/preventPageScroll","a/showIndicator","a/showIndicatorIcon","a/styles","b/sidebarPosition","b/openDelay","b/openAction","b/dndOpen","n/autoOpen","u/performReopening"]);l=n.pxTolerance,o=1e3*+n.openDelay,s=n.sidebarPosition,r=n.preventPageScroll,a=n.dndOpen,t.elements.indicator.css("width",h()+"px"),t.elements.iframe.attr(t.opts.attr.position,s),t.elements.sidebar.attr(t.opts.attr.position,s),n.styles&&n.styles.indicatorWidth&&(i=parseInt(n.styles.indicatorWidth)),n.showIndicator&&"icon"!==n.openAction&&"mousemove"!==n.openAction&&(t.elements.indicator.html("<div />").attr(t.opts.attr.position,s),n.showIndicatorIcon&&e("<span />").appendTo(t.elements.indicator.children("div")),e.delay(50).then(()=>{t.elements.indicator.addClass(t.opts.classes.page.visible)})),v(),m(),(g().startsWith("newtab_")&&n.autoOpen||n.performReopening)&&(this.openSidebar(),t.helper.model.setData({"u/performReopening":!1})),!1===u()&&t.elements.iframe.addClass(t.opts.classes.page.hideMask)}),this.closeSidebar=(()=>{t.elements.sidebar.hasClass(t.opts.classes.sidebar.permanent)||(f("close"),f("open"),t.helper.contextmenu.close(),t.helper.tooltip.close(),t.helper.dragndrop.cancel(),t.elements.iframe.removeClass(t.opts.classes.page.visible),e("body").removeClass(t.opts.classes.page.noscroll),e(document).trigger("mousemove.bs"))}),this.openSidebar=(()=>{!1===t.helper.utility.isBackgroundConnected()?(t.elements.iframe.addClass(t.opts.classes.page.visible),t.addReloadMask()):(t.helper.model.call("shareInfoMask").then(e=>{e&&e.showMask?t.addShareInfoMask():t.elements.sidebar.find("#"+t.opts.ids.sidebar.shareInfo).remove()}),t.elements.sidebar.hasClass(t.opts.classes.sidebar.openedOnce)||(t.trackInitialEvents(),t.elements.sidebar.addClass(t.opts.classes.sidebar.openedOnce),this.markLastUsed()),t.helper.model.call("trackPageView",{page:"/sidebar/"+g()}),t.elements.iframe.addClass(t.opts.classes.page.visible),t.initImages(),r&&e("body").addClass(t.opts.classes.page.noscroll),e.delay(t.helper.model.getData("b/animations")?300:0).then(()=>t.helper.entry.initOnce()).then(()=>{t.helper.scroll.focus()}),e(document).trigger("mousemove.bs"),t.helper.utility.triggerEvent("sidebarOpened"))}),this.markLastUsed=(()=>{let e=t.helper.model.getData(["u/lastOpened","b/rememberState"]);if("all"===e.rememberState&&e.lastOpened){let s=t.elements.bookmarkBox.all.find("ul > li > a["+t.opts.attr.id+"='"+e.lastOpened+"']");s&&s.length()>0&&(s.addClass(t.opts.classes.sidebar.mark),t.helper.model.setData({"u/lastOpened":null}))}}),this.addSidebarHoverClass=(()=>{t.elements.iframe.addClass(t.opts.classes.page.hover)}),this.removeSidebarHoverClass=(()=>{let e=t.elements.iframeBody.find("div."+t.opts.classes.contextmenu.wrapper),s=t.elements.iframeBody.find("div."+t.opts.classes.tooltip.wrapper);0!==e.length()||0!==s.length()||t.elements.iframeBody.hasClass(t.opts.classes.drag.isDragged)||t.elements.lockPinned.hasClass(t.opts.classes.sidebar.active)||t.elements.iframe.removeClass(t.opts.classes.page.hover)});let h=()=>l[t.helper.utility.isWindowed()?"windowed":"maximized"],m=async()=>{e(window).on("resize.bs",()=>{t.elements.indicator.css("width",h()+"px")}),t.elements.iframe.find("body").on("click",e=>{if(e.pageX){let a=e.pageX;"right"===s&&(a=u()?window.innerWidth-a+t.elements.sidebar.realWidth()-1:t.elements.iframe.realWidth()-a),a>t.elements.sidebar.realWidth()&&t.elements.iframe.hasClass(t.opts.classes.page.visible)&&this.closeSidebar()}}),e(document).on(t.opts.events.openSidebar+".bs",()=>{this.openSidebar()}),e(document).on("mousedown.bs click.bs",e=>{e.isTrusted&&t.elements.iframe.hasClass(t.opts.classes.page.visible)&&this.closeSidebar()}),e(window).on("keydown.bs",()=>{c=+new Date}).on("keyup.bs",()=>{c=null}),t.elements.sidebar.on("mouseleave",()=>{if(e.delay(100).then(()=>{this.removeSidebarHoverClass()}),0===e("iframe#"+t.opts.ids.page.overlay).length()&&!1===t.elements.iframeBody.hasClass(t.opts.classes.drag.isDragged)){let e=t.helper.model.getData("b/closeTimeout");-1!=+e&&(p.close=setTimeout(()=>{!1===t.elements.iframeBody.hasClass(t.opts.classes.drag.isDragged)&&this.closeSidebar()},1e3*+e))}}).on("mouseenter",()=>{this.addSidebarHoverClass(),f("close")}),e(document).on("visibilitychange.bs",()=>{document.hidden&&0===e("iframe#"+t.opts.ids.page.overlay).length()&&(t.elements.indicator.removeClass(t.opts.classes.page.hover),t.elements.iframe.hasClass(t.opts.classes.page.visible)&&this.closeSidebar())}).on("mouseout.bs",()=>{f("open")}).on("mousemove.bs",e=>{if(e.isTrusted&&b(e.pageX,e.pageY)){let e=+new Date-(n||0);p.indicator||(p.indicator=setTimeout(()=>{t.elements.indicator.addClass(t.opts.classes.page.hover)},Math.max(o-e,0)))}else f("indicator"),t.elements.indicator.removeClass(t.opts.classes.page.hover)},{passive:!0});let l=t.helper.model.getData("b/openAction");"icon"!==l&&e(document).on(l+".bs dragover.bs",e=>{let t=!1;t="dragover"===e.type?a:"mousedown"!==e.type||0===e.button,e.isTrusted&&t&&b(e.pageX,e.pageY)?(e.stopPropagation(),e.preventDefault(),"mousemove"===l?p.open||(p.open=setTimeout(()=>{this.openSidebar()},o)):(0===o||null===n||+new Date-n>o)&&this.openSidebar()):f("open")})},u=()=>{let e=g(),s=t.helper.model.getData("a/styles"),a=t.helper.model.getData("n/autoOpen"),l=s.sidebarMaskColor||null;return!(e.startsWith("newtab_")&&a||"onboarding"===e||"transparent"===l)},g=()=>{let e=location.href,t="other",s=!1,a={newtab_default:["https?://www.google..+/_/chrome/newtab"],newtab_replacement:[chrome.extension.getURL("html/newtab.html")],newtab_website:[".*[?&]bs_nt=1(&|#|$)"],website:["https?://"],onboarding:["chrome-extension://.*/intro.html"],chrome:["chrome://"],extension:["chrome-extension://"],local:["file://"]};return Object.keys(a).some(l=>{if(a[l].some(a=>{if(0===e.search(new RegExp(a,"gi")))return t=l,s=!0,!0}),s)return!0}),t},b=(e,a)=>{let l=!1;if(null!==c&&+new Date-c<500);else if(void 0!==e&&null!==e&&(e>0||a>0||d)){d=!0,"right"===s&&(e=window.innerWidth-e-1);let a=h();t.elements.indicator.hasClass(t.opts.classes.page.hover)&&i>a&&(a=i),l=e<a}return!1===l?n=null:null===n&&(n=+new Date),l},f=e=>{p[e]&&(clearTimeout(p[e]),p[e]=null)},v=async()=>{e(t.opts.leftsideBackSelector).length()>0?t.elements.indicator.addClass(t.opts.classes.page.hasLeftsideBack):e(document).on(t.opts.events.lsbLoaded+".bs",e=>{e.detail.showIndicator&&t.elements.indicator.addClass(t.opts.classes.page.hasLeftsideBack)})}},window.TooltipHelper=function(t){let s={},a={};this.init=(async()=>{a=t.helper.model.getData(["b/tooltipContent","b/tooltipDelay","b/sidebarPosition"]);let e=t.helper.model.getData("a/styles");a.scrollBarWidth=+e.scrollBarWidth.replace("px","")}),this.create=(o=>{let i=o.attr(t.opts.attr.id);if(i&&!1===t.helper.entry.isSeparator(i)){t.helper.toggle.addSidebarHoverClass(),r(i);let n=t.elements.iframeBody.find("div."+t.opts.classes.tooltip.wrapper+"["+t.opts.attr.id+"='"+i+"']");if(n.length()>0)0!==n[0].getBoundingClientRect().top&&n.addClass(t.opts.classes.tooltip.visible);else if(-1!=+a.tooltipDelay){let r=t.helper.entry.getData(i);if(r){let n=e("<div />").addClass(t.opts.classes.tooltip.wrapper).attr(t.opts.attr.id,i).appendTo(t.elements.iframeBody);"all"!==a.tooltipContent&&"title"!==a.tooltipContent||e("<h3 />").text(r.title).appendTo(n),r.isDir?e("<span />").text(r.children.length+" "+t.helper.i18n.get("sidebar_dir_children")).appendTo(n):"all"!==a.tooltipContent&&"url"!==a.tooltipContent||e("<span />").text(r.url).appendTo(n),s[i]&&(clearTimeout(s[i]),s[i]=null),s[i]=setTimeout(()=>{n.addClass(t.opts.classes.tooltip.visible),n.css("top",o[0].getBoundingClientRect().top+o.realHeight()/2-n.realHeight()/2+"px"),l(n,o)},1e3*+a.tooltipDelay)}}}else r()}),this.close=(()=>{r()});let l=(e,s)=>{let l=t.helper.i18n.isRtl(),r={l:t.elements.sidebar.realWidth()-a.scrollBarWidth,r:s.realWidth()+10};"right"===a.sidebarPosition?e.css("right",r[l?"l":"r"]+"px"):e.css("left",r[l?"r":"l"]+"px")},r=(a=null)=>{Object.values(s).forEach(e=>{e&&clearTimeout(s[e])}),s={};let l=t.elements.iframeBody.find("div."+t.opts.classes.tooltip.wrapper+(a?":not(["+t.opts.attr.id+"='"+a+"'])":"")),r=!1;l.forEach(s=>{if(e(s).hasClass(t.opts.classes.tooltip.visible))return r=!0,!1}),l.removeClass(t.opts.classes.tooltip.visible),e.delay(r?300:0).then(()=>{l.remove(),t.helper.toggle.removeSidebarHoverClass()})}},window.UtilityHelper=function(t){this.openUrl=((e,s="default",a=!0)=>{"about:blank"!==e.url&&(t.helper.model.setData({"u/lastOpened":e.id,"u/performReopening":!!a&&(e.reopenSidebar||!1)}),"incognito"===s?t.helper.model.call("openLink",{href:e.url,incognito:!0}):"newWindow"===s?t.helper.model.call("openLink",{href:e.url,newWindow:!0}):t.helper.model.call("openLink",{parentId:e.parentId,id:e.id,href:e.url,newTab:"newTab"===s,position:t.helper.model.getData("b/newTabPosition"),active:a}))}),this.openAllBookmarks=(e=>{t.helper.model.call("trackEvent",{category:"url",action:"open",label:"new_tab_all_children",value:e.length}),"afterCurrent"===t.helper.model.getData("b/newTabPosition")&&e.reverse(),e.forEach(e=>{this.openUrl(e,"newTab",!1)})}),this.isBackgroundConnected=(()=>{let e=chrome.runtime.connect();return!!e&&(e.disconnect(),!0)}),this.triggerEvent=((e,s={},a=null)=>{(a||document).dispatchEvent(new CustomEvent(t.opts.events[e],{detail:s,bubbles:!0,cancelable:!1}))}),this.copyToClipboard=(s=>{let a=e("<textarea />").text(s).appendTo(t.elements.iframeBody);a[0].select();let l=!1;try{l=t.elements.iframe[0].contentDocument.execCommand("copy")}catch(e){}return a.remove(),l}),this.isWindowed=(()=>{return window.screenX>12||window.screenY>12||Math.abs(window.screen.availWidth-window.innerWidth)>12})},window.ext=function(t){let s={},a=!1;this.initialized=null,this.firstRun=!0,this.refreshRun=!0,this.isDev=!1,this.elements={},this.opts=t,this.needsReload=!1,this.run=(()=>{this.isDev="Dev"===t.manifest.version_name||!("update_url"in t.manifest);let s=o();r(),e(document).on("visibilitychange.bs",()=>{!0!==document.hidden&&(null===this.initialized?l():this.needsReload&&this.reload())},{capture:!1}),l(!1===s)});let l=(e=!1)=>{!1!==a||!e&&!0===document.hidden||(a=!0,this.helper.model.init().then(()=>this.helper.i18n.init()).then(()=>(this.helper.font.init(),this.helper.stylesheet.init(),this.helper.stylesheet.addStylesheets(["content"]),i())).then(()=>{this.elements.iframe&&this.elements.iframe[0]&&(this.elements.iframeBody.parent("html").attr("dir",this.helper.i18n.isRtl()?"rtl":"ltr"),this.helper.toggle.init(),this.helper.list.init(),this.helper.scroll.init(),this.helper.tooltip.init(),this.helper.sidebarEvents.init(),this.helper.dragndrop.init(),this.helper.keyboard.init(),""===document.referrer&&this.helper.model.call("addViewAmount",{url:location.href}))}))};this.reload=(()=>{!1===a&&!1===document.hidden&&(this.needsReload=!1,a=!0,this.helper.model.init().then(()=>Promise.all([this.helper.i18n.init(),this.helper.entry.init()])).then(()=>this.helper.list.updateBookmarkBox()).then(()=>{this.helper.search.init()}))}),this.trackInitialEvents=(()=>{let s=()=>{let e=this.helper.list.getSort();this.helper.model.call("trackEvent",{category:"sorting",action:"initial",label:e.name+"_"+e.dir});let s=this.elements.header.find("div."+t.classes.sidebar.searchBox+" > input[type='text']")[0].value;s.length>0&&this.helper.model.call("trackEvent",{category:"search",action:"search",label:"initial",value:s.length})};this.firstRun?e(document).on(t.events.loaded+".bs",()=>{s()}):s()}),this.log=((...e)=>{this.isDev&&console.log(...e)}),this.loaded=(()=>{if(!this.elements.iframeBody.hasClass(t.classes.sidebar.extLoaded)){let e=this.helper.model.getData(["b/pxTolerance","a/showIndicator"]);this.elements.iframeBody.addClass(t.classes.sidebar.extLoaded),this.helper.list.updateSidebarHeader(),this.helper.search.init(),this.elements.iframe.hasClass(t.classes.page.visible)&&this.helper.toggle.markLastUsed(),this.initialized=+new Date,this.log(this.initialized-this.updateBookmarkBoxStart),this.helper.utility.triggerEvent("loaded",{config:{pxTolerance:e.pxTolerance,showIndicator:e.showIndicator},elm:{iframe:this.elements.iframe,sidebar:this.elements.sidebar}})}a=!1}),this.startLoading=(()=>{this.elements.sidebar.addClass(t.classes.sidebar.loading),s.timeout&&clearTimeout(s.timeout),void 0!==s.loader&&0!==s.loader.length()||(s.loader=this.helper.template.loading().appendTo(this.elements.sidebar))}),this.endLoading=((e=500)=>{s.timeout=setTimeout(()=>{this.elements.sidebar.removeClass(t.classes.sidebar.loading),s.loader&&s.loader.remove(),s={}},e)}),this.initImages=(()=>{this.elements.iframe.hasClass(t.classes.page.visible)&&e.delay(0).then(()=>{this.elements.sidebar.find("img["+t.attr.src+"]").forEach(s=>{let a=e(s),l=a.attr(t.attr.src);a.removeAttr(t.attr.src),a.attr("src",l)})})}),this.addReloadMask=(()=>{this.elements.sidebar.text("");let s=e("<div />").attr("id",t.ids.sidebar.reloadInfo).prependTo(this.elements.sidebar),a=e("<div />").prependTo(s);e("<p />").html(this.helper.i18n.get("status_background_disconnected_reload_desc")).appendTo(a),e("<a />").text(this.helper.i18n.get("status_background_disconnected_reload_action")).appendTo(a)}),this.addShareInfoMask=(()=>{this.elements.sidebar.find("#"+t.ids.sidebar.shareInfo).remove();let s=e("<div />").attr("id",t.ids.sidebar.shareInfo).prependTo(this.elements.sidebar),a=e("<div />").prependTo(s);e("<h2 />").html(this.helper.i18n.get("contribute_headline")).appendTo(a),e("<p />").html(this.helper.i18n.get("contribute_intro")).appendTo(a),["config","activity"].forEach(s=>{let l=e("<label />").text(this.helper.i18n.get("contribute_share_"+s+"_label")).appendTo(a);e("<a />").data({title:l.text(),type:s}).appendTo(l),this.helper.checkbox.get(this.elements.iframeBody,{[t.attr.name]:s},"checkbox","switch").appendTo(a)}),e("<a />").text(this.helper.i18n.get("contribute_dismiss")).appendTo(a)});let r=()=>{this.helper={model:new window.ModelHelper(this),toggle:new window.ToggleHelper(this),entry:new window.EntryHelper(this),list:new window.ListHelper(this),scroll:new window.ScrollHelper(this),template:new window.TemplateHelper(this),i18n:new window.I18nHelper(this),font:new window.FontHelper(this),sidebarEvents:new window.SidebarEventsHelper(this),search:new window.SearchHelper(this),stylesheet:new window.StylesheetHelper(this),dragndrop:new window.DragDropHelper(this),checkbox:new window.CheckboxHelper(this),keyboard:new window.KeyboardHelper(this),bookmark:new window.BookmarkHelper(this),overlay:new window.OverlayHelper(this),utility:new window.UtilityHelper(this),contextmenu:new window.ContextmenuHelper(this),tooltip:new window.TooltipHelper(this)}},o=()=>{let s=!1,a=e("iframe#"+t.ids.page.iframe);return e(document).off("*.bs"),e(window).off("*.bs"),a.length()>0&&(this.log("DESTROY"),a.remove(),e("iframe#"+t.ids.page.overlay).remove(),e("div#"+t.ids.page.indicator).remove(),s=!0),s},i=async()=>{let s=this.helper.model.getData(["b/animations","a/darkMode","a/highContrast"]);this.elements.iframe=e('<iframe id="'+t.ids.page.iframe+'" />').appendTo("body"),!1===s.animations&&this.elements.iframe.addClass(t.classes.page.noAnimations),this.elements.iframeBody=this.elements.iframe.find("body"),this.elements.sidebar=e('<section id="'+t.ids.sidebar.sidebar+'" />').appendTo(this.elements.iframeBody),this.elements.bookmarkBox={},["all","search"].forEach(s=>{this.elements.bookmarkBox[s]=this.helper.scroll.add(t.ids.sidebar.bookmarkBox[s],e("<ul />").appendTo(this.elements.sidebar))}),this.elements.filterBox=e("<div />").addClass(t.classes.sidebar.filterBox).appendTo(this.elements.sidebar),this.elements.pinnedBox=e("<div />").addClass(t.classes.sidebar.entryPinned).prependTo(this.elements.bookmarkBox.all),this.elements.lockPinned=e("<a />").addClass(t.classes.sidebar.lockPinned).html("<span />").appendTo(this.elements.sidebar),this.elements.header=e("<header />").prependTo(this.elements.sidebar),this.helper.stylesheet.addStylesheets(["sidebar"],this.elements.iframe),!0===s.darkMode?this.elements.iframeBody.addClass(t.classes.page.darkMode):!0===s.highContrast&&this.elements.iframeBody.addClass(t.classes.page.highContrast),this.helper.utility.triggerEvent("elementsCreated",{elm:{iframe:this.elements.iframe,sidebar:this.elements.sidebar}})}};let t={ids:{page:{iframe:"blockbyte-bs-sidebar",overlay:"blockbyte-bs-overlay",indicator:"blockbyte-bs-indicator"},sidebar:{sidebar:"sidebar",shareInfo:"shareInfo",reloadInfo:"reloadInfo",bookmarkBox:{all:"bookmarkBox",search:"bookmarkBoxSearch"}},overlay:{urlList:"urlList"}},classes:{page:{visible:"blockbyte-bs-visible",hideMask:"blockbyte-bs-hideMask",hover:"blockbyte-bs-hover",noscroll:"blockbyte-bs-noscroll",hasLeftsideBack:"blockbyte-bs-has-lsb",style:"blockbyte-bs-style",noAnimations:"noAnimations",darkMode:"dark",highContrast:"highContrast"},sidebar:{extLoaded:"loaded",openedOnce:"openedOnce",permanent:"permanent",active:"active",cached:"cached",mark:"mark",hideRoot:"hideRoot",dirAnimated:"animated",dirOpened:"opened",bookmarkDir:"dir",dirIcon:"icon",separator:"separator",bookmarkLink:"link",bookmarkLabel:"label",entryPinned:"pinned",menu:"menu",sort:"sort",hidden:"hidden",hover:"hover",fixed:"fixed",lockPinned:"lockPinned",lastHover:"lastHover",loading:"loading",copied:"copied",filterBox:"filter",search:"search",searchBox:"searchBox",searchClose:"searchClose",searchVisible:"searchVisible",removeMask:"removeMask",removed:"removed",restored:"restored"},tooltip:{wrapper:"tooltip",visible:"visible"},contextmenu:{wrapper:"contextmenu",top:"top",visible:"visible",list:"list",icons:"icons",right:"right",separator:"separator"},drag:{trigger:"drag",helper:"dragHelper",isDragged:"isDragged",cancel:"dragCancel",dragHover:"dragHover",snap:"snap",dragInitial:"dragInitial"},scrollBox:{wrapper:"scrollBox",scrollbar:"scrollbar",inactive:"inactive",hideScrollbar:"hideScrollbar",hidden:"hidden",scrolled:"scrolled"},checkbox:{box:"checkbox",active:"active",clicked:"clicked",focus:"focus"},overlay:{modal:"modal",visible:"visible",preview:"preview",previewUrl:"previewUrl",info:"info",action:"action",close:"close",hasTooltip:"tooltip",inputError:"error",success:"success",progressBar:"progressBar",buttonWrapper:"buttons",checkUrlProgressLabel:"progressLabel",urlCheckLoading:"urlCheckLoading",urlCheckList:"urlCheckList"}},attr:{src:"data-src",position:"data-pos",type:"data-type",name:"data-name",value:"data-value",sort:"data-sort",direction:"data-direction",style:"data-style",id:"data-id"},events:{loaded:"blockbyte-bs-loaded",elementsCreated:"blockbyte-bs-created",openSidebar:"blockbyte-bs-sidebar-open",sidebarOpened:"blockbyte-bs-sidebar-opened",checkboxChanged:"blockbyte-bs-checkbox-changed",scrollBoxLastPart:"blockbyte-bs-scrollbox-lastpart",lsbLoaded:"blockbyte-lsb-loaded"},leftsideBackSelector:"div#blockbyte-lsb-indicator.blockbyte-lsb-visible",manifest:chrome.runtime.getManifest(),demoMode:!1};new window.ext(t).run()})(jsu);