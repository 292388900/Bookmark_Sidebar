/*! (c) Philipp KÃ¶nig under GPL-3.0 */
(()=>{"use strict";let e="isDefined",t="forEach",s=(a=>{let l=document,r=new WeakMap,o=new WeakMap,i=Symbol(),n="_fillNodeList",d="get",p="remove",c="_addEventListener",h="_cloneEventListener",m="_addData",u="_cloneData",g="_cloneElement",b="_htmlText",f="_moveElement",k="_moveElementTo",v="_nextPrev",y="_siblings",w="_realDimension";return class{constructor(e,t=!0){let s=e;if("string"==typeof e&&(!1===t||e.search("<")>-1)){let t=l.createElement("div");t.innerHTML=e,s=t.childNodes}this[n](s)}[n](r){if(a[e](r))if(r instanceof s)this[i]=r[d]();else if("string"==typeof r)this[i]=l.querySelectorAll(r);else if(r instanceof Node||r instanceof HTMLDocument||r instanceof Window)this[i]=[r];else if(r instanceof NodeList||r instanceof HTMLCollection)this[i]=r;else{if("object"!=typeof r)throw new DOMException("invalid parameter for jsu");this[i]=[],a[e](r[t])||(r=[r]),r[t](e=>{let l=e=>{-1===this[i].indexOf(e)&&this[i].push(e)};e instanceof s?e[t](l):Array.isArray(e)||e instanceof NodeList||e instanceof HTMLCollection||/^\[object (HTMLCollection|NodeList|Object)\]$/.test(e.toString())?a[t](e,l):this[i].push(e)})}else this[i]=[];this[t]((e,t)=>{this[t]=e})}[t](e,s=!1){return a[t](this[i],e,s),this}["css"](s,l){let r=!0,o=a[e](s),n=a[e](l),d=[];return this[t](e=>{o&&n&&"string"==typeof s?e.style[s]=l:o&&("string"==typeof s?(d.push(window.getComputedStyle(e)[s]),r=!1):"object"==typeof s&&Object.keys(s)[t](t=>{"string"==typeof t&&(e.style[t]=s[t])}))}),r?this:this[i].length>1?d:d[0]}["attr"](s,l){let r=!0,o=a[e](s),n=a[e](l),d=[];return this[t](i=>{let p=(t,s)=>{a[e](i[t])?i[t]=s:i.setAttribute(t,s)};o&&n&&"string"==typeof s?p(s,l):o&&("string"==typeof s?(d.push((t=>a[e](i[t])?i[t]:i.getAttribute(t))(s)),r=!1):"object"==typeof s&&Object.keys(s)[t](e=>{"string"==typeof e&&p(e,s[e])}))}),r?this:this[i].length>1?d:d[0]}["removeAttr"](e){return this[t](t=>{t.removeAttribute(e)}),this}static[c](t,s){let l=r.get(t);a[e](l)||(l={},r.set(t,l)),l[s.event]||(l[s.event]=[]),l[s.event].push({fn:s.fn,opts:s.opts,wantsUntrusted:s.wantsUntrusted}),t.addEventListener(s.event,s.fn,s.opts,s.wantsUntrusted)}static[h](l,o){let i=r.get(l);a[e](i)&&Object.keys(i)[t](e=>{i[e][t](t=>{s[c](o,{event:e,fn:t.fn,opts:t.opts,wantsUntrusted:t.wantsUntrusted})})}),o.children&&a[t](o.children,(e,t)=>{s[h](l.children[t],e)})}static[m](t,s,l){let r=o.get(t);a[e](r)||(r={},o.set(t,r)),r[s]=l}static[u](l,r){let i=o.get(l);a[e](i)&&Object.keys(i)[t](e=>{s[m](r,e,i[e])}),r.children&&a[t](r.children,(e,t)=>{s[u](l.children[t],e)})}static[g](e){let a=[];return e[t](e=>{let t=e.cloneNode(!0);s[h](e,t),s[u](e,t),a.push(t)}),new s(a)}["clone"](){return s[g](this)}["data"](l,r){let n=!0,d=a[e](l),p=a[e](r),c=[];return this[t](i=>{let h=o.get(i),u=a[e](h);d&&p?s[m](i,l,r):d?"string"==typeof l?(c.push(u?h[l]:void 0),n=!1):"object"==typeof l&&Object.keys(l)[t](e=>{"string"==typeof e&&s[m](i,e,l[e])}):(c.push(u?h:{}),n=!1)}),n?this:this[i].length>1?c:c[0]}["removeData"](s){let l=!a[e](s);return this[t](t=>{let r=o.get(t);a[e](r)&&(l?o.delete(t):a[e](r[s])&&delete r[s])}),this}["on"](e,l,r,o,i){let n=(e,s)=>{Object.keys(s)[t](t=>{try{Object.defineProperty(e,t,{value:s[t]})}catch(e){}})},d=r;"function"==typeof r?d=o:i=o,void 0===d&&(d=null),void 0===i&&(i=null);let p="string"==typeof l;return this[t](o=>{e.split(/\s+/g)[t](e=>{s[c](o,{event:e,fn:s=>{n(s,{type:e}),p?a[t](o.querySelectorAll(":scope "+l),t=>{let a=s.target;for(;a&&a!==o;){if(a===t){let t=new MouseEvent(e,s);n(t,{preventDefault:()=>{s.preventDefault()},stopPropagation:()=>{s.stopPropagation()},target:s.target,currentTarget:a}),r(t)}a=a.parentNode}}):"function"==typeof l&&l(s)},opts:d,wantsUntrusted:i})})},!0),this}["off"](s){return this[t](l=>{let o=r.get(l);if(a[e](o)){let e=s.split(/\s+/g);e[t](e=>{o[e]&&a[t](o[e],(t,s)=>{l.removeEventListener(e,t.fn),o[e].splice(s,1)},!0)})}}),this}["trigger"](e,s){return e.split(/\s+/g)[t](e=>{let a=new Event(e,s);this[t](e=>{e.dispatchEvent(a)})}),this}["addClass"](e){return this[t](t=>{t.classList.add(e)}),this}["removeClass"](e){return this[t](t=>{t.classList.remove(e)}),this}["toggleClass"](e){return this[t](t=>{t.classList.toggle(e)}),this}["hasClass"](e){let s=[];return this[t](t=>{s.push(t.classList.contains(e))}),this[i].length>1?s:s[0]}[w](e,s=!1){let a=[],l="width",r=["left","right"];return"h"===e&&(l="height",r=["top","bottom"]),this[t](e=>{let t=e.getBoundingClientRect(),o=window.getComputedStyle(e),i=t[l];s&&(i+=parseInt(o.getPropertyValue("margin-"+r[0])),i+=parseInt(o.getPropertyValue("margin-"+r[1]))),a.push(i)}),this[i].length>1?a:a[0]}["realWidth"](e=!1){return this[w]("w",e)}["realHeight"](e=!1){return this[w]("h",e)}["find"](e){let a=[];return this[t](t=>{t instanceof HTMLIFrameElement?a.push(t.contentDocument.querySelectorAll(":scope "+e)):a.push(t.querySelectorAll(":scope "+e))}),new s(a)}["children"](e){let a=[];return e||(e="*"),this[t](t=>{a.push(t.querySelectorAll(":scope > "+e))}),new s(a)}[b](s,l){let r=a[e](s),o=r?this:"";return this[t](e=>{r?e[l]=s:o+=e[l]}),o}["html"](e){return this[b](e,"innerHTML")}["text"](e){return this[b](e,"innerText")}[p](){this[t](e=>{e&&e.parentElement&&(r.delete(e),o.delete(e),e.parentElement.removeChild(e))})}[f](e,a=!0,l){"string"==typeof e&&e.search("<")>-1&&(a=!1);let r=new s(e,a);return this[t](e=>{s[g](r)[t](t=>{switch(l){case"append":e.appendChild(t);break;case"prepend":e.insertBefore(t,e.firstChild);break;case"before":e.parentNode.insertBefore(t,e);break;case"after":e.parentNode.insertBefore(t,e.nextSibling)}})}),r[p](),this}[k](e,a){let l=[];return new s(e)[t](e=>{s[g](this)[t](t=>{switch(a){case"append":e.appendChild(t);break;case"prepend":e.insertBefore(t,e.firstChild);break;case"before":e.parentNode.insertBefore(t,e);break;case"after":e.parentNode.insertBefore(t,e.nextSibling)}l.push(t)})}),this[p](),new s(l)}["append"](e,t){return this[f](e,t,"append")}["appendTo"](e){return this[k](e,"append")}["prepend"](e,t=!0){return this[f](e,t,"prepend")}["prependTo"](e){return this[k](e,"prepend")}["before"](e,t=!0){return this[f](e,t,"before")}["insertBefore"](e){return this[k](e,"before")}["after"](e,t=!0){return this[f](e,t,"after")}["insertAfter"](e){return this[k](e,"after")}[v](l,r){let o=a[e](l),i=[];return this[t](t=>{let s="prev"===r?t.previousElementSibling:t.nextElementSibling;a[e](s)&&(!o||a[e](s.matches)&&s.matches(l))&&i.push(s)}),new s(i)}["next"](e){return this[v](e,"next")}["prev"](e){return this[v](e,"prev")}[y](l,r="siblings"){let o=a[e](l),n=[];return this[t](e=>{let t=null,a=[];for("siblings"===r&&e.parentNode.firstElementChild?(t=e.parentNode.firstElementChild,r="next"):"previous"!==r&&"next"!==r||(t=e[r+"ElementSibling"]);t&&t.matches;)t===e||o&&!t.matches(l)||a.push(t),t=t[r+"ElementSibling"];n.push(new s(a))}),this[i].length>1?n:n[0]}["siblings"](e){return this[y](e)}["nextAll"](e){return this[y](e,"next")}["prevAll"](e){return this[y](e,"previous")}["parent"](l){let r=a[e](l),o=[];return this[t](t=>{let i=t.parentNode;!r||a[e](i.matches)&&i.matches(l)||(i=null),o.push(new s(i))}),this[i].length>1?o:o[0]}["parents"](l){let r=a[e](l),o=[];return this[t](e=>{let t=[],a=e.parentNode;for(;a&&a.matches&&a!==this;)r&&!a.matches(l)||t.push(a),a=a.parentNode;o.push(new s(t))}),this[i].length>1?o:o[0]}["document"](){let e=[];return this[t](t=>{e.push(new s(t.ownerDocument))}),this[i].length>1?e:e[0]}["eq"](e){return e<0&&(e=this[i].length+e),new s(this[i][e])}[d](t){return a[e](t)?(t<0&&(t=this[i].length+t),this[i][t]):this[i]}["length"](){return this[i].length}}})(class{static[e](e){return void 0!==e&&null!==e}static[t](s,a,l=!1){let r=s.length;if(l){for(let o=r-1;o>=0;o--)if(this[e](s[o][t]))this[t](s[o],a,l);else if(!1===a(s[o],o))break}else for(let o=0;o<r;o++)if(this[e](s[o][t]))this[t](s[o],a,l);else if(!1===a(s[o],o))break}});window.jsu=function(e){return new s(e)}})(),(e=>{"use strict";window.CheckboxHelper=function(t){let s={};this.get=((s,a,l="checkbox")=>{let o=e("<div />").html("<input type='checkbox' />").data("uid",Math.random().toString(36).substr(2,12)).attr(t.opts.attr.type,l).addClass(t.opts.classes.checkbox.box);return void 0!==a&&(o.children("input[type='checkbox']").attr(a),a[t.opts.attr.name]&&o.attr(t.opts.attr.name,a[t.opts.attr.name])),this.isChecked(o)&&o.addClass(t.opts.classes.checkbox.active),r(o,s),o}),this.isChecked=(e=>e.find("input[type='checkbox']")[0].checked);let a=(e,s)=>{let a=e.children("input[type='checkbox']");a.trigger("change"),t.opts.events&&t.opts.events.checkboxChanged&&t.helper.utility.triggerEvent("checkboxChanged",{container:e,checkbox:a,checked:e.hasClass(t.opts.classes.checkbox.active)},s.document()[0])},l=(r,o)=>{r.addClass(t.opts.classes.checkbox.clicked),r.removeClass(t.opts.classes.checkbox.focus),r.toggleClass(t.opts.classes.checkbox.active);let i=r.hasClass(t.opts.classes.checkbox.active),n=r.children("input[type='checkbox']");if("radio"===r.attr(t.opts.attr.type)&&r.attr(t.opts.attr.name))if(o){let s=r.attr(t.opts.attr.name);r.addClass(t.opts.classes.checkbox.active),i&&(n.attr("checked",!0),a(r,o)),o.find("div."+t.opts.classes.checkbox.box+"["+t.opts.attr.type+"='radio']["+t.opts.attr.name+"='"+s+"']").forEach(t=>{let s=e(t);t!==r[0]&&this.isChecked(s)&&l(s)})}else n.attr("checked",!1);else n.attr("checked",i),a(r,o);let d=r.data("uid");s[d]&&clearTimeout(s[d]),s[d]=setTimeout(()=>{r.removeClass(t.opts.classes.checkbox.clicked)},300)},r=(s,a)=>{s.on("mousedown",s=>{s.preventDefault(),s.stopPropagation(),e(s.currentTarget).addClass(t.opts.classes.checkbox.focus)}).on("click",t=>{t.preventDefault(),t.stopPropagation(),l(e(t.currentTarget),a)}),a.on("click",()=>{s.removeClass(t.opts.classes.checkbox.focus)})}},window.ContextmenuHelper=function(t){this.create=((i,d)=>{if(!1===s(i,d)){this.close(),d.addClass(t.opts.classes.sidebar.active);let s=e("<div />").addClass(t.opts.classes.contextmenu.wrapper).html("<ul class='"+t.opts.classes.contextmenu.list+"'></ul><ul class='"+t.opts.classes.contextmenu.icons+"'></ul>").attr(t.opts.attr.type,i).data("elm",d).appendTo(t.elements.sidebar),p=i,c=d.attr(t.opts.attr.id);switch(c&&s.attr(t.opts.attr.id,c),i){case"list":{o(s,d);let e=t.helper.entry.getData(c);p=e.isDir?"directory":"bookmark";break}case"separator":r(s,d);break;case"menu":l(s,d);break;case"sort":a(s,d)}t.helper.model.call("trackEvent",{category:"contextmenu",action:"open",label:p}),n(s),setTimeout(()=>{s.addClass(t.opts.classes.contextmenu.visible);let e=parseInt(s.css("top")),a=s.realHeight();e+a>=window.innerHeight&&s.css("top",e-a).addClass(t.opts.classes.contextmenu.top)},0)}});let s=(e,s)=>{let a=s.attr(t.opts.attr.id),l="div."+t.opts.classes.contextmenu.wrapper+"["+t.opts.attr.type+"='"+e+"']";return a&&(l+="["+t.opts.attr.id+"='"+a+"']"),t.elements.sidebar.find(l).length()>0};this.close=(()=>{let s=t.elements.iframeBody.find("div."+t.opts.classes.contextmenu.wrapper);s.forEach(s=>{e(s).removeClass(t.opts.classes.contextmenu.visible),e(s).data("elm").removeClass(t.opts.classes.sidebar.active)}),setTimeout(()=>{s.remove()},500)});let a=(s,a)=>{let l=t.helper.list.getSortList(),r=t.helper.list.getSort(),o=s.children("ul."+t.opts.classes.contextmenu.list);s.children("ul."+t.opts.classes.contextmenu.icons).remove(),Object.keys(l).forEach(a=>{let l=a.replace(/([A-Z])/g,"_$1").toLowerCase();e("<li />").append(t.helper.checkbox.get(t.elements.iframeBody,{[t.opts.attr.name]:"sort",[t.opts.attr.value]:a},"radio")).append("<a "+t.opts.attr.name+"='sort'>"+t.helper.i18n.get("sort_label_"+l)+"</a>").appendTo(o),a===r.name&&s.find("input["+t.opts.attr.name+"='sort']["+t.opts.attr.value+"='"+a+"']").parent("div."+t.opts.classes.checkbox.box).trigger("click")});let i=a[0].getBoundingClientRect();s.css("top",i.top+i.height+"px")},l=(s,a)=>{let l=s.children("ul."+t.opts.classes.contextmenu.list),r=s.children("ul."+t.opts.classes.contextmenu.icons);"custom"===t.helper.list.getSort().name&&(e("<li />").append(t.helper.checkbox.get(t.elements.iframeBody,{[t.opts.attr.name]:"toggleFix"})).append("<a "+t.opts.attr.name+"='toggleFix'>"+t.helper.i18n.get("contextmenu_toggle_fix")+"</a>").appendTo(l),!1===t.elements.sidebar.hasClass(t.opts.classes.sidebar.entriesUnlocked)&&s.find("input["+t.opts.attr.name+"='toggleFix']").parent("div."+t.opts.classes.checkbox.box).trigger("click")),e("<li />").append(t.helper.checkbox.get(t.elements.iframeBody,{[t.opts.attr.name]:"toggleHidden"})).append("<a "+t.opts.attr.name+"='toggleHidden'>"+t.helper.i18n.get("contextmenu_toggle_hidden")+"</a>").appendTo(l),!0===t.elements.sidebar.hasClass(t.opts.classes.sidebar.showHidden)&&s.find("input["+t.opts.attr.name+"='toggleHidden']").parent("div."+t.opts.classes.checkbox.box).trigger("click"),r.append("<li><a "+t.opts.attr.name+"='settings' title='"+t.helper.i18n.get("contextmenu_settings")+"'></a></li>").append("<li><a "+t.opts.attr.name+"='bookmarkManager' title='"+t.helper.i18n.get("contextmenu_bookmark_manager")+"'></a></li>");let o=a[0].getBoundingClientRect();s.css("top",o.top+o.height+"px")},r=(s,a)=>{s.css({top:a[0].getBoundingClientRect().top+a.realHeight()+"px",left:a[0].offsetLeft+"px"});let l=e("<li />").appendTo(s.children("ul."+t.opts.classes.contextmenu.list));s.children("ul."+t.opts.classes.contextmenu.icons).remove(),e("<a />").attr(t.opts.attr.name,"deleteSeparator").text(t.helper.i18n.get("contextmenu_delete_separator")).data("infos",a.data("infos")).appendTo(l)},o=(e,s)=>{let a=s.attr(t.opts.attr.id),l=t.helper.entry.getData(a);e.css({top:s[0].getBoundingClientRect().top+s.realHeight()+"px",left:s[0].offsetLeft+"px"});let r=l.isDir?"_dir":"_bookmark",o=e.children("ul."+t.opts.classes.contextmenu.list),i=e.children("ul."+t.opts.classes.contextmenu.icons),n=t.elements.bookmarkBox.search.hasClass(t.opts.classes.sidebar.active);if(l.isDir){let e=l.children.filter(e=>!!e.url);e.length>0&&o.append("<li><a "+t.opts.attr.name+"='openChildren'>"+t.helper.i18n.get("contextmenu_open_children")+"</a></li>"),l.children.length>0&&o.append("<li><a "+t.opts.attr.name+"='updateUrls'>"+t.helper.i18n.get("contextmenu_update_urls")+"</a></li>")}else n&&o.append("<li><a "+t.opts.attr.name+"='showInDir'>"+t.helper.i18n.get("contextmenu_show_in_dir")+"</a></li>"),o.append("<li><a "+t.opts.attr.name+"='newTab'>"+t.helper.i18n.get("contextmenu_new_tab")+"</a></li>"),!1===chrome.extension.inIncognitoContext&&o.append("<li><a "+t.opts.attr.name+"='newTabIncognito'>"+t.helper.i18n.get("contextmenu_new_tab_incognito")+"</a></li>");i.append("<li><a "+t.opts.attr.name+"='infos' title='"+t.helper.i18n.get("contextmenu_infos")+"'></a></li>"),l.parents.length>0&&i.append("<li><a "+t.opts.attr.name+"='edit' title='"+t.helper.i18n.get("contextmenu_edit"+r)+"'></a></li>").append("<li><a "+t.opts.attr.name+"='delete' title='"+t.helper.i18n.get("contextmenu_delete"+r)+"'></a></li>"),l.isDir?i.append("<li><a "+t.opts.attr.name+"='add' title='"+t.helper.i18n.get("contextmenu_add")+"'></a></li>"):l.pinned?i.append("<li><a "+t.opts.attr.name+"='unpin' title='Unpin from top'></a></li>"):i.append("<li><a "+t.opts.attr.name+"='pin' title='Pin to top'></a></li>"),t.helper.entry.isVisible(a)?i.append("<li class='"+t.opts.classes.contextmenu.right+"'><a "+t.opts.attr.name+"='hide' title='"+t.helper.i18n.get("contextmenu_hide_from_sidebar")+"'></a></li>"):!n&&s.parents("li."+t.opts.classes.sidebar.hidden).length()<=1&&i.append("<li class='"+t.opts.classes.contextmenu.right+"'><a "+t.opts.attr.name+"='show' title='"+t.helper.i18n.get("contextmenu_show_in_sidebar")+"'></a></li>")},i=s=>{s.find("input["+t.opts.attr.name+"='sort']").on("change",s=>{if(s.currentTarget.checked){let a=e(s.currentTarget).attr(t.opts.attr.value);t.helper.list.updateSort(a),this.close()}})},n=s=>{i(s),s.find("input["+t.opts.attr.name+"='toggleFix']").on("change",()=>{t.elements.sidebar.toggleClass(t.opts.classes.sidebar.entriesUnlocked),t.helper.model.setData({"u/entriesLocked":!1===t.elements.sidebar.hasClass(t.opts.classes.sidebar.entriesUnlocked)}),this.close()}),s.find("input["+t.opts.attr.name+"='toggleHidden']").on("change",()=>{t.startLoading(),t.elements.sidebar.toggleClass(t.opts.classes.sidebar.showHidden),t.helper.model.setData({"u/showHidden":!0===t.elements.sidebar.hasClass(t.opts.classes.sidebar.showHidden)}).then(()=>{t.helper.model.call("refreshAllTabs",{type:"ToggleHidden"})}),this.close()}),s.find("a").on("click",a=>{a.preventDefault();let l=e(a.currentTarget).attr(t.opts.attr.name),r=s.attr(t.opts.attr.id),o=r?t.helper.entry.getData(r):null;switch(l){case"settings":t.helper.model.call("openLink",{href:chrome.extension.getURL("html/settings.html"),newTab:!0});break;case"sort":case"toggleFix":case"toggleHidden":a.stopPropagation(),e(a.currentTarget).prev("div."+t.opts.classes.checkbox.box).trigger("click");break;case"bookmarkManager":t.helper.model.call("openLink",{href:"chrome://bookmarks",newTab:!0,active:!0});break;case"newTabIncognito":t.helper.model.call("trackEvent",{category:"url",action:"open",label:"new_window_incognito"}),t.helper.utility.openUrl(o,"incognito");break;case"newTab":t.helper.model.call("trackEvent",{category:"url",action:"open",label:"new_tab_contextmenu"}),t.helper.utility.openUrl(o,"newTab","foreground"===t.helper.model.getData("b/newTab"));break;case"deleteSeparator":t.helper.utility.removeSeparator(e(a.currentTarget).data("infos")).then(()=>{t.helper.model.call("refreshAllTabs",{type:"Separator"})});break;case"show":{t.startLoading();let e=t.helper.model.getData("u/hiddenEntries");delete e[r],t.helper.model.setData({"u/hiddenEntries":e}).then(()=>{t.helper.model.call("refreshAllTabs",{type:"Hide"})});break}case"openChildren":{let s=o.children.filter(e=>!!e.url);s.length>10?t.helper.overlay.create(l,e(a.currentTarget).attr("title")||e(a.currentTarget).text(),o):t.helper.utility.openAllBookmarks(s,"foreground"===t.helper.model.getData("b/newTab"));break}case"pin":t.helper.utility.pinEntry(o).then(()=>{t.helper.model.call("refreshAllTabs",{type:"Pin"})});break;case"unpin":t.helper.utility.unpinEntry(o).then(()=>{t.helper.model.call("refreshAllTabs",{type:"Unpin"})});break;case"showInDir":{let e=t.helper.entry.getData(r);if(e&&e.parents){let s=a=>{if(e.parents[a]){let l=t.elements.bookmarkBox.all.find("ul > li > a."+t.opts.classes.sidebar.bookmarkDir+"["+t.opts.attr.id+"='"+e.parents[a]+"']");l.hasClass(t.opts.classes.sidebar.dirOpened)?s(a+1):t.helper.list.toggleBookmarkDir(l,!0).then(()=>{s(a+1)})}else t.helper.search.clearSearch().then(()=>{let e=t.elements.bookmarkBox.all.find("ul > li > a["+t.opts.attr.id+"='"+r+"']");t.helper.scroll.setScrollPos(t.elements.bookmarkBox.all,e[0].offsetTop-50),e.addClass(t.opts.classes.sidebar.mark)})};s(0)}break}default:t.helper.overlay.create(l,e(a.currentTarget).attr("title")||e(a.currentTarget).text(),o)}})}},window.DragDropHelper=function(t){let s=null,a=0,l=null,r={running:!1,posY:null,previousDelta:0,fpsLimit:30};this.init=(()=>{b(),i()});let o=e=>{let s=0;if("object"==typeof e){let t=e[0].getBoundingClientRect();s=t.left}else s=+e;return"right"===t.elements.iframe.attr(t.opts.attr.position)&&(s=window.innerWidth-s),"object"==typeof e?.6*e.realWidth()+s>t.elements.sidebar.realWidth():s>t.elements.sidebar.realWidth()},i=()=>{t.elements.iframeBody.on("dragenter",()=>{t.helper.contextmenu.close(),t.elements.iframeBody.addClass(t.opts.classes.drag.isDragged),t.elements.iframe.removeClass(t.opts.classes.page.hideMask),d("selection"),r.running||window.requestAnimationFrame(h)}).on("drop dragend",s=>{if(s.preventDefault(),s.stopPropagation(),r.posY=null,t.elements.iframeBody.hasClass(t.opts.classes.drag.isDragged)){if(o(s.pageX))p("selection",!0);else{let a=t.elements.bookmarkBox.all.find("li."+t.opts.classes.drag.isDragged).eq(0);if(a&&a.length()>0){let l=s.dataTransfer.getData("URL"),r="";location.href===l&&(r=e(document).find("title").text()),p("selection"),t.helper.overlay.create("add",t.helper.i18n.get("contextmenu_add"),{values:{index:a.prevAll("li").length(),parentId:a.parent("ul").prev("a").attr(t.opts.attr.id),title:r,url:l}})}}t.elements.iframeBody.removeClass(t.opts.classes.drag.isDragged),!1===t.helper.utility.sidebarHasMask()&&t.elements.iframe.addClass(t.opts.classes.page.hideMask)}})},n=e=>{let s="bookmark";return"selection"===e?s=e:e.hasClass(t.opts.classes.sidebar.bookmarkDir)?s="directory":e.hasClass(t.opts.classes.sidebar.separator)&&(s="separator"),s},d=e=>{t.helper.model.call("trackEvent",{category:"dragndrop",action:n(e),label:"dragstart"})},p=(e,s=!1)=>{t.helper.model.call("trackEvent",{category:"dragndrop",action:n(e),label:s?"cancel":"dragend"})},c=(s,a,l)=>{t.helper.contextmenu.close();let o=e(s).parent("a").removeClass(t.opts.classes.sidebar.dirOpened),i=o.parent("li");n(o);t.elements.iframeBody.addClass(t.opts.classes.drag.isDragged),i.clone().addClass(t.opts.classes.drag.dragInitial).insertAfter(i);let p=o.clone().appendTo(t.elements.iframeBody),c=o[0].getBoundingClientRect(),m={};o.hasClass(t.opts.classes.sidebar.separator)||(m=t.helper.entry.getData(o.attr(t.opts.attr.id))),p.removeAttr("title").css({top:c.top+"px",left:c.left+"px",width:o.realWidth()+"px"}).data({elm:i,isDir:!!m.isDir,startPos:{top:l-c.top,left:a-c.left}}).addClass(t.opts.classes.drag.helper),i.addClass(t.opts.classes.drag.isDragged),d(o),r.running||window.requestAnimationFrame(h)},h=e=>{window.requestAnimationFrame(h);let s=e-r.previousDelta;if(!(r.fpsLimit&&s<1e3/r.fpsLimit)){if(null!==r.posY){let e=t.elements.bookmarkBox.all[0].offsetTop,s=t.elements.bookmarkBox.all[0].offsetHeight,a=t.elements.bookmarkBox.all[0].scrollTop,l=null;r.posY-e<60?l=a-Math.pow((50-r.posY+e)/10,2):r.posY+60>s&&(l=a+Math.pow((r.posY+50-s)/10,2)),l&&t.helper.scroll.setScrollPos(t.elements.bookmarkBox.all,l)}r.previousDelta=e}},m=()=>{u();let s=t.elements.iframeBody.children("a."+t.opts.classes.drag.helper),a=t.elements.bookmarkBox.all.find("li."+t.opts.classes.drag.dragInitial),l=s.data("elm"),r=l.children("a"),i=n(r);if(o(s))l.insertAfter(a).removeClass(t.opts.classes.drag.isDragged),a.remove(),s.remove(),p(r,!0);else{s.addClass(t.opts.classes.drag.snap);let o=l.parent("ul").prev("a").attr(t.opts.attr.id),n=0;l.prevAll("li").forEach(s=>{s===a||e(s).children("a").hasClass(t.opts.classes.sidebar.separator)||n++}),"separator"===i?t.helper.utility.removeSeparator(r.data("infos")).then(()=>{let e={id:o,index:n};t.helper.utility.addSeparator(e),r.data("infos",e)}):t.helper.model.call("moveBookmark",{id:l.children("a").attr(t.opts.attr.id),parentId:o,index:n}),p(r),setTimeout(()=>{let e=l[0].getBoundingClientRect();s.css({top:e.top+"px",left:e.left+"px"}),setTimeout(()=>{l.removeClass(t.opts.classes.drag.isDragged),a.remove(),s.remove()},200)},0)}t.elements.iframeBody.removeClass(t.opts.classes.drag.isDragged),setTimeout(()=>{!1===t.helper.utility.sidebarHasMask()&&t.elements.iframe.addClass(t.opts.classes.page.hideMask)},500)},u=(e=null)=>{null===l||null!==e&&l.id===e.attr(t.opts.attr.id)||(l.elm.removeClass(t.opts.classes.drag.dragHover),clearTimeout(l.instance),l=null)},g=(i,n,d)=>{r.posY=d;let p=null,c=null,h=0,m=0;if("dragover"===i){if(h=d-20,m=n,h===a)return!1;a=h,t.elements.bookmarkBox.all.find("li."+t.opts.classes.drag.isDragged).remove(),c=e("<li />").html("<a>&nbsp;</a>").addClass(t.opts.classes.drag.isDragged)}else{let e=(p=t.elements.iframeBody.children("a."+t.opts.classes.drag.helper)).data("startPos");h=d-e.top,m=n-e.left,p.css({top:h+"px",left:m+"px"}),c=p.data("elm")}if(o(p||m))return u(),t.elements.iframeBody.addClass(t.opts.classes.drag.cancel),!1;t.elements.iframeBody.removeClass(t.opts.classes.drag.cancel);let g=null;if(e([t.elements.bookmarkBox.all.find("> ul > li > a."+t.opts.classes.sidebar.dirOpened).parent("li"),t.elements.bookmarkBox.all.find("a."+t.opts.classes.sidebar.dirOpened+" + ul > li")]).forEach(s=>{let a=e(s);if(s!==c[0]&&!a.hasClass(t.opts.classes.drag.dragInitial)){let e=s.getBoundingClientRect();if(e.top>h)return!1;g=a}}),g&&g!==s){s=g;let a=g.children("a").eq(0);if(u(a),a.hasClass(t.opts.classes.sidebar.bookmarkDir))if(a.hasClass(t.opts.classes.sidebar.dirOpened)){let e=c.prependTo(a.next("ul"));p&&p.data("elm",e)}else if(p&&p.data("isDir")){let e=c.insertAfter(g);p&&p.data("elm",e)}else a.hasClass(t.opts.classes.sidebar.dirAnimated)?0===a.next("ul").length()&&(a.addClass(t.opts.classes.sidebar.dirOpened),e("<ul />").insertAfter(a)):null===l&&((l={id:a.attr(t.opts.attr.id),elm:a.addClass(t.opts.classes.drag.dragHover)}).instance=setTimeout(()=>{t.helper.list.toggleBookmarkDir(a)},700));else{let e=c.insertAfter(g);p&&p.data("elm",e)}}},b=()=>{t.elements.bookmarkBox.all.children("ul").on("mousedown","span."+t.opts.classes.drag.trigger,e=>{let s=e.pageX;if(!1===t.helper.utility.sidebarHasMask()&&"right"===t.elements.iframe.attr(t.opts.attr.position)){let e=t.elements.iframe.realWidth();t.elements.iframe.removeClass(t.opts.classes.page.hideMask),s+=t.elements.iframe.realWidth()-e}t.elements.iframe.removeClass(t.opts.classes.page.hideMask),c(e.currentTarget,s,e.pageY)}),t.elements.iframeBody.on("mouseup",e=>{r.posY=null,t.elements.iframeBody.hasClass(t.opts.classes.drag.isDragged)&&(e.preventDefault(),e.stopPropagation(),m())}),t.elements.iframeBody.on("wheel",e=>{if(t.elements.iframeBody.hasClass(t.opts.classes.drag.isDragged)){e.preventDefault(),e.stopPropagation();let s=t.elements.bookmarkBox.all[0].scrollTop;t.helper.scroll.setScrollPos(t.elements.bookmarkBox.all,s-e.wheelDelta,300)}}),t.elements.iframeBody.on("mousemove dragover",e=>{t.elements.iframeBody.hasClass(t.opts.classes.drag.isDragged)&&1===e.which&&(e.preventDefault(),e.stopPropagation(),g(e.type,e.pageX,e.pageY))}),t.elements.iframeBody.on("contextmenu","a."+t.opts.classes.drag.helper,e=>{e.preventDefault(),e.stopPropagation()})}},window.EntryHelper=function(e){let t={};this.update=(s=>new Promise(a=>{e.helper.model.call("viewAmounts").then(l=>{let r=e.helper.model.getData(["u/hiddenEntries","u/pinnedEntries"]),o=e.elements.sidebar.hasClass(e.opts.classes.sidebar.showHidden);t={bookmarks:{},directories:{},pinned:{}};let i=(s,a=[],n=!1)=>{s.forEach((s,d)=>{if(o||!0!==r.hiddenEntries[s.id]){let o=[...a];"0"!==s.parentId&&o.push(s.parentId),s.hidden=n||!0===r.hiddenEntries[s.id],s.parents=o;let p=new Date(Math.max(s.dateAdded,l.counterStartDate)),c=Math.max(1,Math.round((+new Date-p)/2627999942.4));if(s.views={startDate:p,total:0},s.url){e.opts.demoMode&&(s.title=e.helper.i18n.get("overlay_label_bookmark")+" "+(d+1),s.url="https://example.com/");let a=0,i=0;if(l.viewAmounts[s.id]&&(a=l.viewAmounts[s.id].c,i=l.viewAmounts[s.id].d||0),s.views.total=a,s.views.lastView=i,s.views.perMonth=Math.round(a/c*100)/100,o.forEach(e=>{t.directories[e].childrenAmount.bookmarks++,t.directories[e].views.total+=a,t.directories[e].views.lastView=Math.max(t.directories[e].views.lastView||0,i)}),s.pinned=!1,t.bookmarks[s.id]=s,r.pinnedEntries[s.id]){s.pinned=!0;let e=Object.assign({},s);e.index=r.pinnedEntries[s.id].index,delete e.parents,delete e.parentId,t.pinned[s.id]=e}}else s.children&&(e.opts.demoMode&&(s.title=e.helper.i18n.get("overlay_label_dir")+" "+(d+1)),s.childrenAmount={bookmarks:0,directories:0,total:0},o.forEach(e=>{t.directories[e].childrenAmount.directories++}),t.directories[s.id]=s,i(s.children,o,s.hidden),s.isDir=!0,s.childrenAmount.total=s.childrenAmount.bookmarks+s.childrenAmount.directories,s.views.perMonth=Math.round(s.views.total/c*100)/100)}})};i(s),a()})})),this.getAllPinnedData=(()=>Object.values(t.pinned)),this.getAllBookmarkData=(()=>Object.values(t.bookmarks)),this.getData=(e=>{let s=null;return"object"==typeof t.bookmarks[e]?s=t.bookmarks[e]:"object"==typeof t.directories[e]&&(s=t.directories[e]),s}),this.addData=((e,s,a)=>{"object"==typeof t.bookmarks[e]?t.bookmarks[e][s]=a:"object"==typeof t.directories[e]&&(t.directories[e][s]=a)}),this.isVisible=(e=>{let s=!1;return"object"==typeof t.bookmarks[e]?s=!1===t.bookmarks[e].hidden:"object"==typeof t.directories[e]&&(s=!1===t.directories[e].hidden),s})},window.FontHelper=function(t){let s={general:{name:"Roboto",href:"https://fonts.googleapis.com/css?family=Roboto:100,200,300,400,500,100i,200i,300i,400i,500i"},ja:{name:"Noto Sans Japanese",href:"https://fonts.googleapis.com/earlyaccess/notosansjapanese.css"},"zh-CN":{name:"Noto Sans SC",href:"https://fonts.googleapis.com/earlyaccess/notosanssc.css"}},a={__default:{Thin:100,ExtraLight:200,Light:300,Normal:400,Medium:500,SemiBold:600,Bold:700,ExtraBold:800,Black:900},Roboto:{Thin:100,ExtraLight:100,Light:200,Normal:300,Medium:400,SemiBold:400,Bold:500,ExtraBold:500,Black:500},"Noto Sans Japanese":{Thin:100,ExtraLight:100,Light:100,Normal:200,Medium:300,SemiBold:400,Bold:500,ExtraBold:500,Black:500},"Noto Sans SC":{Thin:100,ExtraLight:100,Light:100,Normal:300,Medium:400,SemiBold:400,Bold:400,ExtraBold:500,Black:500}},l={};this.init=(()=>{let e=t.helper.model.getData("a/styles");(l=e.fontFamily&&"default"!==e.fontFamily&&"Roboto"!==e.fontFamily?{name:e.fontFamily}:this.getDefaultFontInfo()).fontWeights=this.getFontWeights(l.name)}),this.isLoaded=(()=>!!l.name),this.getFontInfo=(()=>l),this.getFontWeights=(e=>{let t={};return Object.keys(a.__default).forEach(s=>{let l=a.__default[s];a[e]&&a[e][s]&&(l=a[e][s]),t["fontWeight"+s]=l}),t}),this.addStylesheet=(t=>{l.href&&e("<link />").attr({rel:"stylesheet",type:"text/css",href:l.href}).appendTo(t.find("head"))}),this.getDefaultFontInfo=(()=>{let e=t.helper.i18n.getLanguage();return s[e]?s[e]:s.general})},window.I18nHelper=function(t){let s=null,a={},l={i18n:"data-i18n",i18nReplaces:"data-i18nReplaces"};this.init=(()=>new Promise(e=>{a={},t.helper.model.call("languageInfos").then(l=>{let r=t.helper.model.getData("a/language");"default"===r&&(r=chrome.i18n.getUILanguage());let o=this.getDefaultLanguage();[r,o].some(r=>{if(l.infos&&l.infos[r]&&l.infos[r].available)return s=r,t.helper.model.call("langvars",{lang:r,defaultLang:o}).then(t=>{t&&t.langVars&&(a=t.langVars,e())}),!0})})})),this.getLanguage=(()=>s),this.getDefaultLanguage=(()=>t.opts.manifest.default_locale),this.getLocaleSortCollator=(()=>new Intl.Collator([chrome.i18n.getUILanguage(),this.getDefaultLanguage()])),this.getLocaleDate=(e=>e.toLocaleDateString([chrome.i18n.getUILanguage(),this.getDefaultLanguage()],{year:"numeric",month:"2-digit",day:"2-digit"})),this.parseHtml=(t=>{e(t).find("["+l.i18n+"]").forEach(t=>{let s=null,a=e(t).attr(l.i18n);if(a){let r=[],o=e(t).attr(l.i18nReplaces);o&&(r=o.split(",")),s=this.get(a,r)}s?(e(t).removeAttr(l.i18n),e(t).html(s)):e(t).remove()})}),this.get=((e,t=[])=>{let s="",l=a[e];return l&&l.message&&(s=l.message,t.forEach((e,t)=>{s=s.replace(new RegExp("\\{"+(t+1)+"\\}"),e)}),s=s.replace(/\[b\](.*)\[\/b\]/,"<strong>$1</strong>"),s=s.replace(/\[a\](.*)\[\/a\]/,"<a href='#'>$1</a>"),s=s.replace(/\[em\](.*)\[\/em\]/,"<em>$1</em>")),s})},window.ListHelper=function(t){let s=0,a=null;this.init=(()=>{t.elements.bookmarkBox.all.addClass(t.opts.classes.sidebar.active),Object.values(t.elements.bookmarkBox).forEach(e=>{e.on(t.opts.events.scrollBoxLastPart,()=>{let s=e.children("ul"),a=s.data("remainingEntries");a&&a.length>0&&(this.addBookmarkDir(a,s,!1,!1),(t.refreshRun||!1===t.elements.iframe.hasClass(t.opts.classes.page.visible))&&t.helper.scroll.restoreScrollPos(e))})}),this.updateBookmarkBox()}),this.getSortList=(()=>({custom:{dir:"ASC"},alphabetical:{dir:"ASC"},mostUsed:{dir:"DESC"},recentlyUsed:{dir:"DESC"},recentlyAdded:{dir:"DESC"}})),this.getSort=(()=>a),this.updateSort=((e,s)=>{let l=this.getSortList();l[e]&&(void 0===s&&(s=l[e].dir),a={name:e,dir:"ASC"===s?"ASC":"DESC"},t.startLoading(),t.helper.model.setData({"u/sort":a}).then(()=>{t.helper.model.call("trackEvent",{category:"sorting",action:"change",label:a.name+"_"+a.dir}),t.helper.model.call("refreshAllTabs",{scrollTop:!0,type:"Sort"})}))}),this.updateDirection=(e=>{this.updateSort(a.name,e)}),this.updateBookmarkBox=(()=>{t.startLoading(),a=t.helper.model.getData("u/sort"),t.elements.sidebar.attr(t.opts.attr.sort,a.name);let e=t.elements.bookmarkBox.all.children("ul"),s=[];t.helper.model.call("bookmarks",{id:0}).then(a=>(t.refreshRun=!0,e.removeClass(t.opts.classes.sidebar.hideRoot).text(""),a.bookmarks&&a.bookmarks[0]&&a.bookmarks[0].children&&(s=a.bookmarks[0].children),t.helper.entry.update(s))).then(()=>{n(),this.updateSortFilter(),t.helper.search.init(),t.helper.model.getData("u/viewAsTree")||"custom"===a.name?this.addBookmarkDir(s,e,!0):this.addBookmarkDir(t.helper.entry.getAllBookmarkData(),e,!1),1===e.children("li:not(."+t.opts.classes.sidebar.entryPinned+")").length()?(e.addClass(t.opts.classes.sidebar.hideRoot),this.toggleBookmarkDir(e.find("> li > a."+t.opts.classes.sidebar.bookmarkDir).eq(0))):this.restoreOpenStates(e)}),t.helper.scroll.focus()}),this.toggleBookmarkDir=((s,a)=>new Promise(l=>{s.addClass(t.opts.classes.sidebar.dirAnimated);let r=s.attr(t.opts.attr.id),i=s.next("ul"),n=i.length()>0;void 0===a&&(a=!0===t.refreshRun||!1===t.elements.iframe.hasClass(t.opts.classes.page.visible)||!1===t.helper.model.getData("b/animations")),s.hasClass(t.opts.classes.sidebar.dirOpened)&&n?o(s,i,!1,a).then(l):(t.helper.model.getData("b/dirAccordion")&&t.elements.bookmarkBox.all.find("a."+t.opts.classes.sidebar.dirOpened).forEach(s=>{0===e(s).next("ul").find("a["+t.opts.attr.id+"='"+r+"']").length()&&this.toggleBookmarkDir(e(s),a)}),n?o(s,i,!0,a).then(l):t.helper.model.call("bookmarks",{id:r}).then(t=>{t.bookmarks&&t.bookmarks[0]&&t.bookmarks[0].children&&(i=e("<ul />").insertAfter(s),this.addBookmarkDir(t.bookmarks[0].children,i),o(s,i,!0,a).then(l()))}))})),this.restoreOpenStates=(e=>{let a=0,l=t.helper.model.getData(["b/rememberState","u/openStates"]);"all"!==l.rememberState&&"openStates"!==l.rememberState&&"openStatesRoot"!==l.rememberState||(s++,Object.keys(l.openStates).forEach(s=>{if(!0===l.openStates[s]){let r=e.find("> li > a."+t.opts.classes.sidebar.bookmarkDir+"["+t.opts.attr.id+"='"+s+"']");r.length()>0&&("openStatesRoot"===l.rememberState&&1!==r.parents("ul").length()||(a++,this.toggleBookmarkDir(r)))}}),s--),0===a&&0===s&&setTimeout(()=>{t.helper.scroll.restoreScrollPos(t.elements.bookmarkBox.all).then(()=>{t.initImages(),t.endLoading(200),t.firstRun=!1,t.refreshRun=!1,t.loaded()})},100)}),this.updateSortFilter=(()=>{t.elements.filterBox.removeClass(t.opts.classes.sidebar.hidden).text("");let s=0;if("custom"===a.name)t.elements.filterBox.addClass(t.opts.classes.sidebar.hidden);else{let l=t.helper.model.getData(["u/viewAsTree","u/mostViewedPerMonth"]),r=a.name.replace(/([A-Z])/g,"_$1").toLowerCase();e("<a />").attr(t.opts.attr.direction,a.dir).text(t.helper.i18n.get("sort_label_"+r)).appendTo(t.elements.filterBox);let o=e("<ul />").appendTo(t.elements.filterBox);t.elements.bookmarkBox.search.hasClass(t.opts.classes.sidebar.active)||e("<li />").append(t.helper.checkbox.get(t.elements.iframeBody,{[t.opts.attr.name]:"viewAsTree",checked:l.viewAsTree?"checked":""})).append("<a>"+t.helper.i18n.get("sort_view_as_tree")+"</a>").appendTo(o),"mostUsed"===a.name&&e("<li />").append(t.helper.checkbox.get(t.elements.iframeBody,{[t.opts.attr.name]:"mostViewedPerMonth",checked:l.mostViewedPerMonth?"checked":""})).append("<a>"+t.helper.i18n.get("sort_most_used_per_month")+"</a>").appendTo(o),0===o.children("li").length()&&o.remove(),s=t.elements.filterBox.realHeight()}Object.values(t.elements.bookmarkBox).forEach(e=>{e.css("padding-top",s)})});let l=(s,a,l)=>{let r=e("<li />").appendTo(a),o=e("<a />").html("<span class='"+t.opts.classes.sidebar.bookmarkLabel+"'>"+(s.title||"")+"</span><span class='"+t.opts.classes.drag.trigger+"' />").appendTo(r);return s.id&&o.attr(t.opts.attr.id,s.id),s.separator||!1!==t.helper.entry.isVisible(s.id)||r.addClass(t.opts.classes.sidebar.hidden),t.helper.entry.addData(s.id,"element",o),s.children&&l.asTree?(o.attr("title",s.title+"\n-------------\n"+s.children.length+" "+t.helper.i18n.get("sidebar_dir_children")).addClass(t.opts.classes.sidebar.bookmarkDir),l.config.showDirectoryIcons&&o.prepend("<span class='"+t.opts.classes.sidebar.dirIcon+"' />")):s.url?(o.attr("title",s.title+"\n-------------\n"+s.url).addClass(t.opts.classes.sidebar.bookmarkLink),l.config.showBookmarkIcons&&(t.opts.demoMode?o.prepend("<span class='"+t.opts.classes.sidebar.dirIcon+"' data-color='"+(Math.floor(10*Math.random())+1)+"' />"):t.helper.model.call("favicon",{url:s.url}).then(e=>{e.img&&(t.helper.entry.addData(s.id,"icon",e.img),o.prepend("<img "+(l.sidebarOpen?"src":t.opts.attr.src)+"='"+e.img+"' />"))}))):s.separator&&o.addClass(t.opts.classes.sidebar.separator).data("infos",{id:s.parentId,index:s.index}),r};this.addBookmarkDir=((e,s,o=!0,i=!0)=>{let n=!1,d=t.helper.model.getData(["a/showBookmarkIcons","a/showDirectoryIcons","b/dirOpenDuration"]),p=t.elements.iframe.hasClass(t.opts.classes.page.visible),c=t.elements.sidebar.hasClass(t.opts.classes.sidebar.showHidden);if(0===s.parents("li").length()){if(0===s.find("li."+t.opts.classes.sidebar.entryPinned).length()){let e=t.helper.entry.getAllPinnedData();r(e),e.forEach(e=>{if(c||t.helper.entry.isVisible(e.id)){let a=l(e,s,{config:d,asTree:o,sidebarOpen:p});a.addClass(t.opts.classes.sidebar.entryPinned)}})}}else s.css("transition","height "+d.dirOpenDuration+"s");if(o&&"custom"===a.name&&s.prev("a").length()>0){let a=s.prev("a").attr("data-id"),l=t.helper.model.getData("u/separators");l[a]&&l[a].forEach(t=>{t.separator=!0,t.parentId=a,e.push(t)})}let h=0;return s.removeData("remainingEntries"),i&&r(e),e.some((a,r)=>{if((c||a.separator||t.helper.entry.isVisible(a.id))&&(a.children||a.url||a.separator)&&(t.opts.demoMode&&(a.children?a.title="Directory "+(r+1):(a.title="Bookmark "+(r+1),a.url="https://example.com/")),l(a,s,{config:d,asTree:o,sidebarOpen:p}),a.url&&h++,n=!0,!1===o&&h>=100)){let t=e.slice(100);return t.length>0&&s.data("remainingEntries",t),!0}}),n});let r=e=>{if(e.length>1){let s=t.helper.i18n.getLocaleSortCollator(),l=(t,s)=>{e.sort((e,l)=>"custom"!==a.name&&!!e.children!=!!l.children?e.children?-1:1:(t===a.dir?1:-1)*s(e,l))};switch(a.name){case"custom":l("ASC",(e,t)=>e.index-(e.separator?.5:0)-(t.index-(t.separator?.5:0)));break;case"alphabetical":l("ASC",(e,t)=>s.compare(e.title,t.title));break;case"recentlyAdded":l("DESC",(e,t)=>t.dateAdded-e.dateAdded);break;case"mostUsed":{let e=t.helper.model.getData("u/mostViewedPerMonth");l("DESC",(a,l)=>{let r=t.helper.entry.getData(a.id),o=t.helper.entry.getData(l.id),i=r?r.views[e?"perMonth":"total"]:0,n=o?o.views[e?"perMonth":"total"]:0;return i===n?s.compare(a.title,l.title):n-i});break}case"recentlyUsed":l("DESC",(e,a)=>{let l=t.helper.entry.getData(e.id),r=t.helper.entry.getData(a.id),o=l?l.views.lastView:0,i=r?r.views.lastView:0;return o===i?s.compare(e.title,a.title):i-o})}}},o=(e,s,a,l)=>new Promise(r=>{let o=t.firstRun;if(s.css("height",s[0].scrollHeight+"px"),!1===a&&setTimeout(()=>{s.css("height",0)},0),!0===t.refreshRun)this.restoreOpenStates(s);else{let s=t.helper.model.getData("u/openStates");s[e.attr(t.opts.attr.id)]=a,!1===a?i(e,s):t.helper.model.setData({"u/openStates":s})}let n=t.helper.model.getData("b/dirOpenDuration");setTimeout(()=>{!1===a?e.removeClass(t.opts.classes.sidebar.dirOpened):(e.addClass(t.opts.classes.sidebar.dirOpened),t.helper.model.getData("b/dirAccordion")&&t.helper.scroll.setScrollPos(t.elements.bookmarkBox.all,e[0].offsetTop,300)),s.css("height",""),e.removeClass(t.opts.classes.sidebar.dirAnimated),o||t.helper.model.call("trackEvent",{category:"directory",action:"openState_change",label:a?"open":"close"}),r()},l?0:1e3*+n)}),i=(s,a)=>{s.next("ul").find("a."+t.opts.classes.sidebar.bookmarkDir).forEach(s=>{a[e(s).attr(t.opts.attr.id)]=!1,setTimeout(()=>{e(s).removeClass(t.opts.classes.sidebar.dirOpened)},500)}),t.helper.model.setData({"u/openStates":a})},n=()=>{t.elements.header.text("");let s=t.helper.entry.getAllBookmarkData().length,a=e("<h1 />").html("<strong>"+s+"</strong> <span>"+t.helper.i18n.get("header_bookmarks"+(1===s?"_single":""))+"</span>").attr("title",s+" "+t.helper.i18n.get("header_bookmarks"+(1===s?"_single":""))).appendTo(t.elements.header),l=[];l.push(e("<a />").addClass(t.opts.classes.sidebar.menu).appendTo(t.elements.header)),l.push(e("<a />").addClass(t.opts.classes.sidebar.sort).appendTo(t.elements.header)),l.push(e("<a />").addClass(t.opts.classes.sidebar.search).appendTo(t.elements.header));let r=window.getComputedStyle(t.elements.header[0]),o=parseInt(r.getPropertyValue("padding-top"));l.some(e=>{if(e[0].offsetTop>o)return a.children("span").addClass(t.opts.classes.sidebar.hidden),!0}),e("<div />").addClass(t.opts.classes.sidebar.searchBox).append("<input type='text' placeholder='"+t.helper.i18n.get("sidebar_search_placeholder")+"' />").append("<a class='"+t.opts.classes.sidebar.searchClose+"'></a>").appendTo(t.elements.header)}},window.ModelHelper=function(e){let t={textColor:{light:"rgb(100,100,100)",dark:"rgb(200,200,200)"},sidebarMaskColor:{light:"rgba(255,255,255,0.8)",dark:"rgba(0,0,0,0.6)"},colorScheme:{light:"rgb(27,130,241)",dark:"rgb(31, 77, 128)"}},s={u:{openStates:{},hiddenEntries:{},scrollPos:{},separators:{},pinnedEntries:{},entriesLocked:!1,sort:{name:"custom",dir:"ASC"},mostViewedPerMonth:!1,viewAsTree:!0},b:{animations:!0,preventPageScroll:!1,pxTolerance:{windowed:20,maximized:1},openAction:"mousedown",newTab:"foreground",newTabPosition:"afterCurrent",linkAction:"current",dirAccordion:!1,rememberState:"all",rememberSearch:!0,dirOpenDuration:.5,openDelay:0,closeTimeout:1,initialOpenOnNewTab:!1},a:{sidebarPosition:"left",language:"default",showIndicator:!0,showIndicatorIcon:!0,darkMode:!1,showBookmarkIcons:!0,showDirectoryIcons:!0,styles:{colorScheme:t.colorScheme.light,textColor:t.textColor.light,indicatorWidth:"40px",indicatorIconSize:"32px",indicatorIconColor:"rgb(255,255,255)",indicatorColor:"rgba(0,0,0,0.5)",sidebarWidth:"350px",sidebarMaskColor:t.sidebarMaskColor.light,bookmarksFontSize:"14px",directoriesIconSize:"16px",bookmarksIconSize:"16px",bookmarksLineHeight:"40px",bookmarksDirIcon:"dir-1",bookmarksDirColor:t.textColor.light,bookmarksDirIndentation:"25px",bookmarksHorizontalPadding:"16px",overlayMaskColor:"rgba(0,0,0,0.5)",fontFamily:"default"}}},a={};this.init=(()=>new Promise(e=>{let t=["utility","behaviour","appearance"];chrome.storage.sync.get(t,s=>{a=s,t.forEach(e=>{void 0===a[e]&&(a[e]={})}),e()})})),this.getAllData=(()=>a),this.getData=(t=>{let l=t;"string"==typeof l&&(l=[l]);let r={};if(l.forEach(t=>{let l=t.split("/")[0],o=t.split("/")[1],i=null,n=null;switch(l){case"u":n=a.utility;break;case"b":n=a.behaviour;break;case"a":n=a.appearance}if(null!==n&&(void 0===n[o]?void 0!==s[l]&&void 0!==s[l][o]&&(i=s[l][o]):i=n[o]),"a/styles"===t){if(i=Object.assign({},s.a.styles,i),e.helper.font&&e.helper.font.isLoaded()){let t=e.helper.font.getFontInfo();i.fontFamily=t.name,Object.assign(i,t.fontWeights)}"__color_ee"===i.colorScheme&&(i.isEE=!0,i.colorScheme="#7b5fa4")}r[o]=i}),"string"==typeof t){let e=t.split("/")[1];r=r[e]}return r}),this.setData=(e=>new Promise(t=>{this.init().then(()=>{Object.keys(e).forEach(t=>{let s=t.split("/")[0],l=t.split("/")[1],r=e[t];switch(s){case"u":a.utility[l]=r;break;case"b":a.behaviour[l]=r;break;case"a":a.appearance[l]=r}});try{chrome.storage.sync.set(a,()=>{t()})}catch(e){t()}})})),this.call=((e,t={})=>new Promise(s=>{t.type=e,chrome.extension.sendMessage(t,e=>{s(e)})})),this.getDefaultColor=((e,s)=>t[e]?s&&t[e][s]?t[e][s]:t[e].light:null)},window.OverlayHelper=function(t){let s={};this.create=((l,r,h)=>{s.overlay=e("<iframe />").attr("id",t.opts.ids.page.overlay).appendTo("body"),!1===t.helper.model.getData("b/animations")&&s.overlay.addClass(t.opts.classes.page.noAnimations),t.helper.stylesheet.addStylesheets(["overlay"],s.overlay);let u=s.overlay.find("body");s.modal=e("<div />").attr(t.opts.attr.type,l).addClass(t.opts.classes.overlay.modal).appendTo(u),!0===t.helper.model.getData("a/darkMode")&&u.addClass(t.opts.classes.page.darkMode);let g=l;switch(s.modal.append("<h1>"+r+"</h1>"),e("<a />").addClass(t.opts.classes.overlay.close).appendTo(s.modal),s.buttonWrapper=e("<menu />").addClass(t.opts.classes.overlay.buttonWrapper).appendTo(s.modal),e("<a />").addClass(t.opts.classes.overlay.close).appendTo(s.buttonWrapper),a("infos"===l?"close":"cancel"),l){case"delete":o(h);break;case"edit":i(h);break;case"infos":c(h);break;case"add":p(h);break;case"hide":d(h);break;case"openChildren":n(h);break;case"updateUrls":m(h)}t.helper.model.call("trackPageView",{page:"/overlay/"+g}),w(h),setTimeout(()=>{s.modal.addClass(t.opts.classes.overlay.visible),s.overlay.addClass(t.opts.classes.page.visible)},100)});let a=(e="close")=>{s.buttonWrapper.children("a."+t.opts.classes.overlay.close).text(t.helper.i18n.get("overlay_"+e))},l=(e=!1,a="")=>{t.helper.model.call("realUrl",{abort:!0}),t.elements.bookmarkBox.all.find("li."+t.opts.classes.drag.isDragged).remove(),s.overlay.removeClass(t.opts.classes.page.visible),t.helper.model.call("trackEvent",{category:"overlay",action:e?"cancel":"action",label:s.modal.attr(t.opts.attr.type)+a}),t.helper.scroll.focus(),setTimeout(()=>{s.overlay.remove()},500)},r=(a,l)=>{let r=e("<"+(a.isDir?"span":"a")+" />").attr("title",a.title+(a.url?"\n"+a.url:"")).addClass(t.opts.classes.overlay.preview).html(a.title).appendTo(s.modal);a.isDir?r.prepend("<span class='"+t.opts.classes.sidebar.dirIcon+"' />"):a.icon?r.prepend("<img src='"+a.icon+"' />"):t.opts.demoMode&&r.prepend("<span class='"+t.opts.classes.sidebar.dirIcon+"' data-color='"+(Math.floor(10*Math.random())+1)+"' />"),l&&!0===l&&!0!==a.isDir&&e("<a />").addClass(t.opts.classes.overlay.previewUrl).attr("title",a.url).text(a.url).insertAfter(r)},o=a=>{e("<p />").text(t.helper.i18n.get("overlay_delete_"+(a.isDir?"dir":"bookmark")+"_confirm")).appendTo(s.modal),r(a),e("<a />").addClass(t.opts.classes.overlay.action).text(t.helper.i18n.get("overlay_delete")).appendTo(s.buttonWrapper)},i=a=>{r(a);let l=e("<ul />").appendTo(s.modal);l.append("<li><label>"+t.helper.i18n.get("overlay_bookmark_title")+"</label><input type='text' name='title' value='"+a.title+"' /></li>"),a.isDir||l.append("<li><label>"+t.helper.i18n.get("overlay_bookmark_url")+"</label><input type='text' name='url' value='"+a.url+"' /></li>"),e("<a />").addClass(t.opts.classes.overlay.action).text(t.helper.i18n.get("overlay_save")).appendTo(s.buttonWrapper)},n=a=>{let l=a.children.filter(e=>!!e.url),o=t.helper.i18n.get("overlay_confirm_open_children",[l.length]);e("<p />").text(o).appendTo(s.modal),r(a),e("<a />").addClass(t.opts.classes.overlay.action).text(t.helper.i18n.get("overlay_open_children")).appendTo(s.buttonWrapper)},d=a=>{e("<p />").text(t.helper.i18n.get("overlay_hide_"+(a.isDir?"dir":"bookmark")+"_confirm")).appendTo(s.modal),r(a),e("<a />").addClass(t.opts.classes.overlay.action).text(t.helper.i18n.get("overlay_hide_from_sidebar")).appendTo(s.buttonWrapper)},p=a=>{let r=e("<a />").addClass(t.opts.classes.overlay.action).text(t.helper.i18n.get("overlay_save")).appendTo(s.buttonWrapper),o=e("<menu />").appendTo(s.modal),i=e("<a />").attr(t.opts.attr.type,"bookmark").attr("title",t.helper.i18n.get("overlay_label_bookmark")).appendTo(o);e("<a />").attr(t.opts.attr.type,"dir").attr("title",t.helper.i18n.get("overlay_label_dir")).appendTo(o),e("<a />").attr(t.opts.attr.type,"separator").attr("title",t.helper.i18n.get("overlay_label_separator")).appendTo(o),o.children("a").on("click",i=>{i.preventDefault();let n=e(i.currentTarget).attr(t.opts.attr.type);if("separator"===n)t.helper.utility.addSeparator({id:a.id,index:0}).then(()=>{l(!1,"_separator"),t.helper.model.call("refreshAllTabs",{type:"Separator"})});else{let l=e("<ul />").appendTo(s.modal),d="",p="";"bookmark"===n&&(d=e(document).find("title").text(),p=location.href),a&&a.values&&(a.values.title&&(d=a.values.title),a.values.url&&(p=a.values.url)),l.append("<li><h2>"+e(i.currentTarget).attr("title")+"</h2></li>"),l.append("<li><label>"+t.helper.i18n.get("overlay_bookmark_title")+"</label><input type='text' name='title' value='"+d+"' /></li>"),"bookmark"===n&&l.append("<li><label>"+t.helper.i18n.get("overlay_bookmark_url")+"</label><input type='text' name='url' value='"+p+"'  /></li>"),o.addClass(t.opts.classes.sidebar.hidden),setTimeout(()=>{l.addClass(t.opts.classes.overlay.visible),r.addClass(t.opts.classes.overlay.visible)},a&&a.values?0:100)}}),a&&a.values&&i.trigger("click")},c=a=>{r(a,!0);let l=e("<ul />").appendTo(s.modal),o=new Date(a.dateAdded);if(e("<li />").html(t.helper.i18n.get("overlay_bookmark_created_date")+" "+t.helper.i18n.getLocaleDate(o)).appendTo(l),a.isDir){let s=e("<li />").addClass(t.opts.classes.overlay.hasTooltip).append("<span>"+a.childrenAmount.total+"</span>").append(" "+t.helper.i18n.get("overlay_dir_children"),!1).appendTo(l);e("<ul />").append("<li>"+a.childrenAmount.bookmarks+" "+t.helper.i18n.get("overlay_dir_children_bookmarks")+"</li>").append("<li>"+a.childrenAmount.directories+" "+t.helper.i18n.get("overlay_dir_children_dirs")+"</li>").appendTo(s)}let i=e("<li />").addClass(t.opts.classes.overlay.hasTooltip).append("<span>"+a.views.total+"</span>").append(" "+t.helper.i18n.get("overlay_bookmark_views"+(1===a.views.total?"_single":"")),!1).appendTo(l);e("<ul />").append("<li>"+t.helper.i18n.get("overlay_bookmark_views_since")+" "+t.helper.i18n.getLocaleDate(a.views.startDate)+"</li>").append("<li>"+a.views.perMonth+" "+t.helper.i18n.get("overlay_bookmark_views"+(1===a.views.perMonth?"_single":""))+" "+t.helper.i18n.get("overlay_bookmark_views_per_month")+"</li>").appendTo(i)},h=l=>{let r=l.length>0;setTimeout(()=>{s.desc.remove(),s.progressBar.remove(),s.progressLabel.remove(),r&&s.modal.addClass(t.opts.classes.overlay.urlCheckList),setTimeout(()=>{if(s.loader.remove(),s.modal.removeClass(t.opts.classes.overlay.urlCheckLoading),a("close"),0===l.length)e("<p />").addClass(t.opts.classes.overlay.success).text(t.helper.i18n.get("overlay_check_urls_no_results")).appendTo(s.modal);else{e("<a />").addClass(t.opts.classes.overlay.action).text(t.helper.i18n.get("overlay_update")).appendTo(s.buttonWrapper);let a=t.helper.scroll.add(t.opts.ids.overlay.urlList,e("<ul />").appendTo(s.modal)),r=s.overlay.find("body");l.forEach(s=>{let l=e("<li />").data("entry",s).append(t.helper.checkbox.get(r,{checked:"checked"})).append("<strong>"+s.title+"</strong>");e("<a />").attr({href:s.url,title:s.url,target:"_blank"}).html("<span>"+s.url+"</span>").appendTo(l),404===s.urlStatusCode?e("<span />").text(t.helper.i18n.get("overlay_check_urls_not_found")).appendTo(l):s.newUrl!==s.url&&e("<a />").attr({href:s.newUrl,title:s.newUrl,target:"_blank"}).html("<span>"+s.newUrl+"</span>").appendTo(l),l=l.appendTo(a.children("ul")),t.helper.model.call("favicon",{url:s.url}).then(s=>{s.img&&e("<img src='"+s.img+"' />").insertAfter(l.children("div."+t.opts.classes.checkbox.box))})})}},r?1e3:0)},1e3)},m=l=>{s.loader=t.helper.template.loading().appendTo(s.modal),s.desc=e("<p />").text(t.helper.i18n.get("overlay_check_urls_loading")).appendTo(s.modal),t.helper.model.call("websiteStatus").then(r=>{if("available"===r.status){let a=[],r=e=>{e.forEach(e=>{e.url?a.push(e):e.children&&r(e.children)})};r(l.children);let o=a.length;s.progressBar=e("<div />").addClass(t.opts.classes.overlay.progressBar).html("<div />").appendTo(s.modal),s.progressLabel=e("<span />").addClass(t.opts.classes.overlay.checkUrlProgressLabel).html("<span>0</span>/<span>"+o+"</span>").appendTo(s.modal),setTimeout(()=>{s.modal.addClass(t.opts.classes.overlay.urlCheckLoading)},500);let i=0,n=[];a.forEach(e=>{t.helper.model.call("realUrl",{url:e.url}).then(t=>{i++,s.progressBar.children("div").css("width",i/o*100+"%"),s.progressLabel.children("span").eq(0).text(i),(404==+t.code||e.url!==t.url&&302!=+t.code)&&(e.newUrl=t.url,e.urlStatusCode=+t.code,n.push(e)),i===o&&h(n)})})}else s.loader.remove(),s.desc.remove(),e("<div />").addClass(t.opts.classes.overlay.inputError).append("<h3>"+t.helper.i18n.get("status_service_unavailable_headline")+"</h3>").append("<p>"+t.helper.i18n.get("status_check_urls_unavailable_desc")+"</p>").appendTo(s.modal),a("close")})},u=e=>{l();let s=e.children.filter(e=>!!e.url);t.helper.utility.openAllBookmarks(s,"foreground"===t.helper.model.getData("b/newTab"))},g=e=>{t.startLoading(),l();let s=t.helper.model.getData("u/hiddenEntries");s[e.id]=!0,t.helper.model.setData({"u/hiddenEntries":s}).then(()=>{t.helper.model.call("refreshAllTabs",{type:"Hide"})})},b=e=>{l(),t.helper.model.call("deleteBookmark",{id:e.id}).then(()=>{e.element.parent("li").remove()})},f=e=>{let a=s.modal.find("input[name='title']").removeClass(t.opts.classes.overlay.inputError),l=s.modal.find("input[name='url']").removeClass(t.opts.classes.overlay.inputError),r={errors:!1,values:{title:a[0].value.trim(),url:e?null:l[0].value.trim()}};return 0===r.values.title.length&&(a.addClass(t.opts.classes.overlay.inputError),r.errors=!0),e||0!==r.values.url.length||(l.addClass(t.opts.classes.overlay.inputError),r.errors=!0),null!==r.values.url&&0!==r.values.url.search(/^\w+\:\/\//)&&(r.values.url="http://"+r.values.url),r},k=e=>{let a=f(e.isDir);!1===a.errors&&t.helper.model.call("updateBookmark",{id:e.id,title:a.values.title,url:a.values.url}).then(r=>{r.error?s.modal.find("input[name='url']").addClass(t.opts.classes.overlay.inputError):(l(),e.title=a.values.title,e.url=a.values.url,e.element.children("span."+t.opts.classes.sidebar.bookmarkLabel).text(e.title))})},v=e=>{let a=f(0===s.modal.find("input[name='url']").length());if(!1===a.errors){let r={title:a.values.title,url:a.values.url,parentId:e.id||null,index:0};e&&e.values&&(e.values.index&&(r.index=e.values.index),e.values.parentId&&(r.parentId=e.values.parentId)),t.helper.model.call("createBookmark",r).then(e=>{e.error?s.modal.find("input[name='url']").addClass(t.opts.classes.overlay.inputError):l(!1,"_"+(r.url?"bookmark":"directory"))})}},y=()=>{s.modal.find("div#"+t.opts.ids.overlay.urlList+" ul > li").forEach(s=>{if(e(s).find("input[type='checkbox']")[0].checked){let a=e(s).data("entry");404===a.urlStatusCode?t.helper.model.call("deleteBookmark",{id:a.id}):a.url!==a.newUrl&&t.helper.model.call("updateBookmark",{id:a.id,title:a.title,url:a.newUrl})}}),l()},w=a=>{s.overlay.find("body").on("click",e=>{"BODY"===e.target.tagName&&l(!0)}),s.modal.find("a."+t.opts.classes.overlay.close).on("click",e=>{e.preventDefault(),l(!0)}),s.modal.on("click","a."+t.opts.classes.overlay.action,e=>{switch(e.preventDefault(),s.modal.attr(t.opts.attr.type)){case"delete":b(a);break;case"hide":g(a);break;case"openChildren":u(a);break;case"edit":k(a);break;case"add":v(a);break;case"updateUrls":y()}}),s.modal.on("focus","input",s=>{e(s.currentTarget).removeClass(t.opts.classes.overlay.inputError)}),s.modal.find("a."+t.opts.classes.overlay.preview+", a."+t.opts.classes.overlay.previewUrl).on("click",e=>{e.preventDefault(),t.helper.model.call("trackEvent",{category:"url",action:"open",label:"new_tab_overlay"}),t.helper.utility.openUrl(a,"newTab")})}},window.ScrollHelper=function(t){let s=+new Date,a={},l=[];this.add=((s,a)=>{let r=e("<div id='"+s+"' class='"+t.opts.classes.scrollBox.wrapper+"' tabindex='0' />").insertBefore(a);return a=a.appendTo(r),r.data({list:a}),l.push(r),n(r),r}),this.focus=(()=>{t.elements.iframe.hasClass(t.opts.classes.page.visible)&&t.elements.header.find("div."+t.opts.classes.sidebar.searchBox+" > input[type='text']")[0]!==t.elements.iframe[0].contentDocument.activeElement&&l.forEach(e=>{e.hasClass(t.opts.classes.sidebar.active)&&e[0].focus()})}),this.updateAll=(()=>{l.forEach(e=>{e.hasClass(t.opts.classes.sidebar.active)&&this.update(e)})}),this.restoreScrollPos=(e=>new Promise(s=>{let a=t.helper.model.getData(["b/rememberState","u/scrollPos"]);"all"===a.rememberState?(this.setScrollPos(e,a.scrollPos[e.attr("id")]||0),setTimeout(()=>{s()},100)):s()})),this.setScrollPos=((e,t,s=0)=>{if(0===s)e[0].scrollTop=t,this.update(e);else{let a=e[0].scrollTop,l=0,r=()=>{let o=(l+=1/60)/(s/1e3),i=Math.sin(o*(Math.PI/2));o<1?(window.requestAnimationFrame(r),e[0].scrollTop=a+(t-a)*i):(e[0].scrollTop=t,this.update(e))};r()}});let r=t=>{let s=0;return t.children().forEach(t=>{s+=e(t).realHeight(!0)}),s},o=e=>{if(!1===t.refreshRun&&+new Date-s>500){s=+new Date;let a=t.helper.model.getData("u/scrollPos");a[e.attr("id")]=e[0].scrollTop,t.helper.model.setData({"u/scrollPos":a})}};this.update=(e=>{t.helper.contextmenu.close(),o(e);let s=i(e),l=r(e),n=e[0].scrollTop;n>10?e.addClass(t.opts.classes.scrollBox.scrolled):e.removeClass(t.opts.classes.scrollBox.scrolled);let d=e.data("lastPos")||0;n>d?e.attr(t.opts.attr.direction,"down"):n<d?e.attr(t.opts.attr.direction,"up"):e.removeAttr(t.opts.attr.direction),e.data("lastPos",n),(l-n<2*s||l===n&&0===s)&&e.trigger(t.opts.events.scrollBoxLastPart),t.elements.iframe.hasClass(t.opts.classes.page.visible)?(e.removeClass(t.opts.classes.scrollBox.hideScrollbar),clearTimeout(a[e.attr("id")]),a[e.attr("id")]=setTimeout(()=>{e.addClass(t.opts.classes.scrollBox.hideScrollbar)},1500)):e.addClass(t.opts.classes.scrollBox.hideScrollbar),t.helper.scroll.focus()});let i=e=>e.realHeight()-parseInt(e.css("padding-top")),n=e=>{e.on("scroll",()=>{this.update(e)})}},window.SearchHelper=function(t){let s=null;this.init=(()=>{let e=t.helper.model.getData(["b/rememberSearch","u/searchValue"]);e.rememberSearch&&e.searchValue&&e.searchValue.length>0&&(t.elements.header.addClass(t.opts.classes.sidebar.searchVisible),a(e.searchValue)),o()}),this.clearSearch=(()=>new Promise(e=>{t.helper.contextmenu.close(),t.elements.header.removeClass(t.opts.classes.sidebar.searchVisible),a("").then(e)}));let a=(e=null)=>new Promise(s=>{let a=t.elements.header.find("div."+t.opts.classes.sidebar.searchBox+" > input[type='text']");null===e?e=a[0].value:a[0].value=e,e&&e.length>0?l(a,e).then(s):r(a).then(s)}),l=(a,l)=>new Promise(r=>{let o=t.firstRun;t.elements.bookmarkBox.all.removeClass(t.opts.classes.sidebar.active).removeClass(t.opts.classes.scrollBox.scrolled),t.elements.bookmarkBox.search.addClass(t.opts.classes.sidebar.active),t.helper.scroll.focus(),t.helper.list.updateSortFilter(),l!==a.data("lastVal")&&(t.startLoading(),a.data("lastVal",l),s&&(clearTimeout(s),s=null),t.helper.model.setData({"u/searchValue":l}).then(()=>(t.helper.scroll.setScrollPos(t.elements.bookmarkBox.search,0),t.helper.model.call("searchBookmarks",{searchVal:l}))).then(a=>{t.elements.bookmarkBox.search.children("p").remove();let i=!1,n=t.elements.bookmarkBox.search.children("ul");n.text(""),a.bookmarks&&a.bookmarks.length>0&&(i=t.helper.list.addBookmarkDir(a.bookmarks,n,!1)),!1===i&&e("<p />").text(t.helper.i18n.get("sidebar_search_no_results")).appendTo(t.elements.bookmarkBox.search),o||(s=setTimeout(()=>{t.helper.model.call("trackEvent",{category:"search",action:"search",label:"search",value:l.length})},500)),t.endLoading(500),r()}))}),r=e=>new Promise(s=>{e.removeData("lastVal"),t.helper.model.setData({"u/searchValue":!1}).then(()=>{t.elements.bookmarkBox.search.hasClass(t.opts.classes.sidebar.active)&&(t.startLoading(),t.elements.bookmarkBox.all.addClass(t.opts.classes.sidebar.active),t.elements.bookmarkBox.search.removeClass(t.opts.classes.sidebar.active),t.helper.scroll.restoreScrollPos(t.elements.bookmarkBox.all),t.helper.scroll.focus(),t.endLoading()),t.helper.list.updateSortFilter(),s()})}),o=()=>{t.elements.header.on("click","a."+t.opts.classes.sidebar.search,e=>{e.preventDefault(),e.stopPropagation(),t.helper.contextmenu.close(),t.elements.header.addClass(t.opts.classes.sidebar.searchVisible),t.elements.header.find("div."+t.opts.classes.sidebar.searchBox+" > input[type='text']")[0].focus()}),t.elements.header.on("keyup","div."+t.opts.classes.sidebar.searchBox+" > input[type='text']",e=>{e.preventDefault(),a()}),t.elements.header.on("click","a."+t.opts.classes.sidebar.searchClose,e=>{e.preventDefault(),e.stopPropagation(),this.clearSearch()})}},window.SidebarEventsHelper=function(t){this.init=(()=>{l(),a(),s(),r()});let s=()=>{e([document,t.elements.iframe[0].contentDocument]).on("keydown",s=>{if(t.elements.iframe.hasClass(t.opts.classes.page.visible)&&0===e("iframe#"+t.opts.ids.page.overlay).length()){let a=["ArrowDown","ArrowUp","PageDown","PageUp","Home","End","Space"];if(a.indexOf(s.key)>-1||a.indexOf(s.code)>-1)t.helper.scroll.focus();else if("c"===s.key&&(s.ctrlKey||s.metaKey))s.preventDefault(),Object.values(t.elements.bookmarkBox).forEach(s=>{if(s.hasClass(t.opts.classes.sidebar.active)){let a=s.find("> ul a."+t.opts.classes.sidebar.hover).eq(0);if(a.length()>0){let s=t.helper.entry.getData(a.attr(t.opts.attr.id));if(s&&s.url&&t.helper.utility.copyToClipboard(s.url)){e(a).children("span."+t.opts.classes.sidebar.copied).remove();let s=e("<span />").addClass(t.opts.classes.sidebar.copied).text(t.helper.i18n.get("sidebar_copied_to_clipboard")).appendTo(a);setTimeout(()=>{e(a).addClass(t.opts.classes.sidebar.copied),setTimeout(()=>{e(a).removeClass(t.opts.classes.sidebar.copied),setTimeout(()=>{s.remove()},500)},1500)},100)}}}});else{let e=t.elements.header.find("div."+t.opts.classes.sidebar.searchBox+" > input[type='text']");e[0]!==t.elements.iframe[0].contentDocument.activeElement&&e[0].focus()}}}).on("keyup",()=>{if(t.elements.iframe.hasClass(t.opts.classes.page.visible)){let e=t.elements.header.find("div."+t.opts.classes.sidebar.searchBox+" > input[type='text']"),s=e[0].value;s.length>0&&!t.elements.header.hasClass(t.opts.classes.sidebar.searchVisible)&&(t.helper.contextmenu.close(),t.elements.header.addClass(t.opts.classes.sidebar.searchVisible))}})},a=()=>{t.elements.filterBox.on("click","a["+t.opts.attr.direction+"]",s=>{s.preventDefault();let a="ASC"===e(s.target).attr(t.opts.attr.direction)?"DESC":"ASC";t.helper.list.updateDirection(a)}).on("click","div."+t.opts.classes.checkbox.box+" + a",s=>{s.preventDefault(),e(s.target).prev("div["+t.opts.attr.name+"]").trigger("click")}),e(t.elements.iframe[0].contentDocument).on(t.opts.events.checkboxChanged,e=>{let s=e.detail.checkbox.attr(t.opts.attr.name);"viewAsTree"!==s&&"mostViewedPerMonth"!==s||t.helper.model.setData({["u/"+s]:e.detail.checked}).then(()=>{t.startLoading(),t.helper.model.call("refreshAllTabs",{scrollTop:!0,type:"Sort"})})})},l=()=>{Object.values(t.elements.bookmarkBox).forEach(s=>{s.children("ul").on("click mousedown","a",s=>{if(s.preventDefault(),!e(s.target).hasClass(t.opts.classes.drag.trigger)&&!e(s.target).hasClass(t.opts.classes.sidebar.separator)&&(1===s.which&&"click"===s.type||2===s.which&&"mousedown"===s.type||t.refreshRun)){let a=e(s.currentTarget),l=t.helper.entry.getData(a.attr(t.opts.attr.id));if(l.isDir&&!a.hasClass(t.opts.classes.sidebar.dirAnimated))t.helper.list.toggleBookmarkDir(a);else if(!l.isDir){let e=t.helper.model.getData(["b/newTab","b/linkAction"]),a=2===s.which||"newtab"===e.linkAction;2===s.which?t.helper.model.call("trackEvent",{category:"url",action:"open",label:"new_tab_middle_click"}):t.helper.model.call("trackEvent",{category:"url",action:"open",label:(a?"new":"current")+"_tab_default"}),t.helper.utility.openUrl(l,a?"newTab":"default",!a||"foreground"===e.newTab)}}}).on("mouseover","a",a=>{s.find("> ul a."+t.opts.classes.sidebar.hover).removeClass(t.opts.classes.sidebar.hover),e(a.currentTarget).addClass(t.opts.classes.sidebar.hover).removeClass(t.opts.classes.sidebar.mark)}).on("contextmenu","a",s=>{s.preventDefault();let a="list";e(s.target).hasClass(t.opts.classes.sidebar.separator)&&(a="separator"),t.helper.contextmenu.create(a,e(s.currentTarget))}),s.children("ul").on("mouseleave",s=>{e(s.currentTarget).find("a."+t.opts.classes.sidebar.hover).removeClass(t.opts.classes.sidebar.hover)})})},r=()=>{e(window).on("beforeunload",()=>{t.elements.sidebar.hasClass(t.opts.classes.sidebar.openedOnce)&&t.helper.scroll.updateAll()}),t.elements.iframe.find("body").on("click",()=>{t.helper.contextmenu.close()}),chrome.extension.onMessage.addListener(e=>{if(e&&e.action&&"refresh"===e.action){let s=0;e.scrollTop&&(t.helper.scroll.setScrollPos(t.elements.bookmarkBox.all,0),s=100),setTimeout(()=>{t.refresh()},s)}}),["menu","sort"].forEach(s=>{t.elements.header.on("click contextmenu","a."+t.opts.classes.sidebar[s],a=>{a.preventDefault(),a.stopPropagation(),t.helper.contextmenu.create(s,e(a.currentTarget))})}),t.elements.iframeBody.on("click","#"+t.opts.ids.sidebar.shareUserdata+" a",s=>{s.preventDefault(),t.helper.model.call("shareUserdata",{share:e(s.currentTarget).data("accept")}),t.elements.iframeBody.find("div#"+t.opts.ids.sidebar.shareUserdata).addClass(t.opts.classes.sidebar.hidden)})}},window.StylesheetHelper=function(t){let s={};this.init=(()=>{s=t.helper.model.getData("a/styles")}),this.addStylesheets=((a,l=null)=>{null===l?l=e(document):(t.helper.font.addStylesheet(l),t.opts.classes&&t.opts.classes.page&&(s.isEE&&t.opts.classes.page.ee&&l.find("body").addClass(t.opts.classes.page.ee),!1===t.helper.model.getData("b/animations")&&t.opts.classes.page.noAnimations&&l.find("body").addClass(t.opts.classes.page.noAnimations)));let r=null;r=0===l.find("head").length()?l.find("body"):l.find("head"),a.forEach(e=>{let a=new XMLHttpRequest;a.open("GET",chrome.extension.getURL("css/"+e+".css"),!0),a.onload=(()=>{if(a.response){let l=a.response;Object.keys(s).forEach(e=>{l=l.replace(new RegExp('"?%'+e+'"?',"g"),s[e])}),t.opts.classes&&t.opts.classes.page&&t.opts.classes.style&&t.opts.attr&&t.opts.attr.name?(r.find("style."+t.opts.classes.page.style+"["+t.opts.attr.name+"='"+e+"]").remove(),r.append("<style class='"+t.opts.classes.page.style+"' "+t.opts.attr.name+"='"+e+"'>"+l+"</style>")):r.append("<style>"+l+"</style>")}}),a.send()})})},window.TemplateHelper=function(t){this.loading=(()=>e('<svg class="loading" width="36px" height="36px" viewBox="0 0 36 36" xmlns="http://www.w3.org/2000/svg"><circle fill="none" stroke-width="3" stroke-linecap="round" cx="18" cy="18" r="16"></circle></svg>')),this.footer=(()=>{let t=e('<footer> <a id="copyright" href="https://blockbyte.de/extensions" target="_blank">  &copy; <span class="created">2016</span>&ensp;<strong>Blockbyte</strong> </a></footer>'),s=+t.find("span.created").text(),a=(new Date).getFullYear();return a>s&&t.find("span.created").text(s+" - "+a),t})},window.ToggleHelper=function(t){let s=null,a=null,l=null,r=0,o=null,i=null,n={};this.init=(()=>{t.elements.indicator=e("<div />").attr("id",t.opts.ids.page.indicator).appendTo("body"),!1===t.helper.model.getData("b/animations")&&t.elements.indicator.addClass(t.opts.classes.page.noAnimations);let i=t.helper.model.getData(["b/pxTolerance","b/preventPageScroll","a/showIndicator","a/showIndicatorIcon","a/styles","a/sidebarPosition","b/openDelay","b/openAction","b/initialOpenOnNewTab"]);a=i.pxTolerance,r=1e3*+i.openDelay,s=i.sidebarPosition,l=i.preventPageScroll,t.elements.indicator.css("width",d()+"px"),t.elements.iframe.attr(t.opts.attr.position,s),t.elements.sidebar.attr(t.opts.attr.position,s),i.styles&&i.styles.indicatorWidth&&(o=parseInt(i.styles.indicatorWidth)),i.showIndicator&&"icon"!==i.openAction&&"mousemove"!==i.openAction&&(t.elements.indicator.addClass(t.opts.classes.page.visible).attr(t.opts.attr.position,s),i.showIndicatorIcon&&t.elements.indicator.addClass(t.opts.classes.page.indicatorIcon)),g(),p(),"newtab"===t.helper.utility.getPageType()&&(t.elements.indicator.addClass(t.opts.classes.page.isNewTab),i.initialOpenOnNewTab&&u()),!1===t.helper.utility.sidebarHasMask()&&t.elements.iframe.addClass(t.opts.classes.page.hideMask)});let d=()=>a[t.isWindowed()?"windowed":"maximized"],p=()=>{e(window).on("resize",()=>{t.elements.indicator.css("width",d()+"px")}),t.elements.iframe.find("body").on("click",e=>{if(e.pageX){let a=e.pageX;"right"===s&&(a="newtab"===t.helper.utility.getPageType()?t.elements.iframe.realWidth()-a:window.innerWidth-a+t.elements.sidebar.realWidth()-1),a>t.elements.sidebar.realWidth()&&t.elements.iframe.hasClass(t.opts.classes.page.visible)&&m()}}),e(document).on("click",e=>{e.isTrusted&&m()}),t.elements.sidebar.on("mouseleave",()=>{if(0===e("iframe#"+t.opts.ids.page.overlay).length()&&!1===t.elements.iframeBody.hasClass(t.opts.classes.drag.isDragged)){let e=t.helper.model.getData("b/closeTimeout");-1!=+e&&(n.close=setTimeout(()=>{!1===t.elements.iframeBody.hasClass(t.opts.classes.drag.isDragged)&&m()},1e3*+e))}}).on("mouseenter",()=>{h("close")}),e([document,t.elements.iframe[0].contentDocument]).on("keydown",e=>{"Escape"!==e.key&&"Esc"!==e.key||!t.elements.iframe.hasClass(t.opts.classes.page.visible)||(e.preventDefault(),m())}),e(document).on("visibilitychange",()=>{document.hidden&&0===e("iframe#"+t.opts.ids.page.overlay).length()&&(t.elements.indicator.removeClass(t.opts.classes.page.hover),t.elements.iframe.hasClass(t.opts.classes.page.visible)&&m())}).on("mouseout",()=>{h("open")}).on("mousemove dragover",e=>{if(e.isTrusted&&c(e.pageX)){let e=+new Date-(i||0);n.indicator||(n.indicator=setTimeout(()=>{t.elements.indicator.addClass(t.opts.classes.page.hover)},Math.max(r-e,0)))}else h("indicator"),t.elements.indicator.removeClass(t.opts.classes.page.hover)},{passive:!0}),chrome.extension.onMessage.addListener(e=>{e&&e.action&&"toggleSidebar"===e.action&&(t.elements.iframe.hasClass(t.opts.classes.page.visible)?m():u())});let a=t.helper.model.getData("b/openAction");"icon"!==a&&e(document).on(a+" dragover",e=>{e.isTrusted&&("dragover"===e.type||"mousedown"!==a||0===e.button)&&c(e.pageX)?(e.stopPropagation(),e.preventDefault(),"mousemove"===a?n.open||(n.open=setTimeout(()=>{u()},r)):(0===r||null===i||+new Date-i>r)&&u()):h("open")})},c=e=>{let a=!1;if(void 0!==e&&null!==e){"right"===s&&(e=window.innerWidth-e-1);let l=d();t.elements.indicator.hasClass(t.opts.classes.page.hover)&&o>l&&(l=o),a=e<l}return!1===a?i=null:null===i&&(i=+new Date),a},h=e=>{n[e]&&(clearTimeout(n[e]),n[e]=null)},m=()=>{h("close"),h("open"),t.helper.contextmenu.close(),t.elements.iframe.removeClass(t.opts.classes.page.visible),e("body").removeClass(t.opts.classes.page.noscroll),e(document).trigger("mousemove")},u=()=>{t.helper.model.call("shareUserdataMask").then(e=>{e&&e.showMask?t.addShareUserdataMask():t.elements.sidebar.find("#"+t.opts.ids.sidebar.shareUserdata).remove()}),t.elements.sidebar.hasClass(t.opts.classes.sidebar.openedOnce)||(t.trackInitialEvents(),t.elements.sidebar.addClass(t.opts.classes.sidebar.openedOnce)),t.helper.model.call("trackPageView",{page:"/sidebar/"+t.helper.utility.getPageType()}),t.elements.iframe.addClass(t.opts.classes.page.visible),t.initImages(),l&&e("body").addClass(t.opts.classes.page.noscroll),t.helper.scroll.focus(),e(document).trigger("mousemove"),t.helper.utility.triggerEvent("sidebarOpened")},g=()=>{e(t.opts.leftsideBackSelector).length()>0?t.elements.indicator.addClass(t.opts.classes.page.hasLeftsideBack):e(document).on(t.opts.events.lsbLoaded,e=>{e.detail.showIndicator&&t.elements.indicator.addClass(t.opts.classes.page.hasLeftsideBack)})}},window.UtilityHelper=function(t){this.openUrl=((e,s="default",a=!0)=>{"incognito"===s?t.helper.model.call("openLink",{href:e.url,incognito:!0}):t.helper.model.call("openLink",{parentId:e.parentId,id:e.id,href:e.url,newTab:"newTab"===s,afterLast:"afterLast"===t.helper.model.getData("b/newTabPosition"),active:a})}),this.openAllBookmarks=((e,s=!0)=>{t.helper.model.call("trackEvent",{category:"url",action:"open",label:"new_tab_all_children",value:e.length}),"afterCurrent"===t.helper.model.getData("b/newTabPosition")&&e.reverse(),e.forEach(e=>{this.openUrl(e,"newTab",s)})}),this.getPageType=(()=>{let e=location.href,t="other",s={newtab:"https?://www.google..+/_/chrome/newtab",website:"https?://",onboarding:"chrome-extension://.*/intro.html",chrome:"chrome://",extension:"chrome-extension://",local:"file://"};return Object.keys(s).some(a=>{if(0===e.search(new RegExp(s[a],"gi")))return t=a,!0}),t}),this.sidebarHasMask=(()=>{let e=t.helper.utility.getPageType();return"newtab"!==e&&"onboarding"!==e}),this.triggerEvent=((e,s={},a=null)=>{(a||document).dispatchEvent(new CustomEvent(t.opts.events[e],{detail:s,bubbles:!0,cancelable:!1}))}),this.copyToClipboard=(t=>{let s=e("<textarea />").text(t).appendTo(this.elements.iframeBody);s[0].select();let a=!1;try{a=this.elements.iframe[0].contentDocument.execCommand("copy")}catch(e){}return s.remove(),a}),this.pinEntry=(e=>new Promise(s=>{let a=t.helper.model.getData("u/pinnedEntries"),l=-1;Object.values(a).forEach(e=>{l=Math.max(l,e.index)}),a[e.id]={index:l+1},t.helper.model.setData({"u/pinnedEntries":a}).then(s)})),this.unpinEntry=(e=>new Promise(s=>{let a=t.helper.model.getData("u/pinnedEntries");delete a[e.id],t.helper.model.setData({"u/pinnedEntries":a}).then(s())})),this.addSeparator=(e=>new Promise(s=>{let a=t.helper.model.getData("u/separators");void 0===a[e.id]&&(a[e.id]=[]),a[e.id].push({index:e.index||0}),t.helper.model.setData({"u/separators":a}).then(s)})),this.removeSeparator=(e=>new Promise(s=>{let a=t.helper.model.getData("u/separators");a[e.id].some((t,s)=>{if(t.index===e.index)return a[e.id].splice(s,1),!0}),t.helper.model.setData({"u/separators":a}).then(s)}))},window.ext=function(t){let s={};this.firstRun=!0,this.refreshRun=!0,this.elements={},this.opts=t,this.run=(()=>{a(),this.helper.model.init().then(()=>this.helper.i18n.init()).then(()=>{this.helper.font.init(),this.helper.stylesheet.init(),this.helper.stylesheet.addStylesheets(["content"]),l(),this.helper.toggle.init(),this.helper.list.init(),this.helper.sidebarEvents.init(),this.helper.dragndrop.init(),""===document.referrer&&this.helper.model.call("addViewAmount",{url:location.href})})}),this.isWindowed=(()=>0!==window.screenX||0!==window.screenY||window.screen.availWidth!==window.innerWidth),this.refresh=(()=>{this.helper.model.init().then(()=>this.helper.i18n.init()).then(()=>{let e=this.helper.model.getData(["u/entriesLocked","u/showHidden"]);!1===e.entriesLocked?this.elements.sidebar.addClass(t.classes.sidebar.entriesUnlocked):this.elements.sidebar.removeClass(t.classes.sidebar.entriesUnlocked),!0===e.showHidden?this.elements.sidebar.addClass(t.classes.sidebar.showHidden):this.elements.sidebar.removeClass(t.classes.sidebar.showHidden),this.helper.list.updateBookmarkBox()})}),this.trackInitialEvents=(()=>{this.helper.model.call("trackEvent",{category:"directory",action:"openState_initial",label:"open",value:this.elements.bookmarkBox.all.find("a."+this.opts.classes.sidebar.dirOpened).length()});let e=this.helper.list.getSort();this.helper.model.call("trackEvent",{category:"sorting",action:"initial",label:e.name+"_"+e.dir});let t=(e=0)=>{if(this.elements.header.find("div."+this.opts.classes.sidebar.searchBox).length()>0){let e=this.elements.header.find("div."+this.opts.classes.sidebar.searchBox+" > input[type='text']")[0].value;e.length>0&&this.helper.model.call("trackEvent",{category:"search",action:"search",label:"initial",value:e.length})}else e<20&&setTimeout(()=>{t(++e)},100)};t()}),this.loaded=(()=>{if(!this.elements.iframeBody.hasClass(t.classes.sidebar.extLoaded)){let e=this.helper.model.getData(["b/pxTolerance","a/showIndicator"]);this.elements.iframeBody.addClass(t.classes.sidebar.extLoaded),this.helper.utility.triggerEvent("loaded",{pxTolerance:e.pxTolerance,showIndicator:e.showIndicator})}}),this.startLoading=(()=>{this.elements.sidebar.addClass(t.classes.sidebar.loading),s.timeout&&clearTimeout(s.timeout),void 0!==s.loader&&0!==s.loader.length()||(s.loader=this.helper.template.loading().appendTo(this.elements.sidebar))}),this.endLoading=((e=500)=>{s.timeout=setTimeout(()=>{this.elements.sidebar.removeClass(t.classes.sidebar.loading),s.loader&&s.loader.remove(),s={}},e)}),this.initImages=(()=>{this.elements.iframe.hasClass(this.opts.classes.page.visible)&&this.elements.sidebar.find("img["+t.attr.src+"]").forEach(s=>{let a=e(s),l=a.attr(t.attr.src);a.removeAttr(t.attr.src),a.attr("src",l)})}),this.addShareUserdataMask=(()=>{this.elements.sidebar.find("#"+t.ids.sidebar.shareUserdata).remove();let s=e("<div />").attr("id",t.ids.sidebar.shareUserdata).prependTo(this.elements.sidebar),a=e("<div />").prependTo(s);e("<h2 />").html(this.helper.i18n.get("share_userdata_headline")).appendTo(a),e("<p />").html(this.helper.i18n.get("share_userdata_desc")).appendTo(a),e("<p />").html(this.helper.i18n.get("share_userdata_desc2")).appendTo(a),e("<p />").addClass(t.classes.sidebar.shareUserdataNotice).html(this.helper.i18n.get("share_userdata_notice")).appendTo(a),e("<a />").data("accept",!0).html(this.helper.i18n.get("share_userdata_accept")).appendTo(a),e("<a />").data("accept",!1).html(this.helper.i18n.get("share_userdata_decline")).appendTo(a)});let a=()=>{this.helper={model:new window.ModelHelper(this),toggle:new window.ToggleHelper(this),entry:new window.EntryHelper(this),list:new window.ListHelper(this),scroll:new window.ScrollHelper(this),template:new window.TemplateHelper(this),i18n:new window.I18nHelper(this),font:new window.FontHelper(this),sidebarEvents:new window.SidebarEventsHelper(this),search:new window.SearchHelper(this),stylesheet:new window.StylesheetHelper(this),dragndrop:new window.DragDropHelper(this),checkbox:new window.CheckboxHelper(this),overlay:new window.OverlayHelper(this),utility:new window.UtilityHelper(this),contextmenu:new window.ContextmenuHelper(this)}},l=()=>{this.elements.iframe=e('<iframe id="'+t.ids.page.iframe+'" />').appendTo("body"),!1===this.helper.model.getData("b/animations")&&this.elements.iframe.addClass(this.opts.classes.page.noAnimations),this.elements.iframeBody=this.elements.iframe.find("body"),this.elements.sidebar=e('<section id="'+t.ids.sidebar.sidebar+'" />').appendTo(this.elements.iframeBody),this.elements.bookmarkBox={},["all","search"].forEach(s=>{this.elements.bookmarkBox[s]=this.helper.scroll.add(t.ids.sidebar.bookmarkBox[s],e("<ul />").appendTo(this.elements.sidebar))}),this.elements.filterBox=e("<div />").addClass(t.classes.sidebar.filterBox).appendTo(this.elements.sidebar),this.elements.iframeBody.attr(t.attr.dragCancel,this.helper.i18n.get("sidebar_drag_cancel")),this.elements.header=e("<header />").prependTo(this.elements.sidebar),this.helper.stylesheet.addStylesheets(["sidebar"],this.elements.iframe);let s=this.helper.model.getData(["u/entriesLocked","u/showHidden","a/darkMode"]);!1===s.entriesLocked&&this.elements.sidebar.addClass(t.classes.sidebar.entriesUnlocked),!0===s.showHidden&&this.elements.sidebar.addClass(t.classes.sidebar.showHidden),!0===s.darkMode&&this.elements.iframeBody.addClass(t.classes.page.darkMode)}};let t={ids:{page:{iframe:"blockbyte-bs-sidebar",overlay:"blockbyte-bs-overlay",indicator:"blockbyte-bs-indicator"},sidebar:{sidebar:"sidebar",shareUserdata:"shareUserdata",bookmarkBox:{all:"bookmarkBox",search:"bookmarkBoxSearch"}},overlay:{urlList:"urlList"}},classes:{page:{indicatorIcon:"blockbyte-bs-icon",visible:"blockbyte-bs-visible",isNewTab:"blockbyte-bs-isNewTab",hideMask:"blockbyte-bs-hideMask",hover:"blockbyte-bs-hover",noscroll:"blockbyte-bs-noscroll",hasLeftsideBack:"blockbyte-bs-has-lsb",style:"blockbyte-bs-style",noAnimations:"noAnimations",darkMode:"dark",ee:"ee"},sidebar:{extLoaded:"loaded",openedOnce:"openedOnce",active:"active",mark:"mark",hideRoot:"hideRoot",entriesUnlocked:"entriesUnlocked",showHidden:"showHidden",dirAnimated:"animated",dirOpened:"opened",bookmarkDir:"dir",dirIcon:"icon",separator:"separator",bookmarkLink:"link",bookmarkLabel:"label",entryPinned:"pinned",menu:"menu",sort:"sort",hidden:"hidden",hover:"hover",loading:"loading",copied:"copied",filterBox:"filter",search:"search",searchBox:"searchBox",searchClose:"searchClose",searchVisible:"searchVisible",shareUserdataNotice:"shareNotice"},contextmenu:{wrapper:"contextmenu",top:"top",visible:"visible",list:"list",icons:"icons",right:"right",separator:"separator"},drag:{trigger:"drag",helper:"dragHelper",isDragged:"isDragged",cancel:"dragCancel",dragHover:"dragHover",snap:"snap",dragInitial:"dragInitial"},scrollBox:{wrapper:"scrollBox",scrollbar:"scrollbar",inactive:"inactive",hideScrollbar:"hideScrollbar",hidden:"hidden",scrolled:"scrolled"},checkbox:{box:"checkbox",active:"active",clicked:"clicked",focus:"focus"},overlay:{modal:"modal",visible:"visible",preview:"preview",previewUrl:"previewUrl",action:"action",close:"close",hasTooltip:"tooltip",inputError:"error",success:"success",progressBar:"progressBar",buttonWrapper:"buttons",checkUrlProgressLabel:"progressLabel",urlCheckLoading:"urlCheckLoading",urlCheckList:"urlCheckList"}},attr:{src:"data-src",position:"data-pos",type:"data-type",name:"data-name",value:"data-value",sort:"data-sort",direction:"data-direction",dragCancel:"data-dragCancel",id:"data-id"},events:{loaded:"blockbyte-bs-loaded",sidebarOpened:"blockbyte-bs-sidebar-opened",checkboxChanged:"blockbyte-bs-checkbox-changed",scrollBoxLastPart:"blockbyte-bs-scrollbox-lastpart",lsbLoaded:"blockbyte-lsb-loaded"},leftsideBackSelector:"div#blockbyte-lsb-indicator.blockbyte-lsb-visible",manifest:chrome.runtime.getManifest(),demoMode:!1};new window.ext(t).run()})(jsu);