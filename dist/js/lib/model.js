/*! (c) Philipp KÃ¶nig under GPL-3.0 */
(e=>{"use strict";window.ModelHelper=function(e){let t={textColor:{light:"#646464",dark:"#c8c8c8"},sidebarMaskColor:{light:"rgba(255,255,255,0.8)",dark:"rgba(0,0,0,0.6)"},hoverColor:{light:"#f5f5f5",dark:"#555555"},colorScheme:{light:"#1b82f1",dark:"#1f4d80"},foregroundColor:{light:"#ffffff",dark:"#333333"}},o={u:{openStates:{},hiddenEntries:{},additionalInfo:{},scrollPos:{},separators:{},customCss:"",pinnedEntries:{},lockPinned:!0,translationHelp:!0,performReopening:!1,entryAmounts:{},lastOpened:null,sort:{name:"custom",dir:"ASC"},mostViewedPerMonth:!1,viewAsTree:!0},b:{animations:!0,preventPageScroll:!1,toggleArea:{width:1,widthWindowed:20,height:100,top:0},blacklist:[],whitelist:[],sidebarPosition:"left",openAction:"mousedown",newTab:"foreground",newTabPosition:"afterCurrent",visibility:"always",linkAction:"current",dirAccordion:!1,reopenSidebar:!1,rememberState:"openStatesAndPos",tooltipDelay:1,tooltipContent:"all",dndOpen:!0,openChildrenWarnLimit:10,dirOpenDuration:.5,scrollBarHide:1.5,openDelay:0,closeTimeout:1},n:{override:!1,autoOpen:!0,searchEngine:"google",topPagesType:"topPages",shortcuts:[{label:"Google",url:"https://google.com"}],website:""},a:{showIndicator:!0,showIndicatorIcon:!0,darkMode:!1,highContrast:!1,showBookmarkIcons:!0,showDirectoryIcons:!0,styles:{colorScheme:t.colorScheme.light,foregroundColor:t.foregroundColor.light,textColor:t.textColor.light,hoverColor:t.hoverColor.light,indicatorWidth:"40px",indicatorIconSize:"32px",indicatorIconColor:"#ffffff",indicatorColor:"rgba(0,0,0,0.5)",sidebarWidth:"350px",sidebarHeaderHeight:"50px",sidebarMaskColor:t.sidebarMaskColor.light,bookmarksFontSize:"14px",directoriesIconSize:"16px",bookmarksIconSize:"16px",bookmarksLineHeight:"38px",bookmarksDirIcon:"dir-1",bookmarksDirColor:t.textColor.light,bookmarksDirIndentation:"25px",bookmarksHorizontalPadding:"16px",scrollBarWidth:"11px",tooltipFontSize:"9px",overlayMaskColor:"rgba(0,0,0,0.5)",overlayHeaderHeight:"50px",fontFamily:"default",iconShape:"bookmark",iconColor:"#555555"}}},i={},r=null,a={};this.init=(()=>new Promise(e=>{Promise.all([n(),l()]).then(e)}));let n=()=>new Promise(e=>{r&&r.disconnect(),(r=chrome.runtime.connect({name:"background"})).onMessage.addListener(e=>{a[e.uid]&&(a[e.uid](e.result),delete a[e.uid])}),e()}),l=()=>new Promise(e=>{let t=["utility","behaviour","appearance","newtab"],o={},r=t.length,a=0;t.forEach(t=>{chrome.storage["utility"===t?"local":"sync"].get([t],n=>{o[t]=n[t]||{},++a===r&&(i=o,e())})})});this.getAllData=(()=>i),this.getData=((t,r=!1)=>{let a=t;"string"==typeof a&&(a=[a]);let n={};if(a.forEach(t=>{let a=t.split("/")[0],l=t.split("/")[1],s=null,c=null;switch(a){case"u":c=i.utility;break;case"b":c=i.behaviour;break;case"a":c=i.appearance;break;case"n":c=i.newtab}if(null!==c)if(!0===r||void 0===c[l]){if("b/toggleArea"===t){let e=this.getData("n/pxTolerance");null!==e&&((s=o[a][l]).width=e.maximized,s.widthWindowed=e.windowed,a="__FOUND")}"n/autoOpen"===t&&null!==(s=this.getData("n/initialOpen"))&&(a="__FOUND"),"b/reopenSidebar"===t&&null!==(s=this.getData("b/autoOpen"))&&(a="__FOUND"),void 0!==o[a]&&void 0!==o[a][l]&&(s=o[a][l])}else s=c[l];let d=location.href.search(/chrome\-extension\:\/\//)>-1&&location.pathname.search(/settings\.html$/)>-1;if("b/toggleArea"===t&&matchMedia("(min-resolution: 1.25dppx)").matches&&!1===d&&(s=Object.assign({},s),Object.keys(s).forEach(e=>{e.startsWith("width")&&s[e]++})),"a/styles"===t&&(s=Object.assign({},o.a.styles,s),e.helper.font&&e.helper.font.isLoaded())){let t=e.helper.font.getFontInfo();s.fontFamily=t.name,Object.assign(s,t.fontWeights)}n[l]=s}),"string"==typeof t){let e=t.split("/")[1];n=n[e]}return n}),this.setData=(e=>new Promise(t=>{l().then(()=>{Object.keys(e).forEach(t=>{let o=t.split("/")[0],r=t.split("/")[1],a=e[t];switch(o){case"u":i.utility[r]=a;break;case"b":i.behaviour[r]=a;break;case"a":i.appearance[r]=a;break;case"n":i.newtab[r]=a}});let o=0,r=(e=1)=>{(o+=e)>=4&&t()};try{chrome.storage.local.set({utility:i.utility},()=>{r()}),chrome.storage.sync.set({behaviour:i.behaviour,appearance:i.appearance,newtab:i.newtab},()=>{chrome.runtime.lastError,r(3)})}catch(e){t()}})})),this.call=((e,t={})=>new Promise(o=>{t.type=e,t.uid=e+"_"+JSON.stringify(t)+"_"+ +new Date+Math.random().toString(36).substr(2,12),a[t.uid]=(e=>{o(e)}),r.postMessage(t)})),this.getDefaultColor=((e,o)=>t[e]?o&&t[e][o]?t[e][o]:t[e].light:null)}})(jsu);