/*! (c) Philipp KÃ¶nig under GPL-3.0 */
(e=>{"use strict";window.ModelHelper=function(t){let o={textColor:{light:"rgb(100,100,100)",dark:"rgb(200,200,200)"},sidebarMaskColor:{light:"rgba(255,255,255,0.8)",dark:"rgba(0,0,0,0.6)"},colorScheme:{light:"rgb(27,130,241)",dark:"rgb(31,77,128)"}},i={u:{openStates:{},hiddenEntries:{},scrollPos:{},separators:{},pinnedEntries:{},entriesLocked:!1,sort:{name:"custom",dir:"ASC"},mostViewedPerMonth:!1,viewAsTree:!0},b:{animations:!0,preventPageScroll:!1,pxTolerance:{windowed:20,maximized:1},sidebarPosition:"left",language:"default",openAction:"mousedown",newTab:"foreground",newTabPosition:"afterCurrent",linkAction:"current",dirAccordion:!1,rememberState:"all",tooltipDelay:1,tooltipContent:"all",dndOpen:!0,openChildrenWarnLimit:10,dirOpenDuration:.5,scrollBarHide:1.5,openDelay:0,closeTimeout:1},n:{override:!1,initialOpen:!1,website:""},a:{showIndicator:!0,showIndicatorIcon:!0,darkMode:!1,showBookmarkIcons:!0,showDirectoryIcons:!0,styles:{colorScheme:o.colorScheme.light,textColor:o.textColor.light,indicatorWidth:"40px",indicatorIconSize:"32px",indicatorIconColor:"rgb(255,255,255)",indicatorColor:"rgba(0,0,0,0.5)",sidebarWidth:"350px",sidebarMaskColor:o.sidebarMaskColor.light,bookmarksFontSize:"14px",directoriesIconSize:"16px",bookmarksIconSize:"16px",bookmarksLineHeight:"40px",bookmarksDirIcon:"dir-1",bookmarksDirColor:o.textColor.light,bookmarksDirIndentation:"25px",bookmarksHorizontalPadding:"16px",scrollBarWidth:"11px",overlayMaskColor:"rgba(0,0,0,0.5)",fontFamily:"default",iconShape:"bookmark",iconColor:"rgb(85,85,85)"}}},a={},r=null,n={};this.init=(()=>new Promise(e=>{Promise.all([s(),l()]).then(e)}));let s=()=>new Promise(t=>{r&&r.disconnect(),(r=e.api.runtime.connect({name:"background"})).onMessage.addListener(e=>{n[e.uid]&&(n[e.uid](e.result),delete n[e.uid])}),t()}),l=()=>new Promise(t=>{let o=["utility","behaviour","appearance","newtab"],i={},r=o.length,n=0;o.forEach(o=>{e.api.storage["utility"===o?"local":"sync"].get([o],s=>{i[o]=s[o]||{},"utility"===o&&0===Object.keys(i[o]).length?e.api.storage.sync.get([o],e=>{i[o]=e[o]||{},++n===r&&(a=i,t())}):++n===r&&(a=i,t())})})});this.getAllData=(()=>a),this.getData=(e=>{let o=e;"string"==typeof o&&(o=[o]);let r={};if(o.forEach(e=>{let o=e.split("/")[0],n=e.split("/")[1],s=null,l=null;switch(o){case"u":l=a.utility;break;case"b":l=a.behaviour;break;case"a":l=a.appearance;break;case"n":l=a.newtab}null!==l&&(void 0===l[n]?(["sidebarPosition","language"].some(t=>{if(e==="b/"+t)return null!==(s=this.getData("a/"+t))&&(o="__FOUND"),!0}),void 0!==i[o]&&void 0!==i[o][n]&&(s=i[o][n])):s=l[n]);let c=location.href.search(/chrome\-extension\:\/\//)>-1&&location.pathname.search(/settings\.html$/)>-1;if("b/pxTolerance"===e&&matchMedia("(min-resolution: 1.25dppx)").matches&&!1===c&&(s=Object.assign({},s),Object.keys(s).forEach(e=>{s[e]++})),"a/styles"===e){if(s=Object.assign({},i.a.styles,s),t.helper.font&&t.helper.font.isLoaded()){let e=t.helper.font.getFontInfo();s.fontFamily=e.name,Object.assign(s,e.fontWeights)}"__color_ee"===s.colorScheme&&(s.isEE=!0,s.colorScheme="#7b5fa4")}r[n]=s}),"string"==typeof e){let t=e.split("/")[1];r=r[t]}return r}),this.setData=(t=>new Promise(o=>{l().then(()=>{Object.keys(t).forEach(e=>{let o=e.split("/")[0],i=e.split("/")[1],r=t[e];switch(o){case"u":a.utility[i]=r;break;case"b":a.behaviour[i]=r;break;case"a":a.appearance[i]=r;break;case"n":a.newtab[i]=r}});let i=0,r=(e=1)=>{(i+=e)>=3&&o()};try{e.api.storage.local.set({utility:a.utility},()=>{r()}),e.api.storage.sync.set({behaviour:a.behaviour,appearance:a.appearance},()=>{r(2)})}catch(e){o()}})})),this.call=((e,t={})=>new Promise(o=>{t.type=e,t.uid=e+"_"+JSON.stringify(t)+"_"+ +new Date+Math.random().toString(36).substr(2,12),n[t.uid]=(e=>{o(e)}),r.postMessage(t)})),this.getDefaultColor=((e,t)=>o[e]?t&&o[e][t]?o[e][t]:o[e].light:null)}})(jsu);