/*! (c) Philipp KÃ¶nig under GPL-3.0 */
(e=>{"use strict";window.onboarding=function(){let t=!1,s=!1;this.opts={elm:{body:e("body"),title:e("head > title"),sidebar:{left:e("div#sidebar")}},classes:{initLoading:"initLoading",slide:"slide",skip:"skip",close:"close",gotoSettings:"gotoSettings",hideOpenTypeIcon:"hideOpenType",large:"large",visible:"visible"},attr:{name:"data-name",value:"data-value",position:"data-position",openType:"data-openType",surface:"data-surface"},events:{sidebarOpened:"blockbyte-bs-sidebar-opened"},manifest:chrome.runtime.getManifest()},this.run=(()=>{i();let s=this.helper.template.loading().appendTo(this.opts.elm.body);t=location.href.search(/(\?|\&)skip\=1/)>-1,this.helper.model.init().then(()=>this.helper.i18n.init()).then(()=>{this.helper.font.init(),this.helper.stylesheet.init(),this.helper.stylesheet.addStylesheets(["onboarding"],e(document)),this.helper.i18n.parseHtml(document),this.opts.elm.title.text(this.opts.elm.title.text()+" - "+this.helper.i18n.get("extension_name")),this.opts.elm.sidebar.right=e(this.opts.elm.sidebar.left[0].outerHTML).appendTo(this.opts.elm.body),this.opts.elm.sidebar.right.attr(this.opts.attr.position,"right"),o(),l(),a(),n(),h(),r(),p(),this.helper.model.call("trackPageView",{page:"/onboarding",always:!t}),e.delay(500).then(()=>(this.opts.elm.body.removeClass(this.opts.classes.initLoading),t?m():c("intro"),e.delay(300))).then(()=>{s.remove()})})});let i=()=>{this.helper={i18n:new window.I18nHelper(this),font:new window.FontHelper(this),stylesheet:new window.StylesheetHelper(this),template:new window.TemplateHelper(this),model:new window.ModelHelper(this)}},o=()=>{e(window).on("beforeunload",()=>{s&&this.helper.model.call("reinitialize")})},l=()=>{e("section."+this.opts.classes.slide+"["+this.opts.attr.name+"='intro'] > a").on("click",t=>{t.preventDefault(),e(t.currentTarget).hasClass(this.opts.classes.skip)?m(!0):d()})},a=()=>{e("section."+this.opts.classes.slide+"["+this.opts.attr.name+"='position'] > a").on("mouseenter click",t=>{t.preventDefault();let i=e(t.currentTarget).attr(this.opts.attr.value);this.opts.elm.body.attr(this.opts.attr.position,i),Object.values(this.opts.elm.sidebar).forEach(e=>{e.removeClass(this.opts.classes.visible)}),this.opts.elm.sidebar[i].addClass(this.opts.classes.visible),"click"===t.type&&this.helper.model.setData({"b/sidebarPosition":i}).then(()=>{s=!0,d()})}).on("mouseleave",t=>{let s=e(t.currentTarget).parent();e.delay().then(()=>{s.hasClass(this.opts.classes.visible)&&Object.values(this.opts.elm.sidebar).forEach(e=>{e.removeClass(this.opts.classes.visible)})})})},n=()=>{e("section."+this.opts.classes.slide+"["+this.opts.attr.name+"='surface'] > a").on("mouseenter click",t=>{t.preventDefault();let i=e(t.currentTarget).attr(this.opts.attr.value);if(this.opts.elm.body.attr(this.opts.attr.surface,i),"click"===t.type){let e=this.helper.model.getData("a/styles");e.colorScheme=this.helper.model.getDefaultColor("colorScheme",i),e.textColor=this.helper.model.getDefaultColor("textColor",i),e.bookmarksDirColor=this.helper.model.getDefaultColor("textColor",i),e.sidebarMaskColor=this.helper.model.getDefaultColor("sidebarMaskColor",i),e.hoverColor=this.helper.model.getDefaultColor("hoverColor",i),Object.values(this.opts.elm.sidebar).forEach(e=>{e.removeClass(this.opts.classes.visible)}),this.helper.model.setData({"a/darkMode":"dark"===i,"a/styles":e}).then(()=>{s=!0,d()})}}).on("mouseleave",t=>{let s=e(t.currentTarget).parent();e.delay().then(()=>{s.hasClass(this.opts.classes.visible)&&this.opts.elm.body.removeAttr(this.opts.attr.surface)})})},h=()=>{e("section."+this.opts.classes.slide+"["+this.opts.attr.name+"='openAction'] > a").on("mouseenter click",t=>{t.preventDefault();let i=e(t.currentTarget).attr(this.opts.attr.value);i&&("click"===t.type?(this.opts.elm.body.addClass(this.opts.classes.hideOpenTypeIcon),this.helper.model.setData({"b/openAction":i}).then(()=>{s=!0,m()})):(this.opts.elm.body.removeClass(this.opts.classes.hideOpenTypeIcon),this.opts.elm.body.attr(this.opts.attr.openType,"icon"===i?"icon":"mouse")))}).on("mouseleave",t=>{e(t.currentTarget).parent("section").hasClass(this.opts.classes.visible)&&this.opts.elm.body.addClass(this.opts.classes.hideOpenTypeIcon)})},r=()=>{e(document).on(this.opts.events.sidebarOpened,()=>{e("section."+this.opts.classes.slide+"["+this.opts.attr.name+"='finished']").hasClass(this.opts.classes.visible)||(this.opts.elm.body.addClass(this.opts.classes.hideOpenTypeIcon),c("finished"))})},p=()=>{e("section."+this.opts.classes.slide+"["+this.opts.attr.name+"='finished'] > a").on("click",t=>{t.preventDefault(),e(t.currentTarget).hasClass(this.opts.classes.gotoSettings)?location.href=chrome.extension.getURL("html/settings.html"):e(t.currentTarget).hasClass(this.opts.classes.close)&&window.close()})},d=()=>{let t=e("section."+this.opts.classes.slide+"."+this.opts.classes.visible).next("section."+this.opts.classes.slide).attr(this.opts.attr.name);c(t)},c=s=>{e("section."+this.opts.classes.slide+"."+this.opts.classes.visible).removeClass(this.opts.classes.visible),e.delay(300).then(()=>{this.helper.model.call("trackEvent",{category:"onboarding",action:"view"+(t?"_direct":""),label:s,always:!t}),e("section."+this.opts.classes.slide+"["+this.opts.attr.name+"='"+s+"']").addClass(this.opts.classes.visible)})},m=()=>{c("handson"),b(),Object.values(this.opts.elm.sidebar).forEach(e=>{e.removeClass(this.opts.classes.visible)});let s=e("section."+this.opts.classes.slide+"["+this.opts.attr.name+"='handson']");t&&s.children("p."+this.opts.classes.large).text(this.helper.i18n.get("onboarding_handson_desc_direct"));let i=this.helper.model.getData(["b/openAction","b/sidebarPosition"]);if(this.opts.elm.body.attr(this.opts.attr.position,i.sidebarPosition),"icon"===i.openAction)e("<p />").text(this.helper.i18n.get("onboarding_handson_icon_desc")).appendTo(s);else{let t=this.helper.i18n.get("onboarding_"+i.sidebarPosition);if(e("<p />").text(this.helper.i18n.get("onboarding_handson_mouse_desc_1",[t])).appendTo(s),"mousemove"!==i.openAction){let t=this.helper.i18n.get("onboarding_"+("contextmenu"===i.openAction?"right":"left"));e("<p />").text(this.helper.i18n.get("onboarding_handson_mouse_desc_2",[t])).appendTo(s)}}e.delay(300).then(()=>{this.opts.elm.body.removeClass(this.opts.classes.hideOpenTypeIcon),this.opts.elm.body.attr(this.opts.attr.openType,"icon"===i.openAction?"icon":"mouse")})},b=()=>{this.opts.manifest.content_scripts[0].css.forEach(t=>{e("head").append("<link href='"+chrome.extension.getURL(t)+"' type='text/css' rel='stylesheet' />")});let t=(e=0)=>{let s=this.opts.manifest.content_scripts[0].js[e];if(void 0!==s){let i=document.createElement("script");document.head.appendChild(i),i.onload=(()=>t(e+1)),i.src="/"+s}};t()}},(new window.onboarding).run()})(jsu);